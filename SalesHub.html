<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OD Sales Hub â€” Ryan Wolpe</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Mono:wght@400;500&family=Instrument+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#080c10;
  --surface:#0d1219;
  --card:#111820;
  --card2:#161e28;
  --border:rgba(255,255,255,0.06);
  --border2:rgba(255,255,255,0.1);
  --text:#e8edf2;
  --muted:#5a6a7a;
  --muted2:#8a9aaa;
  --accent:#00d4aa;
  --accent2:#0099ff;
  --accent3:#ff6b35;
  --accent4:#a855f7;
  --gold:#f0b429;
  --red:#ef4444;
  --green:#22c55e;
  --yellow:#eab308;
  --radius:10px;
  --radius2:16px;
}
html,body{height:100%;overflow:hidden}
body{background:var(--bg);color:var(--text);font-family:'Instrument Sans',sans-serif;font-size:14px;display:flex;flex-direction:column}

/* â”€â”€ TOPBAR â”€â”€ */
.topbar{
  display:flex;align-items:center;gap:0;
  height:52px;background:var(--surface);
  border-bottom:1px solid var(--border);
  flex-shrink:0;position:relative;z-index:100;
}
.topbar-logo{
  padding:0 24px;display:flex;align-items:center;gap:10px;
  border-right:1px solid var(--border);height:100%;
  font-family:'Syne',sans-serif;font-weight:800;font-size:16px;
  letter-spacing:-0.02em;white-space:nowrap;
}
.topbar-logo .od{color:var(--accent)}
.topbar-logo .badge{
  background:rgba(0,212,170,0.12);border:1px solid rgba(0,212,170,0.25);
  border-radius:4px;padding:2px 7px;font-size:10px;font-weight:600;
  color:var(--accent);font-family:'DM Mono',monospace;letter-spacing:0.05em;
}
.topbar-nav{display:flex;align-items:center;height:100%;flex:1}
.nav-item{
  height:100%;display:flex;align-items:center;padding:0 18px;
  font-size:13px;font-weight:500;color:var(--muted2);cursor:pointer;
  border-bottom:2px solid transparent;transition:all 0.15s;white-space:nowrap;
  border-right:1px solid var(--border);gap:6px;
}
.nav-item:hover{color:var(--text);background:rgba(255,255,255,0.03)}
.nav-item.active{color:var(--accent);border-bottom-color:var(--accent);background:rgba(0,212,170,0.04)}
.nav-item .nav-icon{font-size:14px;opacity:0.8}
.topbar-right{
  margin-left:auto;padding:0 20px;display:flex;align-items:center;gap:12px;
  border-left:1px solid var(--border);height:100%;
}
.user-chip{
  display:flex;align-items:center;gap:8px;
  background:var(--card);border:1px solid var(--border);
  border-radius:20px;padding:4px 12px 4px 6px;cursor:pointer;
}
.user-avatar{
  width:26px;height:26px;border-radius:50%;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  display:flex;align-items:center;justify-content:center;
  font-size:11px;font-weight:700;color:#000;
}
.user-name{font-size:12px;font-weight:600;color:var(--text)}
.date-chip{
  font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);
  background:var(--card);border:1px solid var(--border);
  border-radius:6px;padding:4px 10px;
}

/* â”€â”€ LAYOUT â”€â”€ */
.app-body{display:flex;flex:1;overflow:hidden}
.sidebar{
  width:0;flex-shrink:0;overflow:hidden;
  background:var(--surface);border-right:1px solid var(--border);
  transition:width 0.2s ease;
}
.main{flex:1;overflow-y:auto;overflow-x:hidden}

/* â”€â”€ PANELS â”€â”€ */
.panel{display:none;padding:28px 32px;min-height:100%}
.panel.active{display:block}

/* â”€â”€ PAGE HEADERS â”€â”€ */
.page-header{margin-bottom:28px}
.page-header h1{
  font-family:'Syne',sans-serif;font-weight:800;font-size:26px;
  letter-spacing:-0.03em;margin-bottom:4px;
}
.page-header .sub{font-size:13px;color:var(--muted2);font-weight:400}

/* â”€â”€ STAT CARDS â”€â”€ */
.stat-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:24px}
.stat-card{
  background:var(--card);border:1px solid var(--border);
  border-radius:var(--radius);padding:16px 18px;position:relative;overflow:hidden;
  display:flex;flex-direction:column;justify-content:space-between;min-height:100px;
}
.stat-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
}
.stat-card.c1::before{background:var(--accent)}
.stat-card.c2::before{background:var(--accent2)}
.stat-card.c3::before{background:var(--gold)}
.stat-card.c4::before{background:var(--accent3)}
.stat-card.c5::before{background:var(--accent4)}
.stat-label{font-size:11px;color:var(--muted);font-weight:500;letter-spacing:0.05em;text-transform:uppercase;margin-bottom:8px;font-family:'DM Mono',monospace}
.stat-value{font-family:'Syne',sans-serif;font-size:32px;font-weight:800;letter-spacing:-0.03em;line-height:1}
.stat-sub{font-size:11px;color:var(--muted2);margin-top:6px}
.stat-delta{font-size:11px;font-weight:600;margin-top:4px}
.stat-delta.up{color:var(--green)}
.stat-delta.down{color:var(--red)}

/* â”€â”€ CARDS â”€â”€ */
.card{
  background:var(--card);border:1px solid var(--border);
  border-radius:var(--radius2);overflow:hidden;margin-bottom:20px;
}
.card-header{
  padding:16px 20px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
}
.card-title{font-family:'Syne',sans-serif;font-weight:700;font-size:14px;letter-spacing:-0.01em}
.card-body{padding:20px}

/* â”€â”€ BUTTONS â”€â”€ */
.btn{
  display:inline-flex;align-items:center;gap:6px;
  padding:8px 16px;border-radius:8px;font-size:13px;font-weight:600;
  cursor:pointer;border:none;transition:all 0.15s;white-space:nowrap;
  font-family:'Instrument Sans',sans-serif;
}
.btn-primary{background:var(--accent);color:#000}
.btn-primary:hover{background:#00bfa0;transform:translateY(-1px)}
.btn-secondary{background:var(--card2);color:var(--text);border:1px solid var(--border2)}
.btn-secondary:hover{background:var(--card);border-color:var(--border2)}
.btn-danger{background:rgba(239,68,68,0.15);color:var(--red);border:1px solid rgba(239,68,68,0.2)}
.btn-ghost{background:transparent;color:var(--muted2);border:1px solid var(--border)}
.btn-ghost:hover{color:var(--text);border-color:var(--border2)}
.btn-sm{padding:5px 10px;font-size:12px}
.btn-xs{padding:3px 8px;font-size:11px;border-radius:5px}
.btn-icon{padding:7px;border-radius:7px;font-size:14px}

/* â”€â”€ TABLES â”€â”€ */
.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse}
th{
  text-align:left;padding:10px 14px;font-size:11px;font-weight:600;
  color:var(--muted);text-transform:uppercase;letter-spacing:0.06em;
  border-bottom:1px solid var(--border);font-family:'DM Mono',monospace;
  background:var(--surface);white-space:nowrap;
}
td{
  padding:12px 14px;border-bottom:1px solid var(--border);
  font-size:13px;vertical-align:middle;
}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(255,255,255,0.02)}
tr.selected td{background:rgba(0,212,170,0.05)}

/* â”€â”€ BADGES â”€â”€ */
.badge{
  display:inline-flex;align-items:center;gap:4px;
  border-radius:5px;padding:2px 8px;font-size:11px;font-weight:600;
  font-family:'DM Mono',monospace;white-space:nowrap;
}
.badge-green{background:rgba(34,197,94,0.12);color:var(--green);border:1px solid rgba(34,197,94,0.2)}
.badge-purple{background:rgba(155,89,182,0.15);color:#9b59b6;border-color:rgba(155,89,182,0.3)}
.badge-teal{background:rgba(0,212,170,0.15);color:#00d4aa;border-color:rgba(0,212,170,0.3)}
.badge-orange{background:rgba(230,126,34,0.15);color:#e67e22;border-color:rgba(230,126,34,0.3)}
.badge-red{background:rgba(231,76,60,0.15);color:#e74c3c;border-color:rgba(231,76,60,0.3)}
.badge-blue{background:rgba(0,153,255,0.12);color:var(--accent2);border:1px solid rgba(0,153,255,0.2)}
.badge-orange{background:rgba(255,107,53,0.12);color:var(--accent3);border:1px solid rgba(255,107,53,0.2)}
.badge-purple{background:rgba(168,85,247,0.12);color:var(--accent4);border:1px solid rgba(168,85,247,0.2)}
.badge-gold{background:rgba(240,180,41,0.12);color:var(--gold);border:1px solid rgba(240,180,41,0.2)}
.badge-red{background:rgba(239,68,68,0.12);color:var(--red);border:1px solid rgba(239,68,68,0.2)}
.badge-muted{background:rgba(255,255,255,0.06);color:var(--muted2);border:1px solid var(--border)}
.badge-accent{background:rgba(0,212,170,0.12);color:var(--accent);border:1px solid rgba(0,212,170,0.2)}

/* â”€â”€ STATUS DOTS â”€â”€ */
.status-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.dot-green{background:var(--green)}
.dot-blue{background:var(--accent2)}
.dot-gold{background:var(--gold)}
.dot-orange{background:var(--accent3)}
.dot-red{background:var(--red)}
.dot-muted{background:var(--muted)}

/* â”€â”€ SCORE BAR â”€â”€ */
.score-bar{display:flex;align-items:center;gap:8px}
.score-track{flex:1;height:5px;background:rgba(255,255,255,0.08);border-radius:3px;overflow:hidden;min-width:60px}
.score-fill{height:100%;border-radius:3px;transition:width 0.3s}
.score-num{font-family:'DM Mono',monospace;font-size:11px;font-weight:500;width:28px;text-align:right}

/* â”€â”€ FORMS â”€â”€ */
.form-group{margin-bottom:16px}
.form-label{font-size:12px;font-weight:600;color:var(--muted2);margin-bottom:6px;display:block;text-transform:uppercase;letter-spacing:0.04em;font-family:'DM Mono',monospace}
.form-input,.form-select,.form-textarea{
  width:100%;background:var(--surface);border:1px solid var(--border2);
  border-radius:8px;padding:10px 14px;font-size:13px;color:var(--text);
  font-family:'Instrument Sans',sans-serif;outline:none;transition:border-color 0.15s;
}
.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--accent)}
.form-textarea{resize:vertical;min-height:100px;line-height:1.6}
.form-select option{background:var(--card)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px}

/* â”€â”€ SEARCH BAR â”€â”€ */
.search-wrap{position:relative;margin-bottom:16px}
.search-input{
  width:100%;background:var(--surface);border:1px solid var(--border);
  border-radius:8px;padding:9px 14px 9px 38px;font-size:13px;color:var(--text);
  font-family:'Instrument Sans',sans-serif;outline:none;
}
.search-input:focus{border-color:var(--accent)}
.search-icon{position:absolute;left:13px;top:50%;transform:translateY(-50%);color:var(--muted);font-size:14px}

/* â”€â”€ TAGS â”€â”€ */
.tag{
  display:inline-flex;align-items:center;gap:4px;
  background:rgba(255,255,255,0.06);border:1px solid var(--border);
  border-radius:4px;padding:2px 8px;font-size:11px;color:var(--muted2);
  cursor:pointer;transition:all 0.15s;
}
.tag:hover,.tag.active{background:rgba(0,212,170,0.1);border-color:rgba(0,212,170,0.3);color:var(--accent)}
.tag-remove{opacity:0.5;font-size:10px;margin-left:2px;cursor:pointer}
.tag-remove:hover{opacity:1;color:var(--red)}

/* â”€â”€ KANBAN â”€â”€ */
.kanban{display:grid;grid-template-columns:repeat(8,minmax(160px,1fr));gap:10px;align-items:start;overflow-x:auto;padding-bottom:8px}
.kanban-col.drag-over{border:2px dashed var(--accent)!important;background:rgba(0,212,170,0.06)!important}
.kanban-card{cursor:grab;transition:transform 0.15s,box-shadow 0.15s}
.kanban-card:active{cursor:grabbing}
.kanban-card.dragging{opacity:0.4;transform:scale(0.97)}
.kanban-card.drag-ghost{box-shadow:0 8px 32px rgba(0,0,0,0.5);transform:rotate(1.5deg);opacity:0.95}
.kanban-col{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius2);overflow:hidden}
.kanban-header{
  padding:12px 14px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
}
.kanban-title{font-size:12px;font-weight:700;letter-spacing:0.02em;display:flex;align-items:center;gap:7px}
.kanban-count{
  background:rgba(255,255,255,0.08);border-radius:10px;
  padding:1px 7px;font-size:11px;font-family:'DM Mono',monospace;
}
.kanban-body{padding:10px;display:flex;flex-direction:column;gap:8px;min-height:200px}
.kanban-card{
  background:var(--card);border:1px solid var(--border);
  border-radius:var(--radius);padding:12px;cursor:pointer;
  transition:all 0.15s;
}
.kanban-card:hover{border-color:var(--border2);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.3)}
.kanban-card-name{font-size:13px;font-weight:600;margin-bottom:4px}
.kanban-card-meta{font-size:11px;color:var(--muted2);display:flex;align-items:center;gap:8px;flex-wrap:wrap}

/* â”€â”€ SIGNAL CARDS â”€â”€ */
.signal-item{
  display:flex;gap:12px;padding:14px 0;border-bottom:1px solid var(--border);
  align-items:flex-start;
}
.signal-item:last-child{border-bottom:none}
.signal-icon{
  width:34px;height:34px;border-radius:8px;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;font-size:15px;
}
.sig-funding{background:rgba(240,180,41,0.12);border:1px solid rgba(240,180,41,0.2)}
.sig-launch{background:rgba(0,212,170,0.1);border:1px solid rgba(0,212,170,0.2)}
.sig-hire{background:rgba(0,153,255,0.1);border:1px solid rgba(0,153,255,0.2)}
.sig-nil{background:rgba(168,85,247,0.1);border:1px solid rgba(168,85,247,0.2)}
.sig-campaign{background:rgba(255,107,53,0.1);border:1px solid rgba(255,107,53,0.2)}
.sig-retail{background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.2)}
.signal-content{flex:1;min-width:0}
.signal-account{font-size:12px;font-weight:700;color:var(--accent);margin-bottom:2px}
.signal-text{font-size:13px;line-height:1.5;margin-bottom:5px}
.signal-meta{font-size:11px;color:var(--muted);display:flex;align-items:center;gap:10px;font-family:'DM Mono',monospace}
.signal-strength{display:flex;align-items:center;gap:4px}
.strength-dot{width:5px;height:5px;border-radius:50%}

/* â”€â”€ AI COMPOSER â”€â”€ */
.composer-wrap{display:grid;grid-template-columns:320px 1fr;gap:20px;height:calc(100vh - 180px)}
.composer-sidebar{display:flex;flex-direction:column;gap:14px;overflow-y:auto}
.composer-main{display:flex;flex-direction:column;gap:14px}
.account-select-card{
  background:var(--card);border:1px solid var(--border);
  border-radius:var(--radius2);padding:16px;
}
.output-tabs{display:flex;gap:6px;margin-bottom:14px}
.output-tab{
  padding:6px 14px;border-radius:6px;font-size:12px;font-weight:600;
  cursor:pointer;border:1px solid var(--border);color:var(--muted2);
  transition:all 0.15s;
}
.output-tab.active{background:rgba(0,212,170,0.1);border-color:rgba(0,212,170,0.3);color:var(--accent)}
.output-area{
  flex:1;background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius2);padding:0;font-size:13px;line-height:1.8;
  color:var(--text);overflow-y:auto;min-height:300px;position:relative;
}
.output-area.loading{display:flex;align-items:center;justify-content:center;color:var(--muted);padding:40px}
.output-placeholder{color:var(--muted);font-style:italic;text-align:center;margin-top:60px;padding:20px}
.output-raw{padding:20px;white-space:pre-wrap;font-size:13px;line-height:1.8}

/* â”€â”€ GMAIL MOCKUP â”€â”€ */
.gmail-mockup{background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,0.15)}
.gmail-chrome{background:#f1f3f4;padding:8px 14px;display:flex;align-items:center;gap:8px;border-bottom:1px solid #e0e0e0}
.gmail-dot{width:12px;height:12px;border-radius:50%}
.gmail-title{font-size:11px;color:#666;font-family:'DM Mono',monospace;margin:0 auto}
.gmail-header{padding:16px 20px 12px;border-bottom:1px solid #e8eaed}
.gmail-field{display:flex;gap:8px;margin-bottom:6px;font-size:13px;color:#202124}
.gmail-field-label{color:#999;min-width:40px;font-size:12px;padding-top:1px}
.gmail-subject{font-weight:600;color:#202124}
.gmail-body{padding:20px;font-size:14px;line-height:1.7;color:#202124;white-space:pre-wrap}
.gmail-body strong{color:#1a1a1a}
.gmail-footer{padding:14px 20px;border-top:1px solid #e8eaed;display:flex;gap:10px}
.gmail-btn-send{background:#1a73e8;color:#fff;border:none;border-radius:4px;padding:8px 18px;font-size:13px;font-weight:500;cursor:pointer}
.gmail-btn-secondary{background:none;border:1px solid #dadce0;border-radius:4px;padding:8px 14px;font-size:13px;color:#444;cursor:pointer}

/* â”€â”€ NIL CONCEPT CARDS â”€â”€ */
.nil-concepts-grid{padding:16px;display:flex;flex-direction:column;gap:14px}
.nil-concept-card{background:var(--card);border:1px solid var(--border);border-radius:10px;overflow:hidden}
.nil-concept-header{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border2)}
.nil-concept-num{font-family:'Syne',sans-serif;font-size:28px;font-weight:800;color:var(--border2);line-height:1;min-width:32px}
.nil-concept-title{font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:var(--text);letter-spacing:-0.01em;text-transform:uppercase}
.nil-concept-meta{font-size:11px;color:var(--accent);font-family:'DM Mono',monospace;margin-top:2px;letter-spacing:0.04em}
.nil-concept-badges{display:flex;gap:6px;flex-wrap:wrap;margin-left:auto}
.nil-concept-badge{padding:3px 8px;border-radius:4px;font-size:10px;font-weight:700;letter-spacing:0.05em;text-transform:uppercase}
.nil-concept-body{padding:14px 16px;display:grid;grid-template-columns:1fr 1fr;gap:10px}
.nil-concept-field{font-size:12px}
.nil-concept-field-label{color:var(--muted2);font-family:'DM Mono',monospace;font-size:10px;letter-spacing:0.06em;text-transform:uppercase;margin-bottom:3px}
.nil-concept-field-val{color:var(--text);line-height:1.4}
.nil-concept-angle{padding:12px 16px;background:rgba(0,212,170,0.06);border-top:1px solid var(--border2);grid-column:span 2;font-size:13px;color:var(--text2);line-height:1.5;font-style:italic}
.nil-concept-why{padding:10px 16px;background:rgba(251,191,36,0.07);border-top:1px solid var(--border2);font-size:11px;color:var(--gold);display:flex;gap:8px;align-items:flex-start}

/* â”€â”€ CALL PREP CARD â”€â”€ */
.call-prep-card{padding:16px;display:flex;flex-direction:column;gap:12px}
.call-prep-section{background:var(--card);border:1px solid var(--border);border-radius:8px;overflow:hidden}
.call-prep-section-header{padding:10px 14px;background:rgba(0,0,0,0.15);border-bottom:1px solid var(--border2);display:flex;align-items:center;gap:8px}
.call-prep-section-label{font-family:'DM Mono',monospace;font-size:10px;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:var(--muted2)}
.call-prep-section-body{padding:14px;font-size:13px;color:var(--text2);line-height:1.6}
.call-prep-section-body strong{color:var(--text)}
.call-prep-tag{padding:2px 7px;border-radius:4px;font-size:10px;font-weight:700;background:rgba(0,212,170,0.1);color:var(--accent);margin-left:auto}

/* â”€â”€ LINKEDIN CARD â”€â”€ */
.linkedin-mockup{background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,0.15)}
.linkedin-header{background:#0a66c2;padding:12px 16px;display:flex;align-items:center;gap:10px}
.linkedin-avatar{width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,0.2);display:flex;align-items:center;justify-content:center;font-size:16px}
.linkedin-sender{color:#fff;font-size:13px;font-weight:600}
.linkedin-sender-title{color:rgba(255,255,255,0.7);font-size:11px}
.linkedin-body{padding:20px;font-size:14px;line-height:1.6;color:#1c1c1c;min-height:80px}
.linkedin-char-count{padding:8px 20px 16px;font-size:11px;color:#666;font-family:'DM Mono',monospace}
.linkedin-footer{padding:10px 16px;border-top:1px solid #e0e0e0;display:flex;gap:8px}
.linkedin-btn-send{background:#0a66c2;color:#fff;border:none;border-radius:20px;padding:7px 18px;font-size:12px;font-weight:600;cursor:pointer}

/* â”€â”€ ACCOUNT DETAIL DRAWER â”€â”€ */
.drawer-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:200;
  opacity:0;pointer-events:none;transition:opacity 0.2s;
}
.drawer-overlay.open{opacity:1;pointer-events:all}
.drawer{
  position:fixed;right:0;top:0;bottom:0;width:560px;
  background:var(--surface);border-left:1px solid var(--border);
  z-index:201;transform:translateX(100%);transition:transform 0.25s cubic-bezier(0.4,0,0.2,1);
  display:flex;flex-direction:column;overflow:hidden;
}
.drawer.open{transform:translateX(0)}
.drawer-header{
  padding:20px 24px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;flex-shrink:0;
}
.drawer-body{flex:1;overflow-y:auto;padding:24px}
.drawer-close{
  width:30px;height:30px;border-radius:6px;background:var(--card);
  border:1px solid var(--border);cursor:pointer;display:flex;
  align-items:center;justify-content:center;font-size:16px;color:var(--muted2);
  transition:all 0.15s;
}
.drawer-close:hover{color:var(--text);border-color:var(--border2)}

/* â”€â”€ UPLOAD ZONE â”€â”€ */
.upload-zone{
  border:2px dashed var(--border2);border-radius:var(--radius2);
  padding:48px 24px;text-align:center;cursor:pointer;transition:all 0.2s;
}
.upload-zone:hover,.upload-zone.drag{border-color:var(--accent);background:rgba(0,212,170,0.04)}
.upload-zone .upload-icon{font-size:40px;margin-bottom:12px;display:block}
.upload-zone h3{font-family:'Syne',sans-serif;font-weight:700;font-size:16px;margin-bottom:6px}
.upload-zone p{font-size:13px;color:var(--muted2)}

/* â”€â”€ FILTERS â”€â”€ */
.filter-bar{display:flex;align-items:center;gap:10px;margin-bottom:18px;flex-wrap:wrap}
.filter-chip{
  padding:5px 12px;border-radius:20px;font-size:12px;font-weight:500;
  border:1px solid var(--border);color:var(--muted2);cursor:pointer;transition:all 0.15s;
}
.filter-chip:hover{border-color:var(--border2);color:var(--text)}
.filter-chip.active{background:rgba(0,212,170,0.1);border-color:rgba(0,212,170,0.3);color:var(--accent)}

/* â”€â”€ PRIORITY RING â”€â”€ */
.priority-ring{
  width:38px;height:38px;border-radius:50%;display:flex;align-items:center;
  justify-content:center;font-family:'Syne',sans-serif;font-weight:800;font-size:13px;
  flex-shrink:0;border:2px solid;
}
.ring-hot{border-color:var(--red);color:var(--red);background:rgba(239,68,68,0.08)}
.ring-high{border-color:var(--gold);color:var(--gold);background:rgba(240,180,41,0.08)}
.ring-medium{border-color:var(--accent2);color:var(--accent2);background:rgba(0,153,255,0.08)}
.ring-low{border-color:var(--muted);color:var(--muted);background:rgba(255,255,255,0.04)}

/* â”€â”€ MODAL â”€â”€ */
.modal-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:300;
  display:none;align-items:center;justify-content:center;
}
.modal-overlay.open{display:flex}
.modal{
  background:var(--card);border:1px solid var(--border2);
  border-radius:var(--radius2);width:560px;max-height:85vh;
  overflow-y:auto;box-shadow:0 24px 80px rgba(0,0,0,0.6);
}
.modal-header{
  padding:20px 24px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;
  background:var(--card);z-index:1;
}
.modal-header h2{font-family:'Syne',sans-serif;font-size:17px;font-weight:700}
.modal-body{padding:24px}
.modal-footer{
  padding:16px 24px;border-top:1px solid var(--border);
  display:flex;justify-content:flex-end;gap:10px;
  position:sticky;bottom:0;background:var(--card);
}

/* â”€â”€ TOAST â”€â”€ */
.toast-container{position:fixed;bottom:24px;right:24px;z-index:500;display:flex;flex-direction:column;gap:8px}
.toast{
  background:var(--card2);border:1px solid var(--border2);
  border-radius:10px;padding:12px 16px;font-size:13px;
  box-shadow:0 8px 32px rgba(0,0,0,0.4);display:flex;align-items:center;gap:10px;
  animation:slideIn 0.25s ease;max-width:320px;
}
@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:none;opacity:1}}
.toast.success .toast-icon{color:var(--green)}
.toast.error .toast-icon{color:var(--red)}
.toast.info .toast-icon{color:var(--accent)}

/* â”€â”€ LOADERS â”€â”€ */
.spinner{
  width:20px;height:20px;border:2px solid rgba(255,255,255,0.1);
  border-top-color:var(--accent);border-radius:50%;
  animation:spin 0.8s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
.pulse{animation:pulse 1.5s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}

/* â”€â”€ SCROLLBAR â”€â”€ */
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,0.2)}

/* â”€â”€ NIL SCORE â”€â”€ */
.nil-score{
  display:inline-flex;align-items:center;gap:6px;
  font-family:'DM Mono',monospace;font-size:12px;font-weight:500;
}
.nil-score .score-num{
  font-weight:700;font-size:14px;
}

/* â”€â”€ EMPTY STATE â”€â”€ */
.empty-state{
  text-align:center;padding:60px 24px;color:var(--muted);
}
.empty-state .empty-icon{font-size:48px;margin-bottom:16px;display:block;opacity:0.4}
.empty-state h3{font-family:'Syne',sans-serif;font-size:17px;color:var(--muted2);margin-bottom:8px}
.empty-state p{font-size:13px;max-width:300px;margin:0 auto}

/* â”€â”€ DASHBOARD TOP 15 â”€â”€ */
.top15-grid{display:flex;flex-direction:column;gap:8px}
.top15-item{
  display:flex;align-items:center;gap:14px;
  background:var(--card);border:1px solid var(--border);
  border-radius:var(--radius);padding:12px 16px;cursor:pointer;
  transition:all 0.15s;
}
.top15-item:hover{border-color:var(--border2);background:var(--card2)}
.top15-rank{
  font-family:'Syne',sans-serif;font-weight:800;font-size:18px;
  color:var(--muted);width:28px;text-align:center;flex-shrink:0;
}
.top15-rank.top3{color:var(--gold)}
.top15-info{flex:1;min-width:0}
.top15-name{font-weight:700;font-size:14px;margin-bottom:2px}
.top15-signals{font-size:12px;color:var(--muted2);display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.top15-actions{display:flex;gap:8px;flex-shrink:0}

/* â”€â”€ SECTION TABS â”€â”€ */
.section-tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:20px}
.section-tab{
  padding:10px 18px;font-size:13px;font-weight:600;cursor:pointer;
  border-bottom:2px solid transparent;color:var(--muted2);transition:all 0.15s;margin-bottom:-1px;
}
.section-tab:hover{color:var(--text)}
.section-tab.active{color:var(--accent);border-bottom-color:var(--accent)}

/* â”€â”€ GRID LAYOUTS â”€â”€ */
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px;align-items:stretch;margin-bottom:24px}
.grid-2 > div{display:flex;flex-direction:column}
.grid-2 > div > .card:last-child{flex:1}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}

/* â”€â”€ API CONFIG NOTICE â”€â”€ */
.api-notice{
  background:rgba(240,180,41,0.08);border:1px solid rgba(240,180,41,0.2);
  border-radius:var(--radius);padding:12px 16px;font-size:12px;
  color:var(--gold);margin-bottom:16px;display:flex;align-items:center;gap:8px;
}

/* â”€â”€ CONTACT CARD â”€â”€ */
.contact-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);padding:14px;display:flex;align-items:center;gap:12px;
}
.contact-avatar{
  width:38px;height:38px;border-radius:50%;flex-shrink:0;
  background:linear-gradient(135deg,var(--accent2),var(--accent4));
  display:flex;align-items:center;justify-content:center;
  font-weight:700;font-size:14px;color:white;
}
.contact-info{flex:1;min-width:0}
.contact-name{font-weight:700;font-size:13px;margin-bottom:2px}
.contact-role{font-size:11px;color:var(--muted2);margin-bottom:3px}
.contact-email{font-size:11px;color:var(--accent);font-family:'DM Mono',monospace}

/* â”€â”€ NEWS SIGNAL BADGE â”€â”€ */
.news-signal{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);padding:12px 14px;margin-bottom:8px;
}
.news-signal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.news-source{font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:0.08em}
.news-headline{font-size:13px;font-weight:600;line-height:1.4;margin-bottom:4px}
.news-summary{font-size:12px;color:var(--muted2);line-height:1.5}

/* â”€â”€ PROGRESS BAR â”€â”€ */
.progress-bar{height:4px;background:rgba(255,255,255,0.06);border-radius:2px;overflow:hidden}
.progress-fill{height:100%;border-radius:2px;transition:width 1s ease}

/* â”€â”€ SETTINGS â”€â”€ */
.settings-section{margin-bottom:28px}
.settings-section h3{
  font-family:'Syne',sans-serif;font-weight:700;font-size:14px;
  margin-bottom:14px;padding-bottom:8px;border-bottom:1px solid var(--border);
}
.setting-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:12px 0;border-bottom:1px solid rgba(255,255,255,0.03);
}
.setting-info .setting-name{font-size:13px;font-weight:600;margin-bottom:2px}
.setting-info .setting-desc{font-size:12px;color:var(--muted2)}
.toggle{
  width:42px;height:24px;border-radius:12px;background:var(--surface);
  border:1px solid var(--border2);cursor:pointer;position:relative;transition:background 0.2s;
  flex-shrink:0;
}
.toggle.on{background:var(--accent);border-color:var(--accent)}
.toggle::after{
  content:'';position:absolute;top:3px;left:3px;width:16px;height:16px;
  border-radius:50%;background:white;transition:transform 0.2s;
  box-shadow:0 1px 3px rgba(0,0,0,0.3);
}
.toggle.on::after{transform:translateX(18px)}
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="topbar-logo">
    <span><span class="od">OD</span> Sales Hub</span>
    <span class="badge">BETA</span>
  </div>
  <nav class="topbar-nav">
    <div class="nav-item active" onclick="showPanel('dashboard')"><span class="nav-icon">âš¡</span>Dashboard</div>
    <div class="nav-item" onclick="showPanel('accounts')"><span class="nav-icon">ğŸ¢</span>Accounts</div>
    <div class="nav-item" onclick="showPanel('pipeline')"><span class="nav-icon">ğŸ“Š</span>Pipeline</div>
    <div class="nav-item" onclick="showPanel('signals')"><span class="nav-icon">ğŸ“¡</span>Signals</div>
    <div class="nav-item" onclick="showPanel('composer')"><span class="nav-icon">âœï¸</span>AI Composer</div>
    <div class="nav-item" onclick="showPanel('discovery')"><span class="nav-icon">ğŸ”</span>Discovery</div>
    <div class="nav-item" onclick="showPanel('settings')"><span class="nav-icon">âš™ï¸</span>Settings</div>
  </nav>
  <div class="topbar-right">
    <div class="date-chip" id="datechip"></div>
    <div class="user-chip">
      <div class="user-avatar">RW</div>
      <div class="user-name">Ryan Wolpe</div>
    </div>
  </div>
</div>

<div class="app-body">
<div class="main">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="panel-dashboard" class="panel active">
  <div class="page-header">
    <h1 id="dash-greeting">Good morning, Ryan â˜€ï¸</h1>
    <div class="sub">Your outbound intelligence briefing â€” <span id="dash-date"></span></div>
  </div>

  <div style="display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap">
    <button class="btn btn-primary" onclick="showPanel('composer')">âœï¸ Compose Outreach</button>
    <button class="btn btn-secondary" onclick="showPanel('signals');runSignalScan()">ğŸ“¡ Scan Hot Accounts</button>
    <button class="btn btn-secondary" onclick="showPanel('discovery')">ğŸ” Score a Brand</button>
    <button class="btn btn-ghost" onclick="exportData()">ğŸ“¥ Export Backup</button>
  </div>

  <div class="stat-grid">
    <div class="stat-card c1" onclick="showPanel('accounts')" style="cursor:pointer" title="View all accounts">
      <div class="stat-label">Total Accounts</div>
      <div class="stat-value" id="stat-total">0</div>
      <div class="stat-sub">in your book â†’</div>
    </div>
    <div class="stat-card c2" onclick="showPanel('pipeline')" style="cursor:pointer" title="View pipeline">
      <div class="stat-label">Active Pipeline</div>
      <div class="stat-value" id="stat-active">0</div>
      <div class="stat-sub">view pipeline â†’</div>
    </div>
    <div class="stat-card c3" onclick="showPanel('pipeline');setTimeout(()=>{document.querySelectorAll('.kanban-col').forEach(c=>c.style.opacity=c.dataset.stage==='meeting'?'1':'0.3')},300)" style="cursor:pointer" title="View meetings in pipeline">
      <div class="stat-label">Meetings Booked</div>
      <div class="stat-value" id="stat-meetings">0</div>
      <div class="stat-sub">view pipeline â†’</div>
    </div>
    <div class="stat-card c4" onclick="document.getElementById('follow-up-queue').scrollIntoView({behavior:'smooth'})" style="cursor:pointer" title="View follow-up queue">
      <div class="stat-label">Follow-ups Due</div>
      <div class="stat-value" id="stat-followups">0</div>
      <div class="stat-sub">jump to queue â†’</div>
    </div>
    <div class="stat-card c5" onclick="showPanel('signals')" style="cursor:pointer" title="View signals">
      <div class="stat-label">Intent Signals</div>
      <div class="stat-value" id="stat-signals">0</div>
      <div class="stat-sub">detected Â· <span id="stat-nil-inline">â€”</span> avg NIL â†’</div>
    </div>
  </div>


  <div class="grid-2">
    <div>
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">âš¡ Today's Top 15 Targets</div>
            <div id="top15-subtitle" style="font-size:11px;color:var(--muted);margin-top:2px">Loading...</div>
          </div>
          <button class="btn btn-sm btn-secondary" onclick="loadAndRenderDailyTargets(true)">â†» Refresh</button>
        </div>
        <div class="card-body" style="padding:12px">
          <div class="top15-grid" id="top15-list">
            <div class="empty-state">
              <span class="empty-icon">ğŸ¯</span>
              <h3>No accounts yet</h3>
              <p>Upload your account CSV to see today's priority targets</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div>
      <div class="card" style="flex:1;display:flex;flex-direction:column">
        <div class="card-header">
          <div class="card-title">ğŸ“¡ Latest Intent Signals</div>
          <button class="btn btn-sm btn-secondary" onclick="showPanel('signals')">View All</button>
        </div>
        <div class="card-body" style="padding:8px 16px;flex:1;overflow-y:auto">
          <div id="dash-signals">
            <div class="empty-state" style="padding:30px">
              <span class="empty-icon" style="font-size:32px">ğŸ“¡</span>
              <h3>No signals yet</h3>
              <p>Scan your accounts to surface intent signals</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pipeline Summary â€” full width -->
  <div class="card" style="margin-bottom:24px">
    <div class="card-header">
      <div class="card-title">ğŸ“‹ Pipeline Summary</div>
    </div>
    <div class="card-body" style="padding:16px 20px">
      <div id="pipeline-summary" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px"></div>
    </div>
  </div>

  <!-- Follow-up Queue -->
  <div style="margin-bottom:24px">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
      <div style="font-family:'Syne',sans-serif;font-size:14px;font-weight:800;text-transform:uppercase;letter-spacing:0.05em;display:flex;align-items:center;gap:8px">
        <span>ğŸ”¥</span> Follow-Up Queue
        <span id="queue-stale-count" style="font-size:11px;font-weight:400;color:var(--muted)"></span>
      </div>
      <button onclick="renderFollowUpQueue()" style="background:none;border:1px solid var(--border);color:var(--muted);font-size:10px;font-weight:700;cursor:pointer;padding:4px 10px;border-radius:var(--radius);font-family:'DM Mono',monospace">â†» REFRESH</button>
    </div>
    <div id="follow-up-queue">
      <div style="text-align:center;padding:20px;color:var(--muted);font-size:12px">Loading queue...</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ACCOUNTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="panel-accounts" class="panel">
  <div class="page-header" style="display:flex;align-items:center;justify-content:space-between">
    <div>
      <h1>Accounts</h1>
      <div class="sub">Manage your priority brand targets</div>
    </div>
    <div style="display:flex;gap:10px">
      <button class="btn btn-secondary" onclick="document.getElementById('csv-input').click()">ğŸ“‚ Import CSV</button>
      <button class="btn btn-secondary" onclick="openAddAccount()">+ Add Account</button>
      <input type="file" id="csv-input" accept=".csv" style="display:none" onchange="handleCSV(event)">
    </div>
  </div>

  <div id="csv-template-notice" style="display:none" class="api-notice">
    ğŸ’¡ CSV columns: Company, Website, Vertical, Territory, Priority, Status, Notes (headers optional)
  </div>

  <div class="filter-bar">
    <span style="font-size:12px;color:var(--muted);font-family:'DM Mono',monospace">FILTER:</span>
    <div class="filter-chip active" onclick="filterAccounts('all',this)">All <span style="font-size:10px;opacity:0.6">(241)</span></div>
    <div class="filter-chip" onclick="filterAccounts('brand_draft',this)">ğŸ“‹ Brand Draft <span style="font-size:10px;opacity:0.6">(40)</span></div>
    <div class="filter-chip" onclick="filterAccounts('prospecting',this)">ğŸ” Prospecting <span style="font-size:10px;opacity:0.6">(201)</span></div>
    <div class="filter-chip" onclick="filterAccounts('not_contacted',this)">Not Contacted</div>
    <div class="filter-chip" onclick="filterAccounts('contacted',this)">Contacted</div>
    <div class="filter-chip" onclick="filterAccounts('follow_up',this)">Follow-up</div>
    <div class="filter-chip" onclick="filterAccounts('meeting',this)">Meeting Booked</div>
    <div class="filter-chip" onclick="filterAccounts('hot',this)">ğŸ”¥ Hot</div>
    <div style="margin-left:auto">
      <div class="search-wrap" style="margin-bottom:0;width:240px">
        <span class="search-icon">ğŸ”</span>
        <input class="search-input" placeholder="Search accounts..." oninput="searchAccounts(this.value)">
      </div>
    </div>
  </div>

  <div class="card">
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th style="width:32px"></th>
            <th>Company</th>
            <th>Vertical</th>
            <th>Territory</th>
            <th>NIL Score</th>
            <th>Status</th>
            <th>Signals</th>
            <th>Last Touch</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="accounts-tbody">
          <tr><td colspan="9"><div class="empty-state"><span class="empty-icon">ğŸ¢</span><h3>No accounts loaded</h3><p>Import a CSV or add accounts manually</p></div></td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PIPELINE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="panel-pipeline" class="panel">
  <div class="page-header" style="display:flex;align-items:center;justify-content:space-between">
    <div><h1>Pipeline</h1><div class="sub">Outreach workflow by stage</div></div>
  </div>
  <div class="kanban" id="kanban-board"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIGNALS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="panel-signals" class="panel">
  <div class="page-header" style="display:flex;align-items:center;justify-content:space-between">
    <div><h1>Intent Signals</h1><div class="sub">Real-time intelligence from public web sources</div></div>
    <div style="display:flex;gap:10px">
      <button class="btn btn-ghost" onclick="clearOldSignals()" title="Remove signals older than 90 days">ğŸ—‘ï¸ Clear Old</button>
      <button class="btn btn-secondary" id="scan-btn" onclick="runSignalScan()">ğŸ” Scan All Accounts</button>
      <button class="btn btn-primary" onclick="scanSelectedAccounts()">âš¡ Scan Selected</button>
    </div>
  </div>

  <div id="scan-progress" style="display:none" class="card" style="margin-bottom:16px">
    <div class="card-body">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px">
        <div class="spinner"></div>
        <span id="scan-status">Scanning accounts...</span>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="scan-progress-fill" style="width:0%;background:var(--accent)"></div></div>
    </div>
  </div>

  <div class="filter-bar">
    <div class="filter-chip active" onclick="filterSignals('all',this)">All Signals</div>
    <div class="filter-chip" onclick="filterSignals('funding',this)">ğŸ’° Funding</div>
    <div class="filter-chip" onclick="filterSignals('launch',this)">ğŸš€ Launch</div>
    <div class="filter-chip" onclick="filterSignals('growth',this)">ğŸ“ˆ Growth</div>
    <div class="filter-chip" onclick="filterSignals('hire',this)">ğŸ‘¤ Hiring</div>
    <div class="filter-chip" onclick="filterSignals('nil',this)">ğŸ† NIL</div>
    <div class="filter-chip" onclick="filterSignals('campaign',this)">ğŸ“£ Campaign</div>
    <div class="filter-chip" onclick="filterSignals('partnership',this)">ğŸ¤ Partnership</div>
    <div class="filter-chip" onclick="filterSignals('news',this)">ğŸ“° News</div>
  </div>

  <div id="signals-list">
    <div class="empty-state">
      <span class="empty-icon">ğŸ“¡</span>
      <h3>No signals yet</h3>
      <p>Run a scan to surface intent signals from public news and web sources</p>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AI COMPOSER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="panel-composer" class="panel">
  <div class="page-header" style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
    <div>
      <h1>AI Outreach Composer</h1>
      <div class="sub">Proposal-quality creative â€” rendered live, not raw text</div>
    </div>
  </div>
  <div class="composer-wrap">
    <div class="composer-sidebar">
      <div class="account-select-card">
        <div class="form-label">Select Account</div>
        <select class="form-select" id="composer-account-select" onchange="loadComposerAccount()">
          <option value="">â€” Choose an account â€”</option>
        </select>
        <div id="composer-account-preview" style="margin-top:14px;display:none"></div>
      </div>
      <div class="account-select-card">
        <div class="form-group">
          <label class="form-label">Additional Context</label>
          <textarea class="form-textarea" id="extra-context" style="min-height:70px" placeholder="Recent news, campaign angle, mutual connection..."></textarea>
        </div>
      </div>

      <!-- TARGET CONTACTS from Apollo -->
      <div class="account-select-card" id="composer-contacts-panel">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
          <div class="form-label" style="margin:0">ğŸ¯ Target Contacts</div>
          <button class="btn btn-xs btn-secondary" id="composer-refresh-contacts-btn" onclick="refreshComposerContacts()" style="font-size:10px">â†» Refresh</button>
        </div>
        <input class="form-input" id="composer-contact-filter" placeholder="Filter by name or title..." style="font-size:11px;margin-bottom:8px;padding:6px 10px" oninput="filterComposerContacts()">
        <div id="composer-contacts-list" style="max-height:320px;overflow-y:auto">
          <div style="font-size:12px;color:var(--muted);text-align:center;padding:16px">Select an account to see contacts</div>
        </div>
        <div id="composer-contacts-footer" style="display:none;margin-top:8px;padding-top:8px;border-top:1px solid var(--border)">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <span id="composer-selected-count" style="font-size:10px;color:var(--accent);font-weight:700">0 selected</span>
            <button class="btn btn-xs btn-ghost" onclick="clearContactSelection()">Clear</button>
          </div>
        </div>
      </div>

      <button class="btn btn-primary" style="width:100%;margin-top:-4px" onclick="generateOutreach()" id="composer-generate-btn">
        &#10027; Generate
      </button>
      <div id="composer-generate-warning" style="display:none;font-size:11px;color:var(--gold);text-align:center;margin-top:6px">âš ï¸ Select at least one contact above to generate</div>
      <!-- Hidden fields for backward compat -->
      <input type="hidden" id="contact-name" value="">
      <input type="hidden" id="contact-title" value="">
      <div class="account-select-card" id="composer-icp-panel">
        <div class="form-label" style="display:flex;align-items:center;gap:6px">ğŸ’ ICP Buyer Archetypes</div>
        <div id="composer-icp-subtitle" style="font-size:11px;color:var(--muted2);margin-bottom:10px">Find contacts at <span id="composer-icp-company">your selected company</span></div>
        <div id="composer-icp-list"></div>
      </div>
    </div>
    <div class="composer-main">
      <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:4px">
        <div class="output-tabs">
          <div class="output-tab active" onclick="switchTab('email',this)">&#128247; Cold Email</div>
          <div class="output-tab" onclick="switchTab('linkedin',this)">&#128188; LinkedIn DM</div>
          <div class="output-tab" onclick="switchTab('nil_angles',this)">&#127942; NIL Angles</div>
          <div class="output-tab" onclick="switchTab('talking_points',this)">&#128222; Call Prep</div>
          <div class="output-tab" onclick="switchTab('creative_brief',this)" style="border-color:rgba(200,168,75,0.5);color:#c8a84b">&#10022; Creative Brief</div>
        </div>
        <div style="display:flex;gap:6px">
          <button class="btn btn-sm btn-ghost" onclick="copyOutput()">&#128203; Copy</button>
          <button class="btn btn-sm btn-ghost" onclick="saveToAccount()">&#128190; Save</button>
          <button class="btn btn-sm btn-ghost" id="pdf-btn" onclick="downloadBriefPDF()" style="display:none;border-color:rgba(200,168,75,0.5);color:#c8a84b">&#8681; PDF</button>
          <button class="btn btn-sm btn-secondary" onclick="regenerateOutput()">&#8635; Redo</button>
        </div>
      </div>
      <div class="output-area" id="output-area">
        <div class="output-placeholder">
          <div style="font-size:36px;margin-bottom:12px">&#10022;</div>
          <div style="font-weight:600;color:var(--text2);margin-bottom:6px">Select an account to generate</div>
          <div style="font-size:12px;max-width:320px;margin:0 auto">Email renders as a live Gmail mockup. NIL Angles as concept cards. Creative Brief as a full proposal deck.</div>
        </div>
      </div>
      <div id="feedback-section" style="display:none;margin-top:10px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px">
        <div style="font-size:10px;font-weight:700;color:var(--muted2);margin-bottom:8px;letter-spacing:0.07em">REFINE THIS OUTPUT</div>
        <textarea id="feedback-input" placeholder="Shorter, more direct, different CTA, reference their TikTok spend..." style="width:100%;background:var(--card);border:1px solid var(--border2);border-radius:var(--radius);color:var(--text);font-family:inherit;font-size:13px;padding:10px 12px;resize:vertical;min-height:60px;outline:none"></textarea>
        <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;align-items:center">
          <button class="btn btn-sm btn-ghost feedback-chip" onclick="applyFeedbackChip(this)" data-val="Make it shorter and punchier">&#9986; Shorter</button>
          <button class="btn btn-sm btn-ghost feedback-chip" onclick="applyFeedbackChip(this)" data-val="Make the tone more casual and conversational">More casual</button>
          <button class="btn btn-sm btn-ghost feedback-chip" onclick="applyFeedbackChip(this)" data-val="Make it more direct and bold, skip the pleasantries">&#9889; Direct</button>
          <button class="btn btn-sm btn-ghost feedback-chip" onclick="applyFeedbackChip(this)" data-val="Add a stronger, more specific call to action">Stronger CTA</button>
          <button class="btn btn-sm btn-ghost feedback-chip" onclick="applyFeedbackChip(this)" data-val="Add more personalization specific to their brand">More personal</button>
          <button class="btn btn-sm btn-primary" onclick="refineWithFeedback()" style="margin-left:auto">&#10027; Refine</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DISCOVERY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="panel-discovery" class="panel">
  <div class="page-header">
    <h1>Brand Discovery</h1>
    <div class="sub">Score new brands for NIL fit â€” paste names, get ranked recommendations</div>
  </div>

  <div class="grid-2" style="align-items:start">
    <div>
      <div class="card">
        <div class="card-header"><div class="card-title">ğŸ” Score a Brand</div></div>
        <div class="card-body">
          <div class="form-group">
            <label class="form-label">Brand Name or Website</label>
            <input class="form-input" id="discovery-brand" placeholder="e.g. Vuori, vuori.com">
          </div>
          <div class="form-group">
            <label class="form-label">What you know about them</label>
            <textarea class="form-textarea" id="discovery-context" placeholder="DTC athletic apparel, raised Series C, heavy on Instagram influencers, targeting 18-30 demo..."></textarea>
          </div>
          <button class="btn btn-primary" style="width:100%" onclick="scoreBrand()">âš¡ Score for NIL Fit</button>
        </div>
      </div>

      <div class="card">
        <div class="card-header"><div class="card-title">ğŸ“‹ Batch Score</div></div>
        <div class="card-body">
          <div class="form-group">
            <label class="form-label">Paste up to 20 brand names (one per line)</label>
            <textarea class="form-textarea" id="batch-brands" placeholder="Athletic Greens&#10;Rhode&#10;Vuori&#10;Figs&#10;Gymshark" style="min-height:140px"></textarea>
          </div>
          <button class="btn btn-secondary" style="width:100%" onclick="batchScore()">Score All â†’</button>
        </div>
      </div>
    </div>

    <div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">ğŸ“Š Discovery Results</div>
          <button class="btn btn-sm btn-secondary" onclick="clearDiscovery()">Clear</button>
        </div>
        <div class="card-body" style="padding:12px">
          <div id="discovery-results">
            <div class="empty-state" style="padding:40px">
              <span class="empty-icon">ğŸ†</span>
              <h3>No results yet</h3>
              <p>Score individual brands or run a batch to see NIL fit rankings</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SETTINGS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="panel-settings" class="panel">
  <div class="page-header"><h1>Settings</h1><div class="sub">Configure your OD Sales Hub</div></div>

  <div style="max-width:640px">
    <div class="settings-section">
      <h3>ğŸ”‘ API Configuration</h3>
      <div class="form-group">
        <label class="form-label">Apollo API Key</label>
        <input class="form-input" type="password" id="apollo-key" placeholder="Enter Apollo API key..." value="">
        <div style="font-size:11px;color:var(--muted);margin-top:5px">Used for contact sourcing. Requires local proxy due to browser CORS restrictions â€” see below.</div>
      </div>
      <div class="form-group">
        <label class="form-label" style="color:var(--accent)">ğŸ”Œ Apollo Proxy URL</label>
        <input class="form-input" type="text" id="apollo-proxy-url" placeholder="https://od-apollo-proxy.vercel.app/apollo" value="https://od-apollo-proxy.vercel.app/apollo">
        <div style="font-size:11px;color:var(--muted);margin-top:6px;line-height:1.6">
          Apollo requires a local relay to work from your browser. Two steps:<br>
          <strong style="color:var(--text1)">1.</strong> Make sure Node.js is installed â†’ <a href="https://nodejs.org" target="_blank" style="color:var(--accent)">nodejs.org</a><br>
          <strong style="color:var(--text1)">2.</strong> Open Terminal and run:<br>
          <code style="display:block;background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:8px 10px;margin-top:6px;font-size:11px;color:var(--green);line-height:1.8">node ~/Downloads/apollo-proxy/server.js</code>
          Leave that Terminal window open while using the hub.
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Anthropic API Key</label>
        <input class="form-input" type="password" id="claude-key" placeholder="Enter Anthropic API key..." value="">
        <div style="font-size:11px;color:var(--muted);margin-top:5px">Powers AI outreach generation and brand scoring</div>
      </div>
      <button class="btn btn-primary" onclick="saveSettings()">Save API Keys</button>
    </div>

    <div class="settings-section">
      <h3>ğŸ”¬ Apollo Diagnostic</h3>
      <div style="font-size:11px;color:var(--muted);margin-bottom:10px">Test Apollo connectivity and see which search strategy works for a domain.</div>
      <div style="display:flex;gap:8px;margin-bottom:10px">
        <input class="form-input" id="apollo-test-domain" placeholder="e.g. aloyoga.com or spotify.com" style="flex:1">
        <button class="btn btn-secondary" onclick="runApolloDiagnostic()">ğŸ” Test</button>
      </div>
      <div id="apollo-diagnostic-output" style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:12px;font-family:'DM Mono',monospace;font-size:11px;color:var(--text2);max-height:400px;overflow-y:auto;white-space:pre-wrap;display:none"></div>
    </div>

    <div class="settings-section">
      <h3>ğŸ¯ NIL Scoring Weights</h3>
      <div class="setting-row">
        <div class="setting-info"><div class="setting-name">Gen Z Brand Signal</div><div class="setting-desc">Boost brands clearly targeting 18â€“25 demographic</div></div>
        <div class="toggle on" onclick="this.classList.toggle('on')"></div>
      </div>
      <div class="setting-row">
        <div class="setting-info"><div class="setting-name">Influencer Activity Signal</div><div class="setting-desc">Detect brands running influencer/creator campaigns</div></div>
        <div class="toggle on" onclick="this.classList.toggle('on')"></div>
      </div>
      <div class="setting-row">
        <div class="setting-info"><div class="setting-name">Funding Stage Boost</div><div class="setting-desc">Prioritize Series Aâ€“C brands with marketing budget</div></div>
        <div class="toggle on" onclick="this.classList.toggle('on')"></div>
      </div>
      <div class="setting-row">
        <div class="setting-info"><div class="setting-name">Campus/College Signal</div><div class="setting-desc">Surface brands with college campus marketing activity</div></div>
        <div class="toggle on" onclick="this.classList.toggle('on')"></div>
      </div>
      <div class="setting-row">
        <div class="setting-info"><div class="setting-name">Exclude Fortune 500</div><div class="setting-desc">Auto-filter legacy enterprise brands from scoring</div></div>
        <div class="toggle on" onclick="this.classList.toggle('on')"></div>
      </div>
    </div>

    <div class="settings-section">
      <h3>ğŸ“¡ Signal Sources</h3>
      <div class="setting-row">
        <div class="setting-info"><div class="setting-name">Google News RSS</div><div class="setting-desc">Free â€” brand news, funding, launches</div></div>
        <div class="badge badge-green">Active</div>
      </div>
      <div class="setting-row">
        <div class="setting-info"><div class="setting-name">PR Newswire Scraper</div><div class="setting-desc">Official press releases â€” product launches, partnerships</div></div>
        <div class="badge badge-green">Active</div>
      </div>
      <div class="setting-row">
        <div class="setting-info"><div class="setting-name">Job Board Scanner</div><div class="setting-desc">Detects NIL/influencer/campus hire signals</div></div>
        <div class="badge badge-green">Active</div>
      </div>
      <div class="setting-row">
        <div class="setting-info"><div class="setting-name">Brand Press Pages</div><div class="setting-desc">Direct scrape of /press, /newsroom, /media</div></div>
        <div class="badge badge-green">Active</div>
      </div>
    </div>

    <div class="settings-section">
      <h3>ğŸ“Š Data</h3>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn btn-secondary" onclick="exportData()">ğŸ“¥ Export Backup</button>
        <button class="btn btn-secondary" onclick="resetToCSV()">ğŸ”„ Reset to Original CSV</button>
        <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ Clear All Data</button>
      </div>
      <div style="font-size:11px;color:var(--muted);margin-top:8px">Export regularly to protect your work. Reset restores all 241 accounts but clears status updates and notes.</div>
    </div>
  </div>
</div>

</div><!-- /main -->
</div><!-- /app-body -->

<!-- ACCOUNT DETAIL DRAWER -->
<div class="drawer-overlay" id="drawer-overlay" onclick="closeDrawer()"></div>
<div class="drawer" id="account-drawer">
  <div class="drawer-header">
    <div>
      <div id="drawer-company" style="font-family:'Syne',sans-serif;font-weight:800;font-size:18px;margin-bottom:2px"></div>
      <div id="drawer-meta" style="font-size:12px;color:var(--muted2)"></div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button class="btn btn-sm btn-primary" onclick="openComposerFor()">âœï¸ Compose</button>
      <div class="drawer-close" onclick="closeDrawer()">âœ•</div>
    </div>
  </div>
  <div class="drawer-body">
    <div class="section-tabs">
      <div class="section-tab active" onclick="drawerTab('overview',this)">Overview</div>
      <div class="section-tab" onclick="drawerTab('outreach',this)">ğŸ• Activity</div>
      <div class="section-tab" onclick="drawerTab('signals',this)">Signals</div>
      <div class="section-tab" onclick="drawerTab('contacts',this)">Contacts</div>
      <div class="section-tab" onclick="drawerTab('outreach',this)">Outreach Log</div>
    </div>
    <div id="drawer-content"></div>
  </div>
</div>

<!-- ADD ACCOUNT MODAL -->
<div class="modal-overlay" id="add-modal">
  <div class="modal">
    <div class="modal-header">
      <h2>Add Account</h2>
      <div class="drawer-close" onclick="closeModal('add-modal')">âœ•</div>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Company Name *</label>
          <input class="form-input" id="add-company" placeholder="e.g. Vuori">
        </div>
        <div class="form-group">
          <label class="form-label">Website</label>
          <input class="form-input" id="add-website" placeholder="vuori.com">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Vertical</label>
          <select class="form-select" id="add-vertical">
            <option>DTC Apparel</option>
            <option>DTC Food & Bev</option>
            <option>DTC Health & Wellness</option>
            <option>DTC Beauty</option>
            <option>DTC Tech / Gadgets</option>
            <option>Sports / Fitness</option>
            <option>Gaming</option>
            <option>Financial Services</option>
            <option>Media / Entertainment</option>
            <option>Other</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Territory</label>
          <select class="form-select" id="add-territory">
            <option>National</option>
            <option>Northeast</option>
            <option>Southeast</option>
            <option>Midwest</option>
            <option>West Coast</option>
            <option>Southwest</option>
            <option>International</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Priority</label>
          <select class="form-select" id="add-priority">
            <option value="hot">ğŸ”¥ Hot</option>
            <option value="high">High</option>
            <option value="medium" selected>Medium</option>
            <option value="low">Low</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Status</label>
          <select class="form-select" id="add-status">
            <option value="not_contacted">ğŸ¯ Prospecting</option>
            <option value="contacted">ğŸ“¬ Contacted</option>
            <option value="follow_up">ğŸ” Nurturing</option>
            <option value="engaged">ğŸ’¬ Engaged</option>
            <option value="meeting">ğŸ“… Meeting Booked</option>
            <option value="proposal">ğŸ“„ Proposal Sent</option>
            <option value="negotiation">ğŸ¤ Negotiating</option>
            <option value="closed">âœ… Closed Won</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Notes</label>
        <textarea class="form-textarea" id="add-notes" placeholder="Key intel, talking points, relationships..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('add-modal')">Cancel</button>
      <button class="btn btn-primary" onclick="saveNewAccount()">Add Account</button>
    </div>
  </div>
</div>

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toast-container"></div>

<script>

// â•â• RYAN WOLPE â€” REAL ACCOUNT DATA FROM CSV â•â•
// VERSION â€” bump this to force localStorage clear after bad builds
const APP_VERSION = 'v3';
(function() {
  try {
    var saved = localStorage.getItem('od_sales_hub');
    if (saved) {
      var d = JSON.parse(saved);
      // Only wipe accounts if missing/empty â€” PRESERVE signals and API keys always
      if (!d.accounts || d.accounts.length < 10) {
        d.accounts = null; // will be rebuilt from CSV in loadState
        localStorage.setItem('od_sales_hub', JSON.stringify(d));
        console.log('Rebuilt empty account list from CSV, preserved keys + signals');
      }
    }
  } catch(e) {
    // On parse error, preserve keys in separate storage before clearing
    try {
      var keys = localStorage.getItem('od_hub_keys');
      localStorage.removeItem('od_sales_hub');
      if (keys) localStorage.setItem('od_hub_keys', keys);
    } catch(e2) {}
    console.log('Cleared corrupt state, preserved API keys');
  }
})();

const RYAN_ACCOUNTS_CSV = [{"id":"17716199472377849579953","company":"Masterclass","website":"masterclass.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472378166371850","company":"In-N-Out Burger","website":"in-n-outburger.com","vertical":"DTC Food & Bev","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472378303428646","company":"Spotify","website":"spotify.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472378516174094","company":"Conagra Brands","website":"conagrabrands.com","vertical":"DTC Apparel","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472378642581980","company":"Johnson & Johnson","website":"johnson&johnson.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472378812472312","company":"Publix","website":"publix.com","vertical":"Retail","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472378953471570","company":"Crumble Cookie","website":"crumblecookie.com","vertical":"DTC Food & Bev","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472379028164664","company":"Alo Yoga","website":"aloyoga.com","vertical":"Sports / Fitness","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit. Strong sports/fitness vertical fit for NIL","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472379085067960","company":"Pategonia","website":"pategonia.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472379240376541","company":"On Cloud (Shoes)","website":"oncloud(shoes).com","vertical":"Tech / Gaming","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472379398588292","company":"Magnum Ice Cream","website":"magnumicecream.com","vertical":"DTC Food & Bev","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472379481821551","company":"GoPro","website":"gopro.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472379609779736","company":"Duolingo","website":"duolingo.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472379756525951","company":"Leonovo","website":"leonovo.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472379885976906","company":"Mattress Firm","website":"mattressfirm.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472380040222468","company":"Molson Coors","website":"molsoncoors.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472380184311585","company":"Mucinex (Reckitt)","website":"mucinex(reckitt).com","vertical":"DTC Health & Wellness","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472380300654932","company":"Notion","website":"notion.com","vertical":"Tech / Gaming","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit. B2B tech \u2014 campus recruiting/student angle","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472380414872601","company":"PrizePicks","website":"prizepicks.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit. Gaming vertical \u2014 college gamer audience overlap","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472380561357160","company":"Twitch","website":"twitch.com","vertical":"Tech / Gaming","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit. Gaming vertical \u2014 college gamer audience overlap","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472380697597898","company":"ZenDesk","website":"zendesk.com","vertical":"Tech / Gaming","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit. B2B tech \u2014 campus recruiting/student angle","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472380836716064","company":"NHL/PGA Tour","website":"nhl/pgatour.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472380979678360","company":"TaylorMade","website":"taylormade.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472381168311152","company":"Titelist","website":"titelist.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472381556946769","company":"Rakuten","website":"rakuten.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472381769225482","company":"HomeChef","website":"homechef.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472381902337253","company":"Zynga","website":"zynga.com","vertical":"Tech / Gaming","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit. Gaming vertical \u2014 college gamer audience overlap","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472382008511562","company":"Handshake","website":"handshake.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit. B2B tech \u2014 campus recruiting/student angle","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472382155229197","company":"Birkenstoc","website":"birkenstoc.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472382298746688","company":"Buc-ee's","website":"buc-ee's.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472382457362182","company":"Aritzia","website":"aritzia.com","vertical":"DTC Apparel","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472382543749150","company":"Urban Outfitters","website":"urbanoutfitters.com","vertical":"DTC Apparel","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472382649275317","company":"Orange Theory Fitness","website":"orangetheoryfitness.com","vertical":"Sports / Fitness","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit. Strong sports/fitness vertical fit for NIL","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472382709841447","company":"H-E-B","website":"h-e-b.com","vertical":"Retail","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472382829982490","company":"Wegmans","website":"wegmans.com","vertical":"Retail","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472382963073342","company":"Popeyes","website":"popeyes.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472383085052737","company":"Spanx","website":"spanx.com","vertical":"DTC Beauty","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472383187844722","company":"Texas Roadhouse","website":"texasroadhouse.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472383338393285","company":"Boost Mobile","website":"boostmobile.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472383479938619","company":"Cinnabon","website":"cinnabon.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"brand_draft","notes":"Brand Draft account \u2014 active pursuit","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472383640118648","company":"Academy Sports and Outdoors","website":"academysportsandoutdoors.com","vertical":"Sports / Fitness","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Strong sports/fitness vertical fit for NIL","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472383764475637","company":"ADDICTION","website":"addiction.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472383943883485","company":"Affinity Designer","website":"affinitydesigner.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472384126143349","company":"Air France","website":"airfrance.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472384285018163","company":"Albertsons","website":"albertsons.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472384431369740","company":"Always","website":"always.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472384573839290","company":"Amerisleep","website":"amerisleep.com","vertical":"DTC Apparel","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472384686246787","company":"Angi","website":"angi.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472384807832008","company":"Arctic Cat","website":"arcticcat.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472384957105890","company":"Arthur J. Gallagher","website":"arthurj.gallagher.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472385151626556","company":"ASRock","website":"asrock.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472385288471528","company":"Atlassian","website":"atlassian.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472385436604407","company":"Auto-Owners Insurance","website":"auto-ownersinsurance.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472385665998816","company":"Babbel","website":"babbel.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472385803804040","company":"Bang Energy","website":"bangenergy.com","vertical":"DTC Food & Bev","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472385887437564","company":"Baskin Robbins","website":"baskinrobbins.com","vertical":"DTC Beauty","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472385984304716","company":"Belkin","website":"belkin.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472386113676538","company":"Bianchi","website":"bianchi.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472386257127473","company":"Bitdefender","website":"bitdefender.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472386413731693","company":"BMO","website":"bmo.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472386549131537","company":"Bojangles","website":"bojangles.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472386713754626","company":"Bombay Sapphire","website":"bombaysapphire.com","vertical":"Tech / Gaming","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472386855256206","company":"Bread Financial Holdings","website":"breadfinancialholdings.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472387033553106","company":"Briogeo","website":"briogeo.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472387174162205","company":"Brunswick","website":"brunswick.com","vertical":"Sports / Fitness","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Strong sports/fitness vertical fit for NIL","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472387250344602","company":"Buffer","website":"buffer.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472387405624970","company":"Build-A-Bear","website":"build-a-bear.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472387565746905","company":"Build-A-Bear Workshop","website":"build-a-bearworkshop.com","vertical":"Retail","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472387748947346","company":"Burberry","website":"burberry.com","vertical":"DTC Apparel","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472387857514959","company":"Cabelas","website":"cabelas.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472388021536352","company":"Callaway","website":"callaway.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472388155486583","company":"Camp Chef","website":"campchef.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472388296487400","company":"Carbon Black","website":"carbonblack.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472388498174949","company":"Cartier","website":"cartier.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472388637622985","company":"Chacott","website":"chacott.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472388767246274","company":"Chubbies","website":"chubbies.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Gen Z DTC challenger \u2014 high NIL potential","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472388904403624","company":"Claires","website":"claires.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472389032193658","company":"CNO Financial Group","website":"cnofinancialgroup.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472389189273862","company":"Coldstone","website":"coldstone.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472389333948411","company":"Colnago","website":"colnago.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472389499106912","company":"Compass","website":"compass.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472389629914857","company":"CookOut","website":"cookout.com","vertical":"DTC Food & Bev","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472389692199788","company":"COSRX","website":"cosrx.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472389810308045","company":"Creed","website":"creed.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472389924106102","company":"CUNA Mutual Group (TruStage)","website":"cunamutualgroup(trustage).com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472390125244280","company":"Cuts","website":"cuts.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Gen Z DTC challenger \u2014 high NIL potential","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472390264446310","company":"Darden Restaurant Group","website":"dardenrestaurantgroup.com","vertical":"DTC Food & Bev","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472390362194847","company":"Darden Restaurants","website":"dardenrestaurants.com","vertical":"DTC Food & Bev","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472390448468367","company":"Deliveroo","website":"deliveroo.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472390588334005","company":"Delta Airlines","website":"deltaairlines.com","vertical":"Travel & Hospitality","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472390766731380","company":"Dermalogica","website":"dermalogica.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472390932289274","company":"Diesel","website":"diesel.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472391075079945","company":"Discount Tire","website":"discounttire.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472391246732990","company":"Dollar Tree","website":"dollartree.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472391510819196","company":"Dream Games","website":"dreamgames.com","vertical":"Tech / Gaming","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Gaming vertical \u2014 college gamer audience overlap","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472391648766348","company":"Dremel","website":"dremel.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472391779215292","company":"Drink LMNT","website":"drinklmnt.com","vertical":"DTC Food & Bev","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472391853324731","company":"Dry Bar","website":"drybar.com","vertical":"DTC Food & Bev","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472391925546301","company":"Duluth Trading","website":"duluthtrading.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472392083275996","company":"Dutch Bros Coffee","website":"dutchbroscoffee.com","vertical":"DTC Food & Bev","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Gen Z DTC challenger \u2014 high NIL potential","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472392201247341","company":"Eight Sleep","website":"eightsleep.com","vertical":"DTC Apparel","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472392298373987","company":"Entergy","website":"entergy.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472392453066699","company":"Erewhon","website":"erewhon.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Gen Z DTC challenger \u2014 high NIL potential","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472392590756391","company":"ESET","website":"eset.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472392707361143","company":"Exelon","website":"exelon.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472392838151287","company":"F45 Training","website":"f45training.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472392994438187","company":"Fifth Third Bank","website":"fifththirdbank.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472393136357699","company":"Fila","website":"fila.com","vertical":"DTC Apparel","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472393219315054","company":"First Watch","website":"firstwatch.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472393365723444","company":"FirstCash Holdings","website":"firstcashholdings.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472393558446874","company":"Fizik Saddles","website":"fiziksaddles.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472393721545635","company":"Fortinet","website":"fortinet.com","vertical":"Tech / Gaming","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472393843274388","company":"Fractal Design","website":"fractaldesign.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472394004782766","company":"Fruit of the Loom","website":"fruitoftheloom.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472394167577208","company":"Gannett","website":"gannett.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472394305162780","company":"Genuine Parts","website":"genuineparts.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472394465844423","company":"Giorgio Armani Beauty","website":"giorgioarmanibeauty.com","vertical":"DTC Beauty","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472394569166806","company":"Globe Life","website":"globelife.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472394738591010","company":"Good Ranchers","website":"goodranchers.com","vertical":"DTC Health & Wellness","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Health DTC \u2014 college wellness angle","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472394852066071","company":"Goodyear Tire & Rubber","website":"goodyeartireandrubber.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472395061592636","company":"GoPuff","website":"gopuff.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472395191697733","company":"Guardian Life Ins. Co. of America","website":"guardianlifeins.co.ofamerica.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472395401218962","company":"Hallmark","website":"hallmark.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472395546123222","company":"Hard Rock Digital","website":"hardrockdigital.com","vertical":"Tech / Gaming","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472395687627152","company":"Hartford Financial Services Group","website":"hartfordfinancialservicesgroup.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472395873948172","company":"HelloFresh","website":"hellofresh.com","vertical":"DTC Health & Wellness","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Health DTC \u2014 college wellness angle","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472395996177907","company":"Hers","website":"hers.com","vertical":"DTC Health & Wellness","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Health DTC \u2014 college wellness angle","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472396089362768","company":"Hims","website":"hims.com","vertical":"DTC Health & Wellness","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Health DTC \u2014 college wellness angle","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472396178499581","company":"Hitachi (Metabo HPT)","website":"hitachi(metabohpt).com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472396367026454","company":"Huda Beauty","website":"hudabeauty.com","vertical":"DTC Beauty","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472396479921327","company":"Instant Brands","website":"instantbrands.com","vertical":"DTC Apparel","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472396597038972","company":"InVision","website":"invision.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472396743592438","company":"Jackson Financial","website":"jacksonfinancial.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472396896232963","company":"Jamba Juice","website":"jambajuice.com","vertical":"DTC Food & Bev","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472396969375089","company":"Jefferies Financial Group","website":"jefferiesfinancialgroup.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472397169865942","company":"Johnson's","website":"johnsons.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472397327769198","company":"Justice Active","website":"justiceactive.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472397487171376","company":"Kate Spade","website":"katespade.com","vertical":"DTC Beauty","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472397580313543","company":"Kingston","website":"kingston.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472397720067683","company":"Kodak","website":"kodak.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472397870866033","company":"Kosas","website":"kosas.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472397994599806","company":"KTM","website":"ktm.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472398098911186","company":"Lee","website":"lee.com","vertical":"DTC Apparel","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472398175826895","company":"Liberty Media","website":"libertymedia.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472398330549429","company":"Lifeway Foods","website":"lifewayfoods.com","vertical":"DTC Food & Bev","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472398445664284","company":"Linktree","website":"linktree.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472398595718927","company":"Lodge Cast Iron","website":"lodgecastiron.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472398757181330","company":"LPL Financial Holdings","website":"lplfinancialholdings.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472398918873883","company":"Lucky Brand","website":"luckybrand.com","vertical":"DTC Apparel","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472399022295856","company":"Lysol","website":"lysol.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472399178409543","company":"MadHappy","website":"madhappy.com","vertical":"Tech / Gaming","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Gen Z DTC challenger \u2014 high NIL potential","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472399288386603","company":"Madison Reed","website":"madisonreed.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472399479163833","company":"Maison Margiela","website":"maisonmargiela.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472399638513999","company":"Marshalls Kids","website":"marshallskids.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472399791495178","company":"Maytag","website":"maytag.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472399922055796","company":"Mercury General","website":"mercurygeneral.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472400080968360","company":"Mission Foods","website":"missionfoods.com","vertical":"DTC Food & Bev","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472400148898237","company":"Moe's Southwest Grill","website":"moessouthwestgrill.com","vertical":"DTC Food & Bev","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472400232439644","company":"Monzo","website":"monzo.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472400352966012","company":"MSI","website":"msi.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472400479965860","company":"Municipal","website":"municipal.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472400634992435","company":"N26","website":"n26.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472400737989794","company":"Nokia","website":"nokia.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472400863046579","company":"NordiTrac","website":"norditrac.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472401012594619","company":"Nucor","website":"nucor.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472401134829643","company":"Okta","website":"okta.com","vertical":"Tech / Gaming","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472401236062729","company":"Olympus","website":"olympus.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472401469128873","company":"Outdoor Research","website":"outdoorresearch.com","vertical":"Sports / Fitness","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Strong sports/fitness vertical fit for NIL","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472401577206450","company":"PacSun","website":"pacsun.com","vertical":"DTC Apparel","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472401668825258","company":"Palit","website":"palit.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472401805228242","company":"Peets Coffee","website":"peetscoffee.com","vertical":"DTC Food & Bev","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472401884839986","company":"Penn Station","website":"pennstation.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472402041497218","company":"PennyMac Financial Services","website":"pennymacfinancialservices.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472402217604221","company":"Pet Supplies Plus","website":"petsuppliesplus.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472402382187993","company":"Pinarello","website":"pinarello.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472402526042680","company":"Plantronics","website":"plantronics.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472402678078137","company":"Playtika","website":"playtika.com","vertical":"Tech / Gaming","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Gaming vertical \u2014 college gamer audience overlap","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472402794518896","company":"Polaris","website":"polaris.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472402929269546","company":"Popular","website":"popular.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472403062814631","company":"Portillos","website":"portillos.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472403235926528","company":"Potbelly","website":"potbelly.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472403371733073","company":"PowerBlock","website":"powerblock.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472403512903822","company":"ProForm","website":"proform.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472403643002350","company":"Qatar Airways","website":"qatarairways.com","vertical":"Travel & Hospitality","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472403786931184","company":"Quicken Loans","website":"quickenloans.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472403972463878","company":"Rapha","website":"rapha.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472404096017545","company":"Regal Cinemas","website":"regalcinemas.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472404252389530","company":"Revlon","website":"revlon.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472404386223716","company":"Rite Aid","website":"riteaid.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472404524391600","company":"Royal Caribbean","website":"royalcaribbean.com","vertical":"Travel & Hospitality","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472404721367737","company":"Salesforce","website":"salesforce.com","vertical":"Tech / Gaming","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"B2B tech \u2014 campus recruiting/student angle","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472404847692093","company":"SanDisk","website":"sandisk.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472404982294638","company":"Saucony","website":"saucony.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472405113038264","company":"Scythe","website":"scythe.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472405245169091","company":"Selective Insurance Group","website":"selectiveinsurancegroup.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472405419098756","company":"Shipt","website":"shipt.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472405546003006","company":"Singapore Airlines","website":"singaporeairlines.com","vertical":"Travel & Hospitality","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472405713932435","company":"Sketch","website":"sketch.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472405841663475","company":"Skillz","website":"skillz.com","vertical":"Tech / Gaming","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Gaming vertical \u2014 college gamer audience overlap","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472405943477189","company":"Snap-On Tools","website":"snap-ontools.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472406131313786","company":"Square","website":"square.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472406289224868","company":"Stanley Black & Decker","website":"stanleyblackanddecker.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472406468552771","company":"SteelSeries","website":"steelseries.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472406627693546","company":"Strava","website":"strava.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472406754345707","company":"Sunday Riley","website":"sundayriley.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472406906595810","company":"SUSE","website":"suse.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472407024853070","company":"Swig","website":"swig.com","vertical":"Other","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472407133094478","company":"Synopsys","website":"synopsys.com","vertical":"Tech / Gaming","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472407247097140","company":"Take-Two Interactive","website":"take-twointeractive.com","vertical":"Tech / Gaming","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Gaming vertical \u2014 college gamer audience overlap","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472407400594170","company":"Talk Space","website":"talkspace.com","vertical":"DTC Beauty","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472407518489496","company":"Tarte","website":"tarte.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472407646614370","company":"TEGNA","website":"tegna.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472407763498169","company":"Tenable","website":"tenable.com","vertical":"Tech / Gaming","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472407874205046","company":"The RealReal","website":"therealreal.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472408025991371","company":"The Ryl Company","website":"therylcompany.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472408184317050","company":"Thumbtack","website":"thumbtack.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472408324674440","company":"Tillys","website":"tillys.com","vertical":"DTC Apparel","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472408597787989","company":"TJX Companies (TJ Maxx, Marshalls)","website":"tjxcompanies(tjmaxx,marshalls).com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472408821613414","company":"TP-Link","website":"tp-link.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472408957728130","company":"Trargar","website":"trargar.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472409117772431","company":"Tropicana","website":"tropicana.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472409269218675","company":"TRX Training","website":"trxtraining.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472409428715216","company":"Ubiquiti","website":"ubiquiti.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472409568395031","company":"Universal Health Services","website":"universalhealthservices.com","vertical":"DTC Health & Wellness","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472409717915738","company":"Untuckit","website":"untuckit.com","vertical":"DTC Apparel","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472409811605998","company":"Vanguard","website":"vanguard.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472409930397403","company":"Venus","website":"venus.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472410055565702","company":"Viktor&Rolf","website":"viktorandrolf.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472410209456107","company":"Virgin Mobile","website":"virginmobile.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472410361324508","company":"Volkswagen (Audi, Porsche, etc)","website":"volkswagen(audi,porsche,etc).com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472410595823863","company":"Wahoo Fitness","website":"wahoofitness.com","vertical":"Sports / Fitness","territory":"National","priority":"high","status":"not_contacted","bucket":"prospecting","notes":"Strong sports/fitness vertical fit for NIL","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472410660282895","company":"Webster Financial","website":"websterfinancial.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472410814377227","company":"WeBull","website":"webull.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472410946879922","company":"Western & Southern Financial Group","website":"westernandsouthernfinancialgroup.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472411177997832","company":"Wintrust Financial","website":"wintrustfinancial.com","vertical":"Financial Services","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472411452698565","company":"WordPress","website":"wordpress.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472412093183046","company":"Wyndham Hotels & Resorts","website":"wyndhamhotelsandresorts.com","vertical":"Travel & Hospitality","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472412277514391","company":"Yamaha Motor","website":"yamahamotor.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472412438645009","company":"YSL Beauty","website":"yslbeauty.com","vertical":"DTC Beauty","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472412522697606","company":"Zipcar","website":"zipcar.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]},{"id":"17716199472412681825746","company":"ZTE MF Series","website":"ztemfseries.com","vertical":"Other","territory":"National","priority":"medium","status":"not_contacted","bucket":"prospecting","notes":"Prospecting list account","touchCount":0,"lastTouch":null,"createdAt":"2025-01-01T00:00:00Z","contacts":[]}];
const OFF_LIMITS_SET = new Set(["1-800-Flowers","100 Thieves","24 Hour Fitness","7 Brew","7-Eleven","A.O. Smith","ADT","AES","AIG","AKG","AKIRA","AMC Entertainment Holdings","ARKO","ASICS","ASOS","AT&T","AXS","AbbVie","Abbott Labs","Abercrombie/Hollister","Absolut","Accor Hotels","Ace Hardware","Acer","Acqua di Parma","Acronis","Activision","Acura","Ad Council","Adidas","Adobe","Advance Auto Parts","Advanced Micro Devices (AMD)","Aerie","AeroGarden","Affirm","Aflac","Afterpay","Ahold Delhaize","AirBnB","Akamai Technologies","Alamo","Alaska Airlines","Aldi","Alfa Romeo","Alibaba Cloud","Alienware","Align Technology","All-Clad","AllModern","Allbirds","Allegiant Airlines","Allegiant Travel","Alliant Credit Union","Alliant Energy","Allstate -Dan Keats","Ally Financial","Alteryx","Altice USA","Altra Running","Amazon/WholeFoods/Prime","American Airlines","American Eagle","American Express","American Family Insurance Group","American Greetings","Ameriprise Financial","Amica Mutual Insurance","Amika","Amorepacific","AmpliFi","Amy's Kitchen","Anastasia Beverly Hills","Andy's Frozen Custard","Anheuser-Busch","Anker","Antec","Anthropic","Anytime Fitness","Anywhere Real Estate","Apartments.com","AppLovin","Apple","Applebee's","Aprilia","Aquafina","Aquaphor","Aramark","Arby's","Arctic Cooling","Ariana Grande Fragrances","Arlo","Arm & Hammer","Armani","Article","Asana","Asbury Automotive Group","Aspiration","Assault Fitness","Assurant","Astro Gaming","Asus","Atelier Cologne","Athletic Brewing Co","Athletic Greens","Atmos Energy","Audacy","Audible","Audio-Technica","AutoNation","AutoZone","Autodesk","Avast","Aveda","Aveeno","Avene","Avis Budget Group","Avoli","BJ's Wholesale Club","BJ\u2019s Restaurants","BMW","BOK Financial","BP","Babyganics","Bacardi","Bachans","Ballboyz","Banfield Pet Hospital","Bank of America/Merrill Lynch","Bank of the Oarks","Banza","Barbie","Barclays US","BareMinerals","Barilla","BarkBox","Barracuda","Barry's","Barstool Sports","Bass Pro Shops","Bath & Body Works","Batteries Plus","Be Quiet!","Beard Guyz","Beardbrand","Beats","Beauty of Joseon","Beekman","Bell & Ross","Bell Helmets","Benefit Cosmetics","Bespoke S&E","Best Buy","BetMGM","Betterhelp","Betterment","Betterworks","Beyerdynamic","Beyond Yoga","Big Green Egg","Big Lots","Big Ten","Big Ten Network","BigCommerce","Bioderma","Biostar","BitFenix","Bitbucket","Bizzy Cold Brew","Black Rifle Coffee Company","Blackstone Griddles","Bleacher Report","Blendtec","Blink Charging","Blizzard Entertainment","Block (CashApp)","Bloom Nutrition","Bloomingdale's","Bloomin\u2019 Brands","Blue Apron","Blue Bell","Blue Diamond Almonds","Bluehost","Boar's Head","Boardroom","Body Armor","Boll & Branch","Bombas","Boohoo","Booking.com","Bosch Power Tools","Bose","Bowflex","Bowl Season","Boyd Gaming","Branded Realities","Breitling","Breville","Brex","Briggs & Riley","Brighthouse Financial","Brinker International","British Airways","Brooklinen","Brooks","Brooks Running","Brown & Brown","Brown-Forman (Jack Daniels, Woodford)","Bubly","Bucked Up","Budget","Buffalo Trace","Buffalo Wild Wings","Built Brands","Bulleit","Bulova","Bumble","Bungie","Burger King","Burlington","Burn Boot Camp","Burrow","Burt\u2019s Bees","Bylt","Byredo","CAVA","CDW","CHANEL","CHOMPS","CVS Pharmacy","Cabot","Caesars Sportsbook","Caleres","Califia Farms","Calm","Calphalon","CamelBak","Campbell's","Camping World Holdings","Can-Am","Canada Goose","Cannondale","Canon","Canva","Capital One","CarMax","Care/of","Carhartt","Caribou Coffee","Carl's Jr","Carnival Cruise Line","Carrabba\u2019s Italian Grill","Cars.com","Carter's","Carvana","Casamigos","Casio","Casper","Castelli Cycling","Catalina Crunch","Celsius/Alani","Central Garden & Pet","Centrum","Cerv\u00e9lo","Cetaphil","Champion/Authentic Brands Group","Champs/Foot Locker","Char-Broil","ChargePoint","Charles Schwab","Charlotte Tilbury","Charming Charlie","Charter Spectrum","Chase","ChatGPT","Check Point","Checkers","Cheesecake Factory","Cheniere Energy","Chesapeake Energy","Chevron","Chewy","Chick-Fil-A","Chili's","Chime","Chobani","Chock full o'Nuts","Choice Hotels","Cholula","Chord Energy","Church & Dwight","Cigna","Cinemark","Cisco","Citibank","Citigroup","Citizen","Clarks","ClassPass","Cleveland-Cliffs","Clif Bar","Clorox","Cloudflare","Club Pilates","Cl\u00e9 de Peau Beaut\u00e9","Coach","Cobra Tools","Coca-Cola","Coinbase","Cold Stone Creamery","Cole Haan","Colgate","Colgate (all brands)","ColourPop","Columbia Banking System","Columbia Sportswear","ComEd","Comcast Advertising","Comerica","Commvault","Con Edison","Concept2","Confluence","Consol Energy","Constellation Brands","Consumers Energy","Converse","Coola","Cooler Master","Copart","CorePower Yoga","CorelDRAW","Corpay","Corsair Gaming","Costco","Coterra Energy","Coty Brands (all brands)","Cougar Gaming","Country Financial","Coupang","Coursera","CoverGirl","Cracker Barrel","Craftsman","Crate & Barrel","Crayola","Creative Cloud","Credit Karma","Creo/Omnicom","Cricket Wireless","Crocs","CrossFit","CrowdStrike","Crunch Fitness","Cryorig","Cuisinart","Cullen/Frost Bankers","Culture Pop Soda","Culver's","Current","D-Link Covr","DHC","DJI","DKNY","DTE Energy","DUDE Wipes","Daily Harvest","Dairy Queen","Daisy","Dan-O Seasoning","Dannon","Danone","Datadog","Dave & Buster's","Dave's Killer Bread","David","DeWalt","Decort\u00e9","DeepCool","Deere","Dell","Delsey","Delta Air Lines","Delta Faucet","Denny's","Derma E","Designer Brands","Devon Energy","DexCom","Diageo","Diamondback Energy","Dick's Sporting Goods","Dillard's","Diptyque","Discord","Discover","Disney","Docker","DocuSign","Dolce & Gabbana","Dollar General","Dollar Shave Club","Dominion Energy","Domino's Pizza","Domo","Don Julio","DoorDash","Doritos","Dr Squatch","Dr. Jart+","Dr. Martens","DraftKings","DripDrop Hydration","Dropbox","Drunk Elephant","Ducati","Duke Energy","Dunham's Sporting Goods","Dunkin'","Durex","Dyson","E*TRADE","EA Sports","EOS","EVGA","EVgo","East West Bancorp","Echo Outdoor","Edward Jones","Eero","El Monterey","Electrify America","Eli Lilly","EltaMD","Emerson Electric","Emirates","Endeavor Group Holdings","Energica","Energizer Holdings","Enterprise Rent-A-Car","Epic Games","Equifax","Equinox","Equitable Holdings","Erie Insurance Group","Essential Phone","Est\u00e9e Lauder Companies","Etonic","Etsy","Etude House","Eucerin","Eventbrite","Everlane","Eversource Energy","EveryPlate","Evian","Expedia","Experian","Express","Extra Space Storage","Exverus Agency (Habit Burger)","Exxon Mobil","EyeBuy Direct","F5","FaZe Clan","Fabletics","Factor","Fage","Faherty Brand","Fairphone","Family Dollar","Fanatics","Fandango","Fanduel","Farmers Insurance","Fashion Nova","Feastables","FedEx","Ferrari","Ferrero","Fetch Rewards","Fiat","Fidelity","Figma","Finish Line","First Aid Beauty","First American Financial","First Citizens BancShares","First Horizon","First Horizon Bank","First National of Nebraska","Fiserv","Fisher Nuts","Fisher-Price","Fitbit","Five Below","Five Guys","Fiverr","Floor & Decor Holdings","Flowers Foods","Folgers","Force Factor","Ford Motor Company (Lincoln, T2)","Forever 21","Formula 1","Fortnite","Four Roses","Fox","Frank's RedHot","Franklin Resources","Free People","Fresh","Fresh Thyme","FreshBooks","Freshly","Frigidaire","Frontier Airlines","Frontier Communications","Fujifilm","Function of Beauty","G-III Apparel Group","GNC","GOAT","Gain","GameChanger","GameStop","Gametime","Gap","Garden of Life","Garmin","GearWrench","Geico","Gelid Solutions","Gen Digital","General Electric","General Mills","General Motors (All brands T1-T2)","Genesis Energy","Genuis Sports","Genworth Financial","Gerber Childrenswear","Giant Bicycles","Giant Eagle","Gigabyte Aorus","Giro","GitHub","GitLab","Glanbia (Optimum Nutrition)","Glassdoor","Glenfiddich","Global Payments","Glossier","Glow Recipe","GoDaddy","Gold's Gym","Goldfish","Goldman Sachs","Good Culture","Good Eat'n","Goodwipes","Google/YouTube/YTTV","Gorjana","Grailed","Gray Television","Great Clips","Great Value","Grey Goose","Grocery Outlet Holding","Group 1 Automotive","Groupon","Grubhub","Gruns","Guerlain","Guess","Guitar Center","Gymboree","Gymshark","H&M","H&R Block","HEYDUDE","HNY+","HP","HTC","Habit Burger","Hada Labo","Hamilton","Hammer Strength","Hanes","Hanna Andersson","Hardees","Harley-Davidson","Harry's","Harry\u2019s","Hasbro","Hawaiian Holdings","Headspace","Heimish","Heineken","Hendrick's","Hennessy","Her Camus Media","Herbivore Botanicals","Herm\u00e8s","Hershey","Hertz","Hewlett Packard Enterprise","Hidden Valley Ranch","High Noon","Hill's Pet Nutrition","Hilton","Hippo Insurance","Holika Holika","Home Depot","HomeAdvisor","Homefield Apparel","Honda","Honest Company","Hootsuite","Hopper","Horizon Organic","Hormel Foods","Huawei S-Series","HubSpot","Hudl","Huggies","Hugo Boss","Hulu","Hum Nutrition","Huntington Bancshares","Husqvarna","Hyatt","Hydro Flask","HyperX","Hypervolt","IAC","IBM","IHG","IHOP","IKEA","IMAX","IMG Academy","IOPE","IPSA","Iams","Illy","Impact","Impossible Foods","Indeed","Indian Motorcycle","Infiniti","Ingles Markets","Innisfree","Inno3D","Insomnia Cookies","Instacart","Instax","Intel","Interpublic Group","Intuit","Invicta","Irwin Tools","J.Crew","J.M. Smucker","JBL","JCPenney","Jabra Elite","Jack Links","Jack in the Box","Jackpocket","Jackson Hewitt","Jaguar","Janie and Jack","Jean Paul Gaultier","Jenius Bank","Jersey Mike's","Jet's Pizza","JetBlue","Jif","Jimmy John's","Jose Cuervo","Journeys","Joybird","Juniper Networks","Just Eat","Just Play","K-Swiss","K18","KFC","KLM","KOSE Sekkisei","KVD Beauty","Kanebo","Kappa","Kaspersky","Kawasaki Motorcycles","Kayak","Kellanova","Kemper","Kendra Scott","Kenvue (Tylenol)","Kering","Kerrygold","Ketel One","Keurig Dr Pepper","KeyBank","KeyCorp","Khan Academy","Kia/Hyundai/Genesis","Kimberly Clark","Kind","Kirkland Signature","KitchenAid","Klairs","Klarna","Kleenex","Kodiak Cakes","Kohl's","Kohler","Kontoor Brands","Kopari","Korean Beauty","Kose","Kotex","Kraft-Heinz","Kraken","Krispy Kreme","Krispy Krunch Foods","Kroger","Kum & Go","Kylie Cosmetics","L'Oreal (all brands)","LA Fitness","LEGO","LG","LIV","LOLA","LPGA","LVMH (all brands)","La Banderita","LaCroix","Lacoste","Lamb Weston Holdings","Lancome","Land O'Lakes","Land Rover","Laneige","Larabar","Las Vegas Sands","Laura Mercier","Lavazza","Le Creuset","Le Labo","Learfield/CLC","Lebelage","Legal Shield","Legal Zoom","Lemonade","Levi's","Lexus","Lian Li","Liberty Energy","Liberty Mutual","Lidl","Lids","Life Fitness","Lifetime Fitness","Light & Wonder","Lincoln National","LinkedIn","Linksys","Liquid Death","Liquid IV","Listerine","Lithia Motors","Little Caesars","Live Nation","LiveOn Nebraska","Living Proof","Loews Hotels","Logitech","Longines","Look Cycle","Looker","Love Wellness","Lowe's","Lucid","Lucido-L","Lufthansa","Lululemon","Lume","Lumen Technologies","Lyft","M&T Bank","MGM Resorts","MLB","MLB Draft Academy","MLB Network","MLS","MMGY Global (Visit Detroit/AA)","MSC Cruises","MSUFCU (Collegiate CU & Alumnifi Bank)","MV Agusta","Mac Tools","Macy's","MadeHoops","Madewell","Magento","Mailchimp","Main Event","Major League Pickleball","Major League Rugby","Maker's Mark","Makita","Malibu","Malwarebytes","Mammut","Manscaped","Marc Jacobs Beauty","Marco's Pizza","Marie Callender's","Marin Bikes","Mark Anthony Brands","Markel Group","MarketPryce","Marriott","Mars/Wrigley","Maserati","MassMutual","Mastercard","Match Group","Matco Tools","Mattel","Max","Maxwell House","Mazda","McCormick","McDonald's","MeUndies","Medical Mutual of Ohio","Meijer","Mercedes Benz","MetLife","Meta","Meta (brand)","Michael Kors","MicroStrategy","Microsoft (Xbox)","Midas","Milk Makeup","Milwaukee Tool","Mimecast","Mini","Mint Mobile","Miro","Missha","Mitsubishi","Mizuno","Moderna","Moen","Moncler","Monday.com","Mondelez","MoneyLion","Monos","Monster Beverage","Montblanc","Morgan Stanley","Moroccanoil","Morphe","Motorola","Movado","Mr. Clean","Mugsy Jeans","Muji Skincare","MuleSoft","Murad","Murphy USA","Mutual of Omaha","NARS","NASCAR","NBA","NBA TV","NBC Universal","NFL","NFL Network","NGL Energy Partners","NHL","NOBULL","NRG Energy","NZXT","Namecheap","Natioal Lacrosse League","National Car Rental","National Geographic","National Grid","Nationwide","Native","Nature Made","Nature Republic","Nature Valley","Nature's Bounty","Navy Federal Credit Union","Neiman Marcus","Nerf","Nest","Nestle","Netflix","Netgear","New Balance","New Era Cap Co","New York Community Bancorp","New York Life","Newell Brands","News Corp.","Nexstar Media Group","NextEra Energy","Nike/SKIMS","Nikon","Nintendo","Nissan Tier1 and Tier-2","Nivea","Noble Mobile","Noctua","Noodles & Company","Noom","NordicTrack","Nordstrom/Nordstrom Rack","Normatec","Northern Trust","Northwestern Mutual","Norton Motorcycles","NortonLifeLock","Norwegian Cruise Line","Nothing Bundt Cakes","Nutella","Nutrafol","NutriBullet","Nutrisystems","Nvidia","O'Reilly Auto Parts","ODP","OGE Energy","OGX","ONE Brands","OXO","Oakley & Luxottica designer","Oatly","Ocean Spray","Odoo","Offerpad","Office Depot","Oikos","Olaplex","Old El Paso","Old National Bancorp","Olipop","Olive Garden","Omega","On3","One A Day","OneMain Holdings","OnePlus","OpenAI","OpenTable","Opendoor","Origins","Oscar Health","OshKosh B\u2019gosh","OtterBox","Ouai","Oura Ring","Outback Steakhouse","Overstock","Overtime","Overtime Elite","O\u2019Reilly Auto Parts","P&G (all brands)","PBR","PENN Entertainment","PF Chang's","PGA Tour","PNC Financial Services","PNY","POLA","PVH","PVOLVE","Pacific Gas and Electric","Pacific Life","Paco Rabanne","Palantir","Palo Alto Networks","Panasonic","Pandora","Panera Bread","Panerai","Pantene","Papa Johns","Parachute","Paramount","Park Hotels & Resorts","Parke","Parker-Hannifin","Parrot Drones","Pathway","Paula\u2019s Choice","PayPal/Venmo","Paychex","Peabody Energy","Peacock","Peak Bank","Pearl Izumi","Peloton","PenFed Credit Union","Penhaligon\u2019s","Penn Mutual Life Insurance","Pennington","Penske Automotive Group","Pepperidge Farm","Pepsi","Perdue","Perfect Bar","Perform","Pernod Ricard","Perplexity","Perrier","PetSmart","Petco","Peter Millar","Pfizer","Phanteks","Phillips 66","Piggly Wiggly","Pintrest","Pirate's Booty","Pivot Cycles","Pizza Hut","Planet Fitness HQ and Franchise","Planet Hollywood","Planters","PlayStation","Playa Bowls","Playfly","Playtika Holding","Polar","Polaroid","Polestar","Poppi","Porch","Porter-Cable","Poshmark","Post Holdings","Postmates","PowerColor","Prada","Precor","Premier Lacrosse League","PrettyLittleThing","PriceSmart","Priceline","Prime Hydration","Primerica","Primo Water","Princess Polly","Principal Financial","ProCore","Progressive","Progresso","Proofpoint","Proper Wild","Protex","Prudential","Publicis Sports","Puma","Pure Barre","Pure Storage","Pureology","Purple","Purple Carrot","Pyunkang Yul","Qdoba","Qlik","Quaker","Qualcomm","Quay Australia","Quest","QuickBooks","QuickTrip","QuikTrip","Quince","Qurate Retail","REI","REN Clean Skincare","RH","RMK","RStudio","RXBAR","RYSE Supplements","Radisson Hotel Group","Rado","Raising Cane's","Rally House/Summit Sportswear","Rao's","Rapid7","Rare Beauty","Ray-Ban","Raymond James Financial","Razer","ReadyRX","Real Good Foods","Realtor.com","Red Bull","Red Lobster","Red Robin","Red Wing Shoes","Reddit","Redfin","Redken","Reebok","Regions Bank","ResMed","Restoration Hardware","Resy","Revolut","Revolve","Rhoback","Riboli Wines","Riddell","Ring","Riot Games","Ritual","Ritz","Rivian","Robert Half","Robinhood","Roblox","Rocket Mortgage/Rocket Money","Rockport","Rockstar Games","Rogue Fitness","Roku","Rolex","Roman","Roomba","Rooster Teeth","Ross Stores","Rothy's","Rover","Rowan","Royal Canin","Royal Enfield","Rubrik","Ruckus AP","Ruggable","Runza","Ryobi","R\u00e9my Cointreau","SAP","SAS","SEC","SEC Network","SK-II","SLM","SS&C Technologies Holdings","SUQQU","Saatva","Sabre","Sage","Saks Fifth Avenue","Sally Beauty Holdings","Salomon","Salsa Pace","Sam's Club","Samsonite","Samsung","San Pellegrino","Santa Cruz","Santander","Sapphire","Sargento","Savage X Fenty","Save A Lot","Scheels","Schmidt's","Schwan's","Schwinn","Scotts Miracle-Gro","Sea-Doo","SeaSonic","SeaWorld Parks","Seagate","Seatgeek","Securian Financial Group","Seiko","Sennheiser Gaming","Sensodyne","Sentry Insurance Group","Sephora","ServiceNow","Shake Shack","SharkNinja","Sharp Aquos","SheaMoisture","Sheetz","Shein","Shell","Sherwin-Williams","Shift4 Payments","Shiseido","Shop WSS","ShopRite","Shopify","ShotTracker","Shure","Sidi Cycling","Sierra Wireless","Silk","SilverStone","Simon Property Group","Simple Bank","Simple Skincare","Simply Orange","Sinclair","Sirius XM","Sisense","SiteGround","Six Flags","Sixt","Sketchers","Skil","Skinfood","SkinnyPop","Skippy","Skullcandy","Skyscanner","Slack","Sling TV","Smart & Final","Smithfield","Smucker's","Snap","Snowflake","Snyder's of Hanover","SoFi","Sol de Janeiro","SolidWorks","Sonic","SonicWall","Sonos","Sony","Sophos","SoulCycle","SoundCloud","Southern Company","Southwest","Spam","SpartanNash","Specialized","Spectrum Brands Holdings","Spectrum Reach/Charter","Speedway","Sperry","Spigen","Spindrift","Spinmaster","Spirit Airlines","Spirit Halloween","Splunk","Sport Clips","Sprint","SquareSpace","Sriracha","Stagwell","Stance","Stanley1913","Staples","Starbucks","State Farm Vball Showcase","State Street","Stats Perform","Staub","Steam","Stein Mart","Stellantis (Chrysler, Ram, Dodge, Jeep)","Steve Madden","Stifel Financial","Stihl","StockX","Stride Rite","Stripe","Stryker","StubHub","Studs","Subaru","Subway","Sulwhasoo","SunTrust","Super Micro Computer","Supergoop!","Sur La Table","Suunto","Suzuki Motors","Swarovski","Swatch Group","Sweetgreen","Swiss Army","Synchrony Financial","Synovus Financial","Sysco","T-Mobile","T. Rowe Price","TAG Heuer","TCL","TD Ameritrade","TD Synnex","TGI Fridays","TIAA","TIBCO Spotfire","TOMS","TONYMOLY","Tabasco","Tableau","Taco Bell","Talend","Talenti","Talkspace","Tampax","Tapestry","Target","TaskRabbit","Tatcha","Tax Slayer","TaxAct","Tea Collection","Teladoc Health","TelevisaUnivision","Teltonika","Tempur Sealy International","Tempur-Pedic","Temu","Tencent Cloud","Tenda Nova","Tenet Healthcare","Tesla","Teton Ridge","Texas Instruments","The Athletic","The Children\u2019s Place","The Container Store","The Face Shop","The Fresh Market","The Gist","The Macallan","The Ordinary","The Vitamin Shoppe","The Volume","Therabody","Thermaltake","Thinx","ThredUp","Three Cosmetics","Thrivent Financial for Lutherans","TicketMaster","Tiffany & Co","TikTok","Tile","Tillamook","Tim Hortons","Timex","Tissot","Titan Fitness","Title Boxing Club","Tito's","Toast","TopGolf","Toro","Tory Burch","Total Gym","Toyota","Tractor Supply","Trader Joe's","Traeger Grills","TransUnion","Travel + Leisure","Travelers","Travelpro","Travis Matthew","Trek Bikes","Trello","Trend Micro","TriNet Group","TripAdvisor","Triumph Motorcycles","Trojan","Tropical Smoothie Cafe","TruGreen","True Classic","True Religion","True Value","Truist","Trulia","Truly","Trupanion","Truth Initiative","Tubi","Tuft & Needle","Tumi","Tupperware","Turbo Tax","Turo","Turtle Beach","Tyson Foods","U-Boat","U-Haul","UBS","UFC","UFL","UL Solutions","UPS","US Air Force","US Bank","US Foods Holding","USAA","Uber/Uber Eats","Ubisoft","Udemy","Ugg/HOKA","Ulta Beauty","Umbro","Under Armour","Unilever","Uninterrupted","Uniqlo","United Airlines","United Natural Foods","UnitedHealth Group","Universal","Unum Group","Upbound Group","Upwork","Urban Decay","V2X","VCA","VF Corporation (Vans, North Face, Dickies)","VMware","Vail Resorts","Valero Energy","Valley National Bancorp","Valvoline","Van Wagner","Vanicream","Vans","Varo","Veeam","Ventas","Verisk","Verizon","Versace","Viasat","Victoria's Secret","Victorinox","Visa","Vista Outdoor","Vistra","Vitamin Well","Vitamix","Volvo","Voya Financial","Vrbo","Vuori","W.R. Berkley","WEX","WIlson","WNBA","WWE","Wag!","Walgreens","Walmart/Sam'sClub/Vizio","Warner Bros (HBO)","Waste Management","WatchGuard","Wave Sports + Entertainment","Wawa","Wayfair","Wealthfront","Weber Grills","WeightWatchers","Weis Markets","Welch's","Wells Fargo","Wendy's","Western Alliance Bancorp.","Western Digital","Western Union","Westin","Whataburger","Whirlpool","Whisker","White Castle","White Claw","Whoo","Whoop","Wild Turkey","Williams-Sonoma","WinCo Foods","Wingstop","Winnebago Industries","Wise","Withings","Wix","Wolfram Mathematica","Wolt","Wonderful Pistachios","Wondery","Workday","World Kinect","Worx Tools","Wrangler","Wynn Resorts","X","XFX","Xcel Energy","Xero","Xerox Holdings","Xiaomi Mi Router","Yeti","Yeti Cycles","Yoplait","Youth To The People","Yuengling","ZTE Axon","Zara","Zebra Technologies","Zelle","Zenni Optical","Zero Motorcycles","Zerto","Zillow","Zions Bancorp.","Ziprecruiter","Zoetis","Zoho","Zoom","Zotac","Zscaler","Zwift","Zyxel Nebula","amprm","biBerk Insurance","e.l.f. cosmetics","eBay/eBay Live","eXp World Holdings","enewton","iHeartMedia"]);

function isOffLimits(brandName) {
  if (!brandName) return false;
  const n = brandName.toLowerCase().trim();
  // Check exact match
  if (OFF_LIMITS_SET.has(brandName)) return true;
  // Check case-insensitive
  for (const ol of OFF_LIMITS_SET) {
    if (ol.toLowerCase().trim() === n) return true;
  }
  return false;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STATE = {
  accounts: [],
  signals: [],
  intentClusters: [],    // Intent cluster store
  surfaceLog: [],        // Track when accounts were surfaced and why
  discoveryResults: [],
  composerHistory: [],
  currentFilter: 'all',
  searchQuery: '',
  currentDrawerAccount: null,
  currentDrawerTab: 'overview',
  currentComposerTab: 'email',
  settings: {
    apolloKey: '',
    claudeKey: '',
  },
  outreachLog: {},
  followUps: []
};

// Load from localStorage
function loadState() {
  try {
    const saved = localStorage.getItem('od_sales_hub');
    if (saved) {
      const data = JSON.parse(saved);
      STATE.signals = data.signals || [];
      STATE.intentClusters = data.intentClusters || [];
      STATE.surfaceLog = data.surfaceLog || [];
      STATE.settings = data.settings || { apolloKey:'', claudeKey:'' };
      STATE.outreachLog = data.outreachLog || {};
      STATE.followUps = data.followUps || [];
      STATE.selectedContacts = data.selectedContacts || {};
      STATE.contactsByDomain = data.contactsByDomain || {};

      // Restore API keys from resilient backup store if main state is missing them
      if (!STATE.settings.apolloKey || !STATE.settings.claudeKey) {
        try {
          const keys = JSON.parse(localStorage.getItem('od_hub_keys') || '{}');
          if (keys.apolloKey) STATE.settings.apolloKey = keys.apolloKey;
          if (keys.claudeKey) STATE.settings.claudeKey = keys.claudeKey;
        } catch(e) {}
      }

      // Always sync from real CSV â€” preserve work (status, notes, touchCount) but ensure all 241 accounts exist
      const savedMap = {};
      (data.accounts || []).forEach(a => {
        if (a.company) savedMap[a.company.toLowerCase().trim()] = a;
      });

      // Rebuild from authoritative CSV, layering in any saved work
      STATE.accounts = RYAN_ACCOUNTS_CSV.map(csvAcct => {
        const key = csvAcct.company.toLowerCase().trim();
        const saved = savedMap[key];
        if (saved) {
          // Preserve user work, update structural fields from CSV
          return {
            ...csvAcct,
            status: saved.status || csvAcct.status,
            priority: saved.priority || csvAcct.priority,
            notes: saved.notes !== undefined ? saved.notes : csvAcct.notes,
            touchCount: saved.touchCount || 0,
            lastTouch: saved.lastTouch || null,
            contacts: saved.contacts || [],
          };
        }
        return csvAcct;
      });
    } else {
      // First load â€” use CSV directly
      STATE.accounts = RYAN_ACCOUNTS_CSV.map(a => ({...a}));
      // Restore any previously saved API keys
      try {
        const keys = JSON.parse(localStorage.getItem('od_hub_keys') || '{}');
        if (keys.apolloKey) STATE.settings.apolloKey = keys.apolloKey;
        if (keys.claudeKey) STATE.settings.claudeKey = keys.claudeKey;
      } catch(e) {}
    }
  } catch(e) {
    console.warn('localStorage error, loading from CSV:', e);
    STATE.accounts = RYAN_ACCOUNTS_CSV.map(a => ({...a}));
  }
  // Restore keys to settings UI
  if (STATE.settings.apolloKey) document.getElementById('apollo-key').value = STATE.settings.apolloKey;
  const proxyField = document.getElementById('apollo-proxy-url');
  STATE.settings.apolloProxyUrl = 'https://od-apollo-proxy.vercel.app/apollo';
  if (proxyField) proxyField.value = 'https://od-apollo-proxy.vercel.app/apollo';
  if (STATE.settings.claudeKey) document.getElementById('claude-key').value = STATE.settings.claudeKey;
}

function saveState() {
  localStorage.setItem('od_sales_hub', JSON.stringify({
    accounts: STATE.accounts,
    signals: STATE.signals,
    intentClusters: STATE.intentClusters,
    surfaceLog: STATE.surfaceLog,
    settings: STATE.settings,
    outreachLog: STATE.outreachLog,
    followUps: STATE.followUps || [],
    selectedContacts: STATE.selectedContacts || {}
  }));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showPanel(name) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('panel-'+name).classList.add('active');
  const navItems = document.querySelectorAll('.nav-item');
  navItems.forEach(n => {
    if (n.textContent.toLowerCase().includes(name) ||
        (name==='dashboard' && n.textContent.includes('Dashboard')) ||
        (name==='accounts' && n.textContent.includes('Account')) ||
        (name==='pipeline' && n.textContent.includes('Pipeline')) ||
        (name==='signals' && n.textContent.includes('Signal')) ||
        (name==='composer' && n.textContent.includes('Composer')) ||
        (name==='discovery' && n.textContent.includes('Discovery')) ||
        (name==='settings' && n.textContent.includes('Settings'))) {
      n.classList.add('active');
    }
  });
  if (name === 'dashboard') updateDashboard();
  if (name === 'pipeline') renderKanban();
  if (name === 'accounts') renderAccountsTable();
  if (name === 'signals') renderSignalsList();
  if (name === 'composer') { updateComposerSelect(); renderComposerICP(); var cid = document.getElementById('composer-account-select').value; if (cid) renderComposerContacts(cid); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATE / INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initDate() {
  const now = new Date();
  const opts = { weekday:'long', year:'numeric', month:'long', day:'numeric' };
  const str = now.toLocaleDateString('en-US', opts);
  document.getElementById('datechip').textContent = now.toLocaleDateString('en-US',{month:'short',day:'numeric'});
  document.getElementById('dash-date').textContent = str;
  const h = now.getHours();
  const greet = h < 12 ? 'Good morning' : h < 17 ? 'Good afternoon' : 'Good evening';
  const emoji = h < 12 ? 'â˜€ï¸' : h < 17 ? 'ğŸ‘‹' : 'ğŸŒ™';
  const el = document.getElementById('dash-greeting');
  if (el) el.textContent = `${greet}, Ryan ${emoji}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg, type='info', duration=3000) {
  const icons = {success:'âœ…',error:'âŒ',info:'â„¹ï¸'};
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.innerHTML = `<span class="toast-icon">${icons[type]||'â„¹ï¸'}</span><span>${msg}</span>`;
  document.getElementById('toast-container').appendChild(el);
  setTimeout(() => el.remove(), duration);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NIL SCORING ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function computeNILScore(account) {
  let score = 0;
  const v = (account.vertical||'').toLowerCase();
  const n = (account.company||'').toLowerCase();
  const notes = (account.notes||'').toLowerCase();
  const territory = (account.territory||'').toLowerCase();
  const all = (v + ' ' + n + ' ' + notes + ' ' + territory);

  // â”€â”€ TIER 1: Industry Fit (max 30pts) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Highest fit: brands where athlete/Gen Z marketing is already proven and budgeted
  const tier1Verticals = ['fitness','wellness','athletic','sport','activewear','outdoor','supplement',
    'nutrition','hydration','energy drink','recovery','yoga','performance','running','cycling',
    'sneaker','streetwear','dtc apparel','gen z','campus','college lifestyle','beauty','skincare',
    'grooming','hair care','gaming','esports','consumer tech wearable','headphone','earbud'];
  if (tier1Verticals.some(k => all.includes(k))) score += 30;

  // Strong fit: adjacent categories with clear Gen Z or lifestyle play
  const tier2Verticals = ['apparel','footwear','food','beverage','snack','protein','health food',
    'quick serve','fast casual','dtc','direct to consumer','consumer brand','lifestyle brand',
    'fashion','retail brand','cpg','travel','hospitality','streaming','entertainment','pet',
    'personal care','home goods','tech accessory'];
  if (!tier1Verticals.some(k => all.includes(k)) && tier2Verticals.some(k => all.includes(k))) score += 18;

  // Moderate fit: can work but requires more creative pitch
  const tier3Verticals = ['insurance','fintech','banking','automotive','telecom','software','saas',
    'b2b','recruiting','staffing','real estate','healthcare','pharma'];
  if (!tier1Verticals.some(k=>all.includes(k)) && !tier2Verticals.some(k=>all.includes(k)) 
      && tier3Verticals.some(k => all.includes(k))) score += 6;

  // â”€â”€ TIER 2: Gen Z / Athlete Affinity Signals in notes (max 20pts) â”€â”€
  const strongSignals = ['influencer','creator','ambassador','nil','athlete','college','campus',
    'gen z','tiktok','instagram reels','ugc','brand ambassador','content creator','college marketing',
    'youth marketing','lifestyle campaign'];
  const strongHits = strongSignals.filter(k => notes.includes(k)).length;
  score += Math.min(20, strongHits * 5);

  // â”€â”€ TIER 3: Business Momentum Signals (max 20pts) â”€â”€
  const momentumSignals = ['series a','series b','series c','funding','raised','launch','new product',
    'expansion','rebrand','relaunch','sponsorship','partnership','hired','new vp','new cmo',
    'new head of marketing','growth','scaling','hiring'];
  const momentumHits = momentumSignals.filter(k => notes.includes(k)).length;
  score += Math.min(20, momentumHits * 6);

  // â”€â”€ TIER 4: Priority weighting (max 12pts) â”€â”€
  if (account.priority==='hot') score += 12;
  else if (account.priority==='high') score += 8;
  else if (account.priority==='medium') score += 4;

  // â”€â”€ TIER 5: Signal intelligence boost (max 20pts) â”€â”€
  const acctSignals = STATE.signals.filter(s=>s.accountId===account.id);
  acctSignals.forEach(s => {
    if (s.type==='nil') score += 10;
    else if (s.type==='campaign') score += 8;
    else if (s.type==='funding') score += 7;
    else if (s.type==='hire') score += 6;
    else if (s.type==='product') score += 6;
    else score += 4;
  });
  score += Math.min(8, acctSignals.length * 2); // volume bonus, capped

  // â”€â”€ TIER 6: Contact/status momentum bonus â”€â”€
  if (account.status === 'meeting') score += 5;
  if (account.status === 'follow_up') score += 3;

  // â”€â”€ PENALTY: Low-fit signals in notes â”€â”€
  const lowFitSignals = ['b2b only','enterprise only','no consumer','no retail','government','nonprofit'];
  if (lowFitSignals.some(k => notes.includes(k))) score -= 15;

  return Math.min(99, Math.max(1, Math.round(score)));
}

function getNILColor(score) {
  if (score >= 75) return 'var(--green)';
  if (score >= 50) return 'var(--gold)';
  if (score >= 30) return 'var(--accent2)';
  return 'var(--muted)';
}

function renderNILScore(score) {
  const color = getNILColor(score);
  return `<div class="score-bar">
    <div class="score-track"><div class="score-fill" style="width:${score}%;background:${color}"></div></div>
    <div class="score-num" style="color:${color}">${score}</div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATUS HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STATUS_CONFIG = {
  not_contacted:  {label:'Prospecting',     badge:'badge-muted',   dot:'dot-muted',  kanban:'ğŸ¯', color:'#666',  desc:'In ICP, not yet reached'},
  contacted:      {label:'Contacted',       badge:'badge-blue',    dot:'dot-blue',   kanban:'ğŸ“¬', color:'#4a9eff', desc:'Cold email or LinkedIn sent'},
  follow_up:      {label:'Nurturing',       badge:'badge-gold',    dot:'dot-gold',   kanban:'ğŸ”', color:'#c8a84b', desc:'Multi-touch sequence active'},
  engaged:        {label:'Engaged',         badge:'badge-purple',  dot:'dot-purple', kanban:'ğŸ’¬', color:'#9b59b6', desc:'Replied or showed interest'},
  meeting:        {label:'Meeting Booked',  badge:'badge-teal',    dot:'dot-teal',   kanban:'ğŸ“…', color:'#00d4aa', desc:'Discovery call scheduled'},
  proposal:       {label:'Proposal Sent',   badge:'badge-orange',  dot:'dot-orange', kanban:'ğŸ“„', color:'#e67e22', desc:'Deck or proposal delivered'},
  negotiation:    {label:'Negotiating',     badge:'badge-red',     dot:'dot-red',    kanban:'ğŸ¤', color:'#e74c3c', desc:'Terms and pricing discussion'},
  closed:         {label:'Closed Won',      badge:'badge-accent',  dot:'dot-green',  kanban:'âœ…', color:'#2ecc71', desc:'Deal signed'}
};

// Days until an account is considered stale per stage
const STALE_DAYS = {
  not_contacted: 3,
  contacted:     5,
  follow_up:     4,
  engaged:       3,
  meeting:       2,
  proposal:      3,
  negotiation:   2,
  closed:        30
};

function getDaysSinceTouch(account) {
  if (!account.lastTouch) return 999;
  return Math.floor((Date.now() - new Date(account.lastTouch).getTime()) / 86400000);
}

function isStale(account) {
  const days = getDaysSinceTouch(account);
  const threshold = STALE_DAYS[account.status || 'not_contacted'] || 5;
  return days >= threshold;
}

function stalenessUrgency(account) {
  const days = getDaysSinceTouch(account);
  const threshold = STALE_DAYS[account.status || 'not_contacted'] || 5;
  if (days >= threshold * 2) return 'critical';
  if (days >= threshold) return 'stale';
  if (days >= threshold * 0.7) return 'warming';
  return 'fresh';
}

function logActivity(accountId, type, content, meta) {
  if (!STATE.outreachLog) STATE.outreachLog = {};
  if (!STATE.outreachLog[accountId]) STATE.outreachLog[accountId] = [];
  const entry = {
    id: Date.now() + Math.random(),
    type,       // email|call|linkedin|meeting|note|stage_change
    content,    // subject or note text
    meta: meta || {},
    date: new Date().toISOString()
  };
  STATE.outreachLog[accountId].unshift(entry);
  // Update lastTouch
  const acct = STATE.accounts.find(a => a.id == accountId);
  if (acct) {
    acct.lastTouch = entry.date;
    acct.touchCount = (acct.touchCount || 0) + 1;
  }
  saveState();
  return entry;
}

function statusBadge(status) {
  const cfg = STATUS_CONFIG[status] || STATUS_CONFIG.not_contacted;
  return `<span class="badge ${cfg.badge}">${cfg.label}</span>`;
}

function priorityRing(priority) {
  const map = {hot:'ring-hot',high:'ring-high',medium:'ring-medium',low:'ring-low'};
  const labels = {hot:'ğŸ”¥',high:'H',medium:'M',low:'L'};
  return `<div class="priority-ring ${map[priority]||'ring-low'}">${labels[priority]||'?'}</div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CSV IMPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function handleCSV(event) {
  const file = event.target.files[0];
  if (!file) return;
  Papa.parse(file, {
    header: true,
    skipEmptyLines: true,
    complete: (results) => {
      let imported = 0;
      results.data.forEach(row => {
        const company = row.Company || row.company || row.Name || row.name || row['Brand'] || Object.values(row)[0];
        if (!company || company.trim()==='') return;
        const exists = STATE.accounts.find(a => a.company.toLowerCase()===company.toLowerCase().trim());
        if (exists) return;
        STATE.accounts.push({
          id: Date.now() + Math.random(),
          company: company.trim(),
          website: (row.Website || row.website || row.Domain || row.domain || '').trim(),
          vertical: (row.Vertical || row.vertical || row.Category || row.category || 'Other').trim(),
          territory: (row.Territory || row.territory || 'National').trim(),
          priority: (row.Priority || row.priority || 'medium').toLowerCase().trim(),
          status: (row.Status || row.status || 'not_contacted').toLowerCase().replace(/ /g,'_').trim(),
          notes: (row.Notes || row.notes || '').trim(),
          touchCount: 0,
          lastTouch: null,
          createdAt: new Date().toISOString()
        });
        imported++;
      });
      saveState();
      renderAccountsTable();
      updateDashboard();
      toast(`Imported ${imported} accounts`, 'success');
      document.getElementById('csv-template-notice').style.display='none';
      event.target.value='';
    },
    error: () => toast('CSV parse error â€” check format', 'error')
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACCOUNT MANAGEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getFilteredAccounts() {
  let list = [...STATE.accounts];
  if (STATE.currentFilter !== 'all') {
    if (STATE.currentFilter === 'hot') list = list.filter(a=>a.priority==='hot');
    else if (STATE.currentFilter === 'brand_draft') list = list.filter(a=>a.bucket==='brand_draft');
    else if (STATE.currentFilter === 'prospecting') list = list.filter(a=>a.bucket==='prospecting');
    else list = list.filter(a=>a.status===STATE.currentFilter);
  }
  if (STATE.searchQuery) {
    const q = STATE.searchQuery.toLowerCase();
    list = list.filter(a =>
      a.company.toLowerCase().includes(q) ||
      (a.vertical||'').toLowerCase().includes(q) ||
      (a.territory||'').toLowerCase().includes(q) ||
      (a.notes||'').toLowerCase().includes(q)
    );
  }
  // Sort by NIL score desc
  list.sort((a,b) => computeNILScore(b) - computeNILScore(a));
  return list;
}

function renderAccountsTable() {
  const accounts = getFilteredAccounts();
  const tbody = document.getElementById('accounts-tbody');
  if (accounts.length === 0) {
    tbody.innerHTML = `<tr><td colspan="9"><div class="empty-state"><span class="empty-icon">ğŸ¢</span><h3>${STATE.accounts.length===0?'No accounts loaded':'No accounts match your filter'}</h3><p>${STATE.accounts.length===0?'Import a CSV or add accounts manually':'Try a different filter or search term'}</p></div></td></tr>`;
    return;
  }
  tbody.innerHTML = accounts.map(a => {
    const score = computeNILScore(a);
    const acctSignals = STATE.signals.filter(s=>s.accountId===a.id);
    const lastTouch = a.lastTouch ? new Date(a.lastTouch).toLocaleDateString('en-US',{month:'short',day:'numeric'}) : 'â€”';
    return `<tr onclick="openDrawer('${a.id}')" style="cursor:pointer">
      <td>${priorityRing(a.priority)}</td>
      <td><div style="font-weight:600;font-size:13px">${a.company}</div><div style="font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;display:flex;gap:5px;align-items:center;margin-top:2px">${a.bucket==='brand_draft'?'<span style=\"background:rgba(240,180,41,0.15);color:var(--gold);border-radius:3px;padding:1px 5px;font-size:9px;font-weight:700\">BRAND DRAFT</span>':'<span style=\"background:rgba(255,255,255,0.06);color:var(--muted);border-radius:3px;padding:1px 5px;font-size:9px\">PROSPECTING</span>'}${a.website?'<span>'+a.website+'</span>':''}</div></td>
      <td><span class="tag">${a.vertical||'â€”'}</span></td>
      <td><span style="font-size:12px;color:var(--muted2)">${a.territory||'â€”'}</span></td>
      <td>${renderNILScore(score)}</td>
      <td>${statusBadge(a.status)}</td>
      <td>${acctSignals.length>0?`<span class="badge badge-accent">âš¡ ${acctSignals.length}</span>`:'<span style="color:var(--muted);font-size:12px">â€”</span>'}</td>
      <td><span style="font-size:12px;color:var(--muted2)">${lastTouch}</span></td>
      <td onclick="event.stopPropagation()" style="display:flex;gap:6px">
        <button class="btn btn-xs btn-secondary" onclick="composerFromTop15('${a.id}')">âœï¸</button>
        <button class="btn btn-xs btn-ghost" onclick="scanAccount('${a.id}')">ğŸ“¡</button>
        <button class="btn btn-xs btn-danger" onclick="deleteAccount('${a.id}')">âœ•</button>
      </td>
    </tr>`;
  }).join('');
}

function filterAccounts(filter, el) {
  STATE.currentFilter = filter;
  document.querySelectorAll('.filter-chip').forEach(c=>c.classList.remove('active'));
  if (el) el.classList.add('active');
  renderAccountsTable();
}

function searchAccounts(q) {
  STATE.searchQuery = q;
  renderAccountsTable();
}

function deleteAccount(id) {
  STATE.accounts = STATE.accounts.filter(a=>a.id!=id);
  STATE.signals = STATE.signals.filter(s=>s.accountId!=id);
  saveState();
  renderAccountsTable();
  updateDashboard();
  toast('Account removed', 'info');
}

function openAddAccount() {
  document.getElementById('csv-template-notice').style.display='block';
  openModal('add-modal');
}

function saveNewAccount() {
  const company = document.getElementById('add-company').value.trim();
  if (!company) { toast('Company name required','error'); return; }
  STATE.accounts.push({
    id: Date.now()+Math.random(),
    company,
    website: document.getElementById('add-website').value.trim(),
    vertical: document.getElementById('add-vertical').value,
    territory: document.getElementById('add-territory').value,
    priority: document.getElementById('add-priority').value,
    status: document.getElementById('add-status').value,
    notes: document.getElementById('add-notes').value.trim(),
    touchCount: 0,
    lastTouch: null,
    createdAt: new Date().toISOString()
  });
  saveState();
  renderAccountsTable();
  updateDashboard();
  closeModal('add-modal');
  toast(`${company} added`, 'success');
  ['add-company','add-website','add-notes'].forEach(id=>document.getElementById(id).value='');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DRAWER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ ACTIVITY LOGGING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ACTIVITY_CONFIG = {
  email:        { icon:'ğŸ“§', label:'Email Sent',   color:'#4a9eff', badge:'badge-blue'   },
  call:         { icon:'ğŸ“', label:'Called',        color:'#2ecc71', badge:'badge-green'  },
  voicemail:    { icon:'ğŸ“¬', label:'Voicemail',     color:'#9b59b6', badge:'badge-purple' },
  linkedin:     { icon:'ğŸ’¼', label:'LinkedIn DM',   color:'#0077b5', badge:'badge-blue'   },
  meeting:      { icon:'ğŸ“…', label:'Meeting',       color:'#00d4aa', badge:'badge-teal'   },
  note:         { icon:'ğŸ“', label:'Note',          color:'#c8a84b', badge:'badge-gold'   },
  stage_change: { icon:'ğŸ”„', label:'Stage Change',  color:'#888',    badge:'badge-muted'  },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FOLLOW-UP SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function createFollowUp(accountId, activityEntry, daysFromNow, customDate) {
  const account = STATE.accounts.find(a => a.id == accountId);
  if (!account) return null;
  const dueAt = customDate
    ? new Date(customDate + 'T09:00:00').toISOString()
    : new Date(Date.now() + daysFromNow * 24*60*60*1000).toISOString();
  const fu = {
    id: 'fu_' + Date.now() + '_' + Math.random().toString(36).slice(2,8),
    accountId: accountId,
    accountName: account.company,
    createdAt: new Date().toISOString(),
    dueAt: dueAt,
    status: 'open',
    completedAt: null,
    sourceActivityId: activityEntry ? activityEntry.id : null,
    sourceActivityType: activityEntry ? activityEntry.type : 'note',
    sourceActivityNotes: activityEntry ? (activityEntry.content || '').substring(0, 300) : '',
    contactsSnapshot: activityEntry?.meta?.contact ? [activityEntry.meta.contact] : []
  };
  if (!STATE.followUps) STATE.followUps = [];
  STATE.followUps.push(fu);
  // Link back to activity
  if (activityEntry) activityEntry.followUpId = fu.id;
  saveState();
  return fu;
}

function completeFollowUp(fuId) {
  const fu = (STATE.followUps||[]).find(f => f.id === fuId);
  if (fu) {
    fu.status = 'completed';
    fu.completedAt = new Date().toISOString();
    saveState();
    renderFollowUpQueue();
    updateDashboard();
    toast('Follow-up marked done', 'success', 1500);
  }
}

function snoozeFollowUp(fuId, days) {
  const fu = (STATE.followUps||[]).find(f => f.id === fuId);
  if (fu) {
    fu.dueAt = new Date(Date.now() + days * 24*60*60*1000).toISOString();
    saveState();
    renderFollowUpQueue();
    toast(`Snoozed ${days}d`, 'success', 1500);
  }
}

function deleteFollowUp(fuId) {
  STATE.followUps = (STATE.followUps||[]).filter(f => f.id !== fuId);
  saveState();
  renderFollowUpQueue();
}

function getFollowUpStatus(fu) {
  if (fu.status === 'completed') return 'completed';
  const today = new Date();
  today.setHours(0,0,0,0);
  const due = new Date(fu.dueAt);
  due.setHours(0,0,0,0);
  const tomorrow = new Date(today);
  tomorrow.setDate(tomorrow.getDate() + 1);
  if (due < today) return 'overdue';
  if (due.getTime() === today.getTime()) return 'due_today';
  return 'upcoming';
}

function getFollowUpCounts() {
  const fups = (STATE.followUps||[]).filter(f => f.status === 'open');
  let overdue = 0, dueToday = 0, upcoming = 0;
  fups.forEach(f => {
    const s = getFollowUpStatus(f);
    if (s === 'overdue') overdue++;
    else if (s === 'due_today') dueToday++;
    else if (s === 'upcoming') upcoming++;
  });
  return { overdue, dueToday, upcoming, total: overdue + dueToday + upcoming };
}

function formatDueDate(isoStr) {
  const d = new Date(isoStr);
  const today = new Date(); today.setHours(0,0,0,0);
  const due = new Date(d); due.setHours(0,0,0,0);
  const diff = Math.round((due - today) / (24*60*60*1000));
  if (diff === 0) return 'Today';
  if (diff === 1) return 'Tomorrow';
  if (diff === -1) return 'Yesterday';
  if (diff < -1) return Math.abs(diff) + 'd overdue';
  if (diff <= 7) return 'in ' + diff + 'd';
  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

// Show the schedule follow-up UI after logging
function showFollowUpScheduler(accountId, activityEntry) {
  const formEl = document.getElementById(`quick-log-form-${accountId}`);
  if (!formEl) return;
  const dueLabel = (days) => {
    const d = new Date(Date.now() + days*24*60*60*1000);
    return d.toLocaleDateString('en-US', {month:'short', day:'numeric'});
  };
  formEl.innerHTML = `
    <div style="background:rgba(0,212,170,0.06);border:1px solid rgba(0,212,170,0.2);border-radius:var(--radius);padding:10px 12px">
      <div style="font-size:10px;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:8px">ğŸ“… Schedule Follow-up</div>
      <div style="display:flex;gap:6px;flex-wrap:wrap">
        <button onclick="scheduleFollowUp('${accountId}',${activityEntry.id},3)" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:6px 14px;font-size:11px;font-weight:700;color:var(--text1);cursor:pointer">3d <span style="font-size:9px;color:var(--muted)">${dueLabel(3)}</span></button>
        <button onclick="scheduleFollowUp('${accountId}',${activityEntry.id},5)" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:6px 14px;font-size:11px;font-weight:700;color:var(--text1);cursor:pointer">5d <span style="font-size:9px;color:var(--muted)">${dueLabel(5)}</span></button>
        <button onclick="scheduleFollowUp('${accountId}',${activityEntry.id},7)" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:6px 14px;font-size:11px;font-weight:700;color:var(--text1);cursor:pointer">7d <span style="font-size:9px;color:var(--muted)">${dueLabel(7)}</span></button>
        <input type="date" id="fu-custom-${accountId}" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:4px 8px;font-size:11px;color:var(--text1);font-family:inherit" onchange="scheduleFollowUp('${accountId}',${activityEntry.id},0,this.value)">
        <button onclick="skipFollowUp('${accountId}')" style="background:none;border:none;color:var(--muted);font-size:10px;cursor:pointer;padding:6px 8px">Skip</button>
      </div>
    </div>`;
  formEl.style.display = 'block';
}

function scheduleFollowUp(accountId, activityId, days, customDate) {
  const log = STATE.outreachLog[accountId] || [];
  const entry = log.find(e => e.id === activityId);
  const fu = createFollowUp(accountId, entry, days, customDate);
  if (fu) {
    const label = customDate ? new Date(customDate).toLocaleDateString('en-US',{month:'short',day:'numeric'}) : days + 'd';
    toast(`ğŸ“… Follow-up scheduled for ${label}`, 'success', 2000);
  }
  // Hide scheduler and re-render
  const formEl = document.getElementById(`quick-log-form-${accountId}`);
  if (formEl) formEl.style.display = 'none';
  drawerTab('outreach', document.querySelector('.section-tab.active'));
  renderFollowUpQueue();
  updateDashboard();
}

function skipFollowUp(accountId) {
  const formEl = document.getElementById(`quick-log-form-${accountId}`);
  if (formEl) formEl.style.display = 'none';
}

// Schedule a follow-up independently of any activity
function scheduleStandaloneFollowUp(accountId, days, customDate) {
  const account = STATE.accounts.find(a => a.id == accountId);
  if (!account) return;
  const noteEl = document.getElementById(`fu-note-${accountId}`);
  const note = noteEl ? noteEl.value.trim() : '';

  const dueAt = customDate
    ? new Date(customDate + 'T09:00:00').toISOString()
    : new Date(Date.now() + days * 24*60*60*1000).toISOString();

  const fu = {
    id: 'fu_' + Date.now() + '_' + Math.random().toString(36).slice(2,8),
    accountId: accountId,
    accountName: account.company,
    createdAt: new Date().toISOString(),
    dueAt: dueAt,
    status: 'open',
    completedAt: null,
    sourceActivityId: null,
    sourceActivityType: 'note',
    sourceActivityNotes: note || 'Scheduled follow-up',
    contactsSnapshot: []
  };
  if (!STATE.followUps) STATE.followUps = [];
  STATE.followUps.push(fu);
  saveState();

  const label = customDate ? new Date(customDate).toLocaleDateString('en-US',{month:'short',day:'numeric'}) : days + 'd';
  toast(`ğŸ“… Follow-up scheduled for ${label}`, 'success', 2000);

  // Re-render
  drawerTab('outreach', document.querySelector('.section-tab.active'));
  renderFollowUpQueue();
  updateDashboard();
}

var _pendingLogType = null;

function quickLog(accountId, type) {
  _pendingLogType = type;
  const formEl = document.getElementById(`quick-log-form-${accountId}`);
  const inputEl = document.getElementById(`quick-log-input-${accountId}`);
  if (!formEl) return;
  const cfg = ACTIVITY_CONFIG[type] || {};
  formEl.style.display = 'block';
  if (inputEl) {
    inputEl.placeholder = {
      email: 'Subject line or notes (e.g. "Sent creative brief")',
      call: 'Call notes (e.g. "Spoke with Sarah, interested in Q2")',
      voicemail: 'Voicemail left (e.g. "Left VM re: NIL activation idea")',
      linkedin: 'Message notes (e.g. "Sent connection request + note")',
      meeting: 'Meeting details (e.g. "Discovery call booked for March 3")',
      note: 'Type your note...'
    }[type] || 'Add details...';
    inputEl.focus();
  }
}

function cancelQuickLog(accountId) {
  _pendingLogType = null;
  const formEl = document.getElementById(`quick-log-form-${accountId}`);
  if (formEl) formEl.style.display = 'none';
  const inputEl = document.getElementById(`quick-log-input-${accountId}`);
  if (inputEl) inputEl.value = '';
}

function commitQuickLog(accountId) {
  if (!_pendingLogType) return;
  const inputEl = document.getElementById(`quick-log-input-${accountId}`);
  const detail = inputEl ? inputEl.value.trim() : '';
  const cfg = ACTIVITY_CONFIG[_pendingLogType];
  const content = detail || cfg.label;
  const entry = logActivity(accountId, _pendingLogType, content, { detail });
  const logType = _pendingLogType;

  // Clear input but don't hide form yet (scheduler will use it)
  if (inputEl) inputEl.value = '';
  _pendingLogType = null;

  // Auto-advance stage on key activities
  const acct = STATE.accounts.find(a => a.id == accountId);
  if (acct) {
    if (logType === 'meeting' && acct.status === 'engaged') {
      acct.status = 'meeting';
      toast(`${acct.company} â†’ Meeting Booked ğŸ“…`, 'success', 2500);
    } else if (logType === 'email' && acct.status === 'not_contacted') {
      acct.status = 'contacted';
      toast(`${acct.company} â†’ Contacted ğŸ“¬`, 'success', 2000);
    }
    saveState();
  }
  renderKanban();
  updateDashboard();
  toast(`${cfg.icon} ${cfg.label} logged`, 'success', 1800);

  // Show follow-up scheduler (for actionable activity types)
  if (['email','call','voicemail','linkedin','meeting'].includes(logType)) {
    showFollowUpScheduler(accountId, entry);
  } else {
    // For notes/stage changes, just re-render
    drawerTab('outreach', document.querySelector('.section-tab.active'));
  }
}

function renderActivityTimeline(log) {
  const groups = {};
  log.forEach(entry => {
    const d = new Date(entry.date);
    const key = d.toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'});
    if (!groups[key]) groups[key] = [];
    groups[key].push(entry);
  });

  return Object.entries(groups).map(([date, entries]) => `
    <div style="margin-bottom:16px">
      <div style="font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:8px;display:flex;align-items:center;gap:8px">
        <div style="height:1px;flex:1;background:var(--border)"></div>
        ${date}
        <div style="height:1px;flex:1;background:var(--border)"></div>
      </div>
      ${entries.map(entry => {
        const cfg = ACTIVITY_CONFIG[entry.type] || ACTIVITY_CONFIG.note;
        const m = entry.meta || {};
        const time = new Date(entry.date).toLocaleTimeString('en-US', {hour:'numeric', minute:'2-digit'});
        const entryId = String(entry.id).replace(/\./g,'_');

        // Contact pill
        const contactPill = m.contact
          ? `<span style="display:inline-flex;align-items:center;gap:4px;background:${cfg.color}15;border:1px solid ${cfg.color}30;border-radius:12px;padding:2px 8px;font-size:10px;font-weight:600;color:${cfg.color};margin-right:6px">
               ğŸ‘¤ ${m.contact}${m.contactTitle ? ' Â· '+m.contactTitle : ''}
             </span>`
          : '';

        // Tab badge (email type / linkedin DM / call prep etc)
        const tabBadge = m.tabLabel && m.tabLabel !== cfg.label
          ? `<span style="background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:1px 6px;font-size:9px;font-weight:700;color:var(--muted2);font-family:'DM Mono',monospace">${m.tabLabel}</span>`
          : '';

        // Subject line
        const subjectLine = m.subject
          ? `<div style="font-size:12px;font-weight:700;color:var(--text1);margin:5px 0 3px">"${m.subject}"</div>`
          : '';

        // Body preview â€” expandable
        const preview = m.bodyPreview
          ? `<div style="margin-top:6px">
               <div id="preview-short-${entryId}" style="font-size:11.5px;color:var(--text2);line-height:1.6;font-style:italic;background:var(--surface);border-left:2px solid ${cfg.color}60;padding:7px 10px;border-radius:0 4px 4px 0">
                 "${m.bodyPreview}"
               </div>
             </div>`
          : '';

        return `
          <div style="display:flex;gap:10px;margin-bottom:10px;align-items:flex-start">
            <div style="display:flex;flex-direction:column;align-items:center;flex-shrink:0">
              <div style="width:30px;height:30px;border-radius:50%;background:${cfg.color}18;border:1px solid ${cfg.color}50;display:flex;align-items:center;justify-content:center;font-size:14px">${cfg.icon}</div>
              <div style="width:1px;background:var(--border);flex:1;min-height:8px;margin-top:3px"></div>
            </div>
            <div style="flex:1;min-width:0;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);padding:10px 13px;margin-bottom:2px">
              <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:8px;margin-bottom:4px">
                <div style="flex:1;min-width:0">
                  <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap;margin-bottom:3px">
                    <span style="font-size:11px;font-weight:800;color:${cfg.color};text-transform:uppercase;letter-spacing:0.04em">${cfg.label}</span>
                    ${tabBadge}
                    <span style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;margin-left:auto">${time}</span>
                  </div>
                  ${contactPill ? '<div style="margin-bottom:4px">'+contactPill+'</div>' : ''}
                  <div style="font-size:12.5px;font-weight:600;color:var(--text1)">${entry.content || 'â€”'}</div>
                  ${subjectLine}
                  ${preview}
                  ${(() => {
                    // Show linked follow-up if one exists
                    if (!entry.followUpId) return '';
                    const linkedFu = (STATE.followUps||[]).find(f => f.id === entry.followUpId);
                    if (!linkedFu) return '';
                    const fuSt = getFollowUpStatus(linkedFu);
                    const fuColor = fuSt==='completed'?'#2ecc71':fuSt==='overdue'?'#e74c3c':fuSt==='due_today'?'#e67e22':'var(--accent)';
                    const fuLabel = fuSt==='completed'?'âœ“ Followed up':fuSt==='overdue'?'âš  Follow-up overdue':fuSt==='due_today'?'ğŸ“… Follow-up due today':'ğŸ“… Follow-up ' + formatDueDate(linkedFu.dueAt);
                    return `<div style="margin-top:6px;display:inline-flex;align-items:center;gap:6px;background:${fuColor}10;border:1px solid ${fuColor}30;border-radius:4px;padding:3px 8px">
                      <span style="font-size:10px;font-weight:700;color:${fuColor}">${fuLabel}</span>
                      ${linkedFu.status==='open'?`<button onclick="event.stopPropagation();completeFollowUp('${linkedFu.id}');drawerTab('outreach',document.querySelector('.section-tab.active'))" style="background:${fuColor};color:#fff;border:none;border-radius:3px;padding:1px 5px;font-size:8px;font-weight:700;cursor:pointer;margin-left:4px">âœ“</button>`:''}
                    </div>`;
                  })()}
                </div>
                <button onclick="deleteActivity('${entry.id}')" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:11px;padding:2px 5px;opacity:0.35;flex-shrink:0" title="Delete">âœ•</button>
              </div>
            </div>
          </div>`;
      }).join('')}
    </div>`).join('');
}

function deleteActivity(entryId) {
  const accountId = STATE.currentDrawerAccount?.id;
  if (!accountId || !STATE.outreachLog[accountId]) return;
  const eid = String(entryId);
  STATE.outreachLog[accountId] = STATE.outreachLog[accountId].filter(e => String(e.id) !== eid);
  // Also remove linked follow-ups
  STATE.followUps = (STATE.followUps||[]).filter(f => String(f.sourceActivityId) !== eid);
  saveState();
  drawerTab('outreach', document.querySelector('.section-tab.active'));
  renderFollowUpQueue();
  toast('Activity deleted', 'info', 1500);
}

// â”€â”€ FOLLOW-UP QUEUE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderFollowUpQueue(filterOverride) {
  const container = document.getElementById('follow-up-queue');
  if (!container) return;

  const fups = (STATE.followUps || []).filter(f => f.status === 'open');
  const counts = getFollowUpCounts();

  const countEl = document.getElementById('queue-stale-count');
  if (countEl) countEl.textContent = counts.total > 0 ? `Â· ${counts.overdue + counts.dueToday} need attention` : '';

  // Update the dashboard stat card
  const statEl = document.getElementById('stat-followups');
  if (statEl) statEl.textContent = counts.overdue + counts.dueToday;

  if (fups.length === 0) {
    // Fall back to staleness-based queue if no scheduled follow-ups
    renderStalenessQueue(container);
    return;
  }

  // Sort: overdue first, then due today, then upcoming by soonest
  const statusOrder = { overdue: 0, due_today: 1, upcoming: 2 };
  const sorted = fups.map(f => ({ ...f, _status: getFollowUpStatus(f) }))
    .sort((a, b) => {
      const oa = statusOrder[a._status] ?? 3;
      const ob = statusOrder[b._status] ?? 3;
      if (oa !== ob) return oa - ob;
      return new Date(a.dueAt) - new Date(b.dueAt);
    });

  // Filter tabs
  const filter = filterOverride || 'all';
  const filtered = filter === 'all' ? sorted :
    filter === 'overdue' ? sorted.filter(f => f._status === 'overdue') :
    filter === 'due_today' ? sorted.filter(f => f._status === 'due_today') :
    filter === 'upcoming' ? sorted.filter(f => f._status === 'upcoming') : sorted;

  const tabActive = (t) => t === filter ? 'background:var(--accent);color:#000' : 'background:var(--surface);color:var(--muted)';

  const statusColors = { overdue: '#e74c3c', due_today: '#e67e22', upcoming: 'var(--accent)' };
  const statusLabels = { overdue: 'OVERDUE', due_today: 'DUE TODAY', upcoming: 'UPCOMING' };

  container.innerHTML = `
    <div style="display:flex;gap:6px;margin-bottom:12px">
      <button onclick="renderFollowUpQueue('all')" style="border:none;border-radius:20px;padding:4px 12px;font-size:10px;font-weight:700;cursor:pointer;${tabActive('all')}">All (${fups.length})</button>
      <button onclick="renderFollowUpQueue('overdue')" style="border:none;border-radius:20px;padding:4px 12px;font-size:10px;font-weight:700;cursor:pointer;${tabActive('overdue')}">Overdue (${counts.overdue})</button>
      <button onclick="renderFollowUpQueue('due_today')" style="border:none;border-radius:20px;padding:4px 12px;font-size:10px;font-weight:700;cursor:pointer;${tabActive('due_today')}">Due Today (${counts.dueToday})</button>
      <button onclick="renderFollowUpQueue('upcoming')" style="border:none;border-radius:20px;padding:4px 12px;font-size:10px;font-weight:700;cursor:pointer;${tabActive('upcoming')}">Upcoming (${counts.upcoming})</button>
    </div>
    ${filtered.length === 0 ? '<div style="text-align:center;padding:20px;color:var(--muted);font-size:12px">No follow-ups in this view.</div>' :
      filtered.slice(0, 30).map(fu => {
        const uColor = statusColors[fu._status] || 'var(--muted)';
        const uLabel = statusLabels[fu._status] || '';
        const cfg = ACTIVITY_CONFIG[fu.sourceActivityType] || ACTIVITY_CONFIG.note;
        const dueLabel = formatDueDate(fu.dueAt);
        const notes = fu.sourceActivityNotes || '';
        const account = STATE.accounts.find(a => a.id == fu.accountId);
        const score = account ? computeNILScore(account) : 0;
        return `<div style="display:flex;align-items:center;gap:12px;padding:11px 14px;background:var(--surface);border:1px solid var(--border);border-left:3px solid ${uColor};border-radius:var(--radius);margin-bottom:6px;cursor:pointer" onclick="openDrawer('${fu.accountId}');setTimeout(()=>drawerTab('outreach',document.querySelector('.section-tab')),100)">
          <div style="text-align:center;min-width:44px">
            <div style="font-size:14px;font-weight:800;color:${uColor};line-height:1">${dueLabel}</div>
            <div style="font-size:8px;color:var(--muted);letter-spacing:0.05em;margin-top:2px">${uLabel}</div>
          </div>
          <div style="flex:1;min-width:0">
            <div style="display:flex;align-items:center;gap:7px;margin-bottom:2px">
              <span style="font-size:13px;font-weight:700;color:var(--text1)">${fu.accountName}</span>
              <span style="font-size:10px;color:${cfg.color}">${cfg.icon} ${cfg.label}</span>
            </div>
            ${notes ? `<div style="font-size:10px;color:var(--muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:400px">${notes.substring(0,80)}${notes.length>80?'â€¦':''}</div>` : ''}
          </div>
          <div style="display:flex;align-items:center;gap:6px;flex-shrink:0" onclick="event.stopPropagation()">
            <div style="font-size:14px;font-weight:800;color:${score>=75?'#2ecc71':score>=50?'#c8a84b':'#666'};font-family:'DM Mono',monospace">${score}</div>
            <button onclick="completeFollowUp('${fu.id}')" style="background:#2ecc71;color:#fff;border:none;border-radius:4px;padding:4px 8px;font-size:9px;font-weight:700;cursor:pointer" title="Mark done">âœ“</button>
            <button onclick="snoozeFollowUp('${fu.id}',1)" style="background:var(--surface2);color:var(--muted2);border:1px solid var(--border);border-radius:4px;padding:4px 6px;font-size:9px;font-weight:700;cursor:pointer" title="Snooze 1d">+1d</button>
            <button onclick="snoozeFollowUp('${fu.id}',3)" style="background:var(--surface2);color:var(--muted2);border:1px solid var(--border);border-radius:4px;padding:4px 6px;font-size:9px;font-weight:700;cursor:pointer" title="Snooze 3d">+3d</button>
          </div>
        </div>`;
      }).join('')}`;
}

// Fallback: staleness-based queue when no scheduled follow-ups exist
function renderStalenessQueue(container) {
  const staleAccounts = STATE.accounts
    .filter(a => a.status !== 'closed')
    .map(a => ({
      account: a,
      days: getDaysSinceTouch(a),
      urgency: stalenessUrgency(a),
      score: computeNILScore(a)
    }))
    .filter(x => x.urgency === 'critical' || x.urgency === 'stale' || x.urgency === 'warming')
    .sort((a, b) => {
      const uOrder = {critical:0, stale:1, warming:2, fresh:3};
      if (uOrder[a.urgency] !== uOrder[b.urgency]) return uOrder[a.urgency] - uOrder[b.urgency];
      return b.score - a.score;
    });

  const countEl = document.getElementById('queue-stale-count');
  if (countEl) countEl.textContent = staleAccounts.length > 0 ? `Â· ${staleAccounts.length} need attention` : '';

  if (staleAccounts.length === 0) {
    container.innerHTML = `<div style="text-align:center;padding:32px;color:var(--muted)">
      <div style="font-size:32px;margin-bottom:8px">âœ…</div>
      <div style="font-weight:700">You're all caught up!</div>
      <div style="font-size:12px;margin-top:4px">No accounts need attention right now.</div>
    </div>`;
    return;
  }

  const urgencyColors = {critical:'#e74c3c', stale:'#e67e22', warming:'#c8a84b'};
  const urgencyLabels = {critical:'OVERDUE', stale:'STALE', warming:'FOLLOW UP'};

  container.innerHTML = staleAccounts.slice(0, 25).map(({account, days, urgency, score}) => {
    const cfg = STATUS_CONFIG[account.status || 'not_contacted'];
    const uColor = urgencyColors[urgency];
    const lastLog = (STATE.outreachLog[account.id]||[])[0];
    const lastActivity = lastLog
      ? `Last: ${ACTIVITY_CONFIG[lastLog.type]?.icon||'ğŸ“‹'} ${lastLog.content?.substring(0,40)}${lastLog.content?.length>40?'â€¦':''}`
      : 'Never contacted';

    return `<div style="display:flex;align-items:center;gap:12px;padding:11px 14px;background:var(--surface);border:1px solid var(--border);border-left:3px solid ${uColor};border-radius:var(--radius);margin-bottom:6px;cursor:pointer" onclick="openDrawer('${account.id}');setTimeout(()=>drawerTab('outreach',document.querySelector('.section-tab')),100)">
      <div style="text-align:center;min-width:36px">
        <div style="font-size:16px;font-weight:800;color:${uColor};line-height:1">${days===999?'âˆ':days}</div>
        <div style="font-size:8px;color:var(--muted);letter-spacing:0.05em">DAYS</div>
      </div>
      <div style="flex:1;min-width:0">
        <div style="display:flex;align-items:center;gap:7px;margin-bottom:2px">
          <span style="font-size:13px;font-weight:700;color:var(--text1)">${account.company}</span>
          <span style="font-size:9px;font-weight:800;color:${uColor};letter-spacing:0.06em">${urgencyLabels[urgency]}</span>
        </div>
        <div style="display:flex;align-items:center;gap:6px">
          <span style="font-size:10px;color:var(--muted2)">${cfg?.label||account.status}</span>
          <span style="color:var(--border)">Â·</span>
          <span style="font-size:10px;color:var(--muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${lastActivity}</span>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:8px;flex-shrink:0">
        <div style="font-size:14px;font-weight:800;color:${score>=75?'#2ecc71':score>=50?'#c8a84b':'#666'};font-family:'DM Mono',monospace">${score}</div>
        <button onclick="event.stopPropagation();quickLogFromQueue('${account.id}')" style="background:var(--accent);color:#000;border:none;border-radius:var(--radius);padding:5px 10px;font-size:10px;font-weight:800;cursor:pointer">LOG â†’</button>
      </div>
    </div>`;
  }).join('');
}

function quickLogFromQueue(accountId) {
  openDrawer(accountId);
  setTimeout(() => drawerTab('outreach', document.querySelector('.section-tab')), 150);
}

function openDrawer(id) {
  const account = STATE.accounts.find(a=>a.id==id);
  if (!account) return;
  STATE.currentDrawerAccount = account;
  document.getElementById('drawer-company').textContent = account.company;
  document.getElementById('drawer-meta').textContent = `${account.vertical||''} Â· ${account.territory||''} Â· ${account.website||''}`;
  document.getElementById('drawer-overlay').classList.add('open');
  document.getElementById('account-drawer').classList.add('open');
  drawerTab('overview', document.querySelector('.section-tab'));
}

function closeDrawer() {
  document.getElementById('drawer-overlay').classList.remove('open');
  document.getElementById('account-drawer').classList.remove('open');
}

function drawerTab(tab, el) {
  STATE.currentDrawerTab = tab;
  document.querySelectorAll('.section-tab').forEach(t=>t.classList.remove('active'));
  if (el) el.classList.add('active');
  const account = STATE.currentDrawerAccount;
  if (!account) return;
  const score = computeNILScore(account);
  const acctSignals = STATE.signals.filter(s=>s.accountId===account.id);
  const log = STATE.outreachLog[account.id] || [];

  let html = '';
  if (tab === 'overview') {
    html = `
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:16px">
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px">
          <div class="form-label">NIL FIT SCORE</div>
          <div style="font-family:'Syne',sans-serif;font-size:36px;font-weight:800;color:${getNILColor(score)}">${score}</div>
          <div style="font-size:11px;color:var(--muted)">out of 99</div>
        </div>
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px">
          <div class="form-label">STATUS</div>
          ${statusBadge(account.status)}
          <div style="margin-top:8px;font-size:12px;color:var(--muted)">Touch count: ${account.touchCount||0}</div>
        </div>
        <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px">
          <div class="form-label">BUCKET</div>
          <span class="badge ${account.bucket==='brand_draft'?'badge-gold':'badge-muted'}">${account.bucket==='brand_draft'?'ğŸ“‹ Brand Draft':'ğŸ” Prospecting'}</span>
          <div style="margin-top:8px;font-size:12px;color:var(--muted)">${account.vertical||'â€”'}</div>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Update Status</label>
        <select class="form-select" onchange="updateAccountStatus('${account.id}',this.value)">
          ${Object.entries(STATUS_CONFIG).map(([k,v])=>`<option value="${k}" ${account.status===k?'selected':''}>${v.label}</option>`).join('')}
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Priority</label>
        <select class="form-select" onchange="updateAccountField('${account.id}','priority',this.value)">
          <option value="hot" ${account.priority==='hot'?'selected':''}>ğŸ”¥ Hot</option>
          <option value="high" ${account.priority==='high'?'selected':''}>High</option>
          <option value="medium" ${account.priority==='medium'?'selected':''}>Medium</option>
          <option value="low" ${account.priority==='low'?'selected':''}>Low</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Notes</label>
        <textarea class="form-textarea" onblur="updateAccountField('${account.id}','notes',this.value)">${account.notes||''}</textarea>
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-sm btn-secondary" onclick="scanAccount('${account.id}')">ğŸ“¡ Scan for Signals</button>
        <button class="btn btn-sm btn-primary" onclick="composerFromTop15('${account.id}')">âœï¸ Compose Outreach</button>
      </div>`;
  } else if (tab === 'signals') {
    if (acctSignals.length === 0) {
      html = `<div class="empty-state"><span class="empty-icon" style="font-size:32px">ğŸ“¡</span><h3>No signals yet</h3><p>Run a scan to surface intent signals</p><br><button class="btn btn-sm btn-secondary" onclick="scanAccount('${account.id}')">ğŸ“¡ Scan Now</button></div>`;
    } else {
      html = acctSignals.map(s=>renderSignalItem(s)).join('');
    }
  } else if (tab === 'contacts') {
    const savedContacts = account.contacts || [];
    html = `
      <div style="display:flex;gap:8px;margin-bottom:14px">
        <input class="form-input" id="drawer-apollo-domain" placeholder="${account.website||account.company.toLowerCase().replace(/[^a-z0-9]/g,'')+'.com'}" style="flex:1">
        <button class="btn btn-secondary" onclick="lookupContactsForDrawer('${account.id}')">ğŸ” Find Contacts</button>
      </div>
      <div id="drawer-contacts-list">
        ${savedContacts.length > 0
          ? renderContactCards(savedContacts, account.id)
          : '<div class="empty-state" style="padding:30px"><span class="empty-icon" style="font-size:32px">ğŸ‘¤</span><h3>No contacts yet</h3><p>Enter the company domain and click Find Contacts to pull decision makers from Apollo</p></div>'}
      </div>`;
  } else if (tab === 'outreach') {
    const urgency = stalenessUrgency(account);
    const daysSince = getDaysSinceTouch(account);
    const threshold = STALE_DAYS[account.status||'not_contacted'] || 5;
    const urgencyColor = {critical:'#e74c3c',stale:'#e67e22',warming:'#c8a84b',fresh:'#2ecc71'}[urgency];
    const urgencyLabel = {critical:'OVERDUE',stale:'STALE',warming:'FOLLOW UP SOON',fresh:'ON TRACK'}[urgency];

    html = `
      <!-- Staleness banner -->
      <div style="background:rgba(${urgency==='critical'?'231,76,60':urgency==='stale'?'230,126,34':urgency==='warming'?'200,168,75':'46,204,113'},0.08);border:1px solid ${urgencyColor}40;border-radius:var(--radius);padding:10px 14px;margin-bottom:14px;display:flex;align-items:center;justify-content:space-between">
        <div>
          <span style="font-size:10px;font-weight:800;color:${urgencyColor};letter-spacing:0.08em">${urgencyLabel}</span>
          <span style="font-size:12px;color:var(--muted2);margin-left:8px">${daysSince===999?'Never contacted':daysSince===0?'Touched today':daysSince+' days since last touch'}</span>
        </div>
        <div style="font-size:10px;color:var(--muted);font-family:'DM Mono',monospace">Follow-up window: ${threshold}d</div>
      </div>

      <!-- Account follow-ups â€” always visible with add option -->
      <div style="background:rgba(0,212,170,0.04);border:1px solid rgba(0,212,170,0.15);border-radius:var(--radius);padding:10px 12px;margin-bottom:14px">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
          <div style="font-size:10px;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:0.08em">ğŸ“… Follow-ups</div>
          <button onclick="document.getElementById('fu-add-${account.id}').style.display=document.getElementById('fu-add-${account.id}').style.display==='none'?'block':'none'" style="background:var(--accent);color:#000;border:none;border-radius:4px;padding:3px 10px;font-size:9px;font-weight:800;cursor:pointer">+ Schedule</button>
        </div>
        <div id="fu-add-${account.id}" style="display:none;margin-bottom:8px;padding:8px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">
          <input id="fu-note-${account.id}" class="form-input" placeholder="Follow-up reason (e.g. check on proposal, re-engage)" style="width:100%;margin-bottom:6px;font-size:11px">
          <div style="display:flex;gap:6px;flex-wrap:wrap">
            <button onclick="scheduleStandaloneFollowUp('${account.id}',3)" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:5px 12px;font-size:10px;font-weight:700;color:var(--text1);cursor:pointer">3d</button>
            <button onclick="scheduleStandaloneFollowUp('${account.id}',5)" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:5px 12px;font-size:10px;font-weight:700;color:var(--text1);cursor:pointer">5d</button>
            <button onclick="scheduleStandaloneFollowUp('${account.id}',7)" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:5px 12px;font-size:10px;font-weight:700;color:var(--text1);cursor:pointer">7d</button>
            <button onclick="scheduleStandaloneFollowUp('${account.id}',14)" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:5px 12px;font-size:10px;font-weight:700;color:var(--text1);cursor:pointer">14d</button>
            <button onclick="scheduleStandaloneFollowUp('${account.id}',30)" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:5px 12px;font-size:10px;font-weight:700;color:var(--text1);cursor:pointer">30d</button>
            <input type="date" id="fu-custom-date-${account.id}" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:4px 8px;font-size:10px;color:var(--text1)" onchange="scheduleStandaloneFollowUp('${account.id}',0,this.value)">
          </div>
        </div>
        ${(() => {
          const acctFups = (STATE.followUps||[]).filter(f => f.accountId == account.id && f.status === 'open');
          if (acctFups.length === 0) return '<div style="font-size:11px;color:var(--muted);padding:4px 0">No follow-ups scheduled. Click + Schedule to set a reminder.</div>';
          return acctFups.map(fu => {
            const st = getFollowUpStatus(fu);
            const stColor = st==='overdue'?'#e74c3c':st==='due_today'?'#e67e22':'var(--accent)';
            const stLabel = st==='overdue'?'OVERDUE':st==='due_today'?'DUE TODAY':'Upcoming';
            const cfg2 = ACTIVITY_CONFIG[fu.sourceActivityType] || ACTIVITY_CONFIG.note;
            return `<div style="display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid var(--border)">
              <span style="font-size:10px;font-weight:800;color:${stColor}">${stLabel}</span>
              <span style="font-size:10px;color:var(--muted)">${formatDueDate(fu.dueAt)}</span>
              <span style="font-size:10px;color:var(--muted2);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${fu.sourceActivityNotes?.substring(0,50) || cfg2.icon + ' ' + cfg2.label}</span>
              <div style="display:flex;gap:4px;flex-shrink:0">
                <button onclick="completeFollowUp('${fu.id}');drawerTab('outreach',document.querySelector('.section-tab.active'))" style="background:#2ecc71;color:#fff;border:none;border-radius:3px;padding:2px 6px;font-size:9px;font-weight:700;cursor:pointer">âœ“ Done</button>
                <button onclick="snoozeFollowUp('${fu.id}',3);drawerTab('outreach',document.querySelector('.section-tab.active'))" style="background:var(--surface2);color:var(--muted2);border:1px solid var(--border);border-radius:3px;padding:2px 6px;font-size:9px;cursor:pointer">+3d</button>
                <button onclick="snoozeFollowUp('${fu.id}',7);drawerTab('outreach',document.querySelector('.section-tab.active'))" style="background:var(--surface2);color:var(--muted2);border:1px solid var(--border);border-radius:3px;padding:2px 6px;font-size:9px;cursor:pointer">+7d</button>
                <button onclick="deleteFollowUp('${fu.id}');drawerTab('outreach',document.querySelector('.section-tab.active'))" style="background:none;border:none;color:var(--muted);font-size:9px;cursor:pointer;padding:2px 4px" title="Remove">âœ•</button>
              </div>
            </div>`;
          }).join('');
        })()}
      </div>

      <!-- Quick log bar -->
      <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:12px;margin-bottom:14px">
        <div style="font-size:10px;font-weight:700;color:var(--muted2);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:10px">Log Activity</div>
        <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px">
          <button onclick="quickLog('${account.id}','email')" style="background:var(--bg);border:1px solid var(--border);border-radius:20px;padding:5px 12px;font-size:11px;font-weight:700;color:var(--text1);cursor:pointer;display:flex;align-items:center;gap:5px">ğŸ“§ Email Sent</button>
          <button onclick="quickLog('${account.id}','call')" style="background:var(--bg);border:1px solid var(--border);border-radius:20px;padding:5px 12px;font-size:11px;font-weight:700;color:var(--text1);cursor:pointer;display:flex;align-items:center;gap:5px">ğŸ“ Called</button>
          <button onclick="quickLog('${account.id}','voicemail')" style="background:var(--bg);border:1px solid var(--border);border-radius:20px;padding:5px 12px;font-size:11px;font-weight:700;color:var(--text1);cursor:pointer;display:flex;align-items:center;gap:5px">ğŸ“¬ Voicemail</button>
          <button onclick="quickLog('${account.id}','linkedin')" style="background:var(--bg);border:1px solid var(--border);border-radius:20px;padding:5px 12px;font-size:11px;font-weight:700;color:#0077b5;cursor:pointer;display:flex;align-items:center;gap:5px">ğŸ’¼ LinkedIn DM</button>
          <button onclick="quickLog('${account.id}','meeting')" style="background:var(--bg);border:1px solid var(--border);border-radius:20px;padding:5px 12px;font-size:11px;font-weight:700;color:var(--accent);cursor:pointer;display:flex;align-items:center;gap:5px">ğŸ“… Meeting</button>
          <button onclick="quickLog('${account.id}','note')" style="background:var(--bg);border:1px solid var(--border);border-radius:20px;padding:5px 12px;font-size:11px;font-weight:700;color:var(--gold);cursor:pointer;display:flex;align-items:center;gap:5px">ğŸ“ Note</button>
        </div>
        <div id="quick-log-form-${account.id}" style="display:none">
          <input id="quick-log-input-${account.id}" class="form-input" placeholder="Add details (optional â€” press Enter to save)" style="width:100%;margin-bottom:6px"
            onkeydown="if(event.key==='Enter')commitQuickLog('${account.id}')">
          <div style="display:flex;gap:6px">
            <button onclick="commitQuickLog('${account.id}')" class="btn btn-sm btn-primary">Save</button>
            <button onclick="cancelQuickLog('${account.id}')" class="btn btn-sm btn-secondary">Cancel</button>
          </div>
        </div>
      </div>

      <!-- Activity timeline -->
      <div style="font-size:10px;font-weight:700;color:var(--muted2);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:10px">Activity Timeline</div>
      ${log.length === 0
        ? `<div style="text-align:center;padding:24px;color:var(--muted);font-size:12px">
             <div style="font-size:28px;margin-bottom:6px">ğŸ“‹</div>
             No activity logged yet. Use the buttons above after each touch.
           </div>`
        : renderActivityTimeline(log)
      }`;
  }
  document.getElementById('drawer-content').innerHTML = html;
}

function updateAccountStatus(id, status) {
  const acct = STATE.accounts.find(a=>a.id==id);
  if (acct) {
    acct.status = status;
    acct.lastTouch = new Date().toISOString();
    acct.touchCount = (acct.touchCount||0)+1;
    saveState();
    renderAccountsTable();
    renderKanban();
    toast('Status updated','success');
  }
}

function updateAccountField(id, field, value) {
  const acct = STATE.accounts.find(a=>a.id==id);
  if (acct) { acct[field]=value; saveState(); renderAccountsTable(); }
}

function openComposerFor() {
  if (!STATE.currentDrawerAccount) return;
  composerFromTop15(STATE.currentDrawerAccount.id);
  closeDrawer();
}

function openComposerForId(id) {
  const account = STATE.accounts.find(a=>a.id==id);
  if (!account) return;
  showPanel('composer');
  setTimeout(()=>{
    document.getElementById('composer-account-select').value = id;
    loadComposerAccount();
  },100);
}

function openComposerWithSignal(accountId, signalId) {
  const account = STATE.accounts.find(a => a.id == accountId);
  if (!account) return;
  const signal = STATE.signals.find(s => (s.id + '') === (signalId + ''));

  // Close drawer if open
  closeDrawer();
  showPanel('composer');

  setTimeout(() => {
    // Select the account
    document.getElementById('composer-account-select').value = accountId;
    loadComposerAccount();

    if (!signal) return;

    // Build signal context
    const sigDate = signal.date ? new Date(signal.date) : null;
    const now = new Date();
    let timing = '';
    if (sigDate) {
      const hrs = (now - sigDate) / (1000 * 60 * 60);
      if (hrs < 24) timing = 'today';
      else if (hrs < 48) timing = 'yesterday';
      else if (hrs < 168) timing = Math.round(hrs / 24) + ' days ago';
      else timing = sigDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }

    const contextParts = [
      `TRIGGER SIGNAL (${timing}): "${signal.title}"`,
      signal.summary ? `Context: ${signal.summary.substring(0, 200)}` : '',
      signal.source ? `Source: ${signal.source}` : '',
      signal.link ? `Article: ${signal.link}` : '',
      `Signal type: ${signal.type} | NIL relevance: ${signal.strength || 'unknown'}`,
      '',
      'INSTRUCTION: Write the cold email specifically referencing this trigger event. The email should feel like I saw this news and reached out because of it. Lead with what THEY did, not what we sell. Reference the specific event with timing language.'
    ].filter(Boolean).join('\n');

    // Inject signal context
    const contextEl = document.getElementById('extra-context');
    if (contextEl) contextEl.value = contextParts;

    // Make sure we're on Cold Email tab, then generate
    // Set tab state directly to avoid switchTab calling generateOutreach prematurely
    STATE.currentComposerTab = 'email';
    STATE.composerHistory = [];
    STATE.lastComposerRaw = '';
    document.querySelectorAll('.output-tab').forEach(t => t.classList.remove('active'));
    const firstTab = document.querySelector('.output-tab');
    if (firstTab) firstTab.classList.add('active');

    // Show toast so user knows what's happening
    toast(`âš¡ Drafting signal-led email for ${account.company}...`, 'info', 3000);

    // Wait for contacts to load, then auto-select the best one and generate
    const waitForContacts = () => {
      const checkboxes = document.querySelectorAll('#composer-contacts-list input[type=checkbox]');
      if (checkboxes.length > 0) {
        // Auto-select the top-scored contact
        if (checkboxes[0]) checkboxes[0].checked = true;
        updateContactSelection();
        setTimeout(() => generateOutreach(), 100);
      } else {
        // Contacts still loading â€” try again or generate without
        setTimeout(() => {
          const cb2 = document.querySelectorAll('#composer-contacts-list input[type=checkbox]');
          if (cb2.length > 0) {
            cb2[0].checked = true;
            updateContactSelection();
          }
          generateOutreach();
        }, 1500);
      }
    };
    setTimeout(waitForContacts, 800);
  }, 200);
}

function composerFromTop15(accountId) {
  // Find the best (highest strength) signal for this account
  const acctSignals = STATE.signals
    .filter(s => s.accountId == accountId)
    .sort((a, b) => (b.strength || 0) - (a.strength || 0));
  if (acctSignals.length > 0) {
    openComposerWithSignal(accountId, acctSignals[0].id);
  } else {
    openComposerForId(accountId);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KANBAN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderKanban() {
  const board = document.getElementById('kanban-board');
  const stages = ['not_contacted','contacted','follow_up','engaged','meeting','proposal','negotiation','closed'];
  board.innerHTML = stages.map(stage => {
    const cfg = STATUS_CONFIG[stage];
    const accounts = STATE.accounts.filter(a => (a.status||'not_contacted') === stage);
    const totalScore = accounts.reduce((s,a) => s + computeNILScore(a), 0);
    const cards = accounts.sort((a,b) => computeNILScore(b) - computeNILScore(a)).map(a => {
      const score = computeNILScore(a);
      const scoreColor = score >= 75 ? '#2ecc71' : score >= 50 ? '#c8a84b' : '#666';
      return `<div class="kanban-card" draggable="true"
        data-id="${a.id}"
        data-stage="${stage}"
        ondragstart="handleDragStart(event)"
        ondragend="handleDragEnd(event)"
        onclick="openDrawer('${a.id}')">
        <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:6px;margin-bottom:6px">
          <div style="font-size:12px;font-weight:700;color:var(--text1);line-height:1.3;flex:1">${a.company}</div>
          <div style="font-size:13px;font-weight:800;color:${scoreColor};font-family:'DM Mono',monospace;flex-shrink:0">${score}</div>
        </div>
        <div style="font-size:10px;color:var(--muted2);margin-bottom:6px">${a.vertical||'â€”'}</div>
        <div style="display:flex;align-items:center;gap:5px;flex-wrap:wrap">
          <span class="badge ${STATUS_CONFIG[a.priority]?.badge||'badge-muted'}" style="font-size:9px;padding:1px 5px">${a.priority||'medium'}</span>
          ${a.lastTouch ? `<span style="font-size:9px;color:var(--muted);font-family:'DM Mono',monospace">${daysSince(a.lastTouch)}d ago</span>` : ''}
        </div>
        ${a.notes ? `<div style="font-size:10px;color:var(--muted);margin-top:5px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%">${a.notes.substring(0,45)}${a.notes.length>45?'â€¦':''}</div>` : ''}
      </div>`;
    }).join('');

    return `<div class="kanban-col"
      data-stage="${stage}"
      ondragover="handleDragOver(event)"
      ondragenter="handleDragEnter(event)"
      ondragleave="handleDragLeave(event)"
      ondrop="handleDrop(event)">
      <div class="kanban-header" style="border-top:3px solid ${cfg.color}">
        <div class="kanban-title">
          <span>${cfg.kanban}</span>
          <span>${cfg.label}</span>
        </div>
        <div style="display:flex;align-items:center;gap:6px">
          <div class="kanban-count">${accounts.length}</div>
        </div>
      </div>
      <div style="padding:4px 6px 3px;background:rgba(0,0,0,0.2);border-bottom:1px solid var(--border)">
        <div style="font-size:9px;color:var(--muted);letter-spacing:0.05em;text-transform:uppercase">${cfg.desc}</div>
      </div>
      <div class="kanban-body" data-stage="${stage}">
        ${accounts.length === 0
          ? `<div style="text-align:center;padding:24px 10px;color:var(--muted);font-size:11px;opacity:0.5">
              <div style="font-size:20px;margin-bottom:6px">${cfg.kanban}</div>
              Drop here
            </div>`
          : cards}
      </div>
    </div>`;
  }).join('');
}

function daysSince(dateStr) {
  if (!dateStr) return 'â€”';
  return Math.floor((Date.now() - new Date(dateStr).getTime()) / 86400000);
}

// â”€â”€ DRAG AND DROP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var _dragId = null;
var _dragOriginStage = null;

function handleDragStart(e) {
  _dragId = e.currentTarget.dataset.id;
  _dragOriginStage = e.currentTarget.dataset.stage;
  e.currentTarget.classList.add('dragging');
  e.dataTransfer.effectAllowed = 'move';
  e.dataTransfer.setData('text/plain', _dragId);
}

function handleDragEnd(e) {
  e.currentTarget.classList.remove('dragging');
  document.querySelectorAll('.kanban-col').forEach(c => c.classList.remove('drag-over'));
}

function handleDragOver(e) {
  e.preventDefault();
  e.dataTransfer.dropEffect = 'move';
}

function handleDragEnter(e) {
  e.preventDefault();
  const col = e.currentTarget.closest('.kanban-col') || e.currentTarget;
  col.classList.add('drag-over');
}

function handleDragLeave(e) {
  const col = e.currentTarget.closest('.kanban-col') || e.currentTarget;
  // Only remove if leaving the column entirely
  if (!col.contains(e.relatedTarget)) {
    col.classList.remove('drag-over');
  }
}

function handleDrop(e) {
  e.preventDefault();
  const col = e.currentTarget.closest('.kanban-col') || e.currentTarget;
  col.classList.remove('drag-over');
  const targetStage = col.dataset.stage;
  if (!_dragId || !targetStage) return;
  const account = STATE.accounts.find(a => String(a.id) === String(_dragId));
  if (!account) return;
  if (account.status === targetStage) return;
  const oldStage = account.status;
  account.status = targetStage;
  account.lastTouch = new Date().toISOString();
  // Log the move
  if (!STATE.outreachLog) STATE.outreachLog = {};
  if (!STATE.outreachLog[_dragId]) STATE.outreachLog[_dragId] = [];
  STATE.outreachLog[_dragId].push({
    action: 'stage_change',
    from: oldStage,
    to: targetStage,
    date: new Date().toISOString()
  });
  saveState();
  renderKanban();
  updateDashboard();
  toast(`${account.company} â†’ ${STATUS_CONFIG[targetStage].label}`, 'success', 2000);
  _dragId = null;
  _dragOriginStage = null;
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIGNAL SCANNING v3 â€” Broadened retrieval, scored relevance
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ RSS FETCHER â”€â”€
async function fetchGoogleNewsRSS(query) {
  const encoded = encodeURIComponent(query);
  const url = `https://news.google.com/rss/search?q=${encoded}&hl=en-US&gl=US&ceid=US:en`;
  try {
    const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
    const data = await res.json();
    const parser = new DOMParser();
    const doc = parser.parseFromString(data.contents, 'text/xml');
    const items = Array.from(doc.querySelectorAll('item')).slice(0,10);
    return items.map(item=>({
      title: item.querySelector('title')?.textContent||'',
      desc: item.querySelector('description')?.textContent?.replace(/<[^>]+>/g,'')||'',
      pubDate: item.querySelector('pubDate')?.textContent||'',
      source: item.querySelector('source')?.textContent||'News',
      link: item.querySelector('link')?.textContent||''
    }));
  } catch(e) {
    console.warn('[Signals] RSS fetch failed for:', query, e.message);
    return [];
  }
}

// â”€â”€ BRAND NAME VARIANTS â”€â”€
// Generate search-friendly variants for brands with punctuation/apostrophes
function getBrandVariants(name) {
  const variants = [name];
  // Strip apostrophes: "Buc-ee's" â†’ "Buc-ees"
  if (name.includes("'")) variants.push(name.replace(/'/g, ''));
  // Strip hyphens: "Buc-ee's" â†’ "Buc ees" / "Bucees"
  if (name.includes('-')) {
    variants.push(name.replace(/-/g, ' '));
    variants.push(name.replace(/-/g, ''));
  }
  // Strip both: "Buc-ee's" â†’ "Bucees"
  if (name.includes("'") || name.includes('-')) {
    variants.push(name.replace(/[-']/g, ''));
    variants.push(name.replace(/[-']/g, ' ').replace(/\s+/g,' ').trim());
  }
  // Dedupe
  return [...new Set(variants.map(v=>v.trim()).filter(v=>v.length>1))];
}

// â”€â”€ QUERY PACK â”€â”€
// Returns array of {query, type} objects
function buildQueryPack(brandName) {
  const q = `"${brandName}"`;
  return [
    { query: `${brandName}`, type: 'general' },
    { query: `${q} marketing OR campaign OR partnership OR collaboration OR sponsorship OR ambassador OR influencer OR creator`, type: 'marketing' },
    { query: `${q} opens OR opening OR expansion OR "new location" OR hiring OR launches OR rollout OR flagship`, type: 'growth' },
    { query: `${q} sports OR athlete OR NIL OR college OR campus OR student OR football OR basketball`, type: 'sports' }
  ];
}

// â”€â”€ URL CANONICALIZATION â”€â”€
function canonicalizeUrl(url) {
  if (!url) return '';
  try {
    // Strip Google News redirect wrapper
    if (url.includes('news.google.com/rss/articles/')) {
      // Google wraps URLs â€” just use as-is since we can't reliably unwrap
      return url.split('?')[0];
    }
    const u = new URL(url);
    // Strip utm params and tracking
    ['utm_source','utm_medium','utm_campaign','utm_term','utm_content','ref','fbclid','gclid'].forEach(p => u.searchParams.delete(p));
    return u.origin + u.pathname;
  } catch {
    return url.split('?')[0];
  }
}

// â”€â”€ SIGNAL CLASSIFICATION (type + tags) â”€â”€
function classifySignal(title, desc) {
  const text = ((title||'') + ' ' + (desc||'')).toLowerCase();

  // Primary type (best match)
  let type = 'news', icon = 'ğŸ“°', cls = 'sig-news';

  if (/\$[\d.]+[mb]|series [a-d]|funding|raised|investment|venture capital|fundrais/i.test(text)) {
    type='funding'; icon='ğŸ’°'; cls='sig-funding';
  } else if (/\bnil\b|name.?image.?likeness|college athlete|student.?athlete|ncaa/i.test(text)) {
    type='nil'; icon='ğŸ†'; cls='sig-nil';
  } else if (/hire|appoint|join|named.*chief|named.*vp|named.*director|named.*head|new cmo|new ceo/i.test(text)) {
    type='hire'; icon='ğŸ‘¤'; cls='sig-hire';
  } else if (/influencer|creator|ambassador|collab|tiktok|instagram|youtube|ugc|social.?media.?campaign/i.test(text)) {
    type='campaign'; icon='ğŸ“£'; cls='sig-campaign';
  } else if (/launch|unveil|introduc|new product|debut|announc|rebrand|refresh/i.test(text)) {
    type='launch'; icon='ğŸš€'; cls='sig-launch';
  } else if (/expand|open|new store|new location|flagship|new market|rollout|pop.?up/i.test(text)) {
    type='growth'; icon='ğŸ“ˆ'; cls='sig-growth';
  } else if (/partner|sponsor|deal|sign|endorse|activation|brand deal/i.test(text)) {
    type='partnership'; icon='ğŸ¤'; cls='sig-campaign';
  } else if (/retail|store|target|walmart|whole foods|sephora|distribution/i.test(text)) {
    type='retail'; icon='ğŸª'; cls='sig-retail';
  } else if (/sport|athlete|football|basketball|baseball|soccer|volleyball|swim|gymnast|track/i.test(text)) {
    type='sports'; icon='ğŸ…'; cls='sig-nil';
  }

  // Derived tags (multiple can apply)
  const tags = [];
  if (/creator|influencer|ugc|ambassador|tiktok|instagram|youtube/i.test(text)) tags.push('Creator');
  if (/campus|college|university|student|ncaa/i.test(text)) tags.push('Campus');
  if (/partner|sponsor|collab|activation|endorse/i.test(text)) tags.push('Partnership');
  if (/expan|open|new store|new location|flagship|new market|rollout/i.test(text)) tags.push('Expansion');
  if (/hire|appoint|named|new cmo|new vp/i.test(text)) tags.push('Hire');
  if (/nil|name.?image|athlete.?deal/i.test(text)) tags.push('NIL');
  if (/campaign|marketing|advertis|promo/i.test(text)) tags.push('Marketing');
  if (/launch|debut|new product|unveil|rebrand/i.test(text)) tags.push('Launch');
  if (/fund|raised|series|invest|ipo|valuation/i.test(text)) tags.push('Funding');
  if (/viral|trend|controversy|backlash|buzz/i.test(text)) tags.push('Buzz');
  if (/tour|festival|event|pop.?up|limited.?drop|seasonal/i.test(text)) tags.push('Event');
  if (/sport|athlete|football|basketball|baseball|soccer/i.test(text)) tags.push('Sports');

  return { type, icon, class: cls, tags };
}

// â”€â”€ RELEVANCE SCORING â”€â”€
// Replaces the old signalStrength â€” scores 0-100, boosts on NIL adjacency but doesn't gate on it
function signalStrength(type, title, desc, queryType, pubDate) {
  const text = ((title||'') + ' ' + (desc||'')).toLowerCase();
  let score = 0;

  // 1. RECENCY (0-40)
  if (pubDate) {
    const age = (Date.now() - new Date(pubDate).getTime()) / (1000*60*60*24);
    if (age < 1) score += 40;
    else if (age < 2) score += 35;
    else if (age < 3) score += 30;
    else if (age < 7) score += 20;
    else if (age < 14) score += 10;
    else if (age < 21) score += 5;
    // older = 0
  } else {
    score += 15; // unknown date, give moderate score
  }

  // 2. QUERY TYPE (10-20)
  const queryScores = { general: 10, marketing: 15, growth: 15, sports: 20 };
  score += queryScores[queryType] || 10;

  // 3. BOOSTS
  // Creator/influencer keywords
  if (/influencer|creator|ugc|ambassador|tiktok|instagram|youtube|streamer/i.test(text)) score += 15;
  // Sports/athlete keywords
  if (/sport|athlete|nil|college athlete|student.?athlete|ncaa|football|basketball|baseball/i.test(text)) score += 15;
  // College/campus keywords
  if (/college|campus|university|student|collegiate|ncaa/i.test(text)) score += 15;
  // Partnership/sponsorship
  if (/partner|sponsor|collab|activation|endorsement|brand deal/i.test(text)) score += 10;
  // Expansion/opening
  if (/expan|open|new store|new location|flagship|new market|rollout/i.test(text)) score += 10;
  // Senior marketing hire
  if (/cmo|vp.?market|head of (influencer|partnership|marketing|brand)|chief brand|chief market/i.test(text)) score += 20;
  // NIL-specific (strongest signal)
  if (/\bnil\b|name.?image.?likeness/i.test(text)) score += 10;
  // Budget/money signals
  if (/\$\d+.*[mb]|series [a-d]|funding round|raised/i.test(text)) score += 5;
  // Campaign/ad signals
  if (/campaign|launch|rebrand|new campaign|ad spend|marketing budget/i.test(text)) score += 5;

  // 4. PENALTIES
  if (/lawsuit|layoff|downsiz|bankrupt|restructur|recall/i.test(text)) score -= 10;
  if (/obituar|death|accident|scandal/i.test(text)) score -= 8;
  if (/earnings call|sec filing|quarterly report/i.test(text)) score -= 5;

  return Math.max(5, Math.min(99, score));
}

// â”€â”€ COMPANY MENTION CHECKER â”€â”€
function buildCompanyMatcher(companyName) {
  const lower = companyName.toLowerCase().trim();
  const variants = getBrandVariants(companyName).map(v => v.toLowerCase());

  // Get significant words (>2 chars, not common words)
  const stopWords = ['the','and','or','for','of','in','at','by','inc','llc','ltd','co','corp'];
  const sigWords = lower.split(/[\s&,.''-]+/).filter(w => w.length > 2 && !stopWords.includes(w));

  return function isRealMention(text) {
    const t = text.toLowerCase();
    // Check any variant matches directly
    for (const v of variants) {
      if (t.includes(v)) return true;
    }
    // For multi-word, check if enough significant words appear
    if (sigWords.length > 1) {
      const matched = sigWords.filter(w => {
        try { return new RegExp('\\b' + w.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'i').test(t); }
        catch { return t.includes(w); }
      });
      return matched.length >= Math.min(2, sigWords.length);
    }
    // Single significant word â€” word boundary match
    if (sigWords.length === 1) {
      try { return new RegExp('\\b' + sigWords[0].replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'i').test(t); }
      catch { return t.includes(sigWords[0]); }
    }
    return false;
  };
}

// â”€â”€ MAIN SCAN FUNCTION â”€â”€
async function scanAccount(id) {
  const account = STATE.accounts.find(a=>a.id==id);
  if (!account) return;
  toast(`Scanning ${account.company}...`, 'info', 5000);

  // Remove old signals for this account
  STATE.signals = STATE.signals.filter(s=>s.accountId!=id);

  const brandName = account.company;
  const variants = getBrandVariants(brandName);
  const isCompanyMention = buildCompanyMatcher(brandName);

  // Date cutoff â€” 90 days
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - 90);

  // Build query pack from primary name
  const queryPack = buildQueryPack(brandName);

  // Add general queries for name variants (e.g. "Bucees" for "Buc-ee's")
  variants.slice(1).forEach(v => {
    queryPack.push({ query: v, type: 'general' });
  });

  // Collect all articles, keyed by canonical URL for dedup
  const seen = new Map(); // canonicalUrl â†’ article object

  for (const qp of queryPack) {
    const articles = await fetchGoogleNewsRSS(qp.query);
    articles.forEach(article => {
      if (!article.title) return;

      const titleAndDesc = (article.title || '') + ' ' + (article.desc || '');

      // Light company mention check â€” don't be overly strict
      // For general queries, we trust the search engine matched correctly
      if (qp.type !== 'general' && !isCompanyMention(titleAndDesc)) return;

      // Date filter
      if (article.pubDate) {
        const articleDate = new Date(article.pubDate);
        if (articleDate < cutoffDate) return;
      }

      // Dedup by canonical URL
      const cUrl = canonicalizeUrl(article.link) || article.title.toLowerCase().trim();
      const existing = seen.get(cUrl);
      const queryTypes = existing ? [...(existing._queryTypes || []), qp.type] : [qp.type];

      // Compute score for this query type
      const score = signalStrength(null, article.title, article.desc, qp.type, article.pubDate);

      if (!existing || score > (existing._score || 0)) {
        seen.set(cUrl, { ...article, _queryTypes: [...new Set(queryTypes)], _score: score, _canonicalUrl: cUrl });
      } else {
        existing._queryTypes = [...new Set(queryTypes)];
      }
    });
    await new Promise(r=>setTimeout(r,250));
  }

  // Convert deduped articles to signals
  const newSignals = [];
  seen.forEach((article) => {
    // Skip exact title duplicates
    const titleNorm = article.title.toLowerCase().trim();
    if (newSignals.some(s => s.title.toLowerCase().trim() === titleNorm)) return;

    const classified = classifySignal(article.title, article.desc);
    const queryType = article._queryTypes.includes('sports') ? 'sports' :
                      article._queryTypes.includes('marketing') ? 'marketing' :
                      article._queryTypes.includes('growth') ? 'growth' : 'general';

    const signal = {
      id: Date.now() + Math.random(),
      accountId: id,
      accountName: account.company,
      type: classified.type,
      icon: classified.icon,
      iconClass: classified.class,
      tags: classified.tags || [],
      queryTypes: article._queryTypes,
      title: article.title,
      summary: article.desc.substring(0, 200),
      source: article.source,
      strength: signalStrength(classified.type, article.title, article.desc, queryType, article.pubDate),
      date: article.pubDate || new Date().toISOString(),
      link: article.link,
      intent_cluster_id: null
    };

    assignSignalToCluster(signal);
    newSignals.push(signal);
  });

  // Sort by score, keep top 12
  newSignals.sort((a, b) => (b.strength || 0) - (a.strength || 0));
  const kept = newSignals.slice(0, 12);
  kept.forEach(s => STATE.signals.push(s));

  saveState();
  renderSignalsList();
  updateDashboard();
  renderAccountsTable();
  if (STATE.currentDrawerAccount?.id == id) drawerTab(STATE.currentDrawerTab, null);
  toast(`${account.company} scan complete â€” ${kept.length} signals found`, 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INTENT CLUSTERING ENGINE// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INTENT CLUSTERING & EVENT-DRIVEN SURFACING v2
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CLUSTER_WINDOW_DAYS = 14;      // similar signals within 14d collapse
const COOLDOWN_DAYS = 21;            // default cooldown before resurfacing same cluster reason
const FRESHNESS_DAYS = 7;            // at least 1 signal < 7d old to surface
const RESURFACE_FRESHNESS_HRS = 48;  // must have < 48hr signal for back-to-back
const SCORE_SPIKE_PCT = 0.25;        // 25% week-over-week score increase threshold
const DAILY_SURFACE_LIMIT = 15;      // max accounts per day
const NO_SIGNAL_ROTATE_DAYS = 5;     // rotate no-signal accounts every N days

// â”€â”€ DAILY SESSION TRACKING â”€â”€
function getTodayKey() {
  return new Date().toISOString().slice(0, 10); // "2026-02-22"
}

function getAccountsSurfacedToday() {
  const today = getTodayKey();
  return STATE.surfaceLog
    .filter(e => e.surfaced_at && e.surfaced_at.slice(0, 10) === today)
    .map(e => e.account_id);
}

function wasAccountSurfacedToday(accountId) {
  return getAccountsSurfacedToday().includes(accountId);
}

function getLastSurfaceDateForAccount(accountId) {
  const entries = STATE.surfaceLog
    .filter(e => e.account_id === accountId)
    .sort((a, b) => new Date(b.surfaced_at) - new Date(a.surfaced_at));
  return entries.length > 0 ? entries[0].surfaced_at : null;
}

function daysAgo(dateStr) {
  if (!dateStr) return Infinity;
  return (new Date() - new Date(dateStr)) / (1000 * 60 * 60 * 24);
}

function generateClusterId(accountId, type, title) {
  // Normalize title to group similar signals
  const norm = (title||'').toLowerCase()
    .replace(/[^a-z0-9\s]/g,'')
    .replace(/\b(the|a|an|and|or|for|to|of|in|at|on|by|is|was|has|with)\b/g,'')
    .trim().replace(/\s+/g,' ');
  // Take first 6 meaningful words as fingerprint
  const words = norm.split(' ').slice(0,6).join('_');
  return `${accountId}_${type}_${words}`;
}

function findMatchingCluster(accountId, type, title, signalDate) {
  const candidateId = generateClusterId(accountId, type, title);
  const sigDate = new Date(signalDate);
  // Look for existing cluster this signal should merge into
  return STATE.intentClusters.find(c => {
    if (c.account_id !== accountId) return false;
    if (c.cluster_type !== type) return false;
    // Check if within 14-day window
    const lastDetected = new Date(c.last_detected_at);
    const daysDiff = (sigDate - lastDetected) / (1000*60*60*24);
    if (Math.abs(daysDiff) > CLUSTER_WINDOW_DAYS) return false;
    // Check title similarity (share 3+ meaningful words)
    const existingWords = new Set(c.id.split('_').slice(2));
    const newWords = candidateId.split('_').slice(2);
    const overlap = newWords.filter(w => existingWords.has(w) && w.length > 2).length;
    return overlap >= 2;
  });
}

function assignSignalToCluster(signal) {
  const existing = findMatchingCluster(signal.accountId, signal.type, signal.title, signal.date);
  if (existing) {
    // Merge into existing cluster
    existing.signal_count++;
    const sigDate = new Date(signal.date);
    if (sigDate > new Date(existing.last_detected_at)) {
      existing.last_detected_at = signal.date;
    }
    if (sigDate < new Date(existing.first_detected_at)) {
      existing.first_detected_at = signal.date;
    }
    // Track peak NIL relevance in cluster
    const strength = signal.strength || 0;
    if (strength > (existing.max_strength || 0)) {
      existing.max_strength = strength;
    }
    signal.intent_cluster_id = existing.id;
    return existing;
  } else {
    // Create new cluster
    const cluster = {
      id: generateClusterId(signal.accountId, signal.type, signal.title),
      account_id: signal.accountId,
      cluster_type: signal.type,
      summary: signal.title,
      first_detected_at: signal.date || new Date().toISOString(),
      last_detected_at: signal.date || new Date().toISOString(),
      signal_count: 1,
      max_strength: signal.strength || 0,
      surfaced_count: 0,
      last_surfaced_at: null
    };
    STATE.intentClusters.push(cluster);
    signal.intent_cluster_id = cluster.id;
    return cluster;
  }
}

function clusterSignalsForAccount(accountId) {
  const signals = STATE.signals.filter(s => s.accountId === accountId);
  signals.forEach(s => {
    if (!s.intent_cluster_id) {
      assignSignalToCluster(s);
    }
  });
}

// Sort by: NIL relevance (max_strength) first, then recency as tiebreaker
function getAccountClusters(accountId) {
  return STATE.intentClusters
    .filter(c => c.account_id === accountId)
    .sort((a, b) => {
      // Primary: highest NIL relevance score
      const strengthDiff = (b.max_strength || 0) - (a.max_strength || 0);
      if (strengthDiff !== 0) return strengthDiff;
      // Tiebreaker: most recent
      return new Date(b.last_detected_at) - new Date(a.last_detected_at);
    });
}

function getUnsurfacedClusters(accountId) {
  return getAccountClusters(accountId).filter(c => c.surfaced_count === 0);
}

function getLastSurfaceEntry(accountId) {
  return STATE.surfaceLog
    .filter(e => e.account_id === accountId)
    .sort((a,b) => new Date(b.surfaced_at) - new Date(a.surfaced_at))[0] || null;
}

// â”€â”€ SURFACING ELIGIBILITY CHECK (v2) â”€â”€
// Returns: { eligible, tier, resurfaced, resurfaced_reason, new_intent_cluster_summary, cluster, reason, whyNow }
// Tiers: 1=fresh event, 2=new cluster, 3=score spike, 4=cooldown expired, 5=no-signal rotation
function canSurfaceAccount(accountId) {
  const now = new Date();
  const clusters = getAccountClusters(accountId);
  const unsurfaced = getUnsurfacedClusters(accountId);
  const lastSurface = getLastSurfaceEntry(accountId);
  const lastSurfaceDate = lastSurface ? lastSurface.surfaced_at : null;
  const daysSince = daysAgo(lastSurfaceDate);
  const surfacedToday = wasAccountSurfacedToday(accountId);

  // HARD BLOCK: Already surfaced today â€” never show twice same day
  if (surfacedToday) {
    return { eligible: false, reason: 'already_shown_today' };
  }

  // â”€â”€ ACCOUNTS WITH SIGNALS â”€â”€
  if (clusters.length > 0) {
    const freshestCluster = clusters[0];
    const freshestAgeDays = (now - new Date(freshestCluster.last_detected_at)) / (1000 * 60 * 60 * 24);

    // Freshness gate: best cluster must have signal < 7 days old
    if (freshestAgeDays > FRESHNESS_DAYS) {
      return { eligible: false, reason: 'stale_signals', detail: `Freshest signal is ${Math.round(freshestAgeDays)}d old` };
    }

    // â”€â”€ TIER 1: Never surfaced before â€” always eligible â”€â”€
    if (!lastSurface) {
      return {
        eligible: true, tier: 1,
        resurfaced: false,
        cluster: freshestCluster,
        reason: 'first_surface'
      };
    }

    // â”€â”€ TIER 2: Has UNSURFACED clusters (new intent event) â”€â”€
    if (unsurfaced.length > 0) {
      const bestNew = unsurfaced[0];

      // Consecutive day check: if surfaced yesterday, stricter rules
      if (daysSince < 1.5) {
        const clusterAgeHrs = (now - new Date(bestNew.first_detected_at)) / (1000 * 60 * 60);
        // Must be genuinely new (< 36hr old) AND different type
        if (clusterAgeHrs > 36) {
          return { eligible: false, reason: 'consecutive_day_blocked', detail: 'New cluster too old for back-to-back' };
        }
        if (lastSurface.cluster_type && bestNew.cluster_type === lastSurface.cluster_type) {
          return { eligible: false, reason: 'same_type_consecutive', detail: 'Same cluster type as yesterday' };
        }
        // Must have signal < 48hr old
        const clusterSignals = STATE.signals.filter(s => s.intent_cluster_id === bestNew.id);
        const has48hr = clusterSignals.some(s => (now - new Date(s.date)) / (1000 * 60 * 60) < RESURFACE_FRESHNESS_HRS);
        if (!has48hr) {
          return { eligible: false, reason: 'no_48hr_signal' };
        }
      }

      return {
        eligible: true, tier: 2,
        resurfaced: daysSince < COOLDOWN_DAYS,
        resurfaced_reason: buildResurfaceReason(bestNew),
        new_intent_cluster_summary: buildClusterSummary(bestNew),
        cluster: bestNew,
        reason: 'new_cluster'
      };
    }

    // â”€â”€ TIER 3: Score spike (25%+ WoW signal density increase) â”€â”€
    if (daysSince < COOLDOWN_DAYS) {
      const accountSignals = STATE.signals.filter(s => s.accountId === accountId);
      const weekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);
      const thisWeek = accountSignals.filter(s => new Date(s.date) > weekAgo).length;
      const lastWeek = accountSignals.filter(s => {
        const d = new Date(s.date);
        return d <= weekAgo && d > new Date(weekAgo - 7 * 24 * 60 * 60 * 1000);
      }).length;
      if (lastWeek > 0 && (thisWeek - lastWeek) / lastWeek >= SCORE_SPIKE_PCT) {
        const pctUp = Math.round(((thisWeek - lastWeek) / lastWeek) * 100);
        return {
          eligible: true, tier: 3,
          resurfaced: true,
          resurfaced_reason: `Signal volume surged ${pctUp}% this week`,
          new_intent_cluster_summary: `${thisWeek} signals detected this week vs ${lastWeek} last week â€” momentum building`,
          cluster: freshestCluster,
          reason: 'score_spike'
        };
      }
      // Inside cooldown, all clusters surfaced, no spike â€” blocked
      return { eligible: false, reason: 'cooldown_active', detail: `${Math.round(COOLDOWN_DAYS - daysSince)}d remaining` };
    }

    // â”€â”€ TIER 4: Cooldown expired â€” resurface with fresh cluster â”€â”€
    return {
      eligible: true, tier: 4,
      resurfaced: true,
      resurfaced_reason: 'Re-evaluating after cooldown period',
      new_intent_cluster_summary: freshestCluster.summary,
      cluster: freshestCluster,
      reason: 'cooldown_expired'
    };
  }

  // â”€â”€ ACCOUNTS WITH NO SIGNALS (score-based rotation) â”€â”€
  // Only surface if not shown in last N days â€” forces daily rotation
  if (daysSince < NO_SIGNAL_ROTATE_DAYS) {
    return { eligible: false, reason: 'no_signal_cooldown', detail: `Shown ${Math.round(daysSince)}d ago, rotating` };
  }

  return {
    eligible: true, tier: 5,
    resurfaced: !!lastSurface,
    cluster: null,
    reason: 'score_based_rotation'
  };
}

// â”€â”€ HUMAN-READABLE RESURFACE REASON (max 20 words) â”€â”€
function buildResurfaceReason(cluster) {
  if (!cluster) return 'New activity detected';
  const typeMap = {
    nil: 'New NIL partnership or athlete deal activity',
    funding: 'New funding round or financial expansion',
    hire: 'Key marketing or partnerships hire',
    campaign: 'New marketing campaign or brand initiative',
    launch: 'Product launch or market expansion',
    retail: 'Retail distribution or DTC channel move',
    news: 'Breaking industry news creating outreach window'
  };
  return typeMap[cluster.cluster_type] || 'New intent signal detected';
}

// â”€â”€ CLUSTER SUMMARY (1 sentence) â”€â”€
function buildClusterSummary(cluster) {
  if (!cluster) return '';
  const now = new Date();
  const age = (now - new Date(cluster.last_detected_at)) / (1000 * 60 * 60);
  let timing;
  if (age < 6) timing = 'hours ago';
  else if (age < 24) timing = 'today';
  else if (age < 48) timing = 'yesterday';
  else timing = `${Math.round(age / 24)} days ago`;
  return `${cluster.summary.substring(0, 100)} (detected ${timing}, ${cluster.signal_count} signal${cluster.signal_count > 1 ? 's' : ''} in cluster)`;
}

function summarizeClusterDelta(newCluster, lastSurface) {
  return buildResurfaceReason(newCluster);
}

function markAccountSurfaced(accountId, clusterId, reason) {
  const cluster = STATE.intentClusters.find(c => c.id === clusterId);
  if (cluster) {
    cluster.surfaced_count++;
    cluster.last_surfaced_at = new Date().toISOString();
  }
  STATE.surfaceLog.push({
    account_id: accountId,
    intent_cluster_id: clusterId || null,
    cluster_type: cluster ? cluster.cluster_type : 'none',
    surfaced_at: new Date().toISOString(),
    reason: reason || 'top15'
  });
}

// â”€â”€ ACTIONABLE WHY-NOW SUMMARY â”€â”€
function getWhyNowSummary(accountId, cluster, account) {
  if (!cluster) {
    // No-signal account â€” generate score-based reason
    if (!account) return '';
    const reasons = [];
    if (account.priority === 'hot') reasons.push('marked hot priority');
    if (account.vertical) reasons.push(`${account.vertical} vertical is active in NIL`);
    if (account.territory === 'National') reasons.push('national footprint');
    if (account.notes) reasons.push(account.notes.substring(0, 60));
    return reasons.length > 0
      ? `High-fit account: ${reasons.slice(0, 2).join(', ')}. No signals scanned yet â€” run a scan to surface triggers.`
      : 'High NIL fit score â€” scan this account to surface specific intent triggers.';
  }

  const now = new Date();
  const lastDetected = new Date(cluster.last_detected_at);
  const hoursDiff = (now - lastDetected) / (1000 * 60 * 60);

  // Precise timing language
  let timing;
  if (hoursDiff < 1) timing = 'just now';
  else if (hoursDiff < 6) timing = `${Math.round(hoursDiff)} hours ago`;
  else if (hoursDiff < 24) timing = 'earlier today';
  else if (hoursDiff < 36) timing = 'yesterday';
  else if (hoursDiff < 72) timing = `${Math.round(hoursDiff / 24)} days ago`;
  else timing = `${Math.round(hoursDiff / 24)} days ago`;

  // Signal count context
  const density = cluster.signal_count > 1 ? ` (${cluster.signal_count} related signals)` : '';

  // Event-specific verb + action framing
  const typeFrames = {
    nil: { verb: 'NIL activity detected', action: 'Pitch athlete activation while momentum is fresh' },
    funding: { verb: 'Funding/expansion news', action: 'New budget likely unlocked â€” pitch before competitors' },
    hire: { verb: 'Leadership change', action: 'New decision-maker may be re-evaluating partnerships' },
    campaign: { verb: 'Campaign launched', action: 'They\'re spending on marketing â€” align NIL to their push' },
    launch: { verb: 'Product or initiative launched', action: 'Fresh launch = fresh budget for awareness plays' },
    retail: { verb: 'Distribution expansion', action: 'Growth mode â€” NIL can accelerate awareness in new markets' },
    news: { verb: 'Relevant news coverage', action: 'Brand is in the conversation â€” timely outreach will land' }
  };
  const frame = typeFrames[cluster.cluster_type] || { verb: 'New signal', action: 'Fresh trigger for outreach' };

  return `${frame.verb} ${timing}${density}: "${cluster.summary.substring(0, 70)}." ${frame.action}.`;
}

// â”€â”€ REBUILD CLUSTERS FROM EXISTING SIGNALS â”€â”€
function rebuildAllClusters() {
  // Assign cluster IDs to any signals that don't have one
  STATE.signals.forEach(s => {
    if (!s.intent_cluster_id && s.accountId) {
      assignSignalToCluster(s);
    }
  });
}

async function runSignalScan() {
  if (STATE.accounts.length===0) { toast('No accounts to scan','error'); return; }
  const btn = document.getElementById('scan-btn');
  btn.disabled=true;btn.textContent='Scanning...';
  document.getElementById('scan-progress').style.display='block';
  const toScan = STATE.accounts.slice(0, 20); // Limit to 20 for performance
  for (let i=0;i<toScan.length;i++) {
    document.getElementById('scan-status').textContent=`Scanning ${toScan[i].company} (${i+1}/${toScan.length})...`;
    document.getElementById('scan-progress-fill').style.width=`${((i+1)/toScan.length)*100}%`;
    await scanAccount(toScan[i].id);
    await new Promise(r=>setTimeout(r,500));
  }
  document.getElementById('scan-progress').style.display='none';
  btn.disabled=false;btn.textContent='ğŸ” Scan All Accounts';
  toast('Full scan complete!','success');
}

async function scanSelectedAccounts() {
  const selected = STATE.accounts.filter(a=>a.priority==='hot'||a.priority==='high');
  if (selected.length===0) { toast('No hot/high priority accounts to scan','error'); return; }
  for (const acct of selected.slice(0,10)) {
    await scanAccount(acct.id);
    await new Promise(r=>setTimeout(r,400));
  }
  toast('Priority accounts scanned','success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIGNALS RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSignalItem(s) {
  const strength = s.strength||50;
  const color = strength>=70?'var(--green)':strength>=50?'var(--accent)':strength>=35?'var(--gold)':'var(--muted)';
  const label = strength>=70?'High relevance':strength>=50?'Good relevance':strength>=35?'Moderate':'Low';
  const nilBadge = (s.tags && (s.tags.includes('NIL') || s.tags.includes('Sports') || s.tags.includes('Campus') || s.tags.includes('Creator')))
    ? `<span style="background:rgba(0,212,170,0.15);color:var(--accent);font-size:9px;font-weight:700;padding:1px 6px;border-radius:3px;margin-left:4px">NIL-adjacent</span>` : '';
  const tagHtml = (s.tags && s.tags.length > 0)
    ? s.tags.slice(0,4).map(t => `<span style="background:var(--surface2);color:var(--muted2);font-size:9px;padding:1px 5px;border-radius:3px">${t}</span>`).join('')
    : '';
  return `<div class="signal-item">
    <div class="signal-icon ${s.iconClass||'sig-news'}">${s.icon||'ğŸ“°'}</div>
    <div class="signal-content">
      <div class="signal-account">${s.accountName}${nilBadge}</div>
      <div class="signal-text">${s.title}</div>
      ${s.summary?`<div class="news-summary">${s.summary.substring(0,120)}...</div>`:''}
      <div class="signal-meta">
        <span>${s.source||'Web'}</span>
        <span>${s.date?new Date(s.date).toLocaleDateString('en-US',{month:'short',day:'numeric'}):'Recent'}</span>
        <div class="signal-strength">
          <div class="strength-dot" style="background:${color}"></div>
          <span style="color:${color};font-weight:600">${strength} Â· ${label}</span>
        </div>
        ${tagHtml ? `<div style="display:flex;gap:3px;flex-wrap:wrap">${tagHtml}</div>` : ''}
        ${s.link?`<a href="${s.link}" target="_blank" style="color:var(--accent);text-decoration:none">â†— View</a>`:''}
      </div>
    </div>
    <div style="flex-shrink:0">
      <button class="btn btn-xs btn-primary" onclick="openComposerWithSignal('${s.accountId}','${s.id}')" title="Draft outreach referencing this signal">âœï¸</button>
    </div>
  </div>`;
}

function clearOldSignals() {
  const cutoff = new Date();
  cutoff.setDate(cutoff.getDate() - 90);
  const before = STATE.signals.length;
  STATE.signals = STATE.signals.filter(s => {
    if (!s.date) return false;
    return new Date(s.date) >= cutoff;
  });
  const removed = before - STATE.signals.length;
  saveState();
  renderSignalsList();
  updateDashboard();
  toast(`Removed ${removed} signals older than 90 days`, 'success');
}

function renderSignalsList(filter='all') {
  let signals = [...STATE.signals];
  if (filter!=='all') signals=signals.filter(s=>s.type===filter);
  // Sort by date (newest first), then by strength
  signals.sort((a,b)=> {
    const da = new Date(a.date || 0);
    const db = new Date(b.date || 0);
    if (Math.abs(db - da) > 24*60*60*1000) return db - da; // different days â†’ newest first
    return (b.strength||0) - (a.strength||0); // same day â†’ highest strength first
  });

  const container = document.getElementById('signals-list');
  if (signals.length===0) {
    container.innerHTML='<div class="empty-state"><span class="empty-icon">ğŸ“¡</span><h3>No signals yet</h3><p>Run a scan to surface intent signals from public news and web sources</p></div>';
    return;
  }
  container.innerHTML = `<div class="card"><div class="card-body" style="padding:8px 16px">${signals.map(s=>renderSignalItem(s)).join('')}</div></div>`;
}

function filterSignals(filter, el) {
  document.querySelectorAll('.filter-chip').forEach(c=>c.classList.remove('active'));
  if(el) el.classList.add('active');
  renderSignalsList(filter);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateDashboard() {
  const accounts = STATE.accounts;
  const active = accounts.filter(a=>['contacted','follow_up','engaged','meeting','proposal','negotiation'].includes(a.status));
  const meetings = accounts.filter(a=>a.status==='meeting');
  const followups = accounts.filter(a=>['follow_up','engaged'].includes(a.status));
  const nilScores = accounts.map(a=>computeNILScore(a));
  const avgNIL = nilScores.length ? Math.round(nilScores.reduce((a,b)=>a+b,0)/nilScores.length) : 0;

  document.getElementById('stat-total').textContent = accounts.length;
  document.getElementById('stat-active').textContent = active.length;
  document.getElementById('stat-meetings').textContent = meetings.length;
  document.getElementById('stat-followups').textContent = followups.length;
  const sigEl = document.getElementById('stat-signals');
  if (sigEl) sigEl.textContent = STATE.signals.length;
  const nilEl = document.getElementById('stat-nil-inline');
  if (nilEl) nilEl.textContent = avgNIL||'â€”';
  const oldNil = document.getElementById('stat-nil');
  if (oldNil) oldNil.textContent = avgNIL||'â€”';

  // Top 15 â€” use stable daily targets (regenerate only every 24h or on manual refresh)
  loadAndRenderDailyTargets();

  // Pipeline summary â€” horizontal card layout
  const stages = Object.entries(STATUS_CONFIG);
  document.getElementById('pipeline-summary').innerHTML = stages.map(([k,v])=>{
    const count = accounts.filter(a=>a.status===k).length;
    const isActive = count > 0;
    return `<div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:12px 14px;text-align:center;opacity:${isActive ? 1 : 0.5}">
      <div style="font-size:20px;margin-bottom:4px">${v.kanban}</div>
      <div style="font-family:'Syne',sans-serif;font-size:22px;font-weight:800;color:${isActive ? 'var(--text1)' : 'var(--muted)'}">${count}</div>
      <div style="font-size:10px;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:0.04em;margin-top:2px">${v.label}</div>
    </div>`;
  }).join('');

  // Recent signals on dashboard â€” always re-derive from canonical STATE.signals
  renderDashboardSignals();
  setTimeout(renderFollowUpQueue, 0);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD SIGNALS â€” always re-derive from canonical STATE.signals
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboardSignals() {
  const dashSig = document.getElementById('dash-signals');
  if (!dashSig) return;

  // Merge all signals, dedupe by id, sort by date desc then strength
  const seen = new Set();
  const all = [];
  STATE.signals.forEach(s => {
    const key = s.id || s.title;
    if (seen.has(key)) return;
    seen.add(key);
    all.push(s);
  });

  all.sort((a, b) => {
    const da = new Date(a.date || 0);
    const db = new Date(b.date || 0);
    if (Math.abs(db - da) > 24*60*60*1000) return db - da;
    return (b.strength || 0) - (a.strength || 0);
  });

  const top = all.slice(0, 10);
  if (top.length === 0) {
    dashSig.innerHTML = '<div class="empty-state" style="padding:30px"><span class="empty-icon" style="font-size:32px">ğŸ“¡</span><h3>No signals yet</h3><p>Scan your accounts to surface intent signals</p></div>';
  } else {
    dashSig.innerHTML = top.map(s => renderSignalItem(s)).join('');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STABLE DAILY TARGETS â€” persist for 24h, no reshuffle
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DAILY_TARGETS_KEY = 'od_daily_targets_v1';
const DAILY_TARGETS_TTL_MS = 24 * 60 * 60 * 1000; // 24 hours

function loadDailyTargets() {
  try {
    const raw = localStorage.getItem(DAILY_TARGETS_KEY);
    if (!raw) return null;
    return JSON.parse(raw);
  } catch { return null; }
}

function saveDailyTargets(data) {
  try { localStorage.setItem(DAILY_TARGETS_KEY, JSON.stringify(data)); } catch {}
}

function shouldRegenerateDailyTargets(saved) {
  if (!saved || !saved.expiresAt) return true;
  return new Date() > new Date(saved.expiresAt);
}

function generateDailyTargets() {
  // Rebuild clusters
  if (typeof rebuildAllClusters === 'function') rebuildAllClusters();

  const allAccounts = STATE.accounts.map(a => ({
    ...a,
    score: computeNILScore(a),
    signals: STATE.signals.filter(s => s.accountId === a.id).length
  }));

  if (allAccounts.length === 0) return { generatedAt: new Date().toISOString(), expiresAt: new Date(Date.now() + DAILY_TARGETS_TTL_MS).toISOString(), targets: [] };

  // Use the same tiered surfacing logic
  const tier1 = [], tier2 = [], tier3 = [], tier4 = [], tier5 = [];
  allAccounts.forEach(a => {
    if (typeof canSurfaceAccount === 'function') {
      const result = canSurfaceAccount(a.id);
      if (result.eligible) {
        a._surfaceResult = result;
        a.whyNow = typeof getWhyNowSummary === 'function' ? getWhyNowSummary(a.id, result.cluster, a) : '';
        switch (result.tier) {
          case 1: tier1.push(a); break;
          case 2: tier2.push(a); break;
          case 3: tier3.push(a); break;
          case 4: tier4.push(a); break;
          default: tier5.push(a);
        }
      } else {
        tier5.push(a); // Still include in rotation pool
      }
    } else {
      tier5.push(a);
    }
  });

  [tier1, tier2, tier3, tier4, tier5].forEach(t => t.sort((a, b) => b.score - a.score));

  const eventDriven = [...tier1, ...tier2, ...tier3, ...tier4];
  const fillerSlots = Math.max(0, 15 - eventDriven.length);
  const filler = tier5.slice(0, fillerSlots);
  const combined = [...eventDriven, ...filler].slice(0, 15);

  const now = new Date();
  return {
    generatedAt: now.toISOString(),
    expiresAt: new Date(now.getTime() + DAILY_TARGETS_TTL_MS).toISOString(),
    targets: combined.map(a => ({
      accountId: a.id,
      accountName: a.company,
      score: a.score,
      signals: a.signals,
      tier: a._surfaceResult ? a._surfaceResult.tier : 5,
      whyNow: a.whyNow || '',
      _surfaceResult: a._surfaceResult || null
    }))
  };
}

function backfillDailyTargets(saved) {
  // Remove targets whose accounts no longer exist
  const validAccountIds = new Set(STATE.accounts.map(a => a.id));
  const validTargets = saved.targets.filter(t => validAccountIds.has(t.accountId));

  if (validTargets.length >= 15) {
    saved.targets = validTargets.slice(0, 15);
    return saved;
  }

  // Backfill missing spots
  const usedIds = new Set(validTargets.map(t => t.accountId));
  const candidates = STATE.accounts
    .filter(a => !usedIds.has(a.id))
    .map(a => ({ ...a, score: computeNILScore(a), signals: STATE.signals.filter(s => s.accountId === a.id).length }))
    .sort((a, b) => b.score - a.score);

  const needed = 15 - validTargets.length;
  candidates.slice(0, needed).forEach(a => {
    validTargets.push({
      accountId: a.id,
      accountName: a.company,
      score: a.score,
      signals: a.signals,
      tier: 5,
      whyNow: '',
      _surfaceResult: null
    });
  });

  saved.targets = validTargets;
  return saved;
}

async function loadAndRenderDailyTargets(forceRefresh) {
  let saved = loadDailyTargets();

  if (forceRefresh || !saved || shouldRegenerateDailyTargets(saved)) {
    saved = generateDailyTargets();
    saveDailyTargets(saved);
  } else {
    // Backfill if accounts changed
    saved = backfillDailyTargets(saved);
    saveDailyTargets(saved);
  }

  // Hydrate targets with full account data for rendering
  const ranked = saved.targets.map(t => {
    const account = STATE.accounts.find(a => a.id === t.accountId);
    if (!account) return null;
    return {
      ...account,
      score: t.score || computeNILScore(account),
      signals: t.signals || STATE.signals.filter(s => s.accountId === account.id).length,
      whyNow: t.whyNow || '',
      _surfaceResult: t._surfaceResult || null
    };
  }).filter(Boolean);

  const age = saved.generatedAt ? Math.round((Date.now() - new Date(saved.generatedAt).getTime()) / (1000*60*60)) : 0;
  const reason = forceRefresh ? 'Refreshed just now' : `Generated ${age}h ago Â· stable for 24h`;
  renderTop15List(ranked, reason);

  // If forced refresh, mark accounts surfaced
  if (forceRefresh) {
    ranked.forEach(a => {
      if (a._surfaceResult && typeof markAccountSurfaced === 'function') {
        const clusterId = a._surfaceResult.cluster ? a._surfaceResult.cluster.id : null;
        markAccountSurfaced(a.id, clusterId, a._surfaceResult.reason);
      }
    });
    saveState();
  }
}

function renderTop15List(ranked, aiReason) {
  const list = document.getElementById('top15-list');
  if (!ranked || ranked.length === 0) {
    list.innerHTML = `<div class="empty-state"><span class="empty-icon">ğŸ¯</span><h3>No accounts yet</h3><p>Upload your account CSV to see today's priority targets</p></div>`;
    return;
  }
  const subtitle = document.getElementById('top15-subtitle');
  if (subtitle) subtitle.textContent = aiReason || 'Event-driven ranking';

  list.innerHTML = ranked.map((a, i) => {
    const resurf = a._surfaceResult;
    const isResurfaced = resurf && resurf.resurfaced;
    const tier = resurf ? resurf.tier : 5;

    // Tier badge
    const tierBadges = {
      1: '<span class="badge" style="font-size:9px;background:rgba(0,212,170,0.15);color:var(--accent);border:1px solid rgba(0,212,170,0.3)">ğŸ”¥ New Event</span>',
      2: '<span class="badge" style="font-size:9px;background:rgba(200,168,75,0.15);color:var(--gold);border:1px solid rgba(200,168,75,0.3)">â†» New Trigger</span>',
      3: '<span class="badge" style="font-size:9px;background:rgba(231,76,60,0.15);color:var(--red);border:1px solid rgba(231,76,60,0.3)">ğŸ“ˆ Surge</span>',
      4: '<span class="badge" style="font-size:9px;background:rgba(108,117,125,0.15);color:var(--muted);border:1px solid rgba(108,117,125,0.3)">â™»ï¸ Re-eval</span>',
      5: '<span class="badge" style="font-size:9px;background:rgba(108,117,125,0.1);color:var(--muted2);border:1px solid rgba(108,117,125,0.2)">ğŸ“‹ Rotation</span>'
    };

    // Cluster type badge
    const clusterBadge = resurf && resurf.cluster
      ? `<span class="badge" style="font-size:9px;background:rgba(0,212,170,0.1);color:var(--accent);border:1px solid rgba(0,212,170,0.2)">${{ nil: 'ğŸ† NIL', funding: 'ğŸ’° Funding', hire: 'ğŸ‘¤ Hire', campaign: 'ğŸ“£ Campaign', launch: 'ğŸš€ Launch', retail: 'ğŸª Retail', news: 'ğŸ“° News' }[resurf.cluster.cluster_type] || 'ğŸ“¡ Signal'}</span>`
      : '';

    const whyNow = a.whyNow || a.whyToday || '';
    const resurfDetail = isResurfaced && resurf.new_intent_cluster_summary
      ? `<div style="font-size:10px;color:var(--gold);margin-top:3px;padding:4px 8px;background:rgba(200,168,75,0.06);border-radius:4px;border-left:2px solid var(--gold)">â†» ${resurf.resurfaced_reason}: ${resurf.new_intent_cluster_summary.substring(0, 100)}</div>`
      : '';

    // Left border color by tier
    const borderColor = { 1: 'var(--accent)', 2: 'var(--gold)', 3: 'var(--red)', 4: 'var(--muted)', 5: 'transparent' }[tier] || 'transparent';

    return `
    <div class="top15-item" onclick="openDrawer('${a.id}')" style="border-left:3px solid ${borderColor}">
      <div class="top15-rank ${i < 3 ? 'top3' : ''}">${i + 1}</div>
      ${priorityRing(a.priority)}
      <div class="top15-info">
        <div class="top15-name">${a.company}</div>
        <div class="top15-signals">
          <span class="badge badge-muted" style="font-size:10px">${a.vertical || 'â€”'}</span>
          ${a.signals > 0 ? `<span class="badge badge-accent" style="font-size:10px">âš¡ ${a.signals} signals</span>` : ''}
          ${tierBadges[tier] || ''}
          ${clusterBadge}
          ${statusBadge(a.status)}
        </div>
        ${whyNow ? `<div style="font-size:11.5px;color:var(--text1);margin-top:4px;line-height:1.5;font-weight:500">${whyNow}</div>` : ''}
        ${resurfDetail}
      </div>
      <div style="text-align:right;flex-shrink:0">
        <div style="font-family:'Syne',sans-serif;font-size:18px;font-weight:800;color:${getNILColor(a.score)}">${a.score}</div>
        <div style="font-size:10px;color:var(--muted)">fit score</div>
      </div>
      <div class="top15-actions">
        <button class="btn btn-xs btn-primary" onclick="event.stopPropagation();composerFromTop15('${a.id}')" title="Draft signal-led outreach">âœï¸</button>
      </div>
    </div>`;
  }).join('');
}

async function refreshTop15(showLoading) {
  const list = document.getElementById('top15-list');
  const key = STATE.settings.claudeKey;

  // Rebuild clusters for any unclustered signals
  rebuildAllClusters();
  
  // Pre-compute scores
  const allAccounts = STATE.accounts.map(a => ({
    ...a,
    score: computeNILScore(a),
    signals: STATE.signals.filter(s => s.accountId === a.id).length
  }));

  if (allAccounts.length === 0) {
    list.innerHTML = '<div class="empty-state"><span class="empty-icon">ğŸ¯</span><h3>No accounts yet</h3></div>';
    return;
  }

  // â”€â”€ EVENT-DRIVEN FILTERING WITH DAILY DEDUP â”€â”€
  const tier1 = []; // Fresh first-time events
  const tier2 = []; // New unsurfaced clusters (resurfaced accounts)
  const tier3 = []; // Score spikes
  const tier4 = []; // Cooldown expired
  const tier5 = []; // No-signal rotation
  let blockedCount = 0;

  allAccounts.forEach(a => {
    const result = canSurfaceAccount(a.id);
    if (result.eligible) {
      a._surfaceResult = result;
      a.whyNow = getWhyNowSummary(a.id, result.cluster, a);
      switch (result.tier) {
        case 1: tier1.push(a); break;
        case 2: tier2.push(a); break;
        case 3: tier3.push(a); break;
        case 4: tier4.push(a); break;
        case 5: tier5.push(a); break;
        default: tier5.push(a);
      }
    } else {
      blockedCount++;
    }
  });

  // Sort each tier by score
  [tier1, tier2, tier3, tier4, tier5].forEach(t => t.sort((a, b) => b.score - a.score));

  // Combine: event-driven first (tiers 1-4), then score rotation (tier 5) as filler
  // Limit no-signal accounts to max 5 slots so events dominate
  const eventDriven = [...tier1, ...tier2, ...tier3, ...tier4];
  const fillerSlots = Math.max(0, DAILY_SURFACE_LIMIT - eventDriven.length);
  const filler = tier5.slice(0, fillerSlots);
  const surfaceable = [...eventDriven, ...filler].slice(0, 30);

  const eventCount = eventDriven.length;
  const fillerCount = filler.length;

  // If no API key, fall back to local ranking
  if (!key) {
    const final15 = surfaceable.slice(0, DAILY_SURFACE_LIMIT);
    renderTop15List(final15, `Event-driven: ${eventCount} triggered accounts Â· ${fillerCount} rotation fills Â· ${blockedCount} filtered`);
    return;
  }

  if (showLoading !== false) {
    list.innerHTML = `<div style="text-align:center;padding:30px"><div class="spinner" style="margin:0 auto 10px"></div><div style="color:var(--muted);font-size:12px">AI ranking today's event-driven targets...</div></div>`;
  }

  const today = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
  const accountsText = surfaceable.slice(0, 25).map(a => {
    const r = a._surfaceResult || {};
    const tierLabel = { 1: 'NEW_EVENT', 2: 'RESURFACED_NEW_CLUSTER', 3: 'SCORE_SPIKE', 4: 'COOLDOWN_EXPIRED', 5: 'ROTATION' }[r.tier] || 'UNKNOWN';
    const clusterInfo = r.cluster ? `trigger:[${r.cluster.cluster_type}] "${r.cluster.summary.substring(0, 80)}" (${r.cluster.signal_count} signals, detected ${Math.round((new Date() - new Date(r.cluster.last_detected_at)) / (1000 * 60 * 60))}hrs ago)` : 'no signals scanned';
    const resurfInfo = r.resurfaced ? `RESURFACED because: ${r.resurfaced_reason || 'new event'}` : '';
    return `- ${a.company} | ${a.vertical || 'Unknown'} | score:${a.score} | ${a.signals} signals | ${tierLabel} | ${clusterInfo} ${resurfInfo}`.trim();
  }).join('\n');

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'x-api-key': key, 'anthropic-version': '2023-06-01', 'anthropic-dangerous-direct-browser-access': 'true' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 2000,
        messages: [{ role: 'user', content: `Today is ${today}. You are a sales strategist at Opendorse, which connects consumer brands with college athletes for NIL marketing.

You are selecting and ranking today's outbound targets for Ryan Wolpe, a sales rep.

CRITICAL RULES FOR "whyToday":
1. MUST be specific to THIS brand â€” never generic. Reference the actual trigger event.
2. MUST include timing: "announced 18hrs ago", "posted yesterday", "filed this week", etc.
3. MUST explain WHY NOW is the moment to reach out â€” what changed that creates an opening.
4. For brands with signals: reference the specific article/event that triggered surfacing.
5. For brands without signals (ROTATION): reference their vertical, size, or known brand activity. Say "High-fit ${'{vertical}'} brand â€” scan to surface live triggers."
6. For RESURFACED accounts: lead with what's NEW. "Previously surfaced for X, now resurfacing because Y."
7. Never say "recently" without specifics. Never say "growing brand" without evidence. Never fabricate events.
8. Max 25 words. Every word must earn its place.

BAD examples (too generic):
- "Growing DTC brand with strong Gen Z presence" â† no trigger, no timing
- "Recent marketing activity suggests NIL opportunity" â† what activity? when?
- "Brand is expanding and could benefit from NIL" â† vague

GOOD examples:
- "Launched athlete ambassador program 2 days ago â€” pitch before they lock roster"
- "New VP of Brand Partnerships hired yesterday â€” fresh decision-maker, outreach window open"
- "Raised $40M Series C this week â€” marketing budget unlocked, NIL fits their 18-30 demo push"
- "TikTok campaign went viral 3 days ago â€” they're actively spending on Gen Z, perfect NIL moment"

ELIGIBLE ACCOUNTS (pre-filtered, ${blockedCount} already blocked by cooldown/stale/dedup):
${accountsText}

Rank the top 15 for today. Respond ONLY in JSON:
{
  "top15": [
    {"company": "Name", "whyToday": "specific, timed, actionable reason (max 25 words)"}
  ],
  "summary": "one sentence: what events drove today's ranking"
}` }]
      })
    });
    const data = await response.json();
    if (data.error) throw new Error(data.error.message);
    const text = data.content?.[0]?.text || '{}';
    const cleaned = text.replace(/\`\`\`json|\`\`\`/g, '').trim();
    const result = JSON.parse(cleaned);

    // Merge AI ranking back with full account data
    const aiTop15 = (result.top15 || []).map(ai => {
      const match = surfaceable.find(a => a.company.toLowerCase() === ai.company.toLowerCase())
        || surfaceable.find(a => a.company.toLowerCase().includes(ai.company.toLowerCase().split(' ')[0]));
      if (match) return { ...match, whyNow: ai.whyToday, whyToday: ai.whyToday };
      return null;
    }).filter(Boolean).slice(0, DAILY_SURFACE_LIMIT);

    const included = new Set(aiTop15.map(a => a.id));
    const extras = surfaceable.filter(a => !included.has(a.id));
    const final15 = [...aiTop15, ...extras].slice(0, DAILY_SURFACE_LIMIT);

    STATE.lastTop15Refresh = new Date().toISOString();
    renderTop15List(final15, result.summary || `Event-driven ranking Â· ${eventCount} triggered Â· ${blockedCount} filtered`);

    const subtitle = document.getElementById('top15-subtitle');
    if (subtitle) subtitle.textContent = result.summary || `Event-driven: ${eventCount} triggered accounts`;
  } catch (e) {
    console.error('Top15 AI error:', e);
    const final15 = surfaceable.slice(0, DAILY_SURFACE_LIMIT);
    renderTop15List(final15, `Event-driven ranking (AI unavailable) Â· ${eventCount} triggered Â· ${blockedCount} filtered`);
  }
}

// Schedule auto-refresh at 8am EST every day
function scheduleTop15Refresh() {
  const now = new Date();
  // Convert to EST
  const estOffset = -5 * 60; // EST is UTC-5
  const estNow = new Date(now.getTime() + (now.getTimezoneOffset() + estOffset) * 60000);
  const next8am = new Date(estNow);
  next8am.setHours(8, 0, 0, 0);
  if (estNow >= next8am) next8am.setDate(next8am.getDate() + 1); // already past 8am today
  const msUntil8am = next8am - estNow;
  setTimeout(() => {
    refreshTop15(false);
    setInterval(() => refreshTop15(false), 24 * 60 * 60 * 1000); // then every 24h
  }, msUntil8am);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APOLLO CONTACT LOOKUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function lookupApolloContacts() {
  const id = document.getElementById('composer-account-select').value;
  const domainInput = document.getElementById('apollo-domain');
  let domain = domainInput ? domainInput.value.trim() : '';
  // Auto-fill from account if empty
  if (!domain && id) {
    const account = STATE.accounts.find(a=>a.id==id);
    if (account) domain = account.website || account.company.toLowerCase().replace(/[^a-z0-9]/g,'') + '.com';
  }
  if (!domain) { toast('Enter a domain first','error'); return; }
  const key = STATE.settings.apolloKey || document.getElementById('apollo-key').value;
  if (!key) { toast('Add your Apollo API key in Settings first','error'); return; }
  await fetchApolloContacts(domain, key, 'apollo-results', id||null);
}

async function lookupContactsForDrawer(accountId) {
  const account = STATE.accounts.find(a=>a.id==accountId);
  if (!account) return;
  const domain = document.getElementById('drawer-apollo-domain')?.value?.trim() || account.website || account.company+'.com';
  const key = STATE.settings.apolloKey || document.getElementById('apollo-key').value;
  if (!key) { toast('Add your Apollo API key in Settings first','error'); return; }
  toast(`Looking up contacts for ${domain}...`,'info',4000);
  await fetchApolloContacts(domain, key, 'drawer-contacts-list', accountId);
}

// â”€â”€ CONTACT RELEVANCE SCORING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function scoreContact(person) {
  const title = (person.title || '').toLowerCase();
  const dept  = (person.departments || []).join(' ').toLowerCase();
  const all   = title + ' ' + dept;
  let score = 0;
  let tier = '';
  let tierColor = '';

  // TIER 1 â€” owns the budget or signs the deal (80-99)
  const t1 = ['chief marketing','cmo','vp marketing','vp brand','svp marketing','evp marketing',
    'head of marketing','head of brand','director of marketing','director of brand',
    'brand partnerships','head of partnerships','vp partnerships','director of partnerships',
    'vp sponsorship','director of sponsorship','head of sponsorship',
    'vp influencer','director of influencer','head of influencer',
    'head of social','vp social','director of social media',
    'nil ','nil manager','nil director','athlete marketing',
    'sports marketing','head of sports','vp sports'];
  if (t1.some(k => all.includes(k))) { score = 88 + Math.floor(Math.random()*10); tier = 'Decision Maker'; tierColor = '#00d4aa'; }

  // TIER 2 â€” close to budget, likely owns campaigns (60-79)
  else {
    const t2 = ['marketing manager','brand manager','influencer manager','social media manager',
      'content manager','creative director','content director','campaign manager',
      'growth manager','community manager','talent manager','partnerships manager',
      'sponsorship manager','sports manager','athlete relations',
      'marketing lead','brand lead','social lead','influencer lead'];
    if (t2.some(k => all.includes(k))) { score = 62 + Math.floor(Math.random()*16); tier = 'Key Influencer'; tierColor = '#c8a84b'; }

    // TIER 3 â€” relevant but more junior or adjacent (35-59)
    else {
      const t3 = ['marketing','brand','social','content','creative','digital','growth',
        'communications','pr ','public relations','media','advertising','campaign',
        'influencer','talent','sports','partnership','sponsorship'];
      if (t3.some(k => all.includes(k))) { score = 36 + Math.floor(Math.random()*22); tier = 'On Radar'; tierColor = '#7c8da6'; }
      else { score = 15 + Math.floor(Math.random()*18); tier = 'Low Fit'; tierColor = '#555'; }
    }
  }
  return { score, tier, tierColor };
}

function renderContactCards(people, accountId) {
  if (!people || people.length === 0) return '<div style="padding:20px;text-align:center;color:var(--muted);font-size:13px">No contacts found. Try entering the company domain manually.</div>';

  const scored = people.map(function(p) {
    var s = scoreContact(p);
    return Object.assign({}, p, {_score: s.score, _tier: s.tier, _tierColor: s.tierColor});
  }).sort(function(a, b) { return b._score - a._score; });

  return scored.map(function(p) {
    var initials = ((p.first_name||'?')[0] + ((p.last_name||'')[0]||'')).toUpperCase();
    var email = (p.email && p.email !== 'email_not_unlocked') ? p.email : null;
    var emailStatus = p.email_status || '';
    var nameClean = ((p.first_name||'') + ' ' + (p.last_name||'')).trim();
    var titleClean = (p.title||'').replace(/</g,'&lt;');
    var scoreBar = Math.max(4, p._score);
    var tc = p._tierColor;
    var aid = accountId || '';

    var emailBadge = email
      ? '<span style="font-size:11px;background:rgba(0,212,170,0.1);border:1px solid rgba(0,212,170,0.2);color:#00d4aa;padding:3px 9px;border-radius:4px;font-family:monospace">\u2709 ' + email + '</span>'
      : '<span style="font-size:11px;background:rgba(255,255,255,0.04);border:1px solid var(--border);color:var(--muted);padding:3px 9px;border-radius:4px;font-family:monospace">' + (emailStatus === 'verified' ? '\u2709 Verified (unlock in Apollo)' : emailStatus === 'guessed' ? '\u2709 Guessed available' : '\u2709 Not unlocked') + '</span>';

    var linkedinBadge = p.linkedin_url
      ? '<a href="' + p.linkedin_url + '" target="_blank" style="font-size:11px;background:rgba(10,102,194,0.12);border:1px solid rgba(10,102,194,0.2);color:#0a66c2;padding:3px 9px;border-radius:4px;text-decoration:none;font-family:monospace">in LinkedIn \u2197</a>'
      : '';

    var phoneBadge = (p.phone_numbers && p.phone_numbers[0])
      ? '<span style="font-size:11px;background:rgba(200,168,75,0.1);border:1px solid rgba(200,168,75,0.2);color:#c8a84b;padding:3px 9px;border-radius:4px;font-family:monospace">\uD83D\uDCDE ' + (p.phone_numbers[0].sanitized_number || p.phone_numbers[0].raw_number) + '</span>'
      : '';

    var escapedName = nameClean.replace(/'/g, '\\\'');
    var escapedTitle = (p.title||'').replace(/'/g, '\\\'').replace(/</g, '');

    return '<div style="background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 16px;margin-bottom:10px;position:relative;overflow:hidden">'
      + '<div style="position:absolute;top:0;left:0;width:' + scoreBar + '%;height:3px;background:' + tc + ';border-radius:0"></div>'
      + '<div style="display:flex;align-items:flex-start;gap:12px">'
        + '<div style="width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,' + tc + '33,' + tc + '11);border:2px solid ' + tc + '44;display:flex;align-items:center;justify-content:center;font-family:\'Syne\',sans-serif;font-size:14px;font-weight:800;color:' + tc + ';flex-shrink:0">' + initials + '</div>'
        + '<div style="flex:1;min-width:0">'
          + '<div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:3px">'
            + '<span style="font-weight:700;font-size:14px;color:var(--text)">' + nameClean + '</span>'
            + '<span style="font-size:10px;font-weight:700;padding:2px 7px;border-radius:4px;background:' + tc + '22;color:' + tc + ';font-family:monospace;letter-spacing:0.04em;text-transform:uppercase">' + p._tier + '</span>'
          + '</div>'
          + '<div style="font-size:12px;color:var(--muted2);margin-bottom:8px">' + titleClean + '</div>'
          + '<div style="display:flex;flex-wrap:wrap;gap:6px;align-items:center">'
            + emailBadge + linkedinBadge + phoneBadge
          + '</div>'
        + '</div>'
        + '<div style="flex-shrink:0;text-align:right;display:flex;flex-direction:column;align-items:flex-end;gap:8px">'
          + '<div style="font-family:\'Syne\',sans-serif;font-size:22px;font-weight:800;color:' + tc + ';line-height:1">' + p._score + '</div>'
          + '<div style="font-size:9px;color:var(--muted);font-family:monospace;letter-spacing:0.04em">RELEVANCE</div>'
          + '<button class="btn btn-xs btn-primary" style="margin-top:4px" onclick="composeForContact(\'' + aid + '\',\'' + escapedName + '\',\'' + escapedTitle + '\')">&#9997;&#65039; Compose</button>'
        + '</div>'
      + '</div>'
    + '</div>';
  }).join('');
}


async function fetchApolloContacts(domain, key, targetId, accountId) {
  const cleanDomain = domain.replace(/^https?:\/\//,'').replace(/^www\./,'').split('/')[0];
  const target = document.getElementById(targetId);
  if (target) target.innerHTML = '<div style="text-align:center;padding:20px"><div class="spinner" style="margin:0 auto 10px"></div><div style="color:var(--muted);font-size:12px">Finding contacts via Apollo...</div></div>';

  // Cast a wide net: anyone in marketing, brand, partnerships, influencer, talent, sports
  const titles = [
    'Chief Marketing Officer','CMO','VP Marketing','VP Brand','SVP Marketing',
    'Head of Marketing','Head of Brand','Director of Marketing','Director of Brand',
    'Brand Partnerships','Head of Partnerships','Director of Partnerships','VP Partnerships',
    'Influencer Marketing','Head of Influencer','Director of Influencer',
    'Social Media','Head of Social','Director of Social','VP Social',
    'Content Marketing','Creative Director','Head of Content',
    'Sports Marketing','Athlete Marketing','NIL','Head of Sports',
    'Sponsorship','Director of Sponsorship','VP Sponsorship',
    'Marketing Manager','Brand Manager','Growth Marketing',
    'Talent Manager','Talent Partnerships','Community Manager',
    'Campaign Manager','Digital Marketing','Performance Marketing'
  ];

  try {
    const people = await apolloSearchPeople(cleanDomain, key);

    // Save to account
    if (accountId) {
      const account = STATE.accounts.find(a=>a.id==accountId);
      if (account) { account.contacts = people; saveState(); }
    }

    if (!target) return;

    if (people.length === 0) {
      target.innerHTML = `<div style="padding:20px;text-align:center">
        <div style="font-size:28px;margin-bottom:8px">ğŸ”</div>
        <div style="color:var(--muted2);font-size:13px;margin-bottom:6px">No contacts found for <strong>${cleanDomain}</strong></div>
        <div style="color:var(--muted);font-size:11px">Try entering the domain manually (e.g. hellofresh.com) or check your Apollo plan allows people search.</div>
      </div>`;
      return;
    }

    const scored = people.map(p => ({ ...p, ...scoreContact(p) })).sort((a,b) => b.score - a.score);
    const topTier = scored.filter(p => p._score >= 80).length;
    const midTier = scored.filter(p => p._score >= 60 && p._score < 80).length;

    target.innerHTML =
      `<div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;align-items:center">
        <span style="font-size:12px;color:var(--muted2);font-family:monospace">${people.length} contacts found</span>
        ${topTier > 0 ? `<span style="font-size:10px;background:rgba(0,212,170,0.12);color:#00d4aa;padding:2px 8px;border-radius:4px;font-weight:700">${topTier} Decision Makers</span>` : ''}
        ${midTier > 0 ? `<span style="font-size:10px;background:rgba(200,168,75,0.12);color:#c8a84b;padding:2px 8px;border-radius:4px;font-weight:700">${midTier} Key Influencers</span>` : ''}
        <span style="font-size:10px;color:var(--muted);margin-left:auto">Sorted by relevance score</span>
      </div>` +
      renderContactCards(people, accountId);

    toast(`${people.length} contacts found â€” ${topTier} decision makers`,'success');
  } catch(e) {
    if (target) target.innerHTML = `<div style="color:var(--red);font-size:12px;padding:12px;background:rgba(255,80,80,0.06);border-radius:8px;border:1px solid rgba(255,80,80,0.15)">
      <strong>Apollo error:</strong> ${e.message}<br>
      <span style="color:var(--muted);font-size:11px;margin-top:4px;display:block">Check your API key in Settings. Make sure it is a master key.</span>
    </div>`;
  }
}

function composeForContact(accountId, name, title) {
  if (accountId) {
    showPanel('composer');
    setTimeout(() => {
      document.getElementById('composer-account-select').value = accountId;
      loadComposerAccount();
      // Select this contact in the list after it loads
      setTimeout(() => {
        const checkboxes = document.querySelectorAll('#composer-contacts-list input[type=checkbox]');
        checkboxes.forEach(cb => {
          if (cb.dataset.name === name) cb.checked = true;
        });
        updateContactSelection();
      }, 500);
    }, 150);
    closeDrawer();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TARGET CONTACTS ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Selected contacts state
STATE.selectedContacts = STATE.selectedContacts || {};
STATE.contactsByDomain = STATE.contactsByDomain || {};

function contactRelevanceScore(person, accountId) {
  const title = (person.title || '').toLowerCase();
  const dept = (person.departments || []).join(' ').toLowerCase();
  const seniority = (person.seniority || '').toLowerCase();
  const all = title + ' ' + dept;
  let score = 0;
  let why = '';

  // â”€â”€ HIGH PRIORITY TITLE KEYWORDS (core ICP) â”€â”€
  const coreKeywords = [
    { kw: 'influencer', pts: 20, reason: 'Influencer marketing â€” direct NIL buyer' },
    { kw: 'creator', pts: 20, reason: 'Creator marketing â€” runs athlete/creator programs' },
    { kw: 'partnerships', pts: 18, reason: 'Partnerships â€” manages external brand deals' },
    { kw: 'sponsorship', pts: 18, reason: 'Sponsorship â€” controls athlete/sports budget' },
    { kw: 'ambassador', pts: 17, reason: 'Ambassador programs â€” manages athlete rosters' },
    { kw: 'athlete', pts: 22, reason: 'Athlete marketing â€” exact NIL buyer' },
    { kw: 'nil', pts: 25, reason: 'NIL role â€” direct Opendorse buyer' },
    { kw: 'social media', pts: 14, reason: 'Social â€” drives content strategy, key for athlete content' },
    { kw: 'social', pts: 10, reason: 'Social â€” adjacent to athlete content plays' },
    { kw: 'community', pts: 10, reason: 'Community â€” Gen Z engagement, campus activations' },
    { kw: 'brand marketing', pts: 15, reason: 'Brand marketing â€” owns campaign budgets' },
    { kw: 'integrated marketing', pts: 13, reason: 'Integrated marketing â€” owns cross-channel spend' },
    { kw: 'growth marketing', pts: 12, reason: 'Growth â€” performance-minded, values athlete ROI' },
    { kw: 'performance marketing', pts: 10, reason: 'Performance â€” values measurable creator ROI' },
    { kw: 'sports marketing', pts: 20, reason: 'Sports marketing â€” exact vertical alignment' },
    { kw: 'content', pts: 8, reason: 'Content â€” owns creative direction for campaigns' },
  ];
  let bestMatch = { pts: 0, reason: '' };
  coreKeywords.forEach(k => {
    if (all.includes(k.kw) && k.pts > bestMatch.pts) bestMatch = k;
  });
  score += bestMatch.pts;
  why = bestMatch.reason;

  // â”€â”€ SENIORITY BOOST â”€â”€
  if (/\b(chief|cmo|ceo|coo|cbo|cro|evp)\b/.test(all) || seniority === 'c_suite') {
    score += 20; if (!why) why = 'C-suite â€” signs off on large partnerships';
  } else if (/\b(svp|senior vice president)\b/.test(all) || seniority === 'vp') {
    score += 18; if (!why) why = 'VP-level â€” owns budget and strategy';
  } else if (/\b(vp|vice president)\b/.test(all)) {
    score += 16; if (!why) why = 'VP â€” senior budget authority';
  } else if (/\b(director|head of)\b/.test(all) || seniority === 'director') {
    score += 12; if (!why) why = 'Director-level â€” manages programs and budget';
  } else if (/\b(manager|lead)\b/.test(all) || seniority === 'manager') {
    score += 6; if (!why) why = 'Manager â€” executes campaigns, close to the work';
  } else if (/\b(senior|sr\.)\b/.test(all) || seniority === 'senior') {
    score += 4;
  }

  // â”€â”€ GENERAL MARKETING FLOOR â”€â”€
  if (score < 10 && /marketing|brand|media|advertising/.test(all)) {
    score += 8;
    if (!why) why = 'Marketing team â€” general relevance';
  }

  // â”€â”€ INTENT-AWARE BOOST â”€â”€
  if (accountId) {
    const signals = STATE.signals.filter(s => s.accountId == accountId);
    const recentSignals = signals.filter(s => {
      const age = (new Date() - new Date(s.date)) / (1000 * 60 * 60 * 24);
      return age < 14;
    });
    if (recentSignals.length > 0) {
      const sigText = recentSignals.map(s => (s.title + ' ' + (s.summary || '')).toLowerCase()).join(' ');
      // Boost contacts whose role matches the signal type
      if (/creator|influencer|ugc|content creator/.test(sigText) && /influencer|creator|content/.test(all)) {
        score += 10; why = (why ? why + ' + ' : '') + 'Matches recent creator/influencer signal';
      }
      if (/sponsor|partnership|deal|athlete/.test(sigText) && /partner|sponsor|athlete|sports/.test(all)) {
        score += 10; why = (why ? why + ' + ' : '') + 'Matches recent partnership/sponsorship signal';
      }
      if (/campus|student|college|university|gen z/.test(sigText) && /community|campus|brand|social/.test(all)) {
        score += 8; why = (why ? why + ' + ' : '') + 'Matches recent Gen Z/campus signal';
      }
      if (/hire|appoint|new role|join/.test(sigText) && /head|director|vp|chief/.test(all)) {
        score += 8; why = (why ? why + ' + ' : '') + 'New leadership hire â€” outreach window';
      }
    }
  }

  // â”€â”€ LOW PRIORITY EXCLUSIONS â”€â”€
  if (/\b(human resources|hr |recruiting|recruiter|finance|accounting|legal|counsel|compliance|it |engineering|developer|software|sales|account executive|sdr|bdr)\b/.test(all)) {
    score = Math.min(score, 5);
    why = 'Low relevance â€” not a marketing/partnerships buyer';
  }

  // Normalize
  score = Math.max(0, Math.min(99, score));

  // Tier labels
  let tier, tierColor;
  if (score >= 75) { tier = 'Decision Maker'; tierColor = '#00d4aa'; }
  else if (score >= 55) { tier = 'Key Influencer'; tierColor = '#c8a84b'; }
  else if (score >= 30) { tier = 'On Radar'; tierColor = '#7c8da6'; }
  else { tier = 'Low Fit'; tierColor = '#555'; }

  return { _score: score, _tier: tier, _tierColor: tierColor, _why: why || 'General marketing team' };
}

function renderComposerContacts(accountId) {
  const list = document.getElementById('composer-contacts-list');
  const footer = document.getElementById('composer-contacts-footer');
  const warning = document.getElementById('composer-generate-warning');
  if (!list) return;

  if (!accountId) {
    list.innerHTML = '<div style="font-size:12px;color:var(--muted);text-align:center;padding:16px">Select an account to see contacts</div>';
    if (footer) footer.style.display = 'none';
    return;
  }

  const account = STATE.accounts.find(a => a.id == accountId);
  if (!account) return;

  const people = account.contacts || [];
  if (people.length === 0) {
    const hasKey = STATE.settings.apolloKey;
    list.innerHTML = `<div style="text-align:center;padding:16px">
      <div style="font-size:11px;color:var(--muted2);margin-bottom:8px">No contacts loaded yet</div>
      ${hasKey
        ? '<button class="btn btn-xs btn-secondary" onclick="refreshComposerContacts()">ğŸ” Find Contacts via Apollo</button>'
        : '<div style="font-size:10px;color:var(--muted)">Add your Apollo API key in Settings to find contacts</div>'}
    </div>`;
    if (footer) footer.style.display = 'none';
    return;
  }

  // Score, sort, ensure operator coverage
  let scored = people.map(p => ({ ...p, ...contactRelevanceScore(p, accountId) }));
  scored.sort((a, b) => b._score - a._score);

  // Ensure 2 operator-level contacts if available
  const operators = scored.filter(p => /manager|lead|senior|coordinator/i.test(p.title || '') && p._score >= 20);
  const topList = scored.slice(0, 10);
  let operatorsInTop = topList.filter(p => /manager|lead|senior|coordinator/i.test(p.title || '')).length;
  if (operatorsInTop < 2 && operators.length >= 2) {
    const needed = operators.filter(o => !topList.find(t => t.id === o.id)).slice(0, 2 - operatorsInTop);
    needed.forEach(n => topList.push(n));
  }

  // Get previous selection state
  const prevSelected = STATE.selectedContacts[accountId] || [];

  const filterVal = (document.getElementById('composer-contact-filter')?.value || '').toLowerCase();

  const filtered = topList.filter(p => {
    if (!filterVal) return true;
    const name = ((p.first_name || '') + ' ' + (p.last_name || '')).toLowerCase();
    return name.includes(filterVal) || (p.title || '').toLowerCase().includes(filterVal);
  });

  list.innerHTML = filtered.map(p => {
    const name = ((p.first_name || '') + ' ' + (p.last_name || '')).trim();
    const initials = ((p.first_name || '?')[0] + ((p.last_name || '')[0] || '')).toUpperCase();
    const email = (p.email && p.email !== 'email_not_unlocked') ? p.email : null;
    const isSelected = prevSelected.includes(p.id);
    const tc = p._tierColor;

    return `<label style="display:flex;align-items:flex-start;gap:8px;padding:8px 10px;background:${isSelected ? 'rgba(0,212,170,0.06)' : 'var(--surface)'};border:1px solid ${isSelected ? 'rgba(0,212,170,0.25)' : 'var(--border)'};border-radius:8px;margin-bottom:5px;cursor:pointer;transition:all 0.12s" onmouseenter="this.style.borderColor='rgba(0,212,170,0.3)'" onmouseleave="this.style.borderColor='${isSelected ? 'rgba(0,212,170,0.25)' : 'var(--border)'}'" >
      <input type="checkbox" ${isSelected ? 'checked' : ''} data-person-id="${p.id}" data-name="${name.replace(/"/g, '&quot;')}" data-title="${(p.title || '').replace(/"/g, '&quot;')}" data-email="${email || ''}" data-linkedin="${p.linkedin_url || ''}" data-score="${p._score}" data-why="${(p._why || '').replace(/"/g, '&quot;')}" onchange="updateContactSelection()" style="margin-top:4px;flex-shrink:0;accent-color:var(--accent)">
      <div style="flex:1;min-width:0">
        <div style="display:flex;align-items:center;gap:6px">
          <span style="font-size:12px;font-weight:700;color:var(--text)">${name}</span>
          <span style="font-size:9px;font-weight:700;padding:1px 5px;border-radius:3px;background:${tc}22;color:${tc};font-family:monospace">${p._score}</span>
        </div>
        <div style="font-size:10px;color:var(--muted2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${(p.title || '').replace(/</g, '&lt;')}</div>
        <div style="font-size:9px;color:var(--accent);margin-top:2px;opacity:0.8">${p._why || ''}</div>
        ${email ? `<div style="font-size:9px;color:var(--muted);font-family:monospace;margin-top:1px">âœ‰ ${email}</div>` : ''}
      </div>
    </label>`;
  }).join('');

  if (footer) footer.style.display = 'block';
  updateContactSelection();
}

function updateContactSelection() {
  const checkboxes = document.querySelectorAll('#composer-contacts-list input[type=checkbox]');
  const selected = [];
  checkboxes.forEach(cb => {
    if (cb.checked) {
      selected.push({
        id: cb.dataset.personId,
        name: cb.dataset.name,
        title: cb.dataset.title,
        email: cb.dataset.email,
        linkedin: cb.dataset.linkedin,
        score: parseInt(cb.dataset.score) || 0,
        why: cb.dataset.why
      });
    }
  });

  // Update hidden fields with primary contact
  if (selected.length > 0) {
    const primary = selected.sort((a, b) => b.score - a.score)[0];
    document.getElementById('contact-name').value = primary.name;
    document.getElementById('contact-title').value = primary.title;
  } else {
    document.getElementById('contact-name').value = '';
    document.getElementById('contact-title').value = '';
  }

  // Store selection
  const accountId = document.getElementById('composer-account-select').value;
  if (accountId) {
    STATE.selectedContacts[accountId] = selected.map(s => s.id);
  }

  // Update footer count
  const countEl = document.getElementById('composer-selected-count');
  if (countEl) countEl.textContent = selected.length + ' selected';

  // Show/hide warning â€” contacts are optional, just a hint
  const warning = document.getElementById('composer-generate-warning');
  if (warning) warning.style.display = 'none';
}

function clearContactSelection() {
  document.querySelectorAll('#composer-contacts-list input[type=checkbox]').forEach(cb => cb.checked = false);
  updateContactSelection();
}

function filterComposerContacts() {
  const accountId = document.getElementById('composer-account-select').value;
  if (accountId) renderComposerContacts(accountId);
}

async function refreshComposerContacts() {
  const accountId = document.getElementById('composer-account-select').value;
  if (!accountId) { toast('Select an account first', 'error'); return; }
  const account = STATE.accounts.find(a => a.id == accountId);
  if (!account) return;
  const domain = account.website || account.company.toLowerCase().replace(/[^a-z0-9]/g, '') + '.com';
  const key = STATE.settings.apolloKey;
  if (!key) { toast('Add your Apollo API key in Settings', 'error'); return; }

  const list = document.getElementById('composer-contacts-list');
  list.innerHTML = '<div style="text-align:center;padding:16px"><div class="spinner" style="margin:0 auto 8px"></div><div style="font-size:11px;color:var(--muted)">Finding contacts via Apollo...</div></div>';

  try {
    const people = await apolloSearchPeople(domain.replace(/^https?:\/\//, '').replace(/^www\./, '').split('/')[0], key);
    account.contacts = people;
    saveState();
    renderComposerContacts(accountId);
    toast(`${people.length} contacts found`, 'success');
  } catch (e) {
    list.innerHTML = `<div style="padding:12px;font-size:11px;color:var(--red)">Apollo error: ${e.message}</div>`;
  }
}

function getSelectedContacts() {
  const selected = [];
  document.querySelectorAll('#composer-contacts-list input[type=checkbox]:checked').forEach(cb => {
    selected.push({
      name: cb.dataset.name,
      title: cb.dataset.title,
      email: cb.dataset.email,
      linkedin: cb.dataset.linkedin,
      score: parseInt(cb.dataset.score) || 0,
      why: cb.dataset.why
    });
  });
  return selected.sort((a, b) => b.score - a.score);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI COMPOSER â€” Claude API
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateComposerSelect() {
  const sel = document.getElementById('composer-account-select');
  const current = sel.value;
  sel.innerHTML = '<option value="">â€” Choose an account â€”</option>' +
    STATE.accounts.slice().sort((a,b)=>a.company.localeCompare(b.company))
      .map(a=>`<option value="${a.id}">${a.company}</option>`).join('');
  if (current) sel.value = current;
}

function loadComposerAccount() {
  const id = document.getElementById('composer-account-select').value;
  if (!id) { document.getElementById('composer-account-preview').style.display='none'; return; }
  const account = STATE.accounts.find(a=>a.id==id);
  if (!account) return;
  const signals = STATE.signals.filter(s=>s.accountId==id);
  const score = computeNILScore(account);
  const preview = document.getElementById('composer-account-preview');
  preview.style.display='block';
  preview.innerHTML=`
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
      ${priorityRing(account.priority)}
      <div>
        <div style="font-weight:700;font-size:14px">${account.company}</div>
        <div style="font-size:12px;color:var(--muted2)">${account.vertical} Â· ${account.territory}</div>
      </div>
      <div style="margin-left:auto;text-align:right">
        <div style="font-family:'Syne',sans-serif;font-size:22px;font-weight:800;color:${getNILColor(score)}">${score}</div>
        <div style="font-size:10px;color:var(--muted)">NIL Score</div>
      </div>
    </div>
    ${signals.length>0?`<div style="font-size:12px;color:var(--accent)">âš¡ ${signals.length} signals â€” ${signals.slice(0,2).map(s=>s.title.substring(0,60)).join('; ')}</div>`:'<div style="font-size:12px;color:var(--muted)">No signals yet â€” run a scan to enrich</div>'}
    ${account.notes?`<div style="font-size:12px;color:var(--muted2);margin-top:8px;padding:8px;background:var(--surface);border-radius:6px">${account.notes.substring(0,150)}</div>`:''}
  `;

  // Auto-populate domain field and show saved contacts or trigger lookup
  const domainInput = document.getElementById('apollo-domain');
  if (domainInput && account.website) domainInput.value = account.website;

  const resultsEl = document.getElementById('apollo-results');
  if (resultsEl) {
    const saved = account.contacts || [];
    if (saved.length > 0) {
      const topCount = saved.filter(p => scoreContact(p).score >= 80).length;
      resultsEl.innerHTML =
        `<div style="display:flex;gap:6px;margin-bottom:10px;align-items:center">
          <span style="font-size:11px;color:var(--muted2);font-family:monospace">${saved.length} saved contacts</span>
          ${topCount > 0 ? `<span style="font-size:10px;background:rgba(0,212,170,0.12);color:#00d4aa;padding:2px 7px;border-radius:4px;font-weight:700">${topCount} Decision Makers</span>` : ''}
          <button class="btn btn-xs btn-ghost" style="margin-left:auto;font-size:10px" onclick="lookupApolloContacts()">â†» Refresh</button>
        </div>` +
        renderContactCards(saved, account.id);
    } else if (STATE.settings.apolloKey) {
      // Auto-fetch if key is set and no contacts saved yet
      const key = STATE.settings.apolloKey;
      const domain = account.website || account.company.toLowerCase().replace(/[^a-z0-9]/g,'') + '.com';
      fetchApolloContacts(domain, key, 'apollo-results', account.id);
    }
  }

  renderComposerICP();
  // Load Target Contacts panel
  renderComposerContacts(account ? account.id : null);
  // Auto-fetch contacts if we have Apollo key and no contacts cached
  if (account && (!account.contacts || account.contacts.length === 0) && STATE.settings.apolloKey) {
    refreshComposerContacts();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPOSER â€” RENDER ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function buildComposeLogBar() {
  var sel = document.getElementById('composer-account-select');
  var acctId = sel ? sel.value : '';
  if (!acctId) return '';
  var acctName = (sel && sel.options[sel.selectedIndex]) ? sel.options[sel.selectedIndex].text : '';
  // Store for button callbacks
  window._composeLogAcctId = acctId;
  window._composeLogAcctName = acctName;
  return '<div style="background:rgba(0,212,170,0.05);border:1px solid rgba(0,212,170,0.15);border-radius:4px;padding:11px 14px;margin-top:14px">'
    + '<div style="font-size:10px;font-weight:700;color:#00d4aa;letter-spacing:0.08em;text-transform:uppercase;margin-bottom:8px">Log This Send</div>'
    + '<div style="display:flex;gap:6px;flex-wrap:wrap">'
    + '<button onclick="composeLog(this)" data-logtype="email" style="background:#0078d4;color:#fff;border:none;border-radius:20px;padding:5px 12px;font-size:11px;font-weight:700;cursor:pointer">ğŸ“§ Email Sent</button>'
    + '<button onclick="composeLog(this)" data-logtype="call" style="background:#1a1a1a;color:#fff;border:1px solid #333;border-radius:20px;padding:5px 12px;font-size:11px;font-weight:700;cursor:pointer">ğŸ“ Called</button>'
    + '<button onclick="composeLog(this)" data-logtype="linkedin" style="background:#1a1a1a;color:#0077b5;border:1px solid #0077b5;border-radius:20px;padding:5px 12px;font-size:11px;font-weight:700;cursor:pointer">ğŸ’¼ LinkedIn DM</button>'
    + '<button onclick="composeLog(this)" data-logtype="meeting" style="background:#1a1a1a;color:#00d4aa;border:1px solid #00d4aa;border-radius:20px;padding:5px 12px;font-size:11px;font-weight:700;cursor:pointer">ğŸ“… Meeting</button>'
    + '</div>'
    + '</div>';
}

function composeLog(btn) {
  var type = btn.dataset.logtype;
  // Use snapshot from generate time â€” most reliable
  var snap = STATE.lastComposerContact || {};
  var id = snap.accountId || window._composeLogAcctId;
  var name = snap.accountName || window._composeLogAcctName || 'account';
  if (!id) { toast('No account selected', 'error'); return; }

  var contactName = snap.name || '';
  var contactTitle = snap.title || '';
  var lastTab = STATE.lastComposerTab || 'email';
  var rawDraft = STATE.lastComposerRaw || '';

  // â”€â”€ Parse the draft to extract subject + readable body preview â”€â”€
  var subject = '', bodyPreview = '', tabLabel = lastTab;
  var tabLabels = { email:'Cold Email', linkedin_dm:'LinkedIn DM', nil_angles:'NIL Angles',
                    call_prep:'Call Prep', creative_brief:'Creative Brief' };
  tabLabel = tabLabels[lastTab] || lastTab;

  try {
    var parsed = JSON.parse(rawDraft.replace(/```json[\s\S]*?```|```/g,'').trim());
    if (parsed.subjects && Array.isArray(parsed.subjects)) subject = parsed.subjects[0] || '';
    if (parsed.subject) subject = parsed.subject;
    if (parsed.body) {
      // Clean up body â€” strip signature block, get first meaningful paragraph
      bodyPreview = parsed.body
        .split('\n\n').slice(0,3).join(' ')
        .replace(/ryan wolpe[\s\S]*/i,'').trim()
        .substring(0, 280);
      if (parsed.body.length > 280) bodyPreview += 'â€¦';
    }
    if (!bodyPreview && parsed.concepts) {
      bodyPreview = 'Concepts: ' + parsed.concepts.map(function(c){ return c.name; }).join(' Â· ');
    }
    if (!bodyPreview && parsed.talking_points) {
      bodyPreview = parsed.talking_points.slice(0,2).join(' Â· ');
    }
  } catch(e) {
    // Plain text â€” strip blank lines, grab first 280 chars
    bodyPreview = rawDraft.replace(/\n{2,}/g,' ').trim().substring(0, 280);
    if (rawDraft.length > 280) bodyPreview += 'â€¦';
    // Try to extract subject from "Subject:" line
    var subjMatch = rawDraft.match(/subject:\s*(.+)/i);
    if (subjMatch) subject = subjMatch[1].trim();
  }

  // â”€â”€ Build title â”€â”€
  var titleMap = {
    email:    subject ? '"' + subject + '"' : (tabLabel + ' â†’ ' + (contactName || name)),
    linkedin: 'LinkedIn DM' + (contactName ? ' â†’ ' + contactName : (' â†’ ' + name)),
    call:     'Call' + (contactName ? ' with ' + contactName : (' â€” ' + name)),
    voicemail:'Voicemail left' + (contactName ? ' for ' + contactName : ''),
    meeting:  'Meeting booked' + (contactName ? ' with ' + contactName : '')
  };
  var title = titleMap[type] || (tabLabel + ' â†’ ' + name);

  // â”€â”€ Log with rich meta â”€â”€
  logActivity(id, type, title, {
    contact:      contactName || null,
    contactTitle: contactTitle || null,
    subject:      subject || null,
    bodyPreview:  bodyPreview || null,
    tab:          lastTab,
    tabLabel:     tabLabel,
    accountName:  name,
    draftLength:  rawDraft.length
  });

  renderFollowUpQueue();
  updateDashboard();

  var cfg = ACTIVITY_CONFIG[type] || {};
  btn.textContent = 'âœ“ Logged';
  btn.disabled = true;
  btn.style.opacity = '0.55';
  btn.style.cursor = 'default';

  var toastMsg = cfg.icon + ' ' + tabLabel + ' logged';
  if (contactName) toastMsg += ' â†’ ' + contactName;
  else toastMsg += ' â†’ ' + name;
  toast(toastMsg, 'success', 2500);
}

function renderComposerOutput(tab, text, account, contactName) {
  var outputArea = document.getElementById('output-area');
  var co = account ? account.company : 'the brand';
  var safeCompany = co.toLowerCase().replace(/[^a-z0-9]/g, '');
  outputArea.className = 'output-area';

  if (tab === 'email') {
    var parsed = {subject: 'Re: Quick question', body: text};
    try { parsed = JSON.parse(text.replace(/```json|```/g,'')); } catch(e) {}
    var toAddr = contactName
      ? (contactName.toLowerCase().replace(/\s/g, '.') + '@' + safeCompany + '.com')
      : ('vp.marketing@' + safeCompany + '.com');
    var bodyHtml = (parsed.body || text)
      .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
      .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
      .replace(/\n/g,'<br>');
    // Signature block matching Ryan's actual Outlook signature
    var sigHtml = '<div style="margin-top:24px;padding-top:16px;border-top:1px solid #e1dfdd;font-family:Aptos,Calibri,Arial,sans-serif;font-size:12px;color:#323130;line-height:1.5">' +
      '<div style="display:flex;align-items:flex-start;gap:14px">' +
        '<svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">' +
          '<rect width="36" height="36" rx="4" fill="#3B7D3E"/>' +
          '<path d="M8 10h8l4 8-4 8H8l4-8-4-8z" fill="white" opacity="0.9"/>' +
          '<path d="M18 10h10l-4 8 4 8H18l4-8-4-8z" fill="white" opacity="0.6"/>' +
        '</svg>' +
        '<div>' +
          '<div style="font-weight:700;font-size:13px;color:#1a1a1a">Ryan Wolpe</div>' +
          '<div style="color:#605e5c">Senior Director, Brand Partnerships</div>' +
          '<div style="color:#605e5c">Office: 317.612.4510 &nbsp;|&nbsp; Cell: 317.612.4510</div>' +
          '<a href="http://www.opendorse.com" style="color:#0078d4;text-decoration:none">www.opendorse.com</a>' +
        '</div>' +
      '</div>' +
      '<div style="margin-top:10px;display:flex;align-items:center;gap:8px">' +
        '<div style="border-left:3px solid #e3001b;padding-left:8px">' +
          '<div style="font-weight:800;font-size:11px;color:#e3001b;letter-spacing:0.05em">TIME<span style="font-size:9px;vertical-align:super">100</span></div>' +
          '<div style="font-size:9px;font-weight:700;color:#1a1a1a;letter-spacing:0.05em;line-height:1.1">MOST INFLUENTIAL<br>COMPANIES</div>' +
        '</div>' +
      '</div>' +
    '</div>';
    document.getElementById('pdf-btn').style.display = 'none';

    // Parse email body - look for concept blocks styled like the reference
    var lines = (parsed.body || text).split('\n');
    var conceptLines = [];
    var bodyLines = [];
    var inConcept = false;
    lines.forEach(function(l) {
      if (/concept\s+0?\d/i.test(l) && l.length < 120) { inConcept = true; conceptLines.push(l); }
      else if (inConcept && l.trim() && !l.startsWith(' ') && !/concept/i.test(l) && l.length < 120 && conceptLines.length % 2 === 1) { conceptLines.push(l); inConcept = false; }
      else { inConcept = false; bodyLines.push(l); }
    });

    // Build concept blocks like the reference image
    var conceptBlocksHtml = '';
    if (conceptLines.length >= 2) {
      for (var ci = 0; ci < conceptLines.length - 1; ci += 2) {
        conceptBlocksHtml += '<div style="border-left:3px solid #c8a84b;background:#fafaf8;border-radius:0 6px 6px 0;padding:10px 14px;margin:6px 0">'
          + '<div style="font-weight:700;font-size:13px;color:#1a1a1a;margin-bottom:3px">' + bodyHtml.replace(/<br>/g,'\n').split('\n').filter(function(l){return /concept\s+0?\d/i.test(l);})[ci/2] + '</div>'
          + '</div>';
      }
    }

    // Reformat body: bold **text**, convert \n to <br>, extract concept blocks
    var formattedBody = (parsed.body || text)
      .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
      .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
      .replace(/\n\n/g,'</p><p style="margin:0 0 14px">')
      .replace(/\n/g,'<br>');

    // Split into paragraphs and identify concept lines
    var paragraphs = (parsed.body || text).split(/\n\n+/);
    var emailBodyHtml = paragraphs.map(function(para) {
      var escaped = para.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
        .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>');
      // Detect concept blocks: lines like "Concept 01 â€” "Name" Â· Platform"
      if (/concept\s+0?\d/i.test(para) && para.includes('Â·')) {
        var conceptLines2 = para.split('\n').filter(function(l){return l.trim();});
        return conceptLines2.map(function(cl) {
          var esc2 = cl.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
            .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>');
          var isTitleLine = /concept\s+0?\d/i.test(cl) && cl.includes('Â·');
          var isDescLine = !isTitleLine && cl.trim().length > 0;
          if (isTitleLine) {
            return '<div style="border-left:3px solid #c8a84b;background:#fafaf8;border-radius:0 6px 6px 0;padding:10px 14px;margin:6px 0">'
              + '<div style="font-weight:700;font-size:13px;color:#1a1a1a;margin-bottom:0">' + esc2 + '</div>';
          } else if (isDescLine) {
            return '<div style="font-size:12px;color:#555;margin-top:4px;line-height:1.5">' + esc2 + '</div></div>';
          }
          return '';
        }).join('');
      }
      return '<p style="margin:0 0 14px;font-size:13px;color:#323130;line-height:1.7">' + escaped.replace(/\n/g,'<br>') + '</p>';
    }).join('');

    outputArea.innerHTML =
      '<div style="padding:16px 20px">'
      + '<div style="background:#fff;border-radius:6px;overflow:hidden;box-shadow:0 2px 16px rgba(0,0,0,0.12);font-family:Aptos,Calibri,Arial,sans-serif;max-width:660px;margin:0 auto">'
        // Gmail-style chrome
        + '<div style="background:#f6f8fc;border-bottom:1px solid #e0e0e0;padding:8px 16px;display:flex;align-items:center;gap:8px">'
          + '<div style="display:flex;gap:6px">'
            + '<div style="width:12px;height:12px;border-radius:50%;background:#ea4335"></div>'
            + '<div style="width:12px;height:12px;border-radius:50%;background:#fbbc04"></div>'
            + '<div style="width:12px;height:12px;border-radius:50%;background:#34a853"></div>'
          + '</div>'
          + '<div style="flex:1;text-align:center;font-size:12px;color:#666;font-family:sans-serif">New Message â€” Gmail</div>'
        + '</div>'
        // To/From/Subject fields
        + '<div style="border-bottom:1px solid #f0f0f0">'
          + '<div style="display:flex;align-items:baseline;padding:8px 20px;border-bottom:1px solid #f5f5f5">'
            + '<span style="font-size:12px;color:#666;min-width:42px">To</span>'
            + '<span style="font-size:13px;color:#1a1a1a;font-weight:500">' + toAddr + '</span>'
          + '</div>'
          + '<div style="display:flex;align-items:baseline;padding:8px 20px;border-bottom:1px solid #f5f5f5">'
            + '<span style="font-size:12px;color:#666;min-width:42px">From</span>'
            + '<span style="font-size:13px;color:#1a1a1a">ryan.wolpe@opendorse.com</span>'
          + '</div>'
          + '<div style="display:flex;align-items:baseline;padding:8px 20px">'
            + '<span style="font-size:12px;color:#666;min-width:42px">Subj</span>'
            + '<span style="font-size:13px;color:#1a1a1a;font-weight:600">' + (parsed.subjects ? parsed.subjects[0] : parsed.subject||'') + '</span>'
          + '</div>'
          + (parsed.subjects && parsed.subjects.length > 1 ? '<div style="padding:6px 20px 8px;background:#fafafa;border-top:1px solid #f0f0f0"><div style="font-size:10px;color:#888;font-weight:600;margin-bottom:4px">SUBJECT LINE OPTIONS (click to swap)</div>' + parsed.subjects.map(function(subj,idx){ return '<div onclick="(function(el){var sp=el.closest(\'div\').parentNode.querySelector(\'[data-subj-display]\');if(sp){sp.textContent=el.textContent;sp.setAttribute(\'data-subj-display\',el.textContent);window._emailSubject=el.textContent;}el.closest(\'div\').parentNode.querySelectorAll(\'[data-subj-opt]\').forEach(function(o){o.style.background=\'transparent\';o.style.fontWeight=\'400\';});el.style.background=\'rgba(0,120,212,0.08)\';el.style.fontWeight=\'600\';})(this)" data-subj-opt style="font-size:12px;color:#1a1a1a;padding:3px 8px;border-radius:4px;cursor:pointer;' + (idx===0?'background:rgba(0,120,212,0.08);font-weight:600':'') + '">' + idx + '. ' + (subj||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') + '</div>'; }).join('') + '</div>' : '')
        + '</div>'
        // Email body
        + '<div style="padding:24px 28px">'
          + emailBodyHtml
          // Signature
          + '<div style="margin-top:28px;padding-top:16px;border-top:1px solid #e8e8e8">'
            + '<div style="display:flex;align-items:flex-start;gap:12px">'
              + '<svg width="34" height="34" viewBox="0 0 36 36" fill="none"><rect width="36" height="36" rx="4" fill="#3B7D3E"/><path d="M8 10h8l4 8-4 8H8l4-8-4-8z" fill="white" opacity="0.9"/><path d="M18 10h10l-4 8 4 8H18l4-8-4-8z" fill="white" opacity="0.6"/></svg>'
              + '<div>'
                + '<div style="font-weight:700;font-size:13px;color:#1a1a1a">Ryan Wolpe</div>'
                + '<div style="font-size:12px;color:#555">Senior Director, Brand Partnerships Â· Opendorse</div>'
                + '<div style="font-size:12px;color:#555">317.612.4510</div>'
                + '<a href="http://www.opendorse.com" style="font-size:12px;color:#0078d4;text-decoration:none">www.opendorse.com</a>'
              + '</div>'
            + '</div>'
            + '<div style="margin-top:10px;display:inline-flex;align-items:center;gap:6px;border-left:3px solid #e3001b;padding-left:8px">'
              + '<div style="font-weight:800;font-size:11px;color:#e3001b;letter-spacing:0.04em">TIME<sup style="font-size:8px">100</sup></div>'
              + '<div style="font-size:9px;font-weight:700;color:#1a1a1a;line-height:1.2">MOST INFLUENTIAL<br>COMPANIES</div>'
            + '</div>'
          + '</div>'
        + '</div>'
        // CTA buttons matching reference
        + '<div style="border-top:1px solid #f0f0f0;padding:16px 28px;display:flex;gap:10px">'
          + '<button onclick="copyOutput()" style="background:#1a1a1a;color:white;border:none;border-radius:4px;padding:10px 20px;font-size:12px;font-weight:700;font-family:sans-serif;cursor:pointer;letter-spacing:0.04em">COPY EMAIL â†’</button>'
          + '<button onclick="copyOutput()" style="background:transparent;color:#555;border:1px solid #ddd;border-radius:4px;padding:10px 20px;font-size:12px;font-weight:600;font-family:sans-serif;cursor:pointer">SHARE DECK</button>'
        + '</div>'
      + '</div>'
    + '</div>';
  }

  else if (tab === 'linkedin') {
    var dmText = text.trim();
    var charCount = dmText.length;
    var ok = charCount <= 280;
    var dmHtml = dmText.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>');
    outputArea.innerHTML =
      '<div style="padding:16px">' +
      '<div style="background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.12)">' +
        '<div style="background:#0a66c2;padding:12px 16px;display:flex;align-items:center;gap:10px">' +
          '<div style="width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,0.2);display:flex;align-items:center;justify-content:center;font-size:16px">&#128188;</div>' +
          '<div><div style="color:#fff;font-size:13px;font-weight:600">Ryan Wolpe</div><div style="color:rgba(255,255,255,0.7);font-size:11px">Account Executive &middot; Opendorse</div></div>' +
        '</div>' +
        '<div style="padding:20px;font-size:14px;line-height:1.6;color:#1c1c1c;min-height:80px">' + dmHtml + '</div>' +
        '<div style="padding:6px 20px 14px;font-size:11px;color:#666;font-family:monospace">' +
          charCount + ' characters ' + (ok ? '&#10003; within 280' : '&#9888; over 280 &mdash; refine to trim') +
        '</div>' +
        '<div style="padding:10px 16px;border-top:1px solid #e0e0e0;display:flex;gap:8px">' +
          '<button onclick="copyOutput()" style="background:#0a66c2;color:#fff;border:none;border-radius:20px;padding:7px 18px;font-size:12px;font-weight:600;cursor:pointer">&#128203; Copy message</button>' +
        '</div>' +
      '</div></div>';
  }

  else if (tab === 'nil_angles') {
    var concepts = [];
    try {
      var cleaned = text.replace(/```json|```/g,'').trim();
      var parsed2 = JSON.parse(cleaned);
      concepts = parsed2.concepts || parsed2;
      if (!Array.isArray(concepts)) concepts = [];
    } catch(e) {
      // Text fallback: split on numbered headings
      var blocks = text.split(/\n(?=\d\.\s+["A-Z])/).filter(function(b){ return b.trim().length > 30; });
      concepts = blocks.slice(0,4).map(function(b, i) {
        var lines = b.split('\n').filter(function(l){ return l.trim(); });
        var getField = function(rx) {
          var found = lines.find(function(l){ return rx.test(l); });
          return found ? found.replace(/^[^:]+:\s*/,'').trim() : '';
        }
        return {
          name: lines[0].replace(/^\d+\.\s*/,'').replace(/^["""]/,'').replace(/["""].*$/,'').trim() || ('Concept ' + (i+1)),
          athlete: getField(/athlete|sport/i),
          platform: getField(/platform|format/i),
          angle: lines.filter(function(l,li){ return li > 0 && li < 4; }).join(' ').trim(),
          why: getField(/why|fit|right now/i) || lines[lines.length-1] || ''
        };
      });
    }
    var COLORS = ['#e3342f','#3490dc','#38a169','#d69e2e'];
    var ICONS = ['&#127936;','&#9917;','&#127939;&#65039;','&#127934;'];
    var cards = concepts.map(function(c, i) {
      var color = COLORS[i] || '#999';
      var icon = ICONS[i] || '&#127941;';
      function esc(s) { return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
      return '<div style="background:var(--card);border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:12px">' +
        '<div style="display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border2)">' +
          '<div style="font-family:\'Syne\',sans-serif;font-size:30px;font-weight:800;color:var(--border2);line-height:1;min-width:36px">0'+(i+1)+'</div>' +
          '<div>' +
            '<div style="font-family:\'Syne\',sans-serif;font-size:15px;font-weight:800;color:var(--text);letter-spacing:-0.01em;text-transform:uppercase">' + icon + ' &ldquo;' + esc(c.name) + '&rdquo;</div>' +
            '<div style="font-size:11px;color:var(--accent);font-family:monospace;margin-top:2px;letter-spacing:0.04em">' + esc(c.platform||'Platform TBD') + '</div>' +
          '</div>' +
          '<span style="margin-left:auto;padding:3px 8px;border-radius:4px;font-size:10px;font-weight:700;background:'+color+'22;color:'+color+'">' +
            ((c.athlete||'athlete').split(' ')[0]).toUpperCase().replace(/</g,'&lt;') +
          '</span>' +
        '</div>' +
        '<div style="padding:14px 16px;display:grid;grid-template-columns:1fr 1fr;gap:10px">' +
          '<div><div style="color:var(--muted2);font-family:monospace;font-size:10px;letter-spacing:0.06em;text-transform:uppercase;margin-bottom:3px">Athlete Type</div>' +
          '<div style="font-size:13px;color:var(--text)">' + esc(c.athlete||'D1 college athlete') + '</div></div>' +
          '<div><div style="color:var(--muted2);font-family:monospace;font-size:10px;letter-spacing:0.06em;text-transform:uppercase;margin-bottom:3px">Platform &amp; Format</div>' +
          '<div style="font-size:13px;color:var(--text)">' + esc(c.platform||'TikTok / Instagram') + '</div></div>' +
        '</div>' +
        '<div style="padding:12px 16px;background:rgba(0,212,170,0.06);border-top:1px solid var(--border2);font-size:13px;color:var(--text2);line-height:1.5;font-style:italic">' +
          '&ldquo;' + esc(c.angle||c.description||'') + '&rdquo;' +
        '</div>' +
        (c.why ? '<div style="padding:10px 16px;background:rgba(200,168,75,0.07);border-top:1px solid var(--border2);font-size:11px;color:#c8a84b;display:flex;gap:8px">&#128161; <span><strong>Why ' + esc(co) + ' now:</strong> ' + esc(c.why) + '</span></div>' : '') +
      '</div>';
    }).join('');
    outputArea.innerHTML = '<div style="padding:14px">' + cards + '</div>';
  }

  else if (tab === 'talking_points') {
    var SECTIONS = [
      {key:'PERMISSION OPENER', icon:'&#127908;', color:'#3490dc', tag:'OPENER'},
      {key:'REVERSE PITCH', icon:'&#128260;', color:'#e3342f', tag:'PROBLEM LEAD'},
      {key:'DISCOVERY QUESTIONS', icon:'&#128269;', color:'#d69e2e', tag:'DISCOVERY'},
      {key:'KEY TALKING POINTS', icon:'&#9889;', color:'#00d4aa', tag:'TALKING POINTS'},
      {key:'OBJECTION RESPONSES', icon:'&#128737;', color:'#9f7aea', tag:'OBJECTIONS'},
      {key:'VALUE CLOSE', icon:'&#127919;', color:'#38a169', tag:'CLOSE'}
    ];
    var allKeys = SECTIONS.map(function(s){ return s.key; }).join('|');
    var html = '<div style="padding:14px;display:flex;flex-direction:column;gap:10px">';
    SECTIONS.forEach(function(cfg) {
      var re = new RegExp(cfg.key + '[:\\s\\-]+([\\s\\S]*?)(?=\\n(?:' + allKeys + ')|$)', 'i');
      var match = text.match(re);
      var body = match ? match[1].trim() : '';
      if (!body) return;
      var bodyHtml = body.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
        .replace(/\n/g,'<br>').replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>');
      html +=
        '<div style="background:var(--card);border:1px solid var(--border);border-radius:8px;overflow:hidden">' +
          '<div style="padding:9px 14px;background:rgba(0,0,0,0.15);border-bottom:1px solid var(--border2);border-left:3px solid '+cfg.color+';display:flex;align-items:center;gap:8px">' +
            '<span style="font-size:15px">'+cfg.icon+'</span>' +
            '<span style="font-family:monospace;font-size:10px;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:var(--muted2)">'+cfg.key+'</span>' +
            '<span style="margin-left:auto;padding:2px 7px;border-radius:4px;font-size:10px;font-weight:700;background:'+cfg.color+'22;color:'+cfg.color+'">'+cfg.tag+'</span>' +
          '</div>' +
          '<div style="padding:12px 14px;font-size:13px;color:var(--text2);line-height:1.6">'+bodyHtml+'</div>' +
        '</div>';
    });
    if (html === '<div style="padding:14px;display:flex;flex-direction:column;gap:10px">') {
      html += '<div style="padding:20px;white-space:pre-wrap;font-size:13px">' + text.replace(/</g,'&lt;') + '</div>';
    }
    html += '</div>';
    outputArea.innerHTML = html;
  }

  else if (tab === 'creative_brief') {
    document.getElementById('pdf-btn').style.display = 'inline-flex';
    var brief = {};
    try {
      var cleaned = text
        .replace(/^```json\s*/,'').replace(/```\s*$/,'')  // strip fences at start/end
        .replace(/```json/g,'').replace(/```/g,'')           // strip any remaining fences
        .trim();
      // Find the first { and last } to extract just the JSON object
      var jsonStart = cleaned.indexOf('{');
      var jsonEnd = cleaned.lastIndexOf('}');
      if (jsonStart >= 0 && jsonEnd > jsonStart) {
        cleaned = cleaned.slice(jsonStart, jsonEnd + 1);
      }
      brief = JSON.parse(cleaned);
    } catch(e) {
      console.error('Brief JSON parse error:', e, text.substring(0, 200));
      brief = {};
    }
    var concepts2 = brief.concepts || [];
    var flight = brief.flight || [];
    var email2 = brief.email || {};

    if (!concepts2.length && !email2.subject && !(email2.subjects && email2.subjects.length)) {
      outputArea.innerHTML = '<div style="padding:20px;white-space:pre-wrap;font-size:13px;line-height:1.7">' + text.replace(/</g,'&lt;').replace(/>/g,'&gt;') + '</div>';
      return;
    }

    var BCOLORS = ['#c8a84b','#e3342f','#3490dc'];
    var BGCOLORS = ['#1a2035','#1f1510','#0d1e2e'];
    var ACCENT_BG = ['rgba(200,168,75,0.12)','rgba(227,52,47,0.12)','rgba(52,144,220,0.12)'];

    // SVG sport scene generators for each frame
    // makeFrameSVG replaced by phone mockup renderer

    // Build concepts HTML  
    var SPORT_EMOJIS = {'basketball':'ğŸ€','soccer':'âš½','swimming':'ğŸŠ','swim':'ğŸŠ','track':'ğŸƒ','gymnastics':'ğŸ¤¸','football':'ğŸˆ','volleyball':'ğŸ','baseball':'âš¾','tennis':'ğŸ¾','golf':'â›³','hockey':'ğŸ’','lacrosse':'ğŸ¥','wrestling':'ğŸ¤¼','cross country':'ğŸƒ'};
    var conceptsHtml = concepts2.map(function(c, i) {
      var esc = function(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); };
      var numStr = (i+1) < 10 ? '0'+(i+1) : ''+(i+1);
      var conceptName = c.name || ('Concept ' + (i+1));
      var sport = c.sport || 'Sport';
      var platform = c.platform || 'Instagram';
      var postType = c.post_type || 'Feed Post';
      var athleteName = c.athlete_name || 'Jordan Mitchell';
      var athleteHandle = c.athlete_handle || ('@' + athleteName.toLowerCase().replace(/\s+/g,'_'));
      var athleteSchool = c.athlete_school || 'University Â· City';
      var brandHandle = c.brand_handle || ('@' + (co||'brand').toLowerCase().replace(/[^a-z0-9]/g,''));
      var followers = c.followers || '24K';
      var engRate = c.eng_rate || '7.4%';
      var promoCode = c.promo_code || (co.substring(0,4).toUpperCase()+'15');
      var description = c.description || '';
      var caption = c.post_caption || '';
      var imageText = (c.post_image_text || 'Meet your new routine.').replace(/\*\*/g,'').replace(/^_|_$/g,'').replace(/_/g,'');
      var ins1Label = c.insight1_label || 'Perfect Fit';
      var ins1Body = c.insight1_body || '';
      var ins2Label = c.insight2_label || 'Brand Moment';
      var ins2Body = c.insight2_body || '';

      // Sport emoji
      var sportKey = sport.toLowerCase().replace(/[^a-z ]/g,'');
      var sportEmoji = 'ğŸ¯';
      Object.keys(SPORT_EMOJIS).forEach(function(k){ if(sportKey.indexOf(k)>=0) sportEmoji = SPORT_EMOJIS[k]; });

      // Athlete initials for avatar
      var initials = athleteName.split(' ').map(function(n){return n[0]||'';}).join('').substring(0,2).toUpperCase();

      // Card background colors - warm cream per concept
      var cardBgs = ['#fdf6e8','#fdf6e8','#fdf6e8'];
      var accentColors = ['#e85c2e','#e8a020','#2ea85c'];
      var accent = accentColors[i] || '#e85c2e';

      // Instagram phone mockup
      var phoneMockup = '<div style="width:220px;flex-shrink:0;position:relative">'
        + '<div style="background:#000;border-radius:36px;border:3px solid #1a1a1a;box-shadow:0 24px 60px rgba(0,0,0,0.35),inset 0 0 0 1px rgba(255,255,255,0.06);overflow:hidden">'
          // Dynamic island
          + '<div style="position:absolute;top:10px;left:50%;transform:translateX(-50%);width:72px;height:20px;background:#000;border-radius:10px;z-index:40"></div>'
          // Screen
          + '<div style="background:#fff;aspect-ratio:9/19.5;position:relative;overflow:hidden">'
            // IG header
            + '<div style="background:#fff;padding:30px 10px 6px;border-bottom:1px solid #efefef;display:flex;align-items:center;gap:7px">'
              + '<div style="width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:900;color:white;font-family:sans-serif;flex-shrink:0">' + initials + '</div>'
              + '<div style="flex:1;min-width:0">'
                + '<div style="font-size:9px;font-weight:700;color:#1a1a1a;font-family:sans-serif;line-height:1.2">' + esc(athleteHandle) + '</div>'
                + '<div style="font-size:7.5px;color:#888;font-family:sans-serif;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">' + esc(athleteSchool) + '</div>'
              + '</div>'
              + '<svg width="14" height="14" viewBox="0 0 24 24" fill="#1a1a1a" opacity="0.5"><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/></svg>'
            + '</div>'
            // Post image - warm gradient with overlay text
            + '<div style="background:linear-gradient(160deg,#87ceeb 0%,#6ab8d4 40%,#4a9fb5 70%,#b8d4a8 100%);aspect-ratio:1;position:relative;overflow:hidden">'
              + '<div style="position:absolute;top:6px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.75);border-radius:3px;padding:2px 8px;white-space:nowrap">'
                + '<span style="font-size:6px;color:white;font-family:sans-serif;font-weight:700;letter-spacing:0.05em">PAID PARTNERSHIP Â· ' + brandHandle.toUpperCase() + '</span>'
              + '</div>'
              // Stick figure athlete SVG
              + '<svg style="position:absolute;bottom:28px;left:50%;transform:translateX(-50%)" width="60" height="90" viewBox="0 0 60 90">'
                + '<circle cx="30" cy="12" r="9" fill="#e8956d"/>'
                + '<rect x="18" y="24" width="24" height="32" rx="4" fill="' + accent + '"/>'
                + '<line x1="30" y1="24" x2="12" y2="40" stroke="#e8956d" stroke-width="5" stroke-linecap="round"/>'
                + '<line x1="30" y1="24" x2="48" y2="40" stroke="#e8956d" stroke-width="5" stroke-linecap="round"/>'
                + '<line x1="24" y1="56" x2="20" y2="76" stroke="#e8956d" stroke-width="5" stroke-linecap="round"/>'
                + '<line x1="36" y1="56" x2="40" y2="76" stroke="#e8956d" stroke-width="5" stroke-linecap="round"/>'
              + '</svg>'
              // Image overlay text
              + '<div style="position:absolute;bottom:0;left:0;right:0;padding:8px 10px;background:linear-gradient(transparent,rgba(0,0,0,0.6))">'
                + '<div style="font-size:9px;font-style:italic;font-weight:700;color:white;font-family:Georgia,serif;line-height:1.3">' + esc(imageText) + '</div>'
                + '<div style="font-size:7px;color:rgba(255,255,255,0.75);font-family:sans-serif;margin-top:1px">' + esc(brandHandle.replace('@','')) + '.com</div>'
              + '</div>'
            + '</div>'
            // IG action bar
            + '<div style="padding:7px 10px 4px;border-bottom:1px solid #f5f5f5">'
              + '<div style="display:flex;align-items:center;gap:10px;margin-bottom:4px">'
                + '<svg width="16" height="16" viewBox="0 0 24 24" fill="#1a1a1a"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>'
                + '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a1a1a" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>'
                + '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a1a1a" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>'
              + '</div>'
              + '<div style="font-size:8px;font-weight:700;color:#1a1a1a;font-family:sans-serif;margin-bottom:3px">22,841 likes</div>'
              + '<div style="font-size:7.5px;color:#1a1a1a;font-family:sans-serif;line-height:1.4">'
                + '<strong>' + esc(athleteHandle.replace('@','')) + '</strong> ' + esc((caption||'').substring(0,80)) + (caption.length>80?'...':'')
              + '</div>'
              + '<div style="font-size:7px;color:#888;font-family:sans-serif;margin-top:2px">2 HOURS AGO</div>'
            + '</div>'
          + '</div>'
        + '</div>'
      + '</div>';

      // Right-side content
      var clientLogoUrl = 'https://logo.clearbit.com/' + (co||'').toLowerCase().replace(/[^a-z0-9]/g,'') + '.com';
      var rightContent = '<div style="flex:1;min-width:0;padding:8px 0 8px 36px">'
        // Eyebrow with client logo
        + '<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">'
          + '<div style="display:flex;align-items:center;gap:8px">'
            + '<span style="font-size:11px;font-family:monospace;letter-spacing:0.12em;color:#e85c2e;font-weight:700">' + sportEmoji + ' ' + esc(sport.toUpperCase()) + '</span>'
            + '<span style="color:rgba(0,0,0,0.2);font-size:11px">Â·</span>'
            + '<span style="font-size:11px;font-family:monospace;letter-spacing:0.12em;color:#888;text-transform:uppercase">' + esc(postType) + '</span>'
          + '</div>'
          // Client logo top-right of card â€” multi-source with fallback
          + '<div style="display:flex;align-items:center;height:32px">'
          + '<img id="card-logo-cb-' + i + '" src="' + clientLogoUrl + '" style="height:30px;width:auto;max-width:110px;object-fit:contain;mix-blend-mode:multiply" '
          + 'onerror="this.style.display=\'none\';var n=document.getElementById(\'card-logo-goog-' + i + '\');if(n)n.style.display=\'block\'" />'
          + '<img id="card-logo-goog-' + i + '" src="https://www.google.com/s2/favicons?domain=' + (co||'').toLowerCase().replace(/[^a-z0-9]/g,'') + '.com&sz=64" '
          + 'style="display:none;height:24px;width:24px;border-radius:4px;mix-blend-mode:multiply" '
          + 'onerror="this.style.display=\'none\'" />'
          + '</div>'
        + '</div>'
        // Ghost number + name
        + '<div style="position:relative;margin-bottom:12px">'
          + '<div style="position:absolute;top:-18px;left:-6px;font-size:80px;font-weight:900;color:rgba(0,0,0,0.07);font-family:\'Syne\',serif;line-height:1;user-select:none;pointer-events:none">' + numStr + '</div>'
          + '<div style="font-family:\'Syne\',Georgia,serif;font-size:26px;font-weight:900;color:#1a1a1a;line-height:1.15;letter-spacing:-0.02em;position:relative;z-index:1">' + esc(conceptName) + '</div>'
        + '</div>'
        // Description
        + '<div style="font-size:13px;color:#444;line-height:1.65;margin-bottom:18px;max-width:380px">' + esc(description) + '</div>'
        // Stat pills
        + '<div style="display:flex;align-items:center;gap:10px;margin-bottom:20px;flex-wrap:wrap">'
          + '<div style="background:#e85c2e;border-radius:6px;padding:8px 14px;text-align:center">'
            + '<div style="font-size:15px;font-weight:900;color:white;font-family:sans-serif;line-height:1">' + esc(followers) + '</div>'
            + '<div style="font-size:8px;color:rgba(255,255,255,0.8);font-family:sans-serif;letter-spacing:0.08em;text-transform:uppercase;margin-top:2px">Followers</div>'
          + '</div>'
          + '<div style="background:#e8a020;border-radius:6px;padding:8px 14px;text-align:center">'
            + '<div style="font-size:15px;font-weight:900;color:white;font-family:sans-serif;line-height:1">' + esc(engRate) + '</div>'
            + '<div style="font-size:8px;color:rgba(255,255,255,0.8);font-family:sans-serif;letter-spacing:0.08em;text-transform:uppercase;margin-top:2px">Eng. Rate</div>'
          + '</div>'
          + '<div style="padding:8px 14px;text-align:center">'
            + '<div style="font-size:15px;font-weight:900;color:#1a1a1a;font-family:sans-serif;line-height:1">' + esc(promoCode) + '</div>'
            + '<div style="font-size:8px;color:#888;font-family:sans-serif;letter-spacing:0.08em;text-transform:uppercase;margin-top:2px">Code</div>'
          + '</div>'
        + '</div>'
        // Insight cards
        + '<div style="display:flex;flex-direction:column;gap:8px;max-width:400px">'
          + '<div style="background:rgba(232,92,46,0.06);border:1px solid rgba(232,92,46,0.15);border-radius:8px;padding:12px 14px">'
            + '<div style="font-size:9px;font-weight:800;color:#e85c2e;letter-spacing:0.12em;text-transform:uppercase;font-family:sans-serif;margin-bottom:5px">ğŸ¯ ' + esc(ins1Label) + '</div>'
            + '<div style="font-size:12px;color:#333;line-height:1.55;font-family:sans-serif">' + esc(ins1Body) + '</div>'
          + '</div>'
          + '<div style="background:rgba(46,168,92,0.06);border:1px solid rgba(46,168,92,0.15);border-radius:8px;padding:12px 14px">'
            + '<div style="font-size:9px;font-weight:800;color:#2ea85c;letter-spacing:0.12em;text-transform:uppercase;font-family:sans-serif;margin-bottom:5px">ğŸ“Š ' + esc(ins2Label) + '</div>'
            + '<div style="font-size:12px;color:#333;line-height:1.55;font-family:sans-serif">' + esc(ins2Body) + '</div>'
          + '</div>'
        + '</div>'
      + '</div>';

      return '<div style="background:#fdf6e8;padding:40px 44px;' + (i>0?'border-top:2px solid rgba(0,0,0,0.06)':'') + '">'
        + '<div style="display:flex;align-items:center;gap:0;max-width:820px;margin:0 auto">'
          + phoneMockup
          + rightContent
        + '</div>'
      + '</div>';
    }).join('');

    // Flight model
    var flightHtml = '';
    if (flight.length > 0) {
      var flightRowsHtml = flight.map(function(row, i) {
        var color = BCOLORS[i] || '#c8a84b';
        var cells = (row.cells || [null,null,null,null,null,null]).slice(0,6);
        var cellsHtml = cells.map(function(c2) {
          return c2
            ? '<div style="background:' + color + ';border-radius:3px;padding:6px 4px;text-align:center;font-size:9px;font-weight:700;color:#fff;letter-spacing:0.05em">' + (c2+'').replace(/</g,'&lt;') + '</div>'
            : '<div style="background:rgba(255,255,255,0.04);border-radius:3px;min-height:28px"></div>';
        }).join('');
        return '<div style="padding:5px 0"><div style="font-size:11px;font-weight:700;color:#fff">' + ((row.label||'CONCEPT '+(i+1))+'').replace(/</g,'&lt;') + '</div>' +
          '<div style="font-size:10px;color:rgba(255,255,255,0.35);font-family:monospace">' + (row.sub||'').replace(/</g,'&lt;') + '</div></div>' + cellsHtml;
      }).join('');
      flightHtml =
        '<div style="padding:28px 30px;background:rgba(0,0,0,0.25);border-bottom:1px solid rgba(255,255,255,0.06)">' +
          '<div style="font-family:\'Syne\',sans-serif;font-size:22px;font-weight:800;color:#fff;margin-bottom:4px;letter-spacing:-0.02em">6-WEEK FLIGHT MODEL</div>' +
          '<div style="font-size:11px;color:#c8a84b;font-family:monospace;margin-bottom:20px;letter-spacing:0.06em">NIL ATHLETE CREATIVE &middot; MAPPED BY PLATFORM &amp; FUNNEL STAGE</div>' +
          '<div style="display:grid;grid-template-columns:150px repeat(6,1fr);gap:5px;align-items:center">' +
            '<div></div>' +
            ['WK 1','WK 2','WK 3','WK 4','WK 5','WK 6'].map(function(w){
              return '<div style="font-size:10px;color:rgba(255,255,255,0.3);text-align:center;font-family:monospace;padding-bottom:4px">'+w+'</div>';
            }).join('') +
            flightRowsHtml +
          '</div>' +
        '</div>';
    }

    // Email section
    var emailHtml = '';
    if (email2.subject || (email2.subjects && email2.subjects.length)) {
      var esc2 = function(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); };

      // Parse body line-by-line â€” concept lines get individual gold-border cards
      var rawLines = (email2.body || '').split('\n');
      var emailBodyHtml = '';
      var outlookBodyHtml = '';
      var paraBuffer = [];

      var flushPara = function() {
        if (!paraBuffer.length) return;
        var txt = paraBuffer.join(' ').trim();
        if (txt) {
          var escaped = esc2(txt).replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>');
          emailBodyHtml += '<p style="margin:0 0 14px;font-size:13px;color:#323130;line-height:1.7;font-family:Aptos,Calibri,Arial,sans-serif">' + escaped + '</p>';
          outlookBodyHtml += '<p style="margin:0 0 14px;font-size:11pt;color:#1a1a1a;line-height:1.6;font-family:Calibri,Arial,sans-serif">' + escaped + '</p>';
        }
        paraBuffer = [];
      };

      rawLines.forEach(function(line) {
        var trimmed = line.trim();
        if (!trimmed) { flushPara(); return; }
        if (/concept\s+0?\d/i.test(trimmed)) {
          flushPara();
          var dotIdx = trimmed.search(/\.\s+[A-Z]/);
          var titlePart = dotIdx > 0 ? trimmed.slice(0, dotIdx+1) : trimmed;
          var descPart  = dotIdx > 0 ? trimmed.slice(dotIdx+2) : '';
          var tEsc = esc2(titlePart).replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>');
          var dEsc = descPart ? esc2(descPart).replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>') : '';
          // Display version â€” gold border
          emailBodyHtml += '<div style="border-left:3px solid #c8a84b;background:#fffef5;border-radius:0 5px 5px 0;padding:10px 14px;margin:7px 0">'
            + '<div style="font-weight:700;font-size:13px;color:#1a1a1a;line-height:1.4;font-family:Aptos,Calibri,Arial,sans-serif">' + tEsc + '</div>'
            + (dEsc ? '<div style="font-size:12px;color:#605e5c;line-height:1.5;margin-top:3px;font-family:Aptos,Calibri,Arial,sans-serif">' + dEsc + '</div>' : '')
            + '</div>';
          // Outlook HTML clipboard version â€” gold border using table (renders in Outlook)
          outlookBodyHtml += '<table style="border-collapse:collapse;width:100%;margin:6px 0"><tr>'
            + '<td style="width:3px;background:#c8a84b;padding:0"></td>'
            + '<td style="background:#fffef5;padding:10px 14px;border:1px solid #e8d88a;border-left:none">'
            + '<p style="margin:0;font-size:11pt;font-weight:bold;color:#1a1a1a;font-family:Calibri,Arial,sans-serif">' + tEsc + '</p>'
            + (dEsc ? '<p style="margin:3px 0 0;font-size:10pt;color:#444;font-family:Calibri,Arial,sans-serif">' + dEsc + '</p>' : '')
            + '</td></tr></table>';
        } else {
          paraBuffer.push(trimmed);
        }
      });
      flushPara();

      // Outlook signature HTML (renders in Outlook via table layout)
      var outlookSig = '<br><div style="border-top:1px solid #e1dfdd;padding-top:12px;margin-top:16px">'
        + '<table style="border-collapse:collapse"><tr>'
        + '<td style="padding-right:12px;vertical-align:middle">'
        + '<table style="border-collapse:collapse;height:36px"><tr>'
        + '<td style="width:9px;background:#4caf50;border-radius:2px 0 0 2px">&nbsp;</td>'
        + '<td style="width:3px">&nbsp;</td>'
        + '<td style="width:9px;background:#2e7d32">&nbsp;</td>'
        + '<td style="width:3px">&nbsp;</td>'
        + '<td style="width:9px;background:#4caf50;border-radius:0 2px 2px 0">&nbsp;</td>'
        + '</tr></table>'
        + '</td>'
        + '<td style="font-family:Calibri,Arial,sans-serif;font-size:10pt;color:#333;vertical-align:middle;line-height:1.5">'
        + '<strong style="font-size:11pt;color:#1a1a1a">Ryan Wolpe</strong><br>'
        + 'Senior Director, Brand Partnerships<br>'
        + 'Office: 317.612.4510 &nbsp;|&nbsp; Cell: 317.612.4510<br>'
        + '<a href="http://www.opendorse.com" style="color:#0078d4;text-decoration:none">www.opendorse.com</a>'
        + '</td></tr></table>'
        + '<p style="margin:10px 0 0;font-family:Georgia,serif;line-height:1.2">'
        + '<strong style="font-size:14pt">TIME<span style="color:#e3001b">100</span></strong><br>'
        + '<span style="font-size:7pt;font-weight:bold;color:#e3001b;letter-spacing:1px;text-transform:uppercase">Most Influential</span><br>'
        + '<span style="font-size:7pt;font-weight:bold;letter-spacing:1px;text-transform:uppercase">Companies</span>'
        + '</p></div>';

      // Display signature (matches Outlook visual)
      var displaySig = '<div style="border-top:1px solid #edebe9;margin-top:18px;padding-top:14px">'
        + '<table style="border-collapse:collapse"><tr>'
        + '<td style="padding-right:10px;vertical-align:middle">'
        + '<div style="display:flex;gap:3px;align-items:center;height:36px">'
        + '<div style="width:9px;height:36px;background:#4caf50;border-radius:2px"></div>'
        + '<div style="width:9px;height:36px;background:#2e7d32"></div>'
        + '<div style="width:9px;height:36px;background:#4caf50;border-radius:2px"></div>'
        + '</div></td>'
        + '<td style="font-family:Aptos,Calibri,sans-serif;font-size:12px;color:#333;vertical-align:middle;line-height:1.55">'
        + '<strong style="font-size:13px;color:#1a1a1a">Ryan Wolpe</strong><br>'
        + 'Senior Director, Brand Partnerships<br>'
        + 'Office: 317.612.4510 &nbsp;|&nbsp; Cell: 317.612.4510<br>'
        + '<a href="http://www.opendorse.com" style="color:#0078d4;text-decoration:none">www.opendorse.com</a>'
        + '</td></tr></table>'
        + '<div style="margin-top:10px">'
        + '<span style="font-family:Georgia,serif;font-size:15px;font-weight:900">TIME<span style="color:#e3001b">100</span></span><br>'
        + '<span style="font-size:8px;font-weight:800;color:#e3001b;letter-spacing:1px;text-transform:uppercase">Most Influential</span><br>'
        + '<span style="font-size:8px;font-weight:800;letter-spacing:1px;text-transform:uppercase">Companies</span>'
        + '</div></div>';

      // Full Outlook-ready HTML for clipboard
      var outlookFull = '<!DOCTYPE html><html><body style="font-family:Calibri,Arial,sans-serif;font-size:11pt;color:#1a1a1a;margin:20px;padding:0">'
        + outlookBodyHtml + outlookSig + '</body></html>';
      window._emailOutlookHtml = outlookFull;
      window._emailSubject = email2.subject || (email2.subjects ? email2.subjects[0] : '');

      emailHtml =
        '<div style="padding:28px 36px 24px;background:#f5f2ec">'
          + '<div style="font-size:10px;color:#999;font-family:monospace;letter-spacing:0.15em;text-transform:uppercase;margin-bottom:5px">The Outreach</div>'
          + '<div style="font-family:\'Syne\',Impact,sans-serif;font-size:30px;font-weight:900;color:#1a1a1a;letter-spacing:-0.01em;margin-bottom:20px;text-transform:uppercase">The Email</div>'
          // Outlook window
          + '<div style="background:#fff;border-radius:4px;box-shadow:0 2px 16px rgba(0,0,0,0.10);overflow:hidden;max-width:600px;border:1px solid #d0d0d0">'
            // Outlook blue top bar
            + '<div style="height:3px;background:linear-gradient(90deg,#0078d4,#005a9e)"></div>'
            // From / To / Subject â€” Outlook field style
            + '<div style="padding:0 20px;border-bottom:1px solid #edebe9">'
              + '<div style="display:flex;align-items:baseline;padding:9px 0;border-bottom:1px solid #f3f2f1">'
                + '<span style="font-size:12px;color:#605e5c;font-family:Aptos,Calibri,sans-serif;min-width:62px;font-weight:600">From:</span>'
                + '<span style="font-size:13px;color:#323130;font-family:Aptos,Calibri,sans-serif">Ryan Wolpe (ryan.wolpe@opendorse.com)</span>'
              + '</div>'
              + '<div style="display:flex;align-items:baseline;padding:9px 0;border-bottom:1px solid #f3f2f1">'
                + '<span style="font-size:12px;color:#605e5c;font-family:Aptos,Calibri,sans-serif;min-width:62px;font-weight:600">To:</span>'
                + '<span style="font-size:13px;color:#0078d4;font-family:Aptos,Calibri,sans-serif">' + esc2(email2.to || ('vp.marketing@' + safeCompany + '.com')) + '</span>'
              + '</div>'
              + '<div style="display:flex;align-items:baseline;padding:9px 0">'
                + '<span style="font-size:12px;color:#605e5c;font-family:Aptos,Calibri,sans-serif;min-width:62px;font-weight:600">Subject:</span>'
                + '<span data-subj="' + esc2(email2.subject || (email2.subjects ? email2.subjects[0] : '')) + '" style="font-size:13px;color:#323130;font-weight:700;font-family:Aptos,Calibri,sans-serif">' + esc2(email2.subject || (email2.subjects ? email2.subjects[0] : '')) + '</span>'
              + '</div>'
            + '</div>'
            // Outlook formatting toolbar
            + '<div style="background:#f3f2f1;border-bottom:1px solid #edebe9;padding:5px 14px;display:flex;align-items:center;gap:6px">'
              + '<span style="font-size:11px;color:#323130;font-family:sans-serif;background:#fff;border:1px solid #c8c8c8;border-radius:2px;padding:2px 8px">Aptos</span>'
              + '<span style="font-size:11px;color:#323130;font-family:sans-serif;background:#fff;border:1px solid #c8c8c8;border-radius:2px;padding:2px 6px">12</span>'
              + '<span style="font-size:13px;font-weight:900;color:#323130;padding:1px 5px;font-family:sans-serif;cursor:default">B</span>'
              + '<span style="font-size:13px;font-style:italic;color:#323130;padding:1px 5px;font-family:sans-serif;cursor:default">I</span>'
              + '<span style="font-size:13px;text-decoration:underline;color:#323130;padding:1px 5px;font-family:sans-serif;cursor:default">U</span>'
              + '<span style="font-size:11px;color:#999;margin-left:4px;font-family:sans-serif">Â·Â·Â·</span>'
            + '</div>'
            // Body
            + '<div style="padding:20px 22px 16px;font-family:Aptos,Calibri,Arial,sans-serif">'
              + emailBodyHtml
              + displaySig
            + '</div>'
          + '</div>'
          // Activity log bar â€” rendered via helper to avoid quote nesting
          + buildComposeLogBar()
          + '<div style="display:flex;gap:10px;margin-top:12px">'
            + '<button id="copy-outlook-btn" onclick="(function(){'
              + 'var b=document.getElementById(\'copy-outlook-btn\');'
              + 'var html=window._emailOutlookHtml||\'\';'
              + 'if(navigator.clipboard&&window.ClipboardItem){'
                + 'navigator.clipboard.write([new ClipboardItem({\'text/html\':new Blob([html],{type:\'text/html\'})})]).then(function(){b.textContent=\'âœ“ Copied!\';setTimeout(function(){b.textContent=\'COPY FOR OUTLOOK \u2192\';},2000);}).catch(function(){'
                  + 'var d=document.createElement(\'div\');d.contentEditable=true;d.innerHTML=html;d.style.cssText=\'position:fixed;opacity:0;top:0;left:0\';document.body.appendChild(d);'
                  + 'var r=document.createRange();r.selectNodeContents(d);var s=window.getSelection();s.removeAllRanges();s.addRange(r);document.execCommand(\'copy\');document.body.removeChild(d);'
                  + 'b.textContent=\'âœ“ Copied!\';setTimeout(function(){b.textContent=\'COPY FOR OUTLOOK \u2192\';},2000);});'
              + 'var acctId=document.getElementById(\'composer-account-select\').value;'
              + 'if(acctId&&window._emailSubject){logActivity(acctId,\'email\',window._emailSubject||\'Email copied for Outlook\');}'
              + '}else{'
                + 'var d=document.createElement(\'div\');d.contentEditable=true;d.innerHTML=html;d.style.cssText=\'position:fixed;opacity:0;top:0;left:0\';document.body.appendChild(d);'
                + 'var r=document.createRange();r.selectNodeContents(d);var s=window.getSelection();s.removeAllRanges();s.addRange(r);document.execCommand(\'copy\');document.body.removeChild(d);'
                + 'b.textContent=\'âœ“ Copied!\';setTimeout(function(){b.textContent=\'COPY FOR OUTLOOK \u2192\';},2000);'
              + '}'
            + '})()" style="background:#0078d4;color:#fff;border:none;border-radius:4px;padding:12px 22px;font-size:12px;font-weight:700;font-family:sans-serif;cursor:pointer;letter-spacing:0.04em">COPY FOR OUTLOOK &#8594;</button>'
            + '<button onclick="copyOutput()" style="background:transparent;color:#444;border:1.5px solid #ccc;border-radius:4px;padding:12px 22px;font-size:12px;font-weight:600;font-family:sans-serif;cursor:pointer">SHARE DECK</button>'
          + '</div>'
        + '</div>';
    }

    outputArea.innerHTML =
      '<div id="brief-content" style="background:#111;max-width:960px;margin:0 auto">' +
        // Header
        '<div style="background:#0d0d0d;border-bottom:1px solid rgba(255,255,255,0.08);padding:16px 30px;display:flex;align-items:center;justify-content:space-between">' +
          // Left: Opendorse logo + client logo
          '<div style="display:flex;align-items:center;gap:12px">' +
            // Opendorse real logo
            '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAP4AAAB4CAYAAADSf0+UAAABCGlDQ1BJQ0MgUHJvZmlsZQAAeJxjYGA8wQAELAYMDLl5JUVB7k4KEZFRCuwPGBiBEAwSk4sLGHADoKpv1yBqL+viUYcLcKakFicD6Q9ArFIEtBxopAiQLZIOYWuA2EkQtg2IXV5SUAJkB4DYRSFBzkB2CpCtkY7ETkJiJxcUgdT3ANk2uTmlyQh3M/Ck5oUGA2kOIJZhKGYIYnBncAL5H6IkfxEDg8VXBgbmCQixpJkMDNtbGRgkbiHEVBYwMPC3MDBsO48QQ4RJQWJRIliIBYiZ0tIYGD4tZ2DgjWRgEL7AwMAVDQsIHG5TALvNnSEfCNMZchhSgSKeDHkMyQx6QJYRgwGDIYMZAKbWPz9HbOBQAABMOUlEQVR4nO29d7hkVZnv/1lr5won9ekcSE20CYNIEJtBHHFUrl6RNMIIjAooOhhQdMZwx3kcH2BGYAgGEEFkRpiLKNeL/GRUlIsMoYk2uYGmm44nn0o7rfX7Y+29q87p090kFafr+zynq7pq147rfdcbvu+7hNaaLrroYseC/GOfQBdddPGHR1fwu+hiB0RX8LvoYgdEV/C76GIHRFfwu+hiB0RX8LvoYgdEV/C76GIHRFfwu+hiB0RX8LvoYgdEV/C76GIHRFfwu+hiB0RX8LvoYgdEV/C76GIHRFfwu+hiB4Q988dqK5tvTU9M336m7VSxnUYikGhAwFZfXz5UduyXcj5ddLHjYgbBzwV0ep1+LopThUjrFESKKITNBi2Ln2sAodEiAZLsCBKJk72Cyt4pQGqBEiCz34vssKLzdER2imizgciPPf11Jsj2efFKFUwXXfxpY5rgTxeYfAbd3mdGfLTWCDTo6XO2QKDQpDP8Tk85shJTX63tX8MM50exX/NvapRRxyeFRumiix0QWzH1wQil7Jj3c4EGSDHCLwALtCTv5KMRoIWRLw1Cmv+aPZo3EonQstiDFJ2KRLd/kJ9G52u+VWYCTJXfTjM/V0bZ/4tz11POpTvld7EjwjYCO32m34q0TYECLDNna4HAmWFGz/aiQRfCLbO9CmO+C4HIlYbIt9XZq9rGOWS/0bJjm2x7sS1Tv4suurBffiCsc3tj0guRzfQIM/NnAtwps0ILM/0j2zGAwpxom/wCZSyF7Fhia4IvdIf5Pi3+0BEPEKJtAWitETNaCl10sWPBLmZHPbPf3sa0YJ9QxW+MS69BpEAmXMIxm+jO32cCrqU5rGaKE58ri0Lo8/1u87zEtPeaTpNfINC5UsmkXXSlvosdHNvw8SmC5ka2ppv/ZlpXaeZLywiITAQfYYRfWmhtYWbuTPh0x4y/lWMWmHLc/Os8Kp8HEKae1VYxXcF1w/pd7MDYtuC/BKHQpFmqrgHEQILGAmKEcBEin9I7XQSVmf1FCC47nuoQ/Eyot5idO6LzemtWier4ZEsNY7IPXXSx48JuR7fbUfC2sBqkaYrWGssSCGF8ZaVThEiJVYjnQC0a0tpqYVsCl4CGStHKFp5dRmJjIRBYIPI/Mqu8TeyJogTXddFKIUSmk1JAdPxh3AcljE8gM6tEayPkQghj3iuF0gmWZa5lS48hVw5dcs+fApRS5tl2TARKKaTsPr9XAqFUMuUDTZoJjxGYNE2RUhZBMa1FccOFSEhoMDL5on70sbtphCNUe3wWLF5EX89cep25xAgkjrAQaARa2whcXFFGYNGIazjSwrE8jEeeBQCV3NLsz3P8tPP8ueC3v8muYfqFdloS0PGj7sB5PcMEZNs8kemfdaIbu3npsM3s3ma8taPoMQCpihDSRmCTqpQkMWQYKSXSSrGkotEaZsOmVUzUN8LmiGfWPkiaOrhOlWX7vJFKpVf3VPsoeWUs4aG1Q6IaQkoHz3FISWiqJq70IbWxrQAEKNUhlh2zPSIPGirCNEJKcKRVBPJ0dh2dgb12VD/7b+7rd8fK6xrtScbM9rn1KYTAsizSNN1C4LsKYPuwlaJIcwmpgTQTlxSNwnYEgpRUp2gtcBwHKWxAkugGCREpTRLdwC2nuCVBqhuoRJKIhF/+9mZ8r4dqtYfenn4G+mYzu38eg/0LdNUdIMYWCoEtHaNchEJpGyk8ZDvLZ1z6/K0GhEIT49o2JpmYR/HbWYHOKP8Ws4XOfQS6wv86RqcQd870ucvZxSuDncQqs4MV0lIImQApmhilEqS0s5tsoZFobbcDc8IQeKSliXUDLVu0VINmNEmqLYT0mLVogCQJaUQbmBxax/phF9vy8KwqtvBZtHA33V8dZP6cJfS7c4WUAXHSwhYSSzpb4RYZoTfpQ0iJiZXCkhYWglSlaGV+aFsuRpkZos8Wvn4Xr2tIaZS2yp6nEGLKZ9N9/O5s/9JgmxsnQSQIoZDC+MhKJygd4woLE0UzqbQ0VbRaLaRwsTxo6YZOdIIWCY6vkSVILIVjSZCKergZkEhXYvsWtohRaYtaOEESSiafHsWzq8wZeJ55gzvrfZceJGy7B4mYaupj9JNCgUiQpKQ6RomUJI3QCqTUCGwsKZDSBAcVbb5Bu3IoYwjpKQGCLl7HyGf7rmC/NrBtKyfRSYSUmXGsUCohTWNS26LZClGpIPB7cSwPS9pZKs3CE77wfVcrnVIPJ4E6rXgMt1wGIiIVm4BgbKKyru3h2B5+tYTVU6E5WWd4vMbk5CRjY+PstXSZtikLSI3gi46MYzHbJ2giJAqJwLEstGU8+igNieMYW1r4bjDlYrdM43UH0esduTmfC3w+8+fotARydJXD9mErGaF0QkqMCejVSWjpSDeJdZO1L44wPDxKGsK8uTuxaO5eIvD60coE+0IZEyUxWiTYrsQKXFLpIyyIwpBqTyV7ECYwkyQxYTxBM5qA1GWguhjLsgksC1coPBwR6QRfaGzbNoV1AhApWoRoWigiY5WQooh1QkQcx7RaLSZGJ5gcn0AIi7JfYa+lbxRCOCitEUi0UIZElKM7Rl4H6Oyj0PnamVUShXmvtS4+S1Pj7uXWQFfoXxrshDW6JUI0EKo6o7U1rN+0mrUvPk8YNmnUa3i2i44tNo0vYcmSJUCAkCVsIYlxieIU4WlSEZPGGiwflMS2HBqNpsm9KRfLFkhH4vsOsdKoNGW8tQ6V2ERxgJYQk2qPipDaAW0i+8pK0WIcQY0mI1qT0kpSfNtm1aYHWb9pNcObh4njGFJIE03YaPJnyw6nnu6KwwCOzLgJWiBkFgLMUgTbcvtnIgB1Qr4MzTF99gJI1ZbexvT/d8awpn+nOgSj8zj5sTp94JmCYZ1R81eCVxUyyWsntKF65wEYrRLILFApNFJCHIU4rsvvHn1U/+pXv+Lggw/msDe/RZhzMD6/pn0/iz4OYsrhpnxmPL4tr+Cl3gv9GriKRZJphrHxStH5nKenQnPYK9f+hqGRUSZqTcYmhmimG8FukSpFqeyTxpNox0MjUVYDQaQ1WoisYYfAQksLITRaqIxSa5Nqkxi0hJ3pbzt7tppEx2itSElxPQchUmyVIkkR2AIlUVkVcKo0jqMImaDOOv3ipqcYHhvmhdXrqTfH6Z2jqbdGicIQy3KwLNu4LGkL7TaQVqrRWgghsvj+tCjxNgQ3Ix+/7JvdecO399nL5Z9MH7w5QQnaRCsp5XYFvn38mZXG9LqGmfbxUgZpUSexBfVat+syRGf6RiGKc1dIywJtrL/a5CT/5//8H7773e/yl3/5l+y+x17MmjWYhWpmPpfO+9Up8PnnUr5ChZcr185CtJcwVrY2pl4rS2X6c9ras7cfeOROkiRF2iXitIG2Gsgssp+kGmkpQ62XGqRGFeE2iUmjTWX5mRsiEFIXgxBtavC10MUNU0qhlcByHYRlIbEQWprsuxCAqfBxPZtGOsGjz9yrn33xfjaPrcYNLLRysAPB5uEhhEywhETrFKXBwkbILOqLFFKY/SKsrE6g8xpmuHm0Z8ztPks9883Nhafzu5m0upCSbcjljDNWJ9I0KYTXsqzi3iaJIWZ1KoaZ9781gZlKnOlMh3ZCZvvvvGc5e3LK/tjKgBS0qdf58Tr89tpkHd/3sR0Hzw2YnKgjhY3AYnAwF/p8n1N2U7xPU53dizxOoDMmqtwiZjD9fmxNkAoFSZtjkAt1fq1a66LXROdnOcMUQKVtRuLLsjSmvd/Wc5wJdisaBssm8ARpGqFliO1qVKrQMkELQ83VHbR+U4kvUTpBCFlcvIHR3lqJolS3uDAt0FoilAAkQoBKJToxjMA8TYgQSAFKKprRJKP1jXrTyAs04hHsoAWOIIkgThSOC5ZtI5EksUIpsKysoZdSmEcjMwU1negxw41Cb3OgT8d0C6LzIWxtP1OYZx2Jhun7gfZg1Xr6d+bzOI6xbdvEQzqOnabplHTX1gZGZ3BspgGYf7+1+zBlQHdYC1LKGWe26fdDZYpKQBFcTrP/IwSVarWgYwjLjLOevl5qtRq1Wo1ypfKSEjQmFjCdjWqUwEzn90qEMBf+Kdcopt6j6b/Jqch5irJzX9s7j87x1YnpFtxM+7Gl38qCXhCrGrGaJLE0KpUIEYBQKFK0kCg0CjOja2XmeyyJhUVRZ8/UAa4xffSKXnfa2FwCY44qpUFbZp9F+SwYNyLFdSWq2WJ47EVq0SaE30BKBa7E9wLCsGXcDS1RWiGFhWV5pNJYANszv7TWW9b6TPt+WxAdD2wmBtn0Bzr9+0KMO/1O0Rb2rR0+32cQBMUAyE19wBCtpNxCcLc3kGaix8503vmr0nrGgbY1Wu0W21i2ScNqsnEBQpiSbCElcZwyMTlJuVRCA1GSEkYJidKUK5WOc2rfv/Zxpl7XTMK0PQGb6fPO80+12qrFB2ypCKZ9P13ZziT8M2G60E9/djNZLp3f24gmSkiwHTw7o7nKlEQlpFhZMYxh8plUmjasOUHmM0sjzFpmM7Yu/oQQyJlGrjbaVmCUhtYgteETCEDppCAVJYS04hrNeALpppR6LCLdImwpIpWY1KO2EVogLBtLC2PRa1VEfKHN4tdaY70EZZ6b6S+lCGQmFtlMD3Imi0BtS+ts43g5Ok3V6QKYR8CnH7Nzu+mxgGImVmqbRTDTr+/lMuq2MKFFMbFP+b/tWPT39yFEphQzt8Z2nGw/W7HcMhcsjo0rZFlWEU8RwiJNFVGU4Nj5hDTz85spXThdkLcWB+m8F1vbv7S2jLFM3+dMQpz/be35TFfA05Wd7fjQDGNacZ1UxySigbA0Qth4nkMziUzQTtiZ75YZ8ML4MyoT/9z0lDp7eFJ0zF4WQmfballY3ALLfD+DTwhGW1pIymUfy4GWCmklLWJVJ0Yi0EjHhjRBCAshFSKFVMXZoJ26LxNPkmixbTvgtUwJzWSOdT7c6abmluewpRVhXs3/kykDu81oy4U+9/G3NQN3ntNLvabO94VPX7jqHZ2YOl2hDmsw3ybRbSHNA225LhNC02i0cF0Xz7VohjFYNsJ2sFyPRpgQuPYWVlG+v/wvF/pOXz/377d33Z21ADMHZ+UWz7hzFp8eQ+j8Hqbdn2mu4UsZhzMpje1tq7XGTtGkOsGSEsfxsGRMkoS0kpQo7ajcExolVCb4GiHSKakQc9B8xje1tEVHnY4bJ7JZTuZug1JonZnlltmfFBKZlds0iYxvZ1ukYTagpcCSRoHoJEVrUCpFCkhTsJVAWxrHc7O9bF3Qdd7ob/pDyCyWmR7clN9vdb9TTbmtafypgahOrZzvZ8t9Z7oSANd1i+MlSVIMGCebEZMk2e4AygUgd03yc+mM+M9kWprr7xjwTL3Wme78tiyhKfvNzqdaCWi2YuJE4nkOvu8zPj5OHMf4nr3VB5Dvx7ZtpDT3MYoiAILAQ4jsuxk43NOFaVvBNzUtxpH/fqYA5/a+U2qqlbqtwGxnPKXzuFsfZ9Nm/DgBxw5QSqKiBG2BEhae5wASbcLkHQ8zb5OdmfMYM99E5dvPIX9vTjBBaAtN54PPoqBCo4VxI7a4OEDi0mrGqFTieQHSUqgkxHJs4ljhIo321gLbtkmVABS2bROGYRbYy7VrHoE1O9fapNOiWOE41pQZoVFvAbBmzRp97733snnzZoQQLFiwgJ133pkDDjhA+L4RulYrwvNchMh7Ctg0Gi183ydNFbfccouu1Wocd9xxolTyGRkZY2CgjyeeeEo/8MADvPjii9RqNRYvXsyyZctYsmSJqFareJ6H69rUag0qlVJ234zQx3GK41i0whjXdRBCkCpwXSPwzz3/Ao888oh+8sknSZKEwcFBFi9ezH777ScWLJjH+Pgkvb1VUmVmrVYzxHVdRHY9vu+yccMmfvWrX+l99tmH/fffVySJYv369TzzzDN6xYoVaK2ZO3cuRx11lJg9ezaWZZmKOWUKpEROu85m23xGT+IUN5upE62xLcmqZ5/TTz75JA8//LDpyaAFb3jDGzjwwAPF3DmzAGg0Ixr1Jn29/Ti2S5KCLdqKMAxjPM/peA7mmTz33Go2bdqkn332WdauXUu5XGbp0qXstddeYsmSRZlSML/Nrz2/z3nWYs2aF7n11lv13nvvzRFHvEWMjo7T19eLEILVq9ewefNmvXLlSkZGRvjABz4gBgYGcF0bmfW2yOVu8+Zhnn/+ef3MM88wMjJCq9Wir6+PQw89lJ133ln4vo9lCdJUFxKWJCqzULKeGFKaiS+TkdUvrGXVqlX6ySefZGxsjCAIWLBgAQceeCBLl+4qlILJWp1SqZQpdLDRtumAqyVa2KDzJhlZwK6D6y6nLFih2B71ZTpM59z2a3s7XeyzDYmxHGyEsLI4go1pGpSdJ5lJUZzTdEhM3Z40WQgB1gynHIYhjlPCssxNBsEvf/lL/aMf/Yj//M//pL+/H8/zaDQaxHGMlJJDDjlE/+Vf/iUnnHCCyCPErVaE67qEoWERlko+69Zt4Atf+ALVapV99tlH77vvvmLTpk3605/+NPlAqVQqOI5DFEXU63X6+/v1SSedxNlnny20timXS6SpJgxDms0ms2b1F4rY8xxGRsbo6+vDsizuv/8Bfdlll7FixQqSJCGKImbPns26deuwbZudd95Z77XXXlxxxWVibGyCvr4eWq2IIPAAmJio0dNTQSn4wQ9+oC+//HJOP/10dt55Z77zne/oW2+9lTVr1mBZFr29vURRxJlnnqnf+9738rGPfYwjjniLUEoVgp0LvWVNnXGiyDRJWfHACn3FFVdw77330mq1imBlb28/V1xxBf39/fqv/uqvOP3008WsgV5arRbVapWRkRFsK7MxtTmG5zk0Gi2iKKKvr4fx8UmuueYaffXVVzM6Okp/fz9JYo4rhMD3ff2Od7yDU089ld1220WAmWVz5Z2/1moNbrrpJn3ZZZdx/PHHs+eeezJnzmxqtTpXXHGFvvHGG3Fdl40bNyKlxPd9/ZGPfESEYVy4YY1Gk1tuuUXfdttt/OY3v6FUKhHHMa7rYts2l156KTvttJM+66yzOProo4VliUK521kcolCcibF8H3roIf0f//EfrFixglWrVhXPJI5jms0mvb29HHHEEfq0007jgAP2E0b5Qr3exM5CKJhpXRiB03lrrPyvvbLN1NVqRCHQbUxvsaW3UhGXR1o6V+3JFUB7G4k2gq8kwrLRSeanq8zCkMqs+yOm7XuL5qEdx+xAHKdUKiVGR8dxHIdKpcTpp39I33XXXVQqFarVKgsXLmTevHkIIVizZg2bNm3innvu4cEHH+Spp57SH//4x0WlUsH3Xer1JuVygOf1MTlZx3GcQmkMDAxw0UUX6R/+8IdYlsXExASe57HbbrsRBAHr16/HcRziOOb666/npptu0tdccw2LFi0S5XJAqeRTKvnZQE/JO6dVKhXSNOXaa6/V3/jGNyiVSkxOTjJ//nyWLl2KlJJFixbx8MMPs3r1ajZt2sS+++6vr7jiCpYvP1yY/L+Z9Xp6KgwPjxamfqvVYsOGDbzvfe/T69evx7ZtfN+nr6+PPfbYg4mJCYIgYMWKFZx++umcfPLJ+stf/rLIB6fr2liWKCyMyck61WoZgG9842J91feuplwuI6UkiiKWL19OHMds3LgR17WJ45gf/OAH3HLLLfpb3/oWpXLAC2tW84Zl+1Crt/BsY51GkVFeYRjS39/LY489oT/60Y8yOjpKvV7HdV322WcfXNfl8ccfp9VqsW7dOn7605/yb//2b3z3u9/VBx98sAgCjyRRJImxGtNUU6mUCAJT93H33Xfz9a9/jU2bhjjxxBP10NAQo6OjBEHA/vvvz9y5c1m+fHkWWDSpVsex+OY3v6mvuOIKPM9j3rx5zJs3jwMOOIAwDPmv//ovVq1ahRCCz372s1x//fX6qquuEp7nkiSKMAwplQImJ41StizJXXfdpc8555zCfenp6WHRokXMnj2biYkJNm7cyOjoKDfffDN33HEH5557rj7xxBNFqxVRLgdm5AgNWktEwbyTmfk+NcAkTLym41O1Fd9ZF7b+tspgJdNn/i2+BVJjriuTA0iUxpJWcb5TjirM7wqmt24rr7w8Z3oQXWUzZxAE+L7Lhz70Ef3cc8+htWbvvffmM5/5DPvuu6/o9IGfeOIJfdFFF/Gzn/2Mm2++maGhIf2Vr3xFeN5A5mKYB16tlpmYmCBNUzzP47TTTkMpxdDQEMuXL+eUU07hbW97mxBCZK4V3H33Pfrf//3fueeeexgfH+dd73oXP/nJT/Ruu+0m8lx9rVajr68XMFaG1pof/vCH+uqrr6ZWq7FgwQK+/OUv8+Y3v1n09PRkJriZQS655BJ9zTXXIITgjDPO4LLLLtOHHnqomJwM8X0fcDLrQbB27VoGBwe5//772bx5Mz09PZx88sl86EMfErNm9dNotJiYmGDdunX68ssv58EHH+Q73/kOQgj993//98J1bVqtiDRN6e2tAlCtlklTzWc/+1n9y1/+kiAIqNVqnH/++Rzz7neJ4ZFRZg30k6SKzZs3c9NNN+srr7yS1atX8973vpc3velNVKtVxsbGqJR9JNBshgSBRxQl9Pf3ctNNN+svfOELWJZFEAR88pOf5IwzzhCO4zA0NMScOYPU601+/vOf66997Wu4rsvf/M3fcN111+k3vvGNojMgCEZpjYyMANDf389zz63mM5/5jK7X64yPj3PuuedywgkniL6+Pnzfp9VqEcdxkVK99dbb9Le//W0WL17MwMAA3/jGN8SCBQsyxeiSpimrVq3Sl19+OT/72c9YsWIFP/3pT/Vxxx0rbFti20bpeJ5HGMbceeed+qMf/Sj9/f1MTExwwQUXcNxxxwrIZnPbZmxsjLvvvlt/73vfY8WKFVx44YX4vq+PO+5YY4kY6UzMXzbjymlms9CYvvgdFkBbOAsRwpj/bW6fmc3bn08TOV7K4pwmgyDQKjGBGJUiLRA6NX38CmNh+nkJZprhya4y12Cua2c31eWb3/y2vuWWW3jhhRf48Ic/zPXXXycOPPAAIYRhxdm2maXf8Ia9xT/90z+Jf/7nfyZNU2655RZuvvlmnSSqyJ0rpYjjtPCrms1moYlPP/10vvWtb4l3v/udwvddlDKppSRRHHbYIeJf//Vi8cUvfpFSqcTChQv59Kc/Ta1Ww3EMM6+/vxelNM1mSBiGrF69Wv/93/8969at433vex8//elPxdFHHy0GBweKGbdebyKE4NxzPy3uvfdeUa1WKZfLnHvuuQwPD9PT01O4Kfn2vu8TxzGPP/44S5cu5YorruCTn/yk6O/vp15v4jgO8+bN4YADDhBXXXWleOtb34rruvzoRz/izjvv1AC+71IqBURRQhQlKAX/7//9P33nnXfS19fHbrvsxGO/e0QcecRbhEAze6Cfem0S15IsnDeXsz7yYXHFpf/Ku95xNLaAX/3nLxBKYwvJ5Hi9EPpmM8R1bSYmavzoRz9CSkm1WuWCCy7gE584WyRJQhiGzJkzyMREDdu2efvb3y5uvPFGdt99dyqVCn/zN39Ds9ksXIH8nHt7q1QqFRYsWMDIyAhnn322fvzxx6nValx33XWccsopYsGCeZRKPkoZS6FcDorg6M9//nPSNKVer3PzzTeJefPm4XlORq0WuK7N3nvvKT7/+c+Lr371q5xzzjm8//3HijTVDA+P0mpFxLEhZD3zzDP6c5/7HL7vUyqVuPPOO8Wxxx4roighjlOCIMBxHObOnc0xxxwjrrrqKnH00UcD8KlPfYp7771fe56DLARepCCStoBmJrjsmIiFzkVqugKYjq0JtUJkS1p1WgKmf15uS0xrrJAdzcy4Gq3TbDaPtzyG7rBHtMz2u+08fBQlNBotXnxxHZdccgk77bQTJ554Iued91kxPDyaCYIR5jCMslkRZs2axXve8x7x9re/nXnz5nHppZeyfv16tNYEgYfjWGzatIlyuZwNIjPzHX300fzd3/2dKJVKRJHJmkgpcV0b25aMjU0A8K53vUtceumlvPDCCzz33HPccMMNulZrdPjHgiDwqFQqnHPOOSxYsIBDDz2Uf/qnfxJSShzHIU01+YAol4MiQ1Eq+dxwww3CzCAhl1xyiQ7DENs2qak01ZRKAc1mE601Bx10EIcccgj77befcBy7SJE5jkWzGSIENJst/vmfLxTLli2j0Wjwwx/+kDTVJInKAm9GMDds2MBFF13E8PAwURRxxRVXCIGgXC5Tr9cBqFaqpKnOYiY2Bx98sDj11FMZGBhgp512QkqJbdv09paL2ER+Xy688EK9cuVKAL71rW/xF39xlAAolwOEMFZPT08FrTWu67LrrjuL66+/Xqxfvx4hBJdccol2HIskSTIf3CaOU+I4Zs2aNSRJwtNPP00Yhnzzm99k+fLlolqtEoamVV2uOMCwKpVSrFy5Esuy+MxnPsPkZD3zwUNs20YIWL16DQCLFi3g/e9/v/jgBz8oksQcc9as/sIqCAKPyy67jBdffJF58+Zx6623iiAIigxFZ8YkSRRRFFEul7niiivE3nvvTalU4h//8R+p15tIQQwiwqxkmxZ/UreFStAm2BTCOYXzvjW0u/tMEdLODrd660oku4xsVzGWAK0ihDQr9MopnXK3ZolsG65rUyr5/PSnt2rX9Wm1Ir74xS8LgFKpguc5hGGClBae5+I4XkYLFgRBwOc+93kxd+58hoZGuPrqa7QZKJpWK2HhwvmsX7+Ryck6s2bNJkkUn/rUZ8j9yNzaSNO0UALlcjmL4goOO+wQcdZZZ6GU4jvf+Q6+72f+qs2GDZsA+OUv79Dr129keHiUiy66ROgsu2Fy1aIITiWJudaxsRphmLJw4QJOOeWDTE7Wuf/+BzLrIcX33Wygq+Jah4dH+dSnPiN8v0QUpUgp8H2XWq1FFCU0mxFB4NNsRnzpS19hcHAOd9zxG+r1Jq1WhFJQqRi//qGHHtFPPfUMvb39XHfddcyeNcjoyBASQTkoITDl3GGrQeC7JHEKWnPIwQeLvz7lFJ55+kmSOESgSGJz38IwJrfKfvKTn1Cv1znllFPYa6+9RO6v5/EWx7EYG5sohHpsrIbvl/je967F8wL+9V8v44UX1uH7LlKaZ+k4VnYPFVLa+H6J97//eI44YrlQChqNFp7nMDHRoFot02i0UAp838d1bQYH5+B5ATff/BOq1TI9PZVMYQlarYSddloMwMREA6XAtl0cJw+um/0nieLRRx/Xv/zlHSxdugfnnfcFfN9nYKCPJDHWXxyb1HaSqCKrVCr5NJsh5577OebOnc+qVc/xwAMPtSU3d32n+MAdPnQ7pCezOMAMM/SUQF0eK+jYRqhsPbzO44iO7WeGkFPzlFKDVp3RhjZ0pmi0VFOsla1Ba2i1En784x+TJAnve9/7siBRShA4mTDYWBY0GiG2bSLIjYYxv+bMGeTII49k1qxZ3HPPPYRhiuPkBTPQ29vLnDlzaDabvOtd72Lp0p1FFCmCwGFyskkYxpRKPpaVz56GXGKEL+WUU04RjuOglOL+++/XJpCnmTdvDkrBd7/7XQCWL1/O4OAglYqfmYUQhilJAv39VWwbRkcnDRnGsxACzjrrI2Lu3Lls2rSJW2+9VQMMD4/j+zZpmuK6Lr7vs8cee1CtVrFtgedZjI/XaDQiSiWfarVMqeQShgm2bbPTTjuJoaEhfN/n+eef15WKj5SQJBql4MYbb6TZbHLAAQcwODgo0jRlYGAAKSW1Wo0oivA8r6g90NqkesMw5PTTTxVz586lUikVFYi2bYhmrutw++23a8dxsG2bM888U/i+j21Lms0m1Wq5CDL29fUUAtrXV8G24aijjhJRFLFkyRJuu+02bQTQxnEEo6OTLF68mNmzZ7N27VoajQb/+I//KIaGRpHS8ALSlCxiHuJ5TpHG1Br+/M+XM2vWLB577Hd85CMf1atXr6HVSrAs8H2jXBqNiEqlRKnk4rqmcMu2baJIUan4+L7PvffeS6PRwLIsli9fLoxVlE8YXlF/4HkWvu+jFCQJ9PZWOeigA0Ru8d1yyy3YAhvT8tqkx7QGnRVLCCXQUhRMvCkmuTABQV0Uv3TO7Aq0A8otFIERdN0RS7BRGcu/LYSd+8hZggKVgrRdoiTFtkokcYQUnqkXyBSJEh3WhUgAxygA0uwMMiVUrKSjUVqRKmg0ajz77DM0m01OPPF4hAClEpJEZJrX5Ih93yVNNXEcUir5mc+qePObD+Wb37yc1aufY/PmjcyZMwfXtRkfnyRNE9PXoNHgqKOOIo7bjKwgCLBtiii9GUA6cylclIIFCxawZMkSVq1axW9/+1sOPfRg4tisVhyGIVEUoZRicnKSr33ta3rDhg3Mnj0bIQRhGBYFKblp6zgOY2NjRUps1qxZJEnCww8/zAc/+AGk7AFMmrBer+N5HrvvvjtSyswKkPT2VjIugSaKoiz+YWPbMDg4SBAEJEnC0NBQ8WwdR5AkcM8991Aul3nPe96TWSYWSWzOs6fHcO9bzTpJkuC5trGKtCZNNCOjQ7znmHdzzbVXs9+yfY3rhzHfLcvi0UcfxbbtLLo9K3PjGgRBQBjGJElCEASmx4NSOI7D0OgElmXR01PmmPe+h1/84hc8/LtHiVKF60gSDZXeKrVmgzCJ6env48wzzyRFM2uWSQ/axhSlFHjkXau1NoVurVbER886Q/zu0Uf1fffdw52/uYNTP/iYXrRoCXvutRe77rqUgw45mIULF4pYadI4xfds6hmvwnElYWLYmLfd/nN22nUXqr29fOWr/6AHBgZ47pmn8TyvyIw0Go1CaUsps4xAKcvQNBgcHOChhx7AbpvJWd5ctzug5L3rtch6aRQT7PR8e0dPu2I1HNHxp7b83TZM/JmRWw4zBRmNaKtidd1cAUx1V9pZ/9wUULiOw5NPPqkrlQoLFy7EdV2azVYWqMkruayMAWbIPzlbznVtavUaf3bg/qJcLut6vU6j0dBSShFFCeVymeHhYdI0LXLIjmNILVGksG1piBodbCtjopv9R5FRALvuuitr1qzhxRdfBMhy2WVc1+Whhx4iCAKeeOIJHnvsMSzLwvjrNo5jiD157juKIiYnJxkcHGRiYoKenp7Cr67X6zSbMUHgkCR5urCTq74lZVUIkZFksoVTO6iynSzA8fE65XIZ24bJyUl6e3tZvHgxjpMpF9fEDZLYmOy2beMH7bZpOXdi9pw5jIwOseuuu2I7kjSNsR0PrU0qcGJiguHhYZYuXUqaakOgkZUsdsGUc0rTlDRNGeg3ii5ONL29hifw7LPP4jqSOGkr6bzD0+DgIEcccQSB72TjKR9z5tVYKJAvz14um+u4/PJLxQ9/+EN9ww038MQTTzA0NMQTTz3O+FgdrxSwePFi/Rd/8RecddZZolY3408KCKMUz7XQmOe6Zs0a1q1bx6pVqxgZGWH3XXdhYmKCVquVxV0cHMchSRJqtRqVSoUgCBgZGaFcLrNmzRrDHdhSvrZNUd16JP61Rof1ULgQna/t9kyvBrVag76+PkZHRwvmmeu6BVsqN9mlFCSJIVQopToGs7mFY2NjRQ7VtiVRpIpB3Gg0sG23EPAwbAuYEKaM2LZlRh4yiKII27YL879eN3XpSaKKlJgQgiQxVsfhhx9OuVxm9uzZDA0NEQQBcRyTpinVapWJiYliZk7TlEqlwoYNG1i0aAEbNmzgf/7P/0kQGAJMzhUwQa7I0KlFu2lIzmoTQmPbRjBMm3ZjKeWDX0rzeblsLJsNGzbR19dDksQMDW1CSpllPbRho3VQVJVSrF27lvnz5xcFOWmaMnvOHDYPDZFklkw+e+csSjC+tWUJNm0aYtasWcXn5nmYiygi93FSlMYaFwLCsJltr7EtkTFQjcsRBB777L2HMOeoi6DadJpvpzIfGhqiv7+fk046SRx//PE8+uij+v7772fl44/x9FPP8cDDDxW8gssuu0x/7Wtf47jjjhNxmtJqtfDcMkrB5s2bCYKAXXbZhaOPPpr777+fffbcg3rdBAxzxZanEcPQZH1yCnccmwDk4Ycfngv+y0m15d/rtmn9B4Vq84E73IJXCsuy2GuvPUW5XNYZu03EcYzv59FiSJJ0yqA0ATwThZeWy9133617e3sZGhpil112EXmKKU95VatVRkdHqVQqxLEulIVtQxwrTEAub6aRR2adzM2weeyxx+jt7WX27NmZUjGMslYrYnBwENu2eetb38rxxx8v8kFsWSYy7fs2YZjieRZRpHBdM/BHRyfp768WFFXDeEtwnLbwe57X0dUHlGrP7ObedLLxptYV5N/lVkuj0WL27NmFFeS6LpYl2bx5E0HgUa32AoparYHjWHhekLV5k9RqE1QqPURRi3q9mRGU6liWQ5jdC62hWq2yaNEiHnjgAaIoYc6cQaLItIhPUzXNssqq/CxBGBna89DQECMjIxx44IFEcYLrtOfF3FXKszphFOO5zoyt1zqj62EYMjg4aDpTZySlZcuWiQMOOACNcZc2bN7EI488or/+9a/TaDS48MILabVa+gMf+IDo7SnTChN8z2bfffflvvvu401vehOnnnqqOOdvz6ZRayClxPO8wrozvBBvi+5OxtI07FK5BdNu6qZsOcu+hIjZ7wO5Dy86rIDtWifbR87nnj17NnPnzuXHP/6xNlxxSFOVzXQyo56mBZ8/f7itVqtI8/T39xMEAUHgMTFRo1QKaLVaBR/7Zz/7WTF7J4kx93MLIgzjKQPTdNFRDA+PMjExQRRFHHzwwVnAxgR0bNtm1113ZXh4mJyT7/t2wRrzfZtmM8a2raJByapVqzWYgB+Yuv3R0XFKpWxAh2Ex44+MjEwrPjHn1vn/dh4oT/SYuFCaRVekk7Vec2yEJfBKAW7gc92/XY8SMHvOHMI4IYwSwjihXKngegFj45PUGk00EJQrDI+MgbT45a9+jV8q09s3QCPL3Zv7pVm2bFlxzuPj40RRUqTMphYcQRwnU+6jAH77298yODjI3nvvjevYhFFMnEx1eVzXJYrbazJ2VgHmf3mxjVIKz/Oo1Wr4vp8pQR/bts3zTY3rN2fOHN72treJb37zmxx44IGkacr3v/99XEcSRqlpO1ZvMWfOHJIkYcWKFVQqFcIopVwuZUpUZIFGH9/3inoFMFbt2NhEFmzUWQ1Le6i9TJH5Q870HWb/a3x8IQSNRouDDjqIMAz5j//4D3NjpBEUrdtdcHKhzTn5YHzjPCNw0EEHdZjJplgkzcw1x3G44YYb2Lx5M319lSkCZUg2VqaxI6IowfOMn3bJJZfofBD92Z/9WWaN+BlDS3LSSSfR29vLtddeW9A3lTJZA60hCByiKC5KXXfbbSeRR4I3bx7ljjvu0IYQZL7P6ctK6SJIOJNvXzwFpaeUFk83edM0pd5o4jo2jWaL4447jkqlwooVK6jV6kRRgu+VDI/BapvrjuNQLpXNgBWSgYE+fnzzLXp0dJTRkfHCdDWK0KQ/DzzwQFGr1XBdl9tvv13nQth5bsYdaZfrhlGMJQW3/uw2vX79eizL4qijjiq2N5V0ZMHNuLgu25IFF2Wm6r3O95VKpXDd8vGQJAm2tIoYj+tI3rDPnuLjH/84AM8++yxPPrVKG6vE3I83velNWJbFU089xTPPPKNd1yqUsaFI59eWu12qeKa9vT1cffU1Ogg8gsB7GU5yMdt24g8x+2/PCnl1kNJo/NNOOy0jeMR8//vf162WEaIoiov0mOc5lEolfN/FtiWTk3X+7//9v/qee+4hCALOPvtsDMmGLMCiCm72xo0bqVQqXH755XpyspnNBlahlc1AFHieW8xiDzzwgL7xxhtJkoRTTz0VrXXGKwjxPI84TjnmmHeJTZs2sHDhfP7u7z6vN28eplRys8i/iScolWDbYFkwPj5JFJnKwxNPPF6feeaZXH/9v2sjMG2T2RQsJVNmyXxQ5cgDZkhRNGbRov2HFLiug18KiNIU23V481sOZ92G9URJzJkfPUuHSUpQDkiBkfEJ6q2YKAVhO0Qp9PT1MDQ6wch4jW9deRWz583HDUqs37SZSk8lY8qZIOnAwAAnnXQSL774Iueffz71ep0wNPntznLXXOhtWxK4DsObh7n4X75B2Q/oKVc4+I0Hima9ie/YuJZEYtZmtBCkUYxr2UiM1TCTUsxTjbm7lVtgpgAoyvL7bkb2EfiO5Oknn9ZpnHLg/vuJseEhlixcwPOrnsF3JM16k8C1eOfRbxez+npRccSnz/lbWvVmka3IrytJploy9WybU075a33++edzwQX/rKMo6RT8lxMo214M4E8Hub+8++67ixNOOIFNmzZxySWXcPvtt+vx8YmCQ99sNsnXGUxTzfj4JHfddZe+8sorsSyLt771rey//77CmHm6yB8bOq5Jefm+z9VXX83FF1+s0zSd4u/XajWUImPBhdx1193685//fJ4b5+yzzxalks/4+KTR2B2ddK+88ko2bdrEHXfcwbXXXqsnJmpZYC7NlFWQKQAK+ukJJ5yk165dS7Va5aCDDsriDylR1HY5xsbGimPM1BcAQIrONixbBrYUJiLuZKbxn+2/v/jkJz9JkiQ8++yzXHXVVXp0bBIB9PX1EPhOlsqzihk2iiKOP/54vXnzZpIkYWJigv7+/swMbrMdXdfmjDPOEMuWLaPVanHKKafonD6dn1uaqiKiD0YRXnTRRXpkZITR0VG+9KUvASYgmVf9JYkqUmR5EE0pMkU5c6OV/O+xxx7Thx9+uL7mmmv0hg0b8DyPyclJgIwdmJIkij333F0kScKll16qBwcHCcOQZcuWidx6BGM9nnfeefT397Nu3TrOOOMMPX2JsaI0OrMsyuWAiy66SN97773MmTOHJUuWmGyHuQCT88srqvKTnwnGc9NTeom9Gkxv9KBQqA7WYIrRzvkgMOYMBEGpmNVe0TEz0yzXjkII/vZv/1bss88+lMtl/vqv/5rLLrtMr169Bikl5XJAo2ECT61Wi6uuukqfc845rF27lv32248vfvGLotWKilx0mmqq1XJBTOnv72fJkiUsWLCA733ve5x88sn69ttv13mZZH9/b0HfvPzyy/VHP/pRNm7cSBRFfOlLXyI3x3t7q4VZbmZ+l3e84x3ixBNPJAxDrrrqKj772c/qRx9dqdumafs+33bbz/V73vMenacBP/+Fz+H5jkAopGWsGsexUFrhBy7SgjBqonSCtEDptAgaSUn2rExzljQx7EqhFb7rELWa6DTBc2ySJGZ0eAilUj51zt+K//Hud/Hk409w7fe/z+fOO08/9MhK3Wia9R2SNKXWCBFS8v0f/Lv+0Ic/rOuNBkkW1R+YNcs0WJVmpu/p6SkEeeedl3DssceSJAmrV6/m5JNP1j/5yU+0SaVahdWUpilPP71Kf+SMD+lbf/ZTHNfi05/5JIcedrAAaDQbWT0+2LYkTkIQpuV8kkZTU8Uiz2yo4v9KKSYmJpBSsmbNGs4//3yOPPJIff311+tSqUStVqOnp6fgidRqDb785S/rK6+8EiEEBx10EIsXLyRJ0qK/QxB4HH30X4gTTjiBMAx56qmneOc736l//vOf69xiVMq4PY5jsXHjRv2+971fX3755ZTLZQ499FBOOukEEUUJdhynKB0ihYkMWq4kTFsksRkIf2xYWFmDhQDpNFHKRgllfFyrTRB6pSiVfEZGx+np6aFarXL11VeLc889V9u2zZVXXsn//t//Wy9btozDDjsM13W59dZbiyi7lJIDDzyQb3/722LWrH6AIvhmCDAmLRTHcRGtveSSS4oyzHPPPZdLLlmoFy5cSH9/P08//TTr1q0jDEOSJGHp0qV8/etfZ7/9lgmgSM2AKX7xfT8L4sR89atfFUmS6JtuuokHH3yQ97///bzhDW/QixcvZunSpWzatInf/va3jIyMFEVE5513Hscee6xwbDOjtKIWkTbMuXw8NJsmim5beRBNFS5RnsNPEhNEc2yHVKU0m01arRa9vb1TZqK5c+YyMTlBT7WHL3zhCyIIAv2jH93Cr3/9a1auXElfX59etmwZWmuGh4e57777sCyLyclJ0jTl/PPP5+mnn+bKK6+kXq/j2MLEebNiq2bTEIHOPPMjYtGiRfoTn/gEL774It/4xjf4/ve/r5cuXcr8+fOZnJzkoYce4ne/+x0LFs6jXq9z3HHHcdppp4kgCIjiiFJQotlqFtdVKpWKfLnrmM5OtXqNSqk847jKU7nLli0TF198sf7Sl75EqVTi4osv5h/+4R/0u9/9bprNJrvsupS1a9dy2223MX/+fEqlEnvssQeXX365MH0MjBC6rltkWz72sY+JarWqL774YsbGxvja177Gt7/9bb333nszd+5cRkdHyZuaDAwM0NvbyyGHHMKFF54v8qYudimooIUgDiEOEywSUq0AK2MhgaHp5ay3V58778QWrYLIgyQya+tkjuc6PmGiSJXADVxa9ZAg8El1zgR85cijomDYdNddd634X//rq/rBBx8sGkQ8+uijNJvNoi47jmNOOeUUTjv9g2L24Gw2bTLlnsZ3N4G1vNDFcZys8i3kwgsvFM8//7z++Mc/ThRFrF+/nueffx7P8wqfdGBggGOOOYZPfOITYsmSRYVlEwRexsfWxb3TWhQ+5Pnnf1289a1v1RdffDFxHHP//ffzxBNP8Itf/KJo9OF5HgsXLuTSSy9lYGBAOLZDnBj/0/d8ktTktePUfFav1427EkeF2S+FLNpnW4CwzKrJSqVErRazsnLRJIqwpcS2bJqtJoEf0FftIYxC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" style="height:28px;width:auto;object-fit:contain" />' +
            '<div style="width:1px;height:20px;background:rgba(255,255,255,0.15)"></div>' +
            // Client logo â€” try Clearbit, fallback to Google favicon, fallback to initials
            '<div style="display:flex;align-items:center;gap:8px">' +
              '<div style="position:relative;height:28px;display:flex;align-items:center">' +
                '<img id="hdr-logo-cb" src="https://logo.clearbit.com/' + safeCompany + '.com" style="height:28px;width:auto;max-width:100px;object-fit:contain;mix-blend-mode:screen;filter:contrast(1.1)" ' +
                  'onerror="this.style.display=\'none\';document.getElementById(\'hdr-logo-goog\').style.display=\'block\'" />' +
                '<img id="hdr-logo-goog" src="https://www.google.com/s2/favicons?domain=' + safeCompany + '.com&sz=64" style="display:none;height:24px;width:24px;border-radius:4px" ' +
                  'onerror="this.style.display=\'none\';document.getElementById(\'hdr-logo-init\').style.display=\'flex\'" />' +
                '<div id="hdr-logo-init" style="display:none;width:28px;height:28px;border-radius:5px;background:#c8a84b;align-items:center;justify-content:center;font-size:12px;font-weight:900;color:#000;font-family:sans-serif">' + (co||'?')[0].toUpperCase() + '</div>' +
              '</div>' +
              '<span style="font-size:10px;color:rgba(255,255,255,0.5);font-family:monospace;letter-spacing:0.1em;text-transform:uppercase;font-weight:600">' + co.replace(/</g,'&lt;') + '</span>' +
            '</div>' +
          '</div>' +
          '<div style="text-align:center">' +
            '<div style="font-family:\'Syne\',sans-serif;font-size:18px;font-weight:800;color:rgba(255,255,255,0.9);line-height:1;letter-spacing:0.02em">ATHLETE-LED</div>' +
            '<div style="font-family:\'Syne\',sans-serif;font-size:18px;font-weight:800;color:#c8a84b;line-height:1;letter-spacing:0.02em">CREATIVE CONCEPTS</div>' +
          '</div>' +
          '<div style="font-size:10px;color:rgba(255,255,255,0.35);font-family:monospace;text-align:right;text-transform:uppercase">' + concepts2.length + ' Concepts<br>NIL Partnership</div>' +
        '</div>' +
        conceptsHtml +
        flightHtml +
      '</div>' +
      emailHtml;
  }
}

function downloadBriefPDF() {
  var briefEl = document.getElementById('brief-content');
  if (!briefEl) { toast('Generate a Creative Brief first','error'); return; }

  // Get current account name for filename
  var sel = document.getElementById('composer-account-select');
  var accountName = sel && sel.options[sel.selectedIndex] ? sel.options[sel.selectedIndex].text : 'Creative-Brief';
  var filename = accountName.replace(/[^a-zA-Z0-9]/g,'-') + '-NIL-Brief';

  // Build a print-ready HTML document
  var styles = `
    @import url('https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Mono:wght@400;500&display=swap');
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background: #111; color: #fff; }
    @page { size: A4; margin: 0; }
    @media print {
      body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      .page-break { page-break-before: always; }
      .no-print { display: none !important; }
    }
  `;

  var printHTML = '<!DOCTYPE html><html><head>' +
    '<meta charset="utf-8">' +
    '<title>' + filename + '</title>' +
    '<style>' + styles + '</style>' +
    '</head><body>' +
    briefEl.outerHTML +
    '<div style="text-align:center;padding:20px;font-size:10px;color:rgba(255,255,255,0.3);font-family:monospace;letter-spacing:0.08em">OPENDORSE Â· NIL PARTNERSHIP PROPOSAL Â· CONFIDENTIAL</div>' +
    '</body></html>';

  // Open in new window and trigger print-to-PDF
  var win = window.open('', '_blank', 'width=900,height=700');
  win.document.write(printHTML);
  win.document.close();
  win.focus();
  setTimeout(function() {
    win.print();
    toast('Print dialog opened â€” Save as PDF to download', 'success');
  }, 800);
}

function copyOutput() {
  var raw = STATE.lastComposerRaw || '';
  var area = document.getElementById('output-area');
  var textToCopy = raw || area.innerText;
  navigator.clipboard.writeText(textToCopy).then(function(){ toast('Copied to clipboard', 'success'); }).catch(function(){
    var ta = document.createElement('textarea');
    ta.value = textToCopy;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    toast('Copied', 'success');
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPOSER â€” GENERATE OUTREACH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function generateOutreach() {
  var id = document.getElementById('composer-account-select').value;
  if (!id) { toast('Select an account first', 'error'); return; }
  var account = STATE.accounts.find(function(a){ return a.id == id; });
  if (!account) return;

  var key = STATE.settings.claudeKey || document.getElementById('claude-key').value;
  if (!key) { toast('Add your Anthropic API key in Settings', 'error'); return; }

  // Get selected contacts from the Target Contacts panel
  var selectedContacts = getSelectedContacts();
  var primaryContact = selectedContacts.length > 0 ? selectedContacts[0] : null;
  var contactName = primaryContact ? primaryContact.name : '';
  var contactTitle = primaryContact ? primaryContact.title : '';

  // Sync hidden fields
  document.getElementById('contact-name').value = contactName;
  document.getElementById('contact-title').value = contactTitle;

  // Contacts are optional â€” if none selected, generate to generic decision maker
  var tab = STATE.currentComposerTab;
  var warningEl = document.getElementById('composer-generate-warning');
  if (warningEl) warningEl.style.display = 'none';

  var extraContext = document.getElementById('extra-context').value.trim();
  var signals = STATE.signals.filter(function(s){ return s.accountId == id; });
  var co = account.company;

  var outputArea = document.getElementById('output-area');
  var loadingMsgs = {
    email: 'Crafting your cold email\u2026',
    linkedin: 'Writing your LinkedIn DM\u2026',
    nil_angles: 'Building NIL activation concepts\u2026',
    talking_points: 'Prepping your call brief\u2026',
    creative_brief: 'Building your creative proposal deck\u2026'
  };
  outputArea.className = 'output-area loading';
  outputArea.innerHTML = '<div style="display:flex;flex-direction:column;align-items:center;gap:12px"><div class="spinner"></div><div style="color:var(--muted)">' + (loadingMsgs[tab]||'Generating\u2026') + '</div></div>';

  var signalStr = signals.length > 0
    ? signals.sort(function(a,b){ return (b.strength||0)-(a.strength||0); }).slice(0,3).map(function(s){ return '[' + s.type.toUpperCase() + '] ' + s.title + ' (NIL relevance: ' + (s.strength||'?') + ')'; }).join(' | ')
    : '';
  var contextLine = extraContext ? ('- Additional context: ' + extraContext + '\n') : '';

  // Detect if extra context contains a trigger signal (injected by openComposerWithSignal)
  var hasTriggerSignal = extraContext && extraContext.indexOf('TRIGGER SIGNAL') >= 0;

  // Only include signal context when it's a signal-led flow
  // For generic outreach, don't dump signals â€” let the user's Additional Context drive it
  var signalLine = hasTriggerSignal && signalStr ? ('- Recent signals: ' + signalStr + '\n') : '';

  // Build contact context block for the prompt
  var contactBlock = '';
  if (selectedContacts.length > 0) {
    contactBlock = '\nTARGET CONTACT (REAL PERSON FROM APOLLO â€” do NOT invent details):\n';
    var pc = selectedContacts[0];
    contactBlock += '- Name: ' + pc.name + '\n';
    contactBlock += '- Title: ' + pc.title + '\n';
    if (pc.email) contactBlock += '- Email: ' + pc.email + '\n';
    contactBlock += '- Relevance to Opendorse: ' + pc.why + '\n';
    if (selectedContacts.length > 1) {
      contactBlock += '\nADDITIONAL CONTACTS (generate a short variant for each after the main email):\n';
      selectedContacts.slice(1).forEach(function(c) {
        contactBlock += '- ' + c.name + ' (' + c.title + ') â€” ' + c.why + '\n';
      });
    }
  }

  // Detect if extra context contains a trigger signal (injected by openComposerWithSignal)
  var hasTriggerSignal = extraContext && extraContext.indexOf('TRIGGER SIGNAL') >= 0;

  var firstName = contactName ? contactName.split(' ')[0] : '';

  var emailPrompt = 'CRITICAL RULE: Never use dashes, hyphens, or em dashes anywhere in your output. Not in subject lines, not in the body, nowhere. Use commas or periods instead.\n\n' +

    'IDENTITY:\n' +
    'You are Ryan Wolpe. You lead Brand Partnerships at Opendorse. You sell NIL athlete-led creator programs to consumer brands. You are a senior operator, not a junior SDR. You speak peer-to-peer.\n\n' +

    'RECIPIENT:\n' +
    (contactName ? '- Name: ' + contactName + '\n' : '') +
    (contactTitle ? '- Title: ' + contactTitle + '\n' : '') +
    '- Company: ' + co + '\n' +
    '- Industry: ' + (account.vertical||'Consumer') + '\n' +
    (account.territory ? '- Territory: ' + account.territory + '\n' : '') +
    (account.notes ? '- Notes: ' + account.notes + '\n' : '') +
    contextLine +
    (hasTriggerSignal ? signalLine : '') +
    contactBlock + '\n' +

    'TASK: Write one cold outreach email.\n\n' +

    'GREETING:\n' +
    (firstName ? 'Open with: Hi ' + firstName + ',\n' : 'Open with: Hi [First Name],\n') +
    'Then a blank line before the first paragraph.\n\n' +

    (hasTriggerSignal ?
      'MODE: SIGNAL-LED (a specific trigger event was provided above)\n\n' +
      'PARAGRAPH 1 (1-2 sentences):\n' +
      'Open with a natural human reaction to the trigger news. Not "I noticed" or "Saw that you." Instead, react like a peer who follows the space:\n' +
      '"Georgia expansion is a big move."\n' +
      '"Opening across the state line is interesting timing."\n' +
      '"That collab was smart."\n' +
      '"This feels like a moment for the brand."\n' +
      'One sharp observation. Feel like a human reacting to news, not a bot parsing a headline.\n\n' +

      'PARAGRAPH 2 (1-2 sentences):\n' +
      'Quick bridge into how NIL or athlete-led creator content could amplify THAT specific moment. One clear idea, not a feature dump. Do not say "we handle athlete sourcing, content creation, and compliance." Instead say something like "a few college athletes in that market could turn this into a campus moment" or "there\'s a play here with student creators if you\'re thinking about it."\n\n'
    :
      'MODE: GENERIC OUTREACH (no specific trigger, write a warm cold email)\n\n' +
      'PARAGRAPH 1 (1-2 sentences):\n' +
      'Open with something observational about their brand. Not a compliment, not flattery. A sharp, specific thing you notice about their business, positioning, or audience. Feel like a peer who pays attention.\n\n' +

      'PARAGRAPH 2 (1-2 sentences):\n' +
      'Bridge into one clear idea about how college athlete creators could work for their brand. Be specific to their business. Do not over-explain Opendorse. One idea, not a pitch deck.\n\n'
    ) +

    'PARAGRAPH 3 (1 sentence):\n' +
    'Light CTA. Not pushy. No "schedule 30 minutes." No "I\'d love to connect."\n' +
    'Good CTAs: "Worth a quick chat?" / "Open to comparing notes?" / "Curious if you\'re thinking about campus at all?" / "Happy to share a quick idea if helpful."\n\n' +

    'SIGN OFF:\n' +
    'Ryan\n\n' +

    'SUBJECT LINES:\n' +
    'Provide exactly 5 subject line options. They must be:\n' +
    '- Short (2-5 words)\n' +
    '- Specific to this brand or trigger\n' +
    '- Slightly intriguing\n' +
    '- Lowercase\n' +
    '- No emoji, no ALL CAPS, no gimmicks\n' +
    '- Never generic like "partnership opportunity" or "college athletes for your launch"\n' +
    'Good examples: "georgia x campus" / "across the state line" / "new market moment" / "lean into the cult following?" / "expansion timing"\n\n' +

    'WRITING STYLE RULES (STRICT):\n' +
    '- 130 words max for the email body\n' +
    '- Max 3 short paragraphs\n' +
    '- Use contractions (don\'t, we\'re, there\'s)\n' +
    '- Vary sentence length. Mix short punchy sentences with slightly longer ones.\n' +
    '- No buzzwords: leverage, maximize, activation, unlock, innovative, cutting-edge, comprehensive, holistic, seamless, turnkey, synergy\n' +
    '- No corporate filler\n' +
    '- No exclamation points\n' +
    '- No dashes or hyphens of any kind\n' +
    '- No pitch deck tone\n' +
    '- Sound like a thoughtful peer reaching out with a sharp angle, not a sales bot\n' +
    '- Never invent contact info, emails, or LinkedIn URLs\n\n' +

    (selectedContacts.length > 1 ?
      'MULTIPLE CONTACTS:\n' +
      'Write the primary email to the most relevant contact. Then for each additional contact, provide a 1 sentence suggestion for how to adjust the email for their role. Do NOT rewrite the whole email.\n\n' : '') +

    'OUTPUT FORMAT (return ONLY this JSON, no other text):\n' +
    (selectedContacts.length > 1
      ? '{"subjects":["subject1","subject2","subject3","subject4","subject5"],"body":"the full email body including greeting and sign off","variants":[{"name":"Contact Name","tweak":"1 sentence on how to adjust for their role"}]}'
      : '{"subjects":["subject1","subject2","subject3","subject4","subject5"],"body":"the full email body including greeting and sign off"}');

  var linkedinPrompt = 'CRITICAL RULE: Never use dashes, hyphens, or em dashes anywhere in your response.\n\n' +
    'You are Ryan Wolpe, Brand Partnerships at Opendorse. Write a LinkedIn DM to ' + (contactName||'a marketing leader') + ' at ' + co + '.\n\n' +
    'CONTEXT:\n- Industry: ' + (account.vertical||'Consumer') + '\n' + (hasTriggerSignal ? signalLine : '') + contextLine + '\n' +
    'RULES:\n' +
    '- 280 characters MAX hard limit\n' +
    '- Sound like a human, not a template\n' +
    '- No emojis, no exclamation points, no dashes\n' +
    '- Peer-level tone. Confident but not salesy.\n' +
    '- Reference something specific about their brand or a recent trigger\n' +
    '- End with one curious, low-pressure question\n' +
    '- Never say "I came across" or "wanted to reach out" or "I noticed"\n' +
    '- Use contractions. Be warm.\n\n' +
    'Output only the DM text, nothing else.';

  var nilPrompt = 'CRITICAL RULE: Never use dashes, hyphens, or em dashes anywhere in your response.\n\nYou are a creative strategist at Opendorse. Generate 4 specific athlete activation concepts for ' + co + '.\n\n' +
    'BRAND CONTEXT:\n- Industry: ' + account.vertical + '\n- Territory: ' + (account.territory||'National') + '\n- Notes: ' + (account.notes||'None') + '\n' +
    signalLine + contextLine + '\n' +
    'These must feel built specifically for ' + co + ', not templates. Think like a creative director. No dashes or hyphens of any kind in the output.\n\n' +
    'Return ONLY valid JSON:\n' +
    '{"concepts":[{"name":"evocative 4-6 word name","athlete":"specific type and sport","platform":"specific platform and format","angle":"2 sentences â€” concrete, vivid, makes you want to say yes","why":"1 sentence tied to their situation right now"}]}';

  var callPrompt = 'CRITICAL RULE: Never use dashes, hyphens, or em dashes anywhere in your response.\n\nYou are helping Ryan Wolpe prep for a sales call with ' + (contactName||'a decision maker') + ' at ' + co + '. Opendorse connects brands with college athletes.\n\n' +
    'CONTEXT:\n- Industry: ' + account.vertical + '\n- Status: ' + account.status + '\n- Notes: ' + (account.notes||'None') + '\n' +
    signalLine + contextLine + '\n' +
    'APPROACH: Earn permission, surface their problem, position the meeting as delivering value. No dashes or hyphens of any kind in the output.\n\n' +
    'Provide all 6 sections with the exact headers:\n' +
    'PERMISSION OPENER\nREVERSE PITCH\nDISCOVERY QUESTIONS\nKEY TALKING POINTS\nOBJECTION RESPONSES\nVALUE CLOSE';

  var briefPrompt = 'CRITICAL RULE: Never use dashes, hyphens, or em dashes anywhere in your response.\n\nYou are a creative strategist at Opendorse building a full NIL campaign proposal for ' + co + '.\n\n' +
    'BRAND CONTEXT:\n- Industry: ' + account.vertical + '\n- Territory: ' + (account.territory||'National') + '\n- Notes: ' + (account.notes||'None') + '\n' +
    signalLine + contextLine + '\n' +
    'Generate 3 athlete activation concepts, a 6-week flight model, and a cold outreach email. Make each concept feel specifically built for ' + co + '.\n\n' +
    'Return ONLY valid JSON in exactly this structure:\n' +
    '{\n' +
    '  "concepts": [\n' +
    '    {\n' +
    '      "name": "short punchy concept name e.g. The Post-PR Pool Deck",\n' +
    '      "sport": "e.g. Women\'s Swimming",\n' +
    '      "platform": "e.g. Instagram",\n' +
    '      "post_type": "e.g. Feed Post",\n' +
    '      "athlete_name": "realistic fake first+last name for the sport",\n' +
    '      "athlete_handle": "@realistic_handle e.g. @sofia_r_swim",\n' +
    '      "athlete_school": "Real University Â· City e.g. Stanford Aquatics Â· Palo Alto",\n' +
    '      "brand_handle": "real brand @handle e.g. @cheekies",\n' +
    '      "followers": "e.g. 38K",\n' +
    '      "eng_rate": "e.g. 9.2%",\n' +
    '      "promo_code": "e.g. SOFIA15",\n' +
    '      "description": "2-sentence story written as if post already happened, specific to ' + co + '",\n' +
    '      "post_caption": "athlete caption with @brandhandle, promo code, 2-3 hashtags",\n' +
    '      "post_image_text": "bold italic overlay text shown in the post image e.g. Meet your new off-season ritual",\n' +
    '      "insight1_label": "2-3 word insight title e.g. Perfect Fit",\n' +
    '      "insight1_body": "1-2 sentence why this athlete and brand are a natural match",\n' +
    '      "insight2_label": "2-3 word insight title e.g. Women\'s Sports Moment",\n' +
    '      "insight2_body": "1-2 sentence cultural or strategic reason why now",\n' +
    '      "frames": [\n' +
    '        {"label":"HOOK FRAME","time":"0:00-0:02","tag":"MAX PATTERN INTERRUPT","desc":"exact moment"},\n' +
    '        {"label":"REVEAL FRAME","time":"0:02-0:08","tag":"BRAND INTEGRATION","desc":"how brand appears"},\n' +
    '        {"label":"END CARD","time":"0:10-0:15","tag":"INSTALL CTA","desc":"specific CTA copy"}\n' +
    '      ]\n' +
    '    }\n' +
    '  ],\n' +
    '  "flight": [\n' +
    '    {"label":"CONCEPT 01","sub":"Sport Â· Platform","cells":["LAUNCH","PUSH","TEST",null,null,null]},\n' +
    '    {"label":"CONCEPT 02","sub":"Sport Â· Platform","cells":[null,"LAUNCH","PEAK","PEAK","TAPER",null]},\n' +
    '    {"label":"CONCEPT 03","sub":"Sport Â· Platform","cells":[null,null,null,"LAUNCH","WINBACK","CLOSE"]}\n' +
    '  ],\n' +
    '  "email": {\n' +
    '    "to": "vp.marketing@' + (co.toLowerCase().replace(/[^a-z0-9]/g,'')) + '.com",\n' +
    '    "subject": "compelling specific subject line for ' + co + '",\n' +
    '    "body": "Write a 150-word cold email. Plain paragraphs only. After the opening hook, list each concept on its own line using EXACTLY this format: [EMOJI] Concept 0X \"[NAME]\" Â· [Platform]. Then one sentence description. Sport emojis: basketball=ğŸ€ soccer=âš½ swimming=ğŸŠ track=ğŸƒ gymnastics=ğŸ¤¸ football=ğŸˆ volleyball=ğŸ other=ğŸ¯. No dashes, no hyphens, no exclamation points."\n' +
    '  }\n' +
    '}';

  var prompts = {
    email: emailPrompt,
    linkedin: linkedinPrompt,
    nil_angles: nilPrompt,
    talking_points: callPrompt,
    creative_brief: briefPrompt
  };

  var maxTokens = tab === 'creative_brief' ? 4096 : (tab === 'nil_angles' ? 1500 : 1000);

  try {
    var abortCtrl = new AbortController();
    var fetchTimeout = setTimeout(function(){ abortCtrl.abort(); }, tab === 'creative_brief' ? 120000 : 45000);
    var response = await fetch('https://api.anthropic.com/v1/messages', {
      signal: abortCtrl.signal,
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': key,
        'anthropic-version': '2023-06-01',
        'anthropic-dangerous-direct-browser-access': 'true'
      },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: maxTokens,
        messages: [{role:'user', content: prompts[tab] || prompts.email}]
      })
    });
    clearTimeout(fetchTimeout);
    var data = await response.json();
    if (data.error) throw new Error(data.error.message);
    var text2 = (data.content && data.content[0] && data.content[0].text) || 'No response generated';
    outputArea.className = 'output-area';
    renderComposerOutput(tab, text2, account, contactName);
    STATE.composerHistory = [{role:'user', content: prompts[tab]}, {role:'assistant', content: text2}];
    STATE.lastComposerRaw = text2;
    STATE.lastComposerTab = tab;
    // Snapshot contact + context at time of generate so log always reflects who it was for
    STATE.lastComposerContact = {
      name: (document.getElementById('contact-name')||{}).value || '',
      title: (document.getElementById('contact-title')||{}).value || '',
      context: (document.getElementById('composer-context')||{}).value || '',
      accountId: (document.getElementById('composer-account-select')||{}).value || '',
      accountName: (function(){ var s=document.getElementById('composer-account-select'); return s&&s.options[s.selectedIndex]?s.options[s.selectedIndex].text:''; })()
    };
    document.getElementById('feedback-section').style.display = 'block';
    // Inject log bar into output area for non-brief tabs
    if (tab !== 'creative_brief') {
      var logBarId = 'compose-log-bar-' + Date.now();
      var acctSel = document.getElementById('composer-account-select');
      var acctIdLog = acctSel ? acctSel.value : '';
      var acctNameLog = acctSel && acctSel.options[acctSel.selectedIndex] ? acctSel.options[acctSel.selectedIndex].text : '';
      if (acctIdLog) {
        window._composeLogAcctId = acctIdLog;
        window._composeLogAcctName = acctNameLog;
        var logBar = document.createElement('div');
        logBar.innerHTML = buildComposeLogBar();
        outputArea.appendChild(logBar);
      }
    }
    document.getElementById('feedback-input').value = '';
  } catch(err) {
    outputArea.className = 'output-area';
    outputArea.innerHTML = '<div style="padding:20px"><div style="color:var(--red)">Error: ' + err.message.replace(/</g,'&lt;') + '</div><div style="color:var(--muted);font-size:12px;margin-top:8px">Check your Anthropic API key in Settings.</div></div>';
  }
}

function switchTab(tab, el) {
  STATE.currentComposerTab = tab;
  STATE.composerHistory = [];
  STATE.lastComposerRaw = '';
  document.querySelectorAll('.output-tab').forEach(function(t){ t.classList.remove('active'); });
  if (el) el.classList.add('active');
  document.getElementById('feedback-section').style.display = 'none';
  var accountId = document.getElementById('composer-account-select').value;
  if (accountId) {
    generateOutreach();
  } else {
    var area = document.getElementById('output-area');
    area.className = 'output-area';
    area.innerHTML = '<div class="output-placeholder"><div style="font-size:36px;margin-bottom:12px">&#10022;</div><div style="font-weight:600;color:var(--text2);margin-bottom:6px">Select an account to generate</div></div>';
  }
}

function regenerateOutput() { generateOutreach(); }

function applyFeedbackChip(el) {
  var input = document.getElementById('feedback-input');
  input.value = el.getAttribute('data-val');
  input.focus();
}

async function refineWithFeedback() {
  var feedback = document.getElementById('feedback-input').value.trim();
  if (!feedback) { toast('Enter some feedback first', 'error'); return; }
  if (!STATE.composerHistory || !STATE.composerHistory.length) { toast('Generate outreach first', 'error'); return; }
  var key = STATE.settings.claudeKey || document.getElementById('claude-key').value;
  if (!key) { toast('Add your API key in Settings', 'error'); return; }
  var tab = STATE.lastComposerTab || STATE.currentComposerTab;
  var outputArea = document.getElementById('output-area');
  outputArea.className = 'output-area loading';
  outputArea.innerHTML = '<div style="display:flex;flex-direction:column;align-items:center;gap:12px"><div class="spinner"></div><div style="color:var(--muted)">Refining\u2026</div></div>';
  try {
    var messages = STATE.composerHistory.concat([{role:'user', content:'Please revise the above based on this feedback: ' + feedback + '. Important: never use dashes, hyphens, or em dashes anywhere in your response.'}]);
    var abortCtrl = new AbortController();
    var fetchTimeout = setTimeout(function(){ abortCtrl.abort(); }, tab === 'creative_brief' ? 120000 : 45000);
    var response = await fetch('https://api.anthropic.com/v1/messages', {
      signal: abortCtrl.signal, method: 'POST',
      headers: {'Content-Type':'application/json','x-api-key':key,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
      body: JSON.stringify({model:'claude-sonnet-4-20250514', max_tokens:2000, messages: messages})
    });
    clearTimeout(fetchTimeout);
    var data = await response.json();
    if (data.error) throw new Error(data.error.message);
    var text3 = (data.content && data.content[0] && data.content[0].text) || '';
    var account = STATE.accounts.find(function(a){ return a.id == document.getElementById('composer-account-select').value; });
    var cName = document.getElementById('contact-name').value.trim();
    renderComposerOutput(tab, text3, account, cName);
    STATE.composerHistory.push({role:'user', content:'Please revise the above based on this feedback: ' + feedback});
    STATE.composerHistory.push({role:'assistant', content: text3});
    STATE.lastComposerRaw = text3; STATE.lastComposerTab = tab;
    STATE.lastComposerContact = STATE.lastComposerContact || {};
    document.getElementById('feedback-input').value = '';
    toast('Refined!', 'success');
  } catch(err) {
    outputArea.className = 'output-area';
    outputArea.innerHTML = '<div style="padding:20px;color:var(--red)">Error: ' + err.message.replace(/</g,'&lt;') + '</div>';
  }
}

function saveToAccount() {
  var id = document.getElementById('composer-account-select').value;
  if (!id) { toast('Select an account first', 'error'); return; }
  var raw = STATE.lastComposerRaw;
  if (!raw) { toast('Generate outreach first', 'error'); return; }
  var account = STATE.accounts.find(function(a){ return a.id == id; });
  if (!account) return;
  if (!account.savedOutreach) account.savedOutreach = [];
  account.savedOutreach.push({tab: STATE.lastComposerTab||STATE.currentComposerTab, text: raw, date: new Date().toISOString()});
  saveState();
  toast('Saved to ' + account.company, 'success');
}


async function scoreBrand() {
  const brand = document.getElementById('discovery-brand').value.trim();
  const context = document.getElementById('discovery-context').value.trim();
  if (!brand) { toast('Enter a brand name','error'); return; }
  if (isOffLimits(brand)) {
    toast(`â›” ${brand} is assigned to another rep â€” off limits`, 'error', 4000);
    return;
  }
  const key = STATE.settings.claudeKey || document.getElementById('claude-key').value;
  if (!key) { toast('Add your Anthropic API key in Settings','error'); return; }

  const results = document.getElementById('discovery-results');
  results.innerHTML='<div style="text-align:center;padding:40px"><div class="spinner" style="margin:0 auto 12px"></div><div style="color:var(--muted)">Scoring NIL fit + drafting activation email...</div></div>';

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':key,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
      body:JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:1200,
        messages:[{role:'user',content:`You are a NIL strategist at Opendorse, which connects brands with college athletes for NIL partnerships and Gen Z marketing.

Score this brand for NIL fit AND draft a cold outreach email pitching the activation idea:
Brand: ${brand}
${context?`Context: ${context}`:''}

Return ONLY valid JSON, no other text:
{
  "nil_score": [number 1-99],
  "vertical": "[single category]",
  "why_good_fit": "[2 crisp sentences specific to this brand]",
  "athlete_sports": ["sport1","sport2","sport3"],
  "activation_idea": "[one concrete specific activation idea, 2 sentences]",
  "risk": "[one real concern or null]",
  "recommend": true/false,
  "priority": "hot|high|medium|low",
  "suggested_contacts": [
    {"name":"[realistic name]","title":"[VP/Dir Marketing or similar]","why":"[1 sentence why they're the right contact]"},
    {"name":"[realistic name]","title":"[CMO or Brand Partnerships lead]","why":"[1 sentence why they're the right contact]"},
    {"name":"[realistic name]","title":"[Head of Social or Influencer Marketing]","why":"[1 sentence why they're the right contact]"}
  ],
  "cold_email": {
    "to_title": "VP of Marketing",
    "subject": "[compelling lowercase subject line specific to ${brand} and the activation]",
    "body": "[150 word cold email pitching the activation idea. Open with something specific about ${brand}. Reference the activation idea concretely. End with a soft CTA. No dashes, no hyphens, no exclamation points.]"
  }
}`}]
      })
    });
    const data = await response.json();
    const text = data.content?.[0]?.text||'{}';
    const jsonStart = text.indexOf('{'); const jsonEnd = text.lastIndexOf('}');
    const result = JSON.parse(jsonStart>=0 ? text.slice(jsonStart,jsonEnd+1) : text);

    const color = result.nil_score>=75?'var(--green)':result.nil_score>=50?'var(--gold)':'var(--accent2)';
    const safeId = brand.replace(/[^a-zA-Z0-9]/g,'_');

    // Contacts tab will be populated after render via Apollo
    const contactsHtml = `<div id="apollo-contacts-${safeId}">
      <div style="text-align:center;padding:20px">
        <div class="spinner" style="margin:0 auto 8px"></div>
        <div style="font-size:12px;color:var(--muted)">Sourcing real contacts via Apollo...</div>
      </div>
    </div>`;

    // Build email preview HTML
    const email = result.cold_email || {};
    const emailHtml = email.subject ? `
      <div id="disc-email-${safeId}" style="margin-top:4px">
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:var(--radius2);overflow:hidden">
          <div style="background:var(--surface);border-bottom:1px solid var(--border);padding:8px 16px;display:flex;align-items:center">
            <div style="display:flex;gap:5px"><div style="width:10px;height:10px;border-radius:50%;background:#ea4335"></div><div style="width:10px;height:10px;border-radius:50%;background:#fbbc04"></div><div style="width:10px;height:10px;border-radius:50%;background:#34a853"></div></div>
            <div style="flex:1;text-align:center;font-size:10px;color:var(--muted);letter-spacing:0.08em;text-transform:uppercase">Draft â€” Outlook</div>
          </div>
          <div style="padding:0 16px;border-bottom:1px solid var(--border)">
            <div style="display:flex;padding:7px 0;border-bottom:1px solid var(--border2)"><span style="font-size:11px;color:var(--muted);min-width:44px;font-weight:600">To:</span><span data-to-field style="font-size:12px;color:var(--accent)">${email.to_title||'VP Marketing'} @ ${brand}</span></div>
            <div style="display:flex;padding:7px 0;border-bottom:1px solid var(--border2)"><span style="font-size:11px;color:var(--muted);min-width:44px;font-weight:600">From:</span><span style="font-size:12px;color:var(--text1)">ryan.wolpe@opendorse.com</span></div>
            <div style="display:flex;padding:7px 0"><span style="font-size:11px;color:var(--muted);min-width:44px;font-weight:600">Subj:</span><span style="font-size:12px;color:var(--text1);font-weight:700">${email.subject||''}</span></div>
          </div>
          <div style="padding:14px 16px">
            <div id="disc-email-body-${safeId}" style="font-size:12.5px;color:var(--text1);line-height:1.7;white-space:pre-wrap;font-family:Aptos,Calibri,sans-serif">${email.body||''}</div>
            <div style="margin-top:12px;padding-top:10px;border-top:1px solid var(--border);font-size:11px;color:var(--muted2);font-family:Aptos,Calibri,sans-serif">
              Ryan Wolpe Â· Senior Director, Brand Partnerships Â· ryan.wolpe@opendorse.com
            </div>
          </div>
        </div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button onclick="copyDiscoveryEmail('${safeId}')" style="background:#0078d4;color:#fff;border:none;border-radius:4px;padding:9px 18px;font-size:11px;font-weight:700;cursor:pointer">COPY FOR OUTLOOK â†’</button>
          <button onclick="editDiscoveryEmail('${safeId}')" style="background:transparent;border:1px solid var(--border);color:var(--text1);border-radius:4px;padding:9px 18px;font-size:11px;font-weight:600;cursor:pointer">âœï¸ EDIT</button>
          <button onclick="addDiscoveredBrand('${brand}','${result.vertical||'Other'}','${result.priority||'medium'}',${result.nil_score})" style="background:var(--surface2);border:1px solid var(--border);color:var(--text1);border-radius:4px;padding:9px 18px;font-size:11px;font-weight:600;cursor:pointer">+ Add to Pipeline</button>
        </div>
      </div>` : '';

    results.innerHTML=`
      <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius2);overflow:hidden">
        <!-- Score Header -->
        <div style="padding:18px 20px;border-bottom:1px solid var(--border);display:flex;align-items:flex-start;justify-content:space-between">
          <div>
            <div style="font-family:'Syne',sans-serif;font-size:22px;font-weight:800">${brand}</div>
            <div style="font-size:12px;color:var(--muted2);margin-top:2px">${result.vertical||'Unknown'}</div>
            <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap">
              ${(result.athlete_sports||[]).map(s=>`<span class="badge badge-accent">${s}</span>`).join('')}
            </div>
          </div>
          <div style="text-align:center">
            <div style="font-family:'Syne',sans-serif;font-size:52px;font-weight:800;color:${color};line-height:1">${result.nil_score}</div>
            <div style="font-size:10px;color:var(--muted);letter-spacing:0.08em">NIL FIT</div>
            <span class="badge ${result.recommend?'badge-green':'badge-muted'}" style="margin-top:4px">${result.recommend?'âœ“ Recommended':'Not Recommended'}</span>
          </div>
        </div>

        <!-- Tabs -->
        <div style="display:flex;border-bottom:1px solid var(--border)">
          <button onclick="showDiscTab('${safeId}','fit')" id="dtab-fit-${safeId}" style="flex:1;padding:10px;font-size:11px;font-weight:700;background:var(--accent);color:#000;border:none;cursor:pointer;letter-spacing:0.05em;text-transform:uppercase">ğŸ’¡ Fit Analysis</button>
          <button onclick="showDiscTab('${safeId}','contacts')" id="dtab-contacts-${safeId}" style="flex:1;padding:10px;font-size:11px;font-weight:700;background:var(--surface2);color:var(--text2);border:none;border-left:1px solid var(--border);cursor:pointer;letter-spacing:0.05em;text-transform:uppercase">ğŸ‘¤ Contacts</button>
          <button onclick="showDiscTab('${safeId}','email')" id="dtab-email-${safeId}" style="flex:1;padding:10px;font-size:11px;font-weight:700;background:var(--surface2);color:var(--text2);border:none;border-left:1px solid var(--border);cursor:pointer;letter-spacing:0.05em;text-transform:uppercase">âœ‰ï¸ Draft Email</button>
        </div>

        <!-- Fit Tab -->
        <div id="disc-tab-fit-${safeId}" style="padding:16px 20px">
          <div style="margin-bottom:14px">
            <div style="font-size:10px;font-weight:700;color:var(--muted2);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:5px">Why It Fits</div>
            <div style="font-size:13px;line-height:1.6;color:var(--text1)">${result.why_good_fit||'â€”'}</div>
          </div>
          <div style="background:rgba(0,212,170,0.05);border:1px solid rgba(0,212,170,0.2);border-radius:var(--radius);padding:12px;margin-bottom:14px">
            <div style="font-size:10px;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:5px">ğŸ¯ Activation Idea</div>
            <div style="font-size:13px;line-height:1.6;color:var(--text1)">${result.activation_idea||'â€”'}</div>
          </div>
          ${result.risk?`<div style="font-size:12px;color:var(--red);background:rgba(231,76,60,0.08);border:1px solid rgba(231,76,60,0.2);border-radius:var(--radius);padding:10px">âš ï¸ ${result.risk}</div>`:''}
        </div>

        <!-- Contacts Tab (hidden by default) -->
        <div id="disc-tab-contacts-${safeId}" style="padding:16px 20px;display:none">
          ${contactsHtml || '<div style="color:var(--muted);font-size:12px">No contacts generated</div>'}
        </div>

        <!-- Email Tab (hidden by default) -->
        <div id="disc-tab-email-${safeId}" style="padding:16px 20px;display:none">
          <div style="font-size:10px;font-weight:700;color:var(--muted2);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:10px">Activation Pitch â€” Ready to Send</div>
          ${emailHtml}
        </div>
      </div>`;

    // Store for routing
    window._discoveryData = window._discoveryData || {};
    window._discoveryData[safeId] = { brand, result };
    STATE.discoveryResults.push({brand, ...result});

    // Fire Apollo contact lookup after render
    fetchDiscoveryContacts(brand, safeId, result);

  } catch(e) {
    results.innerHTML=`<div style="color:var(--red);padding:20px">Error scoring brand: ${e.message}</div>`;
  }
}

// â”€â”€ APOLLO SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APOLLO CONTACT SEARCH â€” PROXY WITH SERVER-SIDE CASCADE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function apolloSearchPeople(domain, key) {
  const titles = [
    'Marketing','CMO','VP Marketing','SVP Marketing',
    'Head of Marketing','Director of Marketing','Brand Marketing','Growth Marketing',
    'VP Brand','Marketing Manager',
    'CEO','President','COO','Founder','Managing Director',
    'Social Media','Digital Marketing','Head of Social','Director of Content',
    'Partnerships','Sponsorship','Business Development','Brand Partnerships',
    'Head of Partnerships','Director of Partnerships','VP Partnerships',
    'Influencer','Creator','Ambassador','Athlete Marketing',
    'Influencer Marketing','Head of Influencer','Creator Partnerships',
    'Sports Marketing'
  ];

  const proxyUrl = STATE.settings.apolloProxyUrl || 'https://od-apollo-proxy.vercel.app/apollo';

  // The new v2 proxy handles the full cascade server-side (Aâ†’Bâ†’Câ†’D)
  // Just send domain + key + titles and it does all the work
  try {
    const r = await fetch(proxyUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ domain, key, titles, debug: true })
    });
    const d = await r.json();
    console.log('[Apollo] Proxy response:', {
      ok: d.ok,
      domain: d.domain,
      attempt: d.attempt_used,
      reason: d.attempt_reason,
      count: (d.people || []).length,
      total: d.total
    });

    if (d.debug) {
      console.log('[Apollo] Debug info:', JSON.stringify(d.debug, null, 2));
    }

    const people = (d.people || d.contacts || []).map(normalizePerson).filter(Boolean);

    if (people.length > 0) {
      return people;
    }

    // If new proxy format returned ok:false or 0 people, throw with details
    throw new Error(
      d.error || d.attempt_reason ||
      `Apollo returned 0 contacts for ${domain}. Attempt: ${d.attempt_used || 'unknown'}. ${d.debug ? 'Check console for debug info.' : ''}`
    );
  } catch (e) {
    // If it's a network error (not a parsed response error), rethrow
    throw new Error(e.message);
  }
}

// â”€â”€ NORMALIZE PERSON OBJECT â”€â”€
function normalizePerson(p) {
  if (!p) return null;
  return {
    id: p.id || p.apollo_id || null,
    first_name: p.first_name || '',
    last_name: p.last_name || '',
    name: p.name || ((p.first_name || '') + ' ' + (p.last_name || '')).trim(),
    title: p.title || p.headline || '',
    email: p.email || null,
    email_status: p.email_status || null,
    linkedin_url: p.linkedin_url || null,
    photo_url: p.photo_url || null,
    organization_name: p.organization_name || p.organization?.name || '',
    city: p.city || '',
    state: p.state || '',
    country: p.country || '',
    departments: p.departments || [],
    seniority: p.seniority || '',
    phone_numbers: p.phone_numbers || []
  };
}


// â”€â”€ APOLLO DIAGNOSTIC â”€â”€
async function runApolloDiagnostic() {
  const domain = document.getElementById('apollo-test-domain').value.trim();
  if (!domain) { toast('Enter a domain to test', 'error'); return; }
  const key = STATE.settings.apolloKey;
  if (!key) { toast('Add your Apollo API key first', 'error'); return; }
  const out = document.getElementById('apollo-diagnostic-output');
  out.style.display = 'block';
  out.textContent = 'ğŸ” Running Apollo diagnostic for ' + domain + '...\n\n';

  const log = (msg) => { out.textContent += msg + '\n'; out.scrollTop = out.scrollHeight; };

  // Test 1: Direct API with titles
  log('â”â”â” Strategy 1: Direct API + Title Filter â”â”â”');
  try {
    const body = { api_key: key, q_organization_domains: domain, person_titles: ['Marketing','VP Marketing','Head of Marketing','CEO'], page: 1, per_page: 5 };
    log('POST https://api.apollo.io/v1/mixed_people/search');
    log('Body: { q_organization_domains: "' + domain + '", person_titles: [...4 titles], per_page: 5 }');
    const r = await fetch('https://api.apollo.io/v1/mixed_people/search', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
    const d = await r.json();
    log('HTTP Status: ' + r.status);
    log('Response keys: ' + Object.keys(d).join(', '));
    log('Total entries: ' + (d.pagination?.total_entries ?? 'n/a'));
    const people = d.people || d.contacts || [];
    log('People count: ' + people.length);
    if (people.length > 0) {
      people.slice(0, 3).forEach((p, i) => log('  [' + i + '] ' + (p.first_name||'') + ' ' + (p.last_name||'') + ' â€” ' + (p.title||'no title')));
    }
    if (d.error || d.message) log('ERROR: ' + (d.error || d.message));
  } catch (e) { log('FAILED: ' + e.message); }

  log('');

  // Test 2: Direct API without titles
  log('â”â”â” Strategy 2: Direct API, No Titles â”â”â”');
  try {
    const body = { api_key: key, q_organization_domains: domain, page: 1, per_page: 5 };
    const r = await fetch('https://api.apollo.io/v1/mixed_people/search', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
    const d = await r.json();
    log('HTTP Status: ' + r.status);
    log('Total entries: ' + (d.pagination?.total_entries ?? 'n/a'));
    const people = d.people || d.contacts || [];
    log('People count: ' + people.length);
    if (people.length > 0) {
      people.slice(0, 3).forEach((p, i) => log('  [' + i + '] ' + (p.first_name||'') + ' ' + (p.last_name||'') + ' â€” ' + (p.title||'no title')));
    }
    if (d.error || d.message) log('ERROR: ' + (d.error || d.message));
  } catch (e) { log('FAILED: ' + e.message); }

  log('');

  // Test 3: Vercel proxy
  log('â”â”â” Strategy 3: Vercel Proxy (with debug + titles) â”â”â”');
  try {
    const proxyUrl = STATE.settings.apolloProxyUrl || 'https://od-apollo-proxy.vercel.app/apollo';
    const testTitles = ['Marketing','VP Marketing','Head of Marketing','CEO','Partnerships','Influencer'];
    log('POST ' + proxyUrl);
    log('Body: { domain, key, titles: [' + testTitles.length + '], debug: true }');
    const r = await fetch(proxyUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ domain, key, titles: testTitles, debug: true }) });
    const d = await r.json();
    log('HTTP Status: ' + r.status);
    log('Response keys: ' + Object.keys(d).join(', '));
    log('ok: ' + d.ok + ' | attempt_used: ' + d.attempt_used + ' | attempt_reason: ' + d.attempt_reason);
    log('People count: ' + (d.people || []).length + ' | Total: ' + d.total);
    if (d.people && d.people.length > 0) {
      d.people.slice(0, 5).forEach((p, i) => log('  [' + i + '] ' + (p.first_name||'') + ' ' + (p.last_name||'') + ' â€” ' + (p.title||'no title') + (p.email ? ' (' + p.email + ')' : '')));
    }
    if (d.debug) {
      log('');
      log('â”€â”€ Per-Attempt Debug â”€â”€');
      Object.keys(d.debug).forEach(k => {
        log('  ' + k + ': ' + JSON.stringify(d.debug[k]));
      });
    }
    if (d.error) log('ERROR: ' + d.error);
  } catch (e) { log('FAILED: ' + e.message); }

  log('');

  // Test 4: Org search
  log('â”â”â” Strategy 5: Org Search â†’ People â”â”â”');
  try {
    const orgBody = { api_key: key, q_organization_domains: domain, page: 1, per_page: 1 };
    const orgR = await fetch('https://api.apollo.io/v1/mixed_companies/search', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(orgBody) });
    const orgD = await orgR.json();
    const orgs = orgD.organizations || orgD.accounts || [];
    log('Org search: ' + orgs.length + ' results');
    if (orgs.length > 0) {
      log('  Org: ' + orgs[0].name + ' (ID: ' + orgs[0].id + ')');
      const pBody = { api_key: key, organization_ids: [orgs[0].id], page: 1, per_page: 5 };
      const pR = await fetch('https://api.apollo.io/v1/mixed_people/search', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(pBody) });
      const pD = await pR.json();
      const ppl = pD.people || [];
      log('People by org ID: ' + ppl.length + ' (Total: ' + (pD.pagination?.total_entries ?? 'n/a') + ')');
      ppl.slice(0, 3).forEach((p, i) => log('  [' + i + '] ' + (p.first_name||'') + ' ' + (p.last_name||'') + ' â€” ' + (p.title||'no title')));
    }
  } catch (e) { log('FAILED: ' + e.message); }

  log('\nâœ… Diagnostic complete. Check which strategies returned people.');
}

async function fetchDiscoveryContacts(brand, safeId, nilResult) {
  const apolloKey = STATE.settings.apolloKey;
  const container = document.getElementById(`apollo-contacts-${safeId}`);
  if (!container) return;

  if (!apolloKey) {
    container.innerHTML = `
      <div data-info-msg style="background:rgba(200,168,75,0.08);border:1px solid rgba(200,168,75,0.25);border-radius:var(--radius);padding:14px;text-align:center;margin-bottom:12px">
        <div style="font-size:13px;font-weight:700;color:var(--gold);margin-bottom:4px">Apollo API Key Required</div>
        <div style="font-size:12px;color:var(--muted2);margin-bottom:10px">Add your Apollo key in Settings to pull real verified contacts.</div>
        <button onclick="showPanel('settings')" style="background:var(--gold);color:#000;border:none;border-radius:var(--radius);padding:7px 14px;font-size:11px;font-weight:800;cursor:pointer">GO TO SETTINGS â†’</button>
      </div>`;
    // Show ICP archetypes as fallback
    renderAiContacts(safeId, [], null, brand);
    return;
  }

  // Show loading state
  container.innerHTML = '<div style="text-align:center;padding:24px"><div class="spinner" style="margin:0 auto 10px"></div><div style="font-size:12px;color:var(--muted)">Finding contacts via Apollo...</div></div>';

  // Domain resolution â€” try website from discovery data, then derive from brand name
  const data = window._discoveryData?.[safeId];
  let domain = '';
  if (data && data.result && data.result.website) {
    domain = data.result.website.replace(/^https?:\/\//, '').replace(/^www\./, '').split('/')[0];
  }
  if (!domain) {
    // Common brand domain patterns
    domain = brand.toLowerCase().replace(/[^a-z0-9]/g, '') + '.com';
  }

  try {
    console.log('[Discovery] Apollo search for domain:', domain);
    const people = await apolloSearchPeople(domain, apolloKey);
    console.log('[Discovery] Apollo returned', people.length, 'contacts');
    if (people.length > 0) {
      renderApolloContacts(safeId, people, nilResult);
    } else {
      container.innerHTML = `<div data-info-msg style="font-size:11px;color:var(--muted2);padding:10px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:12px;text-align:center">Apollo returned 0 contacts for <strong>${domain}</strong>. All 5 search strategies exhausted.</div>`;
      renderAiContacts(safeId, [], null, brand);
    }
  } catch (e) {
    console.warn('[Discovery] Apollo error:', e.message);
    container.innerHTML = `<div data-info-msg style="font-size:11px;color:var(--gold);padding:10px;background:rgba(200,168,75,0.06);border:1px solid rgba(200,168,75,0.2);border-radius:var(--radius);margin-bottom:12px">
      <strong>Apollo:</strong> ${e.message}
      <button onclick="fetchDiscoveryContacts('${brand.replace(/'/g, "\\'")}','${safeId}',window._discoveryData?.['${safeId}']?.result||{})" style="background:var(--accent);color:#000;border:none;border-radius:4px;padding:3px 10px;font-size:10px;font-weight:700;cursor:pointer;margin-left:8px">â†» Retry</button>
    </div>`;
    renderAiContacts(safeId, [], e.message, brand);
  }
}

function renderApolloContacts(safeId, people, nilResult) {
  const container = document.getElementById(`apollo-contacts-${safeId}`);
  if (!container) return;

  const tabBtn = document.getElementById(`dtab-contacts-${safeId}`);
  if (tabBtn) tabBtn.innerHTML = `ğŸ‘¤ Contacts (${people.length})`;

  if (people.length === 0) {
    container.innerHTML = `<div style="color:var(--muted);font-size:12px;text-align:center;padding:20px">No contacts found on Apollo for this domain.</div>`;
    return;
  }

  const data = window._discoveryData?.[safeId];
  if (data) data.apolloContacts = people;

  // Score and sort contacts using the intent-aware scorer
  const accountId = data?.accountId || null;
  const scored = people.map(p => ({ ...p, ...contactRelevanceScore(p, accountId) })).sort((a, b) => b._score - a._score);
  const topTier = scored.filter(p => p._score >= 75).length;
  const midTier = scored.filter(p => p._score >= 55 && p._score < 75).length;

  container.innerHTML = `
    <div style="font-size:9px;color:var(--accent);font-family:'DM Mono',monospace;letter-spacing:0.08em;margin-bottom:6px;display:flex;align-items:center;gap:6px">
      <span style="width:6px;height:6px;border-radius:50%;background:var(--accent);display:inline-block"></span>
      LIVE FROM APOLLO Â· ${people.length} CONTACTS
    </div>
    <div style="display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap">
      ${topTier > 0 ? `<span style="font-size:10px;background:rgba(0,212,170,0.12);color:#00d4aa;padding:2px 8px;border-radius:4px;font-weight:700">${topTier} Decision Makers</span>` : ''}
      ${midTier > 0 ? `<span style="font-size:10px;background:rgba(200,168,75,0.12);color:#c8a84b;padding:2px 8px;border-radius:4px;font-weight:700">${midTier} Key Influencers</span>` : ''}
    </div>
    ${scored.slice(0, 12).map((p, i) => {
      const name = ((p.first_name || '') + ' ' + (p.last_name || '')).trim();
      const hasEmail = p.email && !p.email.includes('*') && p.email !== 'email_not_unlocked';
      const emailDisplay = hasEmail ? p.email : null;
      const linkedinUrl = p.linkedin_url || '';
      const tc = p._tierColor;
      const initials = ((p.first_name || '?')[0] + ((p.last_name || '')[0] || '')).toUpperCase();

      return `<div style="display:flex;align-items:flex-start;gap:12px;padding:12px;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:8px;border-left:3px solid ${tc}">
        <div style="width:36px;height:36px;border-radius:50%;background:${tc}18;border:1px solid ${tc}40;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:${tc};flex-shrink:0">${initials}</div>
        <div style="flex:1;min-width:0">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:2px">
            <span style="font-size:13px;font-weight:700;color:var(--text1)">${name}</span>
            <span style="font-size:9px;font-weight:700;padding:1px 6px;border-radius:3px;background:${tc}22;color:${tc};font-family:monospace">${p._score} Â· ${p._tier}</span>
            ${linkedinUrl ? `<a href="${linkedinUrl}" target="_blank" style="display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;border-radius:3px;background:#0077b5;text-decoration:none"><svg width="10" height="10" viewBox="0 0 24 24" fill="white"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>` : ''}
          </div>
          <div style="font-size:11px;color:var(--accent);font-family:'DM Mono',monospace;margin-bottom:3px">${(p.title || 'â€”').replace(/</g, '&lt;')}</div>
          <div style="font-size:10px;color:var(--muted2)">${p._why || ''}</div>
          ${emailDisplay ? `<div style="font-size:10px;color:var(--muted);margin-top:2px;font-family:monospace">âœ‰ ${emailDisplay}</div>` : ''}
        </div>
        <div style="display:flex;flex-direction:column;gap:5px;flex-shrink:0">
          <button onclick="routeContactEmail('${safeId}',${i},true)" style="background:var(--accent);color:#000;border:none;border-radius:var(--radius);padding:6px 11px;font-size:10px;font-weight:800;cursor:pointer;white-space:nowrap">DRAFT EMAIL</button>
          <button onclick="sendContactToComposer('${safeId}',${i})" style="background:var(--surface2);color:var(--text2);border:1px solid var(--border);border-radius:var(--radius);padding:5px 10px;font-size:9px;font-weight:700;cursor:pointer;white-space:nowrap">â†’ Composer</button>
        </div>
      </div>`;
    }).join('')}
  `;
}

function sendContactToComposer(safeId, contactIdx) {
  const data = window._discoveryData?.[safeId];
  if (!data || !data.apolloContacts) return;
  const p = data.apolloContacts[contactIdx];
  if (!p) return;
  const name = ((p.first_name || '') + ' ' + (p.last_name || '')).trim();
  const title = p.title || '';
  // Find matching account or create temp
  const brand = data.brand || '';
  const account = STATE.accounts.find(a => a.company.toLowerCase() === brand.toLowerCase());
  if (account) {
    composeForContact(account.id, name, title);
  } else {
    toast('Add this brand as an account first', 'info');
  }
}

function renderAiContacts(safeId, aiContacts, errorMsg, brandName) {
  const container = document.getElementById(`apollo-contacts-${safeId}`);
  if (!container) return;
  const archetypes = ICP_BUYER_ARCHETYPES;

  // Preserve any error/info messages at the top of the container
  const existingMessages = container.querySelectorAll('[data-info-msg]');
  let preservedHtml = '';
  existingMessages.forEach(el => preservedHtml += el.outerHTML);

  const header = `
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
      <div style="font-size:11px;font-weight:800;color:var(--muted2);text-transform:uppercase;letter-spacing:0.08em">ICP Buyer Archetypes</div>
      <button onclick="promptAddContact('${safeId}')" style="background:var(--accent);color:#000;border:none;border-radius:6px;padding:5px 12px;font-size:11px;font-weight:700;cursor:pointer">+ Add Contact</button>
    </div>
    <div style="font-size:9px;color:var(--accent4);font-family:'DM Mono',monospace;letter-spacing:0.06em;margin-bottom:12px;display:flex;align-items:center;gap:6px">ğŸ’ FIND REAL CONTACTS AT ${(brandName||'').toUpperCase()}</div>`;

  // Build archetypes HTML
  const archetypesHtml = archetypes.map((a, i) => {
    const liUrl = `https://www.linkedin.com/search/results/people/?keywords=${encodeURIComponent(a.linkedinQuery)}&company=${encodeURIComponent(brandName||'')}&origin=GLOBAL_SEARCH_HEADER`;
    const apolloTitleParam = (a.apolloTitles || []).map(t => encodeURIComponent(t)).join('&person_titles[]=' );
    const apolloUrl = `https://app.apollo.io/#/people?q_organization_name=${encodeURIComponent(brandName||'')}&person_titles[]=${apolloTitleParam}`;
    return `<div style="display:flex;align-items:flex-start;gap:12px;padding:14px;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:8px;border-left:3px solid ${a.color}">
      <div style="width:36px;height:36px;border-radius:50%;background:${a.color}18;border:1px solid ${a.color}40;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0">${a.icon}</div>
      <div style="flex:1;min-width:0">
        <div style="font-size:14px;font-weight:700;color:var(--accent);margin-bottom:3px">${a.label}</div>
        <div style="font-size:10px;color:var(--muted2);font-family:'DM Mono',monospace;margin-bottom:6px">${a.titles}</div>
        <div style="font-size:12px;color:var(--muted2);line-height:1.5">${a.desc}</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;flex-shrink:0">
        <a href="${liUrl}" target="_blank" style="background:#0077b5;color:white;border:none;border-radius:var(--radius);padding:6px 12px;font-size:10px;font-weight:700;cursor:pointer;white-space:nowrap;text-decoration:none;text-align:center;display:flex;align-items:center;gap:4px"><svg width="11" height="11" viewBox="0 0 24 24" fill="white"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg> LinkedIn</a>
        <a href="${apolloUrl}" target="_blank" style="background:rgba(245,158,11,0.15);color:#f59e0b;border:1px solid rgba(245,158,11,0.3);border-radius:var(--radius);padding:6px 12px;font-size:10px;font-weight:700;cursor:pointer;white-space:nowrap;text-decoration:none;text-align:center">ğŸ¯ Apollo</a>
        <button onclick="routeContactEmail('${safeId}',${i},false)" style="background:var(--surface2);color:var(--text1);border:1px solid var(--border);border-radius:var(--radius);padding:6px 11px;font-size:10px;font-weight:800;cursor:pointer;white-space:nowrap">DRAFT EMAIL</button>
      </div>
    </div>`;
  }).join('');

  // Set container with preserved messages + header + archetypes
  container.innerHTML = preservedHtml + header + archetypesHtml;
}

function promptAddContact(safeId) {
  const data = window._discoveryData?.[safeId];
  const brand = data ? data.brand : '';
  window.open(`https://www.linkedin.com/search/results/people/?keywords=${encodeURIComponent(brand)}&origin=GLOBAL_SEARCH_HEADER`, '_blank');
  toast('Opening LinkedIn to find contacts', 'info', 2500);
}

function showDiscTab(safeId, tab) {
  ['fit','contacts','email'].forEach(t => {
    const panel = document.getElementById(`disc-tab-${t}-${safeId}`);
    const btn = document.getElementById(`dtab-${t}-${safeId}`);
    if (panel) panel.style.display = t===tab ? 'block' : 'none';
    if (btn) {
      btn.style.background = t===tab ? 'var(--accent)' : 'var(--surface2)';
      btn.style.color = t===tab ? '#000' : 'var(--text2)';
    }
  });
}

function routeContactEmail(safeId, contactIdx, isApollo) {
  showDiscTab(safeId, 'email');
  const data = window._discoveryData?.[safeId];
  if (!data) return;

  let name, title, email, linkedin;
  if (isApollo && data.apolloContacts) {
    const p = data.apolloContacts[contactIdx];
    if (!p) return;
    name = `${p.first_name||''} ${p.last_name||''}`.trim();
    title = p.title || '';
    email = (p.email && !p.email.includes('*')) ? p.email : null;
    linkedin = p.linkedin_url || null;
  } else {
    const c = data.result.suggested_contacts?.[contactIdx];
    if (c) { name = c.name; title = c.title; }
    else if (typeof ICP_BUYER_ARCHETYPES !== 'undefined' && ICP_BUYER_ARCHETYPES[contactIdx]) {
      const arch = ICP_BUYER_ARCHETYPES[contactIdx];
      title = arch.titles.split(' Â· ')[0]; name = arch.label;
    } else { title = 'Decision Maker'; name = 'Contact'; }
  }

  // Update the To: field in the email preview
  const emailBox = document.getElementById(`disc-email-${safeId}`);
  if (emailBox) {
    const toSpan = emailBox.querySelector('[data-to-field]');
    if (toSpan) {
      toSpan.textContent = email ? `${name} <${email}>` : `${name} â€” ${title}`;
      toSpan.style.color = email ? 'var(--accent)' : 'var(--gold)';
    }
  }

  // Also personalize email body â€” replace generic opener with name
  const bodyEl = document.getElementById(`disc-email-body-${safeId}`);
  if (bodyEl && name) {
    let body = bodyEl.innerText || bodyEl.textContent;
    // Try to inject name at start
    if (!body.startsWith(`Hi ${name.split(' ')[0]}`)) {
      bodyEl.innerText = `Hi ${name.split(' ')[0]},

` + body.replace(/^hi\s+\w+\W{0,3}/i, '');
    }
  }

  const msg = email
    ? `Routed to ${name} Â· ${email}`
    : linkedin
      ? `Routed to ${name} Â· LinkedIn found`
      : `Routed to ${name} Â· ${title}`;
  toast(msg, 'success', 3000);
}

function copyDiscoveryEmail(safeId) {
  const data = window._discoveryData?.[safeId];
  const email = data?.result?.cold_email;
  if (!email) return;
  const sigPlain = '\n\nRyan Wolpe\nSenior Director, Brand Partnerships\nOffice: 317.612.4510 | Cell: 317.612.4510\nwww.opendorse.com\n\nTIME100 Most Influential Companies';
  const plain = `Subject: ${email.subject}\n\n${email.body}${sigPlain}`;

  // Rich HTML for Outlook paste
  const richHtml = `<!DOCTYPE html><html><body style="font-family:Calibri,Arial,sans-serif;font-size:11pt;color:#1a1a1a;margin:20px">
    <p style="white-space:pre-wrap">${(email.body||'').replace(/\n/g,'<br>')}</p>
    <br><div style="border-top:1px solid #e1dfdd;padding-top:12px;font-family:Calibri,Arial,sans-serif;font-size:10pt;color:#333;line-height:1.5">
    <strong style="font-size:11pt;color:#1a1a1a">Ryan Wolpe</strong><br>
    Senior Director, Brand Partnerships<br>
    Office: 317.612.4510 | Cell: 317.612.4510<br>
    <a href="http://www.opendorse.com" style="color:#0078d4">www.opendorse.com</a>
    </div></body></html>`;

  const btn = document.querySelector(`#disc-email-${safeId}`).querySelector('button');
  if (navigator.clipboard && window.ClipboardItem) {
    navigator.clipboard.write([new ClipboardItem({'text/html': new Blob([richHtml],{type:'text/html'})})]).then(()=>{
      toast('Copied â€” paste into Outlook', 'success');
    }).catch(()=>{
      const el=document.createElement('div');el.contentEditable=true;el.innerHTML=richHtml;el.style.cssText='position:fixed;opacity:0;top:0;left:0';document.body.appendChild(el);
      const r=document.createRange();r.selectNodeContents(el);window.getSelection().removeAllRanges();window.getSelection().addRange(r);
      document.execCommand('copy');document.body.removeChild(el);
      toast('Copied â€” paste into Outlook', 'success');
    });
  } else {
    const el=document.createElement('textarea');el.value=plain;el.style.cssText='position:fixed;opacity:0';document.body.appendChild(el);el.select();document.execCommand('copy');document.body.removeChild(el);
    toast('Copied (plain text)', 'success');
  }
}

function editDiscoveryEmail(safeId) {
  const bodyEl = document.getElementById(`disc-email-body-${safeId}`);
  if (!bodyEl) return;
  if (bodyEl.contentEditable === 'true') {
    bodyEl.contentEditable = 'false';
    bodyEl.style.background = '';
    bodyEl.style.border = '';
    toast('Email saved', 'success');
  } else {
    bodyEl.contentEditable = 'true';
    bodyEl.style.background = 'rgba(0,212,170,0.04)';
    bodyEl.style.border = '1px solid var(--accent)';
    bodyEl.style.borderRadius = '4px';
    bodyEl.style.padding = '8px';
    bodyEl.focus();
    toast('Email is now editable â€” click Edit again to save', 'info');
  }
}

async function batchScore() {
  const text = document.getElementById('batch-brands').value.trim();
  let brands = text.split('\n').map(b=>b.trim()).filter(b=>b.length>0).slice(0,20);
  if (brands.length===0) { toast('Enter at least one brand','error'); return; }
  const blockedBrands = brands.filter(b=>isOffLimits(b));
  brands = brands.filter(b=>!isOffLimits(b));
  if (blockedBrands.length>0) toast(`â›” Removed ${blockedBrands.length} off-limits brands: ${blockedBrands.slice(0,3).join(', ')}`, 'error', 5000);
  if (brands.length===0) { toast('All brands are off-limits','error'); return; }
  const key = STATE.settings.claudeKey || document.getElementById('claude-key').value;
  if (!key) { toast('Add Anthropic API key in Settings','error'); return; }

  const results = document.getElementById('discovery-results');
  results.innerHTML='<div style="text-align:center;padding:40px"><div class="spinner" style="margin:0 auto 12px"></div><div style="color:var(--muted)">Scoring '+brands.length+' brands...</div></div>';

  try {
    const response = await fetch('https://corsproxy.io/?https://api.anthropic.com/v1/messages', {
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':key,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
      body:JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:2000,
        messages:[{role:'user',content:`You are a NIL strategist at Opendorse, which connects brands with college athletes for NIL partnerships and Gen Z marketing.

Score each brand for NIL fit. Return ONLY a JSON array, no other text:

Brands: ${brands.join(', ')}

Return format:
[{"brand":"name","nil_score":75,"vertical":"DTC Apparel","priority":"high","recommend":true,"one_liner":"Why this brand fits â€” specific, 10 words max"},...]

Be honest. Low scores for irrelevant or oversaturated brands.`}]
      })
    });
    const data = await response.json();
    const text2 = data.content?.[0]?.text||'[]';
    const cleaned = text2.replace(/```json|```/g,'').trim();
    const scored = JSON.parse(cleaned);
    scored.sort((a,b)=>b.nil_score-a.nil_score);

    results.innerHTML=`<div style="margin-bottom:12px;font-size:12px;color:var(--muted)">Ranked ${scored.length} brands by NIL fit</div>`+
      scored.map((r,i)=>{
        const color = r.nil_score>=75?'var(--green)':r.nil_score>=50?'var(--gold)':'var(--muted)';
        return `<div style="display:flex;align-items:center;gap:12px;padding:12px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:8px">
          <div style="font-family:'Syne',sans-serif;font-size:20px;font-weight:800;color:${color};width:36px;text-align:center">${r.nil_score}</div>
          <div style="flex:1">
            <div style="font-weight:700;font-size:14px">${r.brand}</div>
            <div style="font-size:12px;color:var(--muted2)">${r.one_liner||''}</div>
          </div>
          <span class="badge badge-muted">${r.vertical||''}</span>
          ${r.recommend?`<button class="btn btn-xs btn-primary" onclick="addDiscoveredBrand('${r.brand}','${r.vertical||'Other'}','${r.priority||'medium'}',${r.nil_score})">Add</button>`:''}
        </div>`;
      }).join('');
  } catch(e) {
    results.innerHTML=`<div style="color:var(--red);padding:20px">Batch scoring error: ${e.message}</div>`;
  }
}

function addDiscoveredBrand(company, vertical, priority, nilScore) {
  const exists = STATE.accounts.find(a=>a.company.toLowerCase()===company.toLowerCase());
  if (exists) { toast(`${company} already in accounts`,'error'); return; }
  STATE.accounts.push({
    id:Date.now()+Math.random(),
    company,vertical,priority,
    territory:'National',
    status:'not_contacted',
    notes:`Discovery score: NIL fit ${nilScore}/99. Added from brand discovery.`,
    touchCount:0,lastTouch:null,
    createdAt:new Date().toISOString()
  });
  saveState();
  updateDashboard();
  toast(`${company} added to accounts`,'success');
}

function clearDiscovery() {
  document.getElementById('discovery-results').innerHTML='<div class="empty-state" style="padding:40px"><span class="empty-icon">ğŸ†</span><h3>Cleared</h3></div>';
  STATE.discoveryResults=[];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveSettings() {
  STATE.settings.apolloKey = document.getElementById('apollo-key').value.trim();
  STATE.settings.claudeKey = document.getElementById('claude-key').value.trim();
  // Save keys in a separate resilient store so they survive any app resets
  try {
    localStorage.setItem('od_hub_keys', JSON.stringify({
      apolloKey: STATE.settings.apolloKey,
      claudeKey: STATE.settings.claudeKey
    }));
  } catch(e) {}
  saveState();
  toast('Settings saved','success');
}

function exportData() {
  const now = new Date();
  const stamp = now.toISOString().split('T')[0];
  const data = JSON.stringify({
    exported: now.toISOString(),
    user: 'Ryan Wolpe',
    accounts: STATE.accounts,
    signals: STATE.signals,
    outreachLog: STATE.outreachLog
  }, null, 2);
  const blob = new Blob([data],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href=url;
  a.download=`od-sales-hub-${stamp}.json`;
  a.click();
  URL.revokeObjectURL(url);
  toast(`Exported ${STATE.accounts.length} accounts + ${STATE.signals.length} signals`, 'success');
}

function clearAllData() {
  if (!confirm('Delete all accounts, signals, and settings? This cannot be undone.')) return;
  STATE.accounts=[];STATE.signals=[];STATE.discoveryResults=[];STATE.outreachLog={};
  localStorage.removeItem('od_sales_hub');
  renderAccountsTable();updateDashboard();renderKanban();renderSignalsList();
  toast('All data cleared','info');
}

function resetToCSV() {
  if (!confirm('Reset all 241 accounts from your original CSV? This will clear any status changes and notes you have made.')) return;
  STATE.accounts = RYAN_ACCOUNTS_CSV.map(a=>({...a, touchCount:0, lastTouch:null, contacts:[]}));
  STATE.signals=[];STATE.outreachLog={};
  saveState();
  renderAccountsTable();updateDashboard();renderKanban();renderSignalsList();updateComposerSelect();
  toast(`Reset to ${STATE.accounts.length} original CSV accounts`,'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }

// Close modal on backdrop click
document.querySelectorAll('.modal-overlay').forEach(el=>{
  el.addEventListener('click',e=>{ if(e.target===el) el.classList.remove('open'); });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function seedSignals() {
  if (STATE.signals.length > 0) return;
  const seeds = [
    { company:'Celsius', type:'funding', title:'Celsius Energy Drink expands NIL partnership program', strength:92 },
    { company:'Crocs', type:'campaign', title:'Crocs launches creator collab with college athletes', strength:88 },
    { company:'Fabletics', type:'campaign', title:'Fabletics ramps up Gen Z athlete ambassador search', strength:85 },
    { company:'GoPro', type:'campaign', title:'GoPro activates athlete content creators for spring push', strength:81 },
    { company:'Panda Express', type:'nil', title:'Panda Express signs multi-athlete NIL deal for NCAA season', strength:79 },
    { company:'Raising Cane\'s', type:'funding', title:"Raising Cane's expands campus marketing footprint", strength:76 },
    { company:'Ridge Wallet', type:'campaign', title:'Ridge Wallet targets college-age men with athlete content', strength:74 },
    { company:'GHOST', type:'campaign', title:'GHOST Energy signs athlete influencers ahead of summer', strength:72 },
    { company:'Topps', type:'nil', title:'Topps/Fanatics launches NIL trading card program', strength:70 },
    { company:'Vuori', type:'campaign', title:'Vuori accelerates influencer strategy with collegiate push', strength:68 },
  ];
  const now = Date.now();
  seeds.forEach((s, i) => {
    const acct = STATE.accounts.find(a => a.company === s.company);
    const signal = {
      id: 'seed_' + i,
      accountId: acct ? acct.id : null,
      accountName: s.company,
      company: s.company,
      type: s.type,
      title: s.title,
      desc: 'Intent signal detected from public sources',
      strength: signalStrength(s.type, s.title, 'Intent signal detected from public sources', 'general', null),
      url: '#',
      date: new Date(now - i * 3600000 * 4).toISOString(),
      seeded: true,
      intent_cluster_id: null
    };
    // Assign to cluster
    if (signal.accountId) {
      assignSignalToCluster(signal);
    }
    STATE.signals.push(signal);
  });
}

function init() {
  initDate();
  scheduleTop15Refresh();
  loadState();
  seedSignals();
  rebuildAllClusters();  // Ensure all signals have cluster assignments
  updateDashboard();
  renderKanban();
  renderSignalsList();
  updateComposerSelect();

  // Save synced accounts back (loadState already handled the merge)
  saveState();
  renderFollowUpQueue();
  toast(`âœ… ${STATE.accounts.length} accounts loaded â€” ${STATE.accounts.filter(a=>a.bucket==='brand_draft').length} Brand Draft Â· ${STATE.accounts.filter(a=>a.bucket==='prospecting').length} Prospecting`, 'success', 4000);
}

init();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ICP BUYER ARCHETYPES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ICP_BUYER_ARCHETYPES = [
  { icon:'ğŸ’¼', label:'Marketing', color:'var(--accent)', titles:'VP Marketing Â· Head of Marketing Â· CMO Â· Director of Marketing Â· SVP Marketing Â· Brand Marketing', desc:'Owns brand strategy, campaigns, and sponsorship budgets. Primary decision-maker for NIL activations.', linkedinQuery:'VP Marketing OR "Head of Marketing" OR CMO OR "Director of Marketing"', apolloTitles:['VP Marketing','Head of Marketing','CMO','Director of Marketing','SVP Marketing','Brand Marketing'] },
  { icon:'ğŸ‘”', label:'Executive', color:'var(--accent4)', titles:'CEO Â· President Â· COO Â· Founder Â· Managing Director Â· General Manager Â· Chief Brand Officer', desc:'Signs off on large partnerships. Engage for high-value deals or when marketing champion needs executive buy-in.', linkedinQuery:'CEO OR President OR COO OR Founder OR "Chief Brand Officer"', apolloTitles:['CEO','President','COO','Founder','Managing Director','Chief Brand Officer'] },
  { icon:'ğŸ“±', label:'Media & Social', color:'var(--accent2)', titles:'Head of Social Â· Director of Content Â· VP Digital Â· Social Media Manager Â· Content Director', desc:'Drives social and content strategy. Key ally for athlete content integration and social amplification.', linkedinQuery:'"Head of Social" OR "Director of Content" OR "Social Media Manager" OR "VP Digital"', apolloTitles:['Head of Social','Director of Content','VP Digital','Social Media Manager','Content Director'] },
  { icon:'ğŸ¤', label:'Partnerships', color:'var(--accent3)', titles:'Head of Partnerships Â· Director of Brand Partnerships Â· VP Partnerships Â· Sponsorship Â· Business Development', desc:'Manages external brand deals day-to-day. Often the closest contact to NIL and sponsorship execution.', linkedinQuery:'"Head of Partnerships" OR "Director of Partnerships" OR "VP Partnerships" OR Sponsorship', apolloTitles:['Head of Partnerships','Director of Brand Partnerships','VP Partnerships','Sponsorship','Business Development'] },
  { icon:'â­', label:'Influencer & Creator', color:'var(--gold)', titles:'Influencer Marketing Â· Head of Influencer Â· Creator Partnerships Â· Athlete Marketing Â· Ambassador Program', desc:'Runs athlete and creator programs. Direct buyer for NIL deals â€” knows the space and controls the roster.', linkedinQuery:'"Influencer Marketing" OR "Creator Partnerships" OR "Athlete Marketing" OR Ambassador', apolloTitles:['Influencer Marketing','Head of Influencer','Creator Partnerships','Athlete Marketing','Ambassador'] },
];

function renderComposerICP() {
  const acctId = document.getElementById('composer-account-select').value;
  const account = acctId ? STATE.accounts.find(a => a.id == acctId) : null;
  const company = account ? account.company : '';
  const companySpan = document.getElementById('composer-icp-company');
  const listEl = document.getElementById('composer-icp-list');
  if (!listEl) return;
  if (companySpan) companySpan.textContent = company || 'your selected company';
  if (!company) { listEl.innerHTML = '<div style="font-size:12px;color:var(--muted);text-align:center;padding:12px">Select an account above to see buyer archetypes</div>'; return; }
  listEl.innerHTML = ICP_BUYER_ARCHETYPES.map((a, i) => {
    const liUrl = `https://www.linkedin.com/search/results/people/?keywords=${encodeURIComponent(a.linkedinQuery)}&company=${encodeURIComponent(company)}&origin=GLOBAL_SEARCH_HEADER`;
    const apolloTitleParam = (a.apolloTitles || []).map(t => encodeURIComponent(t)).join('&person_titles[]=');
    const apolloUrl = `https://app.apollo.io/#/people?q_organization_name=${encodeURIComponent(company)}&person_titles[]=${apolloTitleParam}`;
    const isFirst = i === 0;
    return `<div style="display:flex;align-items:center;gap:10px;padding:10px 12px;background:${isFirst?'rgba(0,212,170,0.08)':'var(--surface)'};border:1px solid ${isFirst?'rgba(0,212,170,0.25)':'var(--border)'};border-radius:8px;margin-bottom:6px;cursor:pointer;transition:all 0.15s" onclick="icpFillContact('${a.titles.split(' Â· ')[0]}','${a.label}')">
      <div style="font-size:16px;flex-shrink:0">${a.icon}</div>
      <div style="flex:1;min-width:0"><div style="font-size:12px;font-weight:700;color:var(--accent)">${a.label}</div><div style="font-size:10px;color:var(--muted2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${a.titles.split(' Â· ').slice(0,3).join(' Â· ')}</div></div>
      <a href="${liUrl}" target="_blank" onclick="event.stopPropagation()" style="display:flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:6px;background:#0077b5;flex-shrink:0;text-decoration:none"><svg width="13" height="13" viewBox="0 0 24 24" fill="white"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
      <a href="${apolloUrl}" target="_blank" onclick="event.stopPropagation()" style="display:flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:6px;background:#f59e0b;flex-shrink:0;text-decoration:none"><svg width="13" height="13" viewBox="0 0 24 24" fill="#000"><circle cx="12" cy="12" r="10" fill="none" stroke="#000" stroke-width="2.5"/><path d="M12 6v6l4 2" fill="none" stroke="#000" stroke-width="2.5" stroke-linecap="round"/></svg></a>
    </div>`;
  }).join('');
}

function icpFillContact(title, label) {
  const titleInput = document.getElementById('contact-title');
  const nameInput = document.getElementById('contact-name');
  if (titleInput) titleInput.value = title;
  if (nameInput) nameInput.focus();
  toast(`${label} â€” fill in the contact name, then Generate`, 'info', 2500);
}

function openLinkedInSearch() {
  const title = document.getElementById('contact-title').value.trim();
  const acctId = document.getElementById('composer-account-select').value;
  const account = STATE.accounts.find(a => a.id == acctId);
  const company = account ? account.company : '';
  if (!title && !company) { toast('Enter a contact title first', 'error'); return; }
  const url = `https://www.linkedin.com/search/results/people/?keywords=${encodeURIComponent(title + ' ' + company)}&origin=GLOBAL_SEARCH_HEADER`;
  window.open(url, '_blank');
}

function openApolloSearch() {
  const title = document.getElementById('contact-title').value.trim();
  const acctId = document.getElementById('composer-account-select').value;
  const account = STATE.accounts.find(a => a.id == acctId);
  const company = account ? account.company : '';
  if (!title && !company) { toast('Enter a contact title first', 'error'); return; }
  const url = `https://app.apollo.io/#/people?q_organization_name=${encodeURIComponent(company)}`;
  window.open(url, '_blank');
}
</script>
</body>
</html>
